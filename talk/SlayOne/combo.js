"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var CONST={ITEM_RESPAWN_TIME:20*45,PLAYER_RADIUS:0.55,WPN_SWITCH_TICKS:20,TRANSMUL:100,MAX_ARMOR:65,MOV_SPEED:0.2035,MAX_JUMP_VEC_LEN:0.21,ENERGY_REG_RATE:0.05,GRAVITY:0.066,MAX_HP_BASE:86,MIN_MAP_SIZE:8,MAX_MAP_SIZE:128,SPAWN_INVINCIBILITY:100,NO_SHOOT_AFTER_BLINK_TICKS:40,XP_FLAG_RETURN:30,START_ENERGY:10,PERC_CRYSTALS_TRANSFER_ON_ZOMBIE_DEATH:0.1,PERC_CRYSTALS_TRANSFER_ON_HUMAN_DEATH:0.4,ZOMBIE_CRYSTAL_BASE:25,ZOMBIE_BASE_DMG:25,ZOMBIE_BASE_HP:70,ZOMBIE_BASE_MOV_SPEED:0.125,ZOMBIE_BASE_HP_REG:0.035,CRYSTALS_PER_SOULS_LVL:100,UPG_OPTIONS_PRESENTED:5,HP_SEPERATOR_AMOUNT:50,MAX_CRYSTALS:1200,FLAME_DMG_PERIOD:5,PLAYER_RESPAWN_DELAY:150,CLAN_CREATION_GOLD_COST:1000,GAME_CREATION_GOLD_COST:100,EMOTE_DURATION:100,BUSH_VISION_RANGE:3};var CREATION_FREE_MAPS=[1,76];var TUTORIALS={1:{mapId:1,mapType:0}};var AUTH_LEVEL=Object.freeze({NONE:0,BOT:2,GUEST:4,PLAYER:6,MOD:8,MOD2:9,ADMIN:10});var MAP_TYPE=Object.freeze({DEATHMATCH:0,TEAM_DEATHMATCH:1,CTF:2,TOURNAMENT:3,TOURNAMENT_UNRANKED:4,ZOMBIE_COOP:5,CUSTOM_BUILD:6});var MAP_TYPE_SETTINGS=[];MAP_TYPE_SETTINGS[MAP_TYPE.DEATHMATCH]={id:MAP_TYPE.DEATHMATCH,zombies:true,souls:true,team:false,name:"Zombie Deathmatch",winningCondition:"souls",winningConditionLabel:"config.resource.soul.name",showTop3:true,ressourceIconName:"souls",langLabel:"config.mode.zdm.label"};MAP_TYPE_SETTINGS[MAP_TYPE.TEAM_DEATHMATCH]={id:MAP_TYPE.TEAM_DEATHMATCH,zombies:true,spawnZombiesUntil:20*60,extraSoulsOnKill:30,souls:true,team:true,name:"Team Deathmatch",winningConditionLabel:"config.resource.soul.name",langLabel:"config.mode.tdm.label",icon:"mode_team.png",unlockLevel:6};MAP_TYPE_SETTINGS[MAP_TYPE.CTF]={id:MAP_TYPE.CTF,zombies:false,team:true,name:"Capture The Flag",flag:true,langLabel:"config.mode.ctf.label",icon:"mode_flag.png",unlockLevel:3};MAP_TYPE_SETTINGS[MAP_TYPE.TOURNAMENT]={id:MAP_TYPE.TOURNAMENT,zombies:false,team:false,name:"Ranked Deathmatch",winningCondition:"elo",winningConditionLabel:"config.resource.score.name",ingameElo:true,showTop3:true,ressourceIconName:"star",langLabel:"config.mode.dm1.label",icon:"mode_ranked.png",unlockLevel:9};MAP_TYPE_SETTINGS[MAP_TYPE.TOURNAMENT_UNRANKED]={id:MAP_TYPE.TOURNAMENT_UNRANKED,zombies:false,team:false,name:"Normal Deathmatch",winningCondition:"elo",winningConditionLabel:"config.resource.score.name",ingameElo:true,showTop3:true,ressourceIconName:"star",langLabel:"config.mode.dm2.label"};MAP_TYPE_SETTINGS[MAP_TYPE.ZOMBIE_COOP]={id:MAP_TYPE.ZOMBIE_COOP,showTop3:true,showZombiesAndHumans:true,zombies:false,souls:true,team:false,coopZombieMode:true,convertTime:20*20,preConvertTime:10*20,convertPercentage:0.2,name:"Zombie Coop",winningConditionLabel:"config.resource.soul.name",ressourceIconName:"souls",langLabel:"config.mode.zc.label",zombieBaseHP:140,zombieHpRegeneration:0.10,zombieMovSpeed:CONST.MOV_SPEED*1.1,zombieLifesteal:0.2,zombieEnergyReg:0.06,humans_souls_per_sec:2,zombies_souls_per_sec:2,global_ammo_mod:0.5,skinBonus:true,humanBossThreshold:0.35,zombieBossThreshold:0.5,zombieBossTime:20*60*5};MAP_TYPE_SETTINGS[MAP_TYPE.CUSTOM_BUILD]={id:MAP_TYPE.CUSTOM_BUILD,customBuild:true,zombies:false,team:false,name:"Custom Build Deathmatch",winningCondition:"elo",winningConditionLabel:"config.resource.score.name",ingameElo:true,showTop3:true,ressourceIconName:"star",unlockLevel:12,langLabel:"config.mode.dm3.label"};var nbs=[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1},{x:-1,y:0},{x:1,y:1},{x:1,y:-1},{x:-1,y:1},{x:-1,y:-1},{x:0,y:2},{x:2,y:0},{x:0,y:-2},{x:-2,y:0},{x:1,y:2},{x:-1,y:-2},{x:-1,y:2},{x:-2,y:1},{x:-2,y:-1},{x:1,y:-2},{x:2,y:1},{x:2,y:-1},{x:-2,y:2},{x:-2,y:-2},{x:2,y:-2},{x:2,y:2},{x:-3,y:0},{x:0,y:3},{x:3,y:0},{x:0,y:-3},{x:1,y:3},{x:-3,y:-1},{x:3,y:-1},{x:-3,y:1},{x:1,y:-3},{x:3,y:1},{x:-1,y:-3},{x:-1,y:3},{x:3,y:2},{x:-3,y:2},{x:2,y:-3},{x:2,y:3},{x:3,y:-2},{x:-2,y:3},{x:-3,y:-2},{x:-2,y:-3},{x:-4,y:0},{x:4,y:0},{x:0,y:-4},{x:0,y:4},{x:-4,y:-1},{x:-1,y:-4},{x:-4,y:1},{x:1,y:-4},{x:4,y:1},{x:1,y:4},{x:4,y:-1},{x:-1,y:4},{x:-3,y:-3},{x:3,y:-3},{x:-3,y:3},{x:3,y:3},{x:-2,y:4},{x:-2,y:-4},{x:2,y:4},{x:4,y:-2},{x:-4,y:2},{x:-4,y:-2},{x:4,y:2},{x:2,y:-4},{x:3,y:4},{x:-4,y:-3},{x:-4,y:3},{x:5,y:0},{x:-5,y:0},{x:0,y:5},{x:4,y:-3},{x:0,y:-5},{x:-3,y:4},{x:4,y:3},{x:-3,y:-4},{x:3,y:-4},{x:-1,y:-5},{x:-1,y:5},{x:5,y:1},{x:5,y:-1},{x:1,y:-5},{x:1,y:5},{x:-5,y:-1},{x:-5,y:1},{x:-5,y:2},{x:5,y:-2},{x:-2,y:5},{x:2,y:-5},{x:-5,y:-2},{x:5,y:2},{x:2,y:5},{x:-2,y:-5},{x:4,y:-4},{x:-4,y:-4},{x:-4,y:4},{x:4,y:4},{x:-5,y:-3},{x:5,y:-3},{x:-5,y:3},{x:-3,y:-5},{x:-3,y:5},{x:3,y:5},{x:5,y:3},{x:3,y:-5},{x:0,y:-6},{x:-6,y:0},{x:6,y:0},{x:0,y:6},{x:-1,y:6},{x:-6,y:1},{x:6,y:1},{x:6,y:-1},{x:1,y:6},{x:1,y:-6},{x:-1,y:-6},{x:-6,y:-1},{x:6,y:2},{x:2,y:-6},{x:2,y:6},{x:-6,y:-2},{x:-6,y:2},{x:-2,y:6},{x:-2,y:-6},{x:6,y:-2},{x:-5,y:4},{x:5,y:4},{x:-4,y:-5},{x:4,y:5},{x:-4,y:5},{x:-5,y:-4},{x:5,y:-4},{x:4,y:-5},{x:6,y:3},{x:-6,y:3},{x:-3,y:6},{x:3,y:6},{x:3,y:-6},{x:-3,y:-6},{x:6,y:-3},{x:-6,y:-3},{x:-7,y:0},{x:7,y:0},{x:0,y:-7},{x:0,y:7},{x:-7,y:-1},{x:-1,y:-7},{x:1,y:-7},{x:7,y:1},{x:5,y:5},{x:5,y:-5},{x:1,y:7},{x:-1,y:7},{x:-5,y:-5},{x:-7,y:1},{x:-5,y:5},{x:7,y:-1},{x:-4,y:-6},{x:4,y:6},{x:6,y:4},{x:4,y:-6},{x:-6,y:-4},{x:6,y:-4},{x:-4,y:6},{x:-6,y:4},{x:-2,y:-7},{x:7,y:-2},{x:-7,y:2},{x:7,y:2},{x:2,y:7},{x:2,y:-7},{x:-2,y:7},{x:-7,y:-2},{x:3,y:7},{x:7,y:3},{x:-7,y:3},{x:-3,y:7},{x:-3,y:-7},{x:3,y:-7},{x:7,y:-3},{x:-7,y:-3},{x:-5,y:6},{x:-6,y:5},{x:5,y:-6},{x:6,y:5},{x:-6,y:-5},{x:-5,y:-6},{x:6,y:-5},{x:5,y:6},{x:4,y:7},{x:-7,y:4},{x:4,y:-7},{x:7,y:-4},{x:-4,y:-7},{x:7,y:4},{x:-4,y:7},{x:-7,y:-4},{x:6,y:6},{x:6,y:-6},{x:-6,y:6},{x:-6,y:-6},{x:7,y:5},{x:-5,y:-7},{x:5,y:7},{x:-7,y:5},{x:7,y:-5},{x:5,y:-7},{x:-5,y:7},{x:-7,y:-5},{x:-6,y:7},{x:6,y:7},{x:7,y:-6},{x:-7,y:6},{x:6,y:-7},{x:-6,y:-7},{x:7,y:6},{x:-7,y:-6},{x:-7,y:-7},{x:7,y:-7},{x:-7,y:7},{x:7,y:7}];var questTypes={ExplosiveExpert:{icon:'ExplosiveExpert',weapons:[1,4,6,7,10,11]},Braaains:{icon:'Braaains',weapons:[12]},LaserExpert:{icon:'LaserExpert',weapons:[0,5]},MinigunExpert:{icon:'MinigunExpert',weapons:[3]},RocketExpert:{icon:'RocketExpert',weapons:[4,6,7,10]},FlameExpert:{icon:'FlameExpert',weapons:[2]},RcExpert:{icon:'RcExpert',weapons:[7]},ShotgunExpert:{icon:'ShotgunExpert',weapons:[9]},SniperExpert:{icon:'SniperExpert',weapons:[8]},CloseRange:{icon:'CloseRange',weapons:[2,9]},FastAndSlow:{icon:'FastAndSlow',weapons:[3,8]},GrenadeExpert:{icon:'GrenadeExpert',weapons:[]}};var weapons=[{id:0,name:"Laser Gun",cooldown:17,dmg:28,projectileSpeed:0.75,lifetime:60,collision:true,dieOnCollision:true,addHeight:true,description:"A basic laser gun.",soundName:"LASER",volume:0.8,bouncePower:0.15,bounceSpeed:0.11,frame:0,isLaser:true,light:"light_blue",particle:"particleBlue",_r:58,_g:58,_b:230,selfImmuneTicks:2,img:"weapon_laser",ammoImgSmall:"ammoLaserSmall",projectileImg:"laserBlue",muzzleFlash:"muzzleFlashLaserBlue",muzzleFlashAnimationType:"row",directions:16,projectileScale:0.85,zombieStunTime:5},{id:1,name:"Grenade Launcher",cooldown:4,dmg:60,projectileSpeed:0.5,range:9.5,aoe:2.1,bounceBack:0.15,aoeCursor:true,collision:false,dieOnCollision:false,description:"A powerful weapon that launches explosive grenades. Grenades can be shot over small obstacles like crates.",ammoImg:"ammoGL",ammoImgSmall:"ammoGrenadeSmall",soundName:"GREANDE_LAUNCH",projectileImg:"grenade",isGrenade:true,impactSound:"EXPLODE",impactSoundVolume:1.0,ammoSize:8,clipSize:1,cooldown2:55,ammoMsg:"Picked up some grenade rounds",reload2Sound:"RELOAD_GL",frame:1,speedModifier:1.03,img:"weapon_gl"},{id:2,name:"Flamethrower",cooldown:2,dmg:4.0,dieOnCollision:true,projectileSpeed:0.45,lifetime:16,projectileSize:1.0,collision:false,addHeight:true,description:"A short range weapon, that can kill an enemy very fast.",bouncePower:0.15,bounceSpeed:0.15,recoil:0.2,flameDeath:true,ammoImg:"ammoFlame",ammoImgSmall:"ammoFlameSmall",ammoSize:100,ammoMsg:"Picked up some gas",clipSize:50,cooldown2:60,reload2Sound:"RELOAD_FLAME",frame:2,img:"weapon_flame",speedModifier:1.13,selfImmuneTicks:60,zombieStunTime:1,noTeleport:true},{id:3,name:"Minigun",cooldown:2,dmg:5.55,projectileSpeed:3.0,lifetime:20,collision:true,dieOnCollision:true,addHeight:true,description:"A strong, fast firing weapon.",bouncePower:0.15,bounceSpeed:0.19,soundName:"MG",volume:0.7,recoil:0.7,scattering:Math.PI*0.03,recoilTime:1,bounceBack:0.05,bounceBackTarget:0.05,normalProjectile:true,spawnBullets:true,frames:2,ammoImg:"ammoMG",ammoImgSmall:"ammoMGSmall",ammoSize:100,ammoMsg:"Picked up some minigun bullets",clipSize:50,cooldown2:60,reload2Sound:"RELOAD_MG",projectileImg:"projectile",directions:16,projectileScale:0.7,muzzleFlash:"muzzleFlashMG",frame:3,img:"weapon_mg",zombieStunTime:2},{id:4,name:"Rocket Launcher",cooldown:4,dmg:60,projectileSpeed:0.6,projectileSize:0.25,lifetime:130,aoe:2.3,soundName:"ROCKET_LAUNCH",volume:0.9,bounceStun:true,collision:true,dieOnCollision:true,description:"A powerful weapon that launches explosive rockets.",ammoImg:"ammoRL",ammoImgSmall:"ammoRocketSmall",ammoSize:8,recoilTime:6,clipSize:1,cooldown2:55,ammoMsg:"Picked up some rockets",reload2Sound:"RELOAD_RL",frame:5,isRocket:true,img:"weapon_rl",projectileImg:"rocket",selfImmuneTicks:3},{id:5,name:"Laser Gun R",cooldown:17,dmg:28,projectileSpeed:0.75,lifetime:100,collision:true,dieOnCollision:true,reflection:true,addHeight:true,description:"A laser gun that gets reflected from walls and obstacles.",soundName:"LASER",volume:0.8,bouncePower:0.15,bounceSpeed:0.11,frame:6,isLaser:true,light:"light_green",particle:"particleGreen",ammoImg:"ammoLaser",ammoImgSmall:"ammoLaser2Small",ammoSize:20,clipSize:999999,cooldown2:20,muzzleFlash:"muzzleFlashLaserGreen",muzzleFlashAnimationType:"row",ammoMsg:"Picked up a battery",reload2Sound:"LASER_RECHARGE",_r:60,_g:240,_b:40,projectileImg:"laserGreen",directions:16,projectileScale:0.85,selfImmuneTicks:1,img:"weapon_laser_r",zombieStunTime:5},{id:6,name:"Homing Launcher",cooldown:4,dmg:50,projectileSpeed:0.36,turnRadius:0.16,projectileSize:0.2,lifetime:250,aoe:1.9,soundName:"ROCKET_LAUNCH",volume:0.9,bounceStun:true,collision:true,dieOnCollision:true,description:"A powerful weapon that launches homing missiles.",ammoImg:"ammoHoming",ammoImgSmall:"ammoRocket2Small",ammoSize:7,recoilTime:6,clipSize:1,cooldown2:70,ammoMsg:"Picked up some homing missiles",reload2Sound:"RELOAD_RL_2",frame:7,isHeatSeeking:true,isRocket:true,img:"weapon_homing",projectileImg:"homingRocket",speedModifier:0.9,selfImmuneTicks:3},{id:7,name:"Remote Controlled Launcher",cooldown:4,dmg:58,projectileSpeed:0.39,turnRadius:0.20,projectileSize:0.2,lifetime:250,aoe:1.9,soundName:"ROCKET_LAUNCH",volume:0.9,bounceStun:true,collision:true,dieOnCollision:true,description:"A powerful weapon that launches homing missiles that follow your mouse cursor.",ammoImg:"ammoNapalm",ammoImgSmall:"ammoRocket3Small",ammoSize:7,recoilTime:6,clipSize:1,cooldown2:70,ammoMsg:"Picked up some homing missiles",reload2Sound:"RELOAD_RL_2",frame:11,isHeatSeeking2:true,isRocket:true,img:"weapon_homing_2",projectileImg:"homingRocket2",speedModifier:0.95,selfImmuneTicks:3},{id:8,name:"Sniper Rifle",cooldown:35,dmg:65,projectileSpeed:8.0,collision:true,dieOnCollision:true,addHeight:true,requiredStandTime:20,description:"A sniper rifle with high range and damage. You need to aim first by pressing and holding F before you can shoot.",lifetime:20,bouncePower:0.15,bounceSpeed:0.35,soundName:"SNIPER",volume:0.9,recoil:1.2,recoilTime:7,normalProjectile:true,muzzleFlash:"muzzleFlashMG",spawnBullets:true,bounceBackTarget:0.22,ammoImg:"ammoSniper",ammoImgSmall:"ammoSniperSmall",ammoSize:10,ammoMsg:"Picked up some sniper rounds",clipSize:5,cooldown2:70,hasLine:true,reload2Sound:"RELOAD_MG",frame:9,projectileImg:"projectile",directions:16,projectileScale:0.6,img:"weapon_sniper",isSniper:true,lastShotSound:"BING",speedModifier:1.1,zombieStunTime:10},{id:9,name:"Shotgun",cooldown:22,dmg:7,dmgLossPerRange:0.15,projectiles:7,scattering:Math.PI*0.09,projectileSpeed:3.0,lifetime:20,collision:true,dieOnCollision:true,addHeight:true,description:"The shotgun deals more damage, the closer you are to the target.",bouncePower:0.25,bounceSpeed:0.4,soundName:"SHOTGUN",volume:0.8,recoil:1.4,recoilTime:5,bounceBack:0.3,bounceBackTarget:0.05,normalProjectile:true,muzzleFlash:"muzzleFlashMG",spawnBullets:true,ammoImg:"ammoShotgun",ammoImgSmall:"ammoShotgunSmall",ammoSize:10,ammoMsg:"Picked up some shotgun shells",clipSize:5,cooldown2:55,reload2Sound:"SHOTGUN_RELOAD_LONG",frame:10,projectileImg:"projectile",directions:16,projectileScale:0.55,img:"weapon_shotgun",speedModifier:1.05,zombieStunTime:10},{id:10,name:"Rapid Rocket Launcher",cooldown:15,dmg:42,projectileSpeed:0.6,projectileSize:0.2,lifetime:130,aoe:1.45,soundName:"ROCKET_LAUNCH",volume:0.75,bounceStun:true,collision:true,dieOnCollision:true,description:"A rocket launcher with a high fire rate.",ammoImgSmall:"ammoRocketSmall",ammoSize:16,recoilTime:6,clipSize:8,cooldown2:60,ammoMsg:"Picked up some rockets",reload2Sound:"RELOAD_RL",frame:12,isRocket:true,img:"weapon_rapid_rl",projectileImg:"rocket",projectileScale:0.8,speedModifier:1.05,selfImmuneTicks:3},{id:11,name:"Rapid Grenade Launcher",cooldown:18,dmg:42,projectileSpeed:0.5,range:9.5,aoe:1.5,bounceBack:0.10,aoeCursor:true,collision:false,dieOnCollision:false,description:"A grenade launcher with high fire rate. Grenades can be shot over small obstacles like crates.",ammoImgSmall:"ammoGrenadeSmall",soundName:"GREANDE_LAUNCH",volume:0.88,projectileImg:"grenade",projectileScale:0.8,isGrenade:true,impactSound:"EXPLODE",impactSoundVolume:0.8,ammoSize:16,clipSize:8,cooldown2:60,ammoMsg:"Picked up some grenade rounds",reload2Sound:"RELOAD_GL",frame:13,speedModifier:1.05,img:"weapon_rapid_gl"},{id:12,name:"Zombie Melee",cooldown:16,dmg:30.0,dieOnCollision:true,projectileSpeed:0.30,lifetime:0,projectileSize:0.8,collision:true,addHeight:true,description:"Dangerous zombie melee claws.",bouncePower:0.15,bounceSpeed:0.11,recoil:0,noWeapon:true,soundName:"ZOMBIE_ATT",impactSound:"ZOMBIE_BITE",impactSoundVolume:0.8,ammoImgSmall:"blank",reload2Sound:"RELOAD_FLAME",img:"zombie_weapon",speedModifier:1.0,zombieStunTime:6,noTeleport:true,selfImmuneTicks:3,slowTicks:3,slowPerc:0.5,corpseLifesteal:20},{id:13,name:"Zombie Ranged",cooldown:20,dmg:44.0,dieOnCollision:true,projectileSpeed:0.45,lifetime:40,projectileSize:0.3,collision:true,addHeight:true,description:"Dangerous zombie poison.",bouncePower:0.15,bounceSpeed:0.11,recoil:0,noWeapon:true,soundName:"ZOMBIE_ATT",impactSound:"ZOMBIE_BITE",impactSoundVolume:0.8,ammoImgSmall:"blank",reload2Sound:"RELOAD_FLAME",img:"zombie_weapon",isZombieRangedWeapon:true,projectileScale:1.15,speedModifier:1.0,zombieStunTime:6,selfImmuneTicks:10,slowTicks:10,slowPerc:0.5},{id:14,name:"Zombie Boss Melee",cooldown:22,dmg:110,dieOnCollision:true,projectileSpeed:0.8,startAtOrigin:true,lifetime:1,projectileSize:1,collision:true,addHeight:true,description:"Dangerous zombie melee fists.",bouncePower:0.15,bounceSpeed:0.11,recoil:0,noWeapon:true,soundName:"ZOMBIE_BOSS_HIT",impactSound:"ZOMBIE_BOSS_HIT",poundSmokeSize:0.8,impactSoundVolume:0.8,ammoImgSmall:"blank",reload2Sound:"RELOAD_FLAME",img:"zombie_weapon",speedModifier:1.0,zombieStunTime:6,noTeleport:true,selfImmuneTicks:3,slowTicks:3,slowPerc:0.5},{id:15,name:"Heal Beam",dmg:-5.0,selfHeal:3.75,autoAimRange:3.0,heals:true,isBeam:true,dieOnCollision:true,projectileSpeed:10.5,soundName:"HEAL_WPN",friendly:true,beamRenderStartOffset:1.2,lifetime:5,cooldown:5,projectileSize:0.01,collision:true,addHeight:true,description:"A sweapon that heals you and your allies.",bouncePower:0,recoil:0.2,ammoImg:"ammoFlame",ammoImgSmall:"ammoHealSmall",ammoSize:100,ammoMsg:"Picked up some energy",clipSize:40,cooldown2:60,reload2Sound:"RELOAD_FLAME",frame:15,img:"weapon_heal",speedModifier:1.15,selfImmuneTicks:60,zombieStunTime:1,noTeleport:true,disableByBot:true,beamColor1:"rgba(93, 194, 57, 0.7)",beamWidth1:0.1,beamColor2:"rgba(126, 225, 92, 0.4)",beamWidth2:0.21,beamColor3:"rgba(160, 242, 131, 0.15)",beamWidth3:0.35,muzzleFlashParticle:"particleGreen"},{id:16,name:"Energy Rifle",cooldown:20,dmg:20,mode2Weapon:17,isBeam:true,isBeam2:true,projectileSpeed:30,projectileSize:0.2,muzzleFlashDisplayTime:4,beamRenderStartOffset:1.2,lifetime:8,fadeOutAt:4,collision:true,dieOnCollision:true,addHeight:true,description:"This weapon has two fire modes: a basic ray and an energy ball. If you hit the ball with the ray, you'll get a big explosion.",bouncePower:0.2,bounceSpeed:0.25,soundName:"ASMD1",expandRange:30,volume:0.55,recoil:1.2,recoilTime:5,bounceBack:0.2,bounceBackTarget:0.27,normalProjectile:true,ammoImg:"ammoMG",ammoImgSmall:"ammoASMDSmall",ammoSize:40,ammoMsg:"Picked up some energy",clipSize:20,cooldown2:60,reload2Sound:"ASMD_RELOAD",directions:16,muzzleFlash:"muzzleFlashMG",frame:14,img:"weapon_asmd",zombieStunTime:12,beamColor1:"rgba(255, 255, 255, 0.8)",beamWidth1:0.1,beamColor2:"rgba(255, 73, 41, 0.6)",beamWidth2:0.21,beamColor3:"rgba(135, 65, 54, 0.3)",beamWidth3:0.35,muzzleFlashParticle:"particleWhite",muzzleFlashLight2:"light_white",muzzleFlashLight:"light_red",hitLight1:"light_red",hitLight2:"light_white"},{id:17,dummyFor:16,name:"ASMD 2nd Mode",cooldown:20,dmg:45,comboDmg:100,projectileSpeed:0.35,projectileSize:0.28,projectileScale:1.45,bounceBack:0.2,lifetime:100,aoe:1.4,comboAoe:3.1,redExplosion:true,soundName:"ASMD_BALL_LAUNCH",impactSound:"ASMD_EXPLO_1",impactSoundCombo:"ASMD_EXPLO_2",volume:0.9,bounceStun:true,collision:true,dieOnCollision:true,description:"A powerful weapon that launches explosive rockets.",ammoImg:"ammoRL",ammoImgSmall:"ammoASMDSmall",ammoSize:40,recoilTime:6,clipSize:20,cooldown2:60,ammoMsg:"Picked up some energy",reload2Sound:"ASMD_RELOAD",frame:17,isRocket:true,img:"weapon_asmd",projectileImg:"fireballMedium",selfImmuneTicks:30,noWeapon:true,directions:1,noRocketEffects:true,glowLightImg:"light_red",flySound:"ASMD_FLY",projectileWiggle:true,spawnLight:"light_red"}];var weaponProto={get name(){return F_&&F_("weapons."+this.id+".name")||this.locales.name;},get description(){return F_&&F_("weapons."+this.id+".description")||this.locales.description;},get ammoMsg(){return F_&&F_("weapons."+this.id+".ammoMsg")||this.locales.ammoMsg;}};for(var i=0;i<weapons.length;i++){var src=weapons[i];src.id=i;if(typeof exports=='undefined'){var dist=Object.create(weaponProto);dist.locales={};for(var key in src){if(['name',"description","ammoMsg"].indexOf(key)>=0){dist.locales[key]=src[key];}else{dist[key]=src[key];}}weapons[i]=dist;}}var itemTypes=[{name:"Medikit",pickupMsg:"Picked up a medikit",hpRestored:50,pickupSound:"HEAL",img:"medikit",scale:0.55,shine:true},{name:"Armor",pickupMsg:"Picked up armor",armorRestored:CONST.MAX_ARMOR,pickupSound:"ARMOR",img:"armor",scale:0.55,shine:true},{name:"Red Flag",pickupSound:"ARMOR",img:"redFlag",special:"redFlag",respawnPeriod:-1},{name:"Blue Flag",pickupSound:"ARMOR",img:"blueFlag",special:"blueFlag",respawnPeriod:-1}];var itemTypeProto={get name(){return F_&&F_("itemTypes."+this.id+".name")||this.locales.name;},get pickupMsg(){return F_&&F_("itemTypes."+this.id+".pickupMsg")||this.locales.pickupMsg;}};for(var i=0;i<itemTypes.length;i++){var src=itemTypes[i];src.id=i;if(typeof exports=='undefined'){var dist=Object.create(itemTypeProto);dist.locales={};for(var key in src){if(['name',"pickupMsg"].indexOf(key)>=0){dist.locales[key]=src[key];}else{dist[key]=src[key];}}itemTypes[i]=dist;}}var hero={"0":"1;1,0,0,0;1,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;4;4;0;2;0;0;0;0;0;0;0;0;0","1":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;1,0,0;0,0;0,0,0,0;0,0,0,0;0,0;1;7;0;0;3;0;0;0;0;0;0;0;0","2":"1;0,0,0,0;0,0,0,0;1,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;3;3;5;0;0;0;0;0;0;0;0;0;0","3":"1;0,0,0,0;1,1,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;1,1,0,0;0,0,0,0;0,0;2;0;0;5;1;0;0;0;0;0;0;0;0","4":"1;0,0,0,0;0,0,0,0;0,0;1,3;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;0;7;0;0;1;0;0;0;0;0;0;0","5":"1;0,0,0,0;1,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;2;3;0;5;1;0;0;0;0;0;0;0;0","6":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;1,0,2,3;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;2;2;0;2;0;0;0;0;0;0;0;0;0","7":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;1,3,3,3;0,0;0;0;0;2;0;0;0;0;0;0;0;0;0","8":"1;1,0,0,0;1,1,2,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;0;3;4;0;0;0;0;0;0;0;0;0","9":"1;0,0,0,0;0,0,0,0;0,0;0,0;1,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;1,0;0;0;5;0;5;0;0;0;0;0;0;0;0","10":"1;0,0,0,0;0,0,0,0;0,0;0,0;1,0;0,0,0,0;1,0,1;0,0;0,0,0,0;0,0,0,0;0,0;5;0;0;4;0;0;0;0;0;0;0;0;0","11":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;1,0,0;0,0;0,0,0,0;0,0,0,0;0,0;1;10;0;0;0;0;0;0;0;0;0;0;0","12":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;3;8;0;0;1;0;0;0;0;0;0;0","13":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;1,0;0;4;4;2;0;1;0;0;0;0;0;0;0","14":"1;0,0,0,0;0,0,0,0;0,0;1,2;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;1;7;0;0;1;0;0;0;0;0;0;0;0","15":"1;0,0,0,0;1,3,0,1;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;0;0;5;2;0;0;0;0;0;0;0;0","16":"1;0,0,0,0;0,0,0,0;1,0;0,0;1,3;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;3;4;0;0;0;0;0;0;0;0;0;0;0","17":"1;0,0,0,0;0,0,0,0;0,0;1,1;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;2;6;0;1;0;1;0;0;0;0;0;0;0","22":"1;1,0,0,3;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;8;0;0;0;0;0;0;0;0;0;0;0;0","23":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;1,1,0;0,0;0,0,0,0;0,0,0,0;0,0;0;0;5;5;0;0;0;0;0;0;0;0;0","24":"1;1,3,0,1;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;7;0;0;0;0;0;0;0;0;0;0;0","25":"1;0,0,0,0;0,0,0,0;1,0;0,0;0,0;0,0,0,0;0,0,0;0,0;1,3,1,0;0,0,0,0;0,0;4;1;0;1;0;0;0;0;0;0;0;0;0","27":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;1,1;2;6;1;0;0;1;0;0;0;0;0;0;0","28":"1;0,0,0,0;0,0,0,0;0,0;0,0;1,3;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;0;0;4;4;0;0;0;0;0;0;0;0","29":"1;0,0,0,0;0,0,0,0;0,0;1,1;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;1;5;0;0;4;0;0;0;0;0;0;0;0","30":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;1;3;7;0;0;1;0;0;0;0;0;0;0","31":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;1,3;0,0,0,0;0,0,0,0;0,0;0;4;0;3;1;0;0;0;0;0;0;0;0","32":"1;1,1,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;5;4;0;0;0;1;0;0;0;0;0;0;0","33":"1;0,0,0,0;0,0,0,0;0,0;0,0;1,1;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;4;4;0;2;0;0;0;0;0;0;0;0","34":"1;1,2,0,0;0,0,0,0;1,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;2;2;0;4;0;0;0;0;0;0;0;0;0","36":"1;0,0,0,0;0,0,0,0;1,2;1,1;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;0;0;7;0;0;0;0;0;0;0;0;0","37":"1;0,0,0,0;0,0,0,0;0,0;1,1;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;10;0;0;0;0;0;0;0;0;0;0;0","41":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;5;1;5;0;0;1;0;0;0;0;0;0;0","42":"1;0,0,0,0;0,0,0,0;1,2;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;0;0;9;0;0;0;0;0;0;0;0;0","43":"1;0,0,0,0;0,0,0,0;1,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;3;8;0;0;0;0;0;0;0;0;0;0;0","44":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;7;4;0;0;1;0;0;0;0;0;0;0","64":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;1,2,0;0,0;0,0,0,0;0,0,0,0;0,0;2;5;0;2;0;0;0;0;0;0;0;0;0","65":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;1,0;6;5;0;0;0;0;0;0;0;0;0;0;0","66":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;1,0,0,0;0,0,0,0;1,0;4;4;0;2;0;0;0;0;0;0;0;0;0","69":"1;0,0,0,0;1,3,3,2;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;0;0;0;3;0;0;0;0;0;0;0;0;0","73":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;1,2,0,2;0,0,0,0;0,0;2;0;0;5;0;0;0;0;0;0;0;0;0","76":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;1,3;0,0,0,0;0,0,0,0;0,0;0;4;4;0;0;0;0;0;0;0;0;0;0","77":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;1;7;3;0;0;1;0;0;0;0;0;0;0","78":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;1,0,1;0,0;0,0,0,0;0,0,0,0;0,0;0;5;5;0;0;0;0;0;0;0;0;0;0","79":"1;0,0,0,0;0,0,0,0;0,0;0,0;0,0;0,0,0,0;0,0,0;0,0;0,0,0,0;0,0,0,0;0,0;3;0;8;0;0;1;0;0;0;0;0;0;0"};var objects={healaura:{name:"Heal Aura",img:["healWard","healWard2"],animationType:"auto",hpPerTick:0.3,aoe:3.5,hp:100,lifetime:20*45,pathing:5,turretsDontShootMe:true,showLifeTimeBar:true,barYOffset:2.0},wall:{name:"Wall",img:["block","block2","block3"],animationType:"dmg",lifetime:20*180,noTeamLifetime:20*90,hp:120,pathing:5,yOffset:4,noBars:true,turretsDontShootMe:true,healthBarW:16},autoturret:{name:"Auto Turret",lifetime:20*120,hp:115,aoe:9,weapon:weapons[3],img:["autoTurretBase"],animation:"autoturret",weaponCooldown:2,pathing:5,dmg:2.25,spawnSound:"TURRET_INIT",volume:0.5,initTicks:40,rotateSpeed:0.1,imgScale:1.1},laserturret:{name:"Laser Turret",lifetime:20*120,hp:115,aoe:9,bounce:0.01,weapon:weapons[0],img:["autoTurretBase"],animation:"laserturret",weaponCooldown:19,pathing:5,dmg:28,spawnSound:"TURRET_INIT",volume:0.5,initTicks:40,rotateSpeed:0.1,imgScale:1.1},missileturret:{name:"Missile Turret",lifetime:20*120,hp:115,weapon:weapons[4],aoe:8.5,radius:2.3,img:["autoTurretBase"],animation:"missileturret",weaponCooldown:57,pathing:5,dmg:55,spawnSound:"TURRET_INIT",volume:0.5,initTicks:40,rotateSpeed:0.09,imgScale:1.1},grenadeturret:{name:"Grenade Turret",radius:2.2,maxRangeBonus:1.5,lifetime:20*120,hp:90,weapon:weapons[1],aoe:7.5,img:["autoTurretBase"],animation:"grenadeturret",weaponCooldown:65,pathing:5,dmg:50,spawnSound:"TURRET_INIT",volume:0.5,initTicks:40,raytraceBlock:4,rotateSpeed:0.077,imgScale:1.1},hegrenade:{name:"HE Grenade",lifetime:1,img:["grenade8","grenade7","grenade6","grenade5","grenade4","grenade3","grenade2","grenade1"],pathing:10,yOffset:4,noBars:true,aoe:2.75,dmg:70,turretsDontShootMe:true},smokegrenade:{name:"Smoke Grenade",lifetime:20*15,img:["grenadeBlue8","grenadeBlue7","grenadeBlue6","grenadeBlue5","grenadeBlue4","grenadeBlue3","grenadeBlue2","grenadeBlue1"],pathing:10,yOffset:4,noBars:true,aoe:2.85,emitsSmoke:true,turretsDontShootMe:true},flashgrenade:{name:"Flash Grenade",lifetime:4,img:["grenadeYellow8","grenadeYellow7","grenadeYellow6","grenadeYellow5","grenadeYellow4","grenadeYellow3","grenadeYellow2","grenadeYellow1"],pathing:10,yOffset:4,noBars:true,aoe:2.85,flash:true,turretsDontShootMe:true},lasergrenade:{name:"Laser Grenade",lifetime:4,img:["grenadeYellow8","grenadeYellow7","grenadeYellow6","grenadeYellow5","grenadeYellow4","grenadeYellow3","grenadeYellow2","grenadeYellow1"],pathing:10,yOffset:4,noBars:true,dmg:24,countLasers:5,turretsDontShootMe:true},poisongrenade:{name:"Acid Gas Grenade",lifetime:200,img:["grenadeBlue8","grenadeBlue7","grenadeBlue6","grenadeBlue5","grenadeBlue4","grenadeBlue3","grenadeBlue2","grenadeBlue1"],pathing:10,yOffset:4,noBars:true,aoe:3.5,emitsPoison:true,flameDPS:25,turretsDontShootMe:true,noBounce:true}};var objectProto={get name(){return F_&&F_("objects."+this.id+".name")||this.locales.name;}};for(var id in objects){var src=objects[id];src.id=id;if(typeof exports=='undefined'){var dist=Object.create(objectProto);dist.locales={};for(var key in src){if(['name'].indexOf(key)>=0){dist.locales[key]=src[key];}else{dist[key]=src[key];}}objects[id]=dist;}}var abilities=[{name:"Heal Aura",object:"healaura",cooldown:0,energy:45,range:5,icon:"healWard",humanOnly:true,type:"place",description:"Create an aura that heals nearby players.",activeMsg:"Left click to place",levelUpFields:["hpPerTick","lifetime","aoe"],levelUpFieldsName:["Heal Rate","Lifetime","Radius"],displayScale:[20,1/20,1],levelUpValues:[0.15,30*20,0.9],levelUpCost:[100,100,100],levelUpMaxLvl:[3,3,3],cost:100,maxLvl:1,defaultLvl:1,isFree:true},{name:"Laser Turret",object:"laserturret",cooldown:0,energy:55,range:5,icon:"laserTurretIcon",humanOnly:true,type:"place",description:"Create a laser turret that shoots enemies.",activeMsg:"Left click to place",levelUpFields:["aoe","weaponCooldown","maxCount"],levelUpFieldsName:["Range","Fire Rate","Max Active"],levelUpValues:[1.5,-2,1],displayScale:[1,1/20,1],levelUpCost:[100,100,100],levelUpMaxLvl:[3,3,3],levelUpMaxUpgLvl:[3,3,3],cost:100,maxLvl:1,defaultLvl:1,tutorialLvl:1,isFree:true,maxCount:2},{name:"Wall",object:"wall",cooldown:0,energy:13,range:5,icon:"block",humanOnly:true,type:"place",description:"Create a wall, that blocks pathing and projectiles. Grenades can be shot over it, though.",activeMsg:"Left click to place",levelUpFields:["hp"],levelUpFieldsName:["Health"],levelUpValues:[45],levelUpCost:[100],levelUpMaxLvl:[3],cost:100,maxLvl:1,isFree:true},{name:"Teleport",cooldown:8*20,energy:45,range:4,type:"blink",icon:"blink",humanOnly:true,description:"Teleport over a short distance. After using teleport, you can not shoot for 2 sec.",activeMsg:"Left click to teleport",levelUpFields:["range"],levelUpFieldsName:["Range"],levelUpValues:[1.5],levelUpCost:[100],levelUpMaxLvl:[3],cost:100,maxLvl:1,gold:1500},{name:"Invisibility",cooldown:0,energy:5,type:"invis",icon:"invis",humanOnly:true,description:"Makes you invisible.",invisEnergyRate:-0.21,isInstant:true,levelUpFields:["invisEnergyRate"],levelUpFieldsName:["Energy Cost"],levelUpValues:[0.016],displayScale:[20],levelUpCost:[100],levelUpMaxLvl:[3],cost:100,maxLvl:1,isFree:true},{name:"Acid Grenade",object:"poisongrenade",cooldown:0,energy:30,range:12,icon:"grenadeBlue1",humanOnly:true,type:"throw",description:"Throw an acid grenade, that causes damage to players and objects over time.",activeMsg:"Left click to throw",levelUpFields:["range","aoe","flameDPS"],levelUpFieldsName:["Range","Radius","Damage"],levelUpValues:[2,0.5,5],levelUpCost:[100,100,100],levelUpMaxLvl:[3,3,3],cost:100,maxLvl:1,isFree:true},{name:"HE Grenade",object:"hegrenade",energy:20,range:11,cooldown:20,icon:"grenade1",humanOnly:true,type:"throw",description:"Throw a grenade that explodes and does damage.",activeMsg:"Left click to throw",levelUpFields:["dmg","range"],levelUpFieldsName:["Damage","Range"],levelUpValues:[10,2],levelUpCost:[100,100],levelUpMaxLvl:[3,3],cost:100,maxLvl:1,isFree:true},{name:"Laser Grenade",object:"lasergrenade",cooldown:6*20,energy:35,range:12,icon:"grenadeYellow1",humanOnly:true,type:"throw",description:"Throw a grenade that shoots lasers in all directions when detonating.",activeMsg:"Left click to throw",levelUpFields:["countLasers"],levelUpFieldsName:["Lasers"],levelUpValues:[2],levelUpCost:[100],levelUpMaxLvl:[3],cost:100,maxLvl:1,gold:1800},{name:"Missile Turret",object:"missileturret",cooldown:0,energy:80,range:5,icon:"missileTurretIcon",humanOnly:true,type:"place",description:"Create a turret that shoots enemies.",activeMsg:"Left click to place",levelUpFields:["dmg","radius","maxCount"],levelUpFieldsName:["Damage","Radius","Max Number"],levelUpValues:[14,0.25,1],levelUpCost:[100,100,100],levelUpMaxLvl:[3,3,3],cost:100,maxLvl:1,gold:1200,maxCount:2},{name:"Grenade Turret",object:"grenadeturret",cooldown:0,energy:75,range:5,icon:"grenadeTurretIcon",humanOnly:true,type:"place",description:"Create a turret that shoots enemies.",activeMsg:"Left click to place",levelUpFields:["dmg","radius","maxCount"],levelUpFieldsName:["Damage","Radius","Max Number"],levelUpValues:[12,0.22,1],levelUpCost:[100,100,100],levelUpMaxLvl:[3,3,3],cost:100,maxLvl:1,gold:1600,maxCount:2},{name:"Scan",cooldown:10*20,duration:16*20,energy:15,type:"scan",icon:"scan",humanOnly:true,description:"Show enemy players on the minimap for a while. Also increases the visibility of invisible players.",isInstant:true,levelUpFields:["duration"],levelUpFieldsName:["Duration"],levelUpValues:[6*20],displayScale:[1/20],levelUpCost:[100],levelUpMaxLvl:[3],cost:100,maxLvl:1,gold:1200},{name:"Strength",type:"passive",field:"maxHP",mod:7,zombieMod:7,defaultLvl:3,tutorialLvl:6,icon:"strength",description:"Increases your max HP by 6.5",cost:100,maxLvl:10,isFree:true,causesFieldUpdate:true},{name:"Agility",type:"passive",field:"movementSpeed",mod:0.0038,zombieMod:0.0045,icon:"agility",description:"Increases your movement Speed",cost:100,defaultLvl:3,tutorialLvl:3,maxLvl:10,isFree:true},{name:"Regeneration",type:"passive",field:"hpRegeneration",mod:0.0155,zombieMod:0.03,icon:"regeneration",description:"Increases your HP regeneration rate",cost:100,maxLvl:10,gold:1200,causesFieldUpdate:true},{name:"Intelligence",type:"passive",field:"energyRegeneration",mod:0.01,zombieMod:0.018,tutorialLvl:10,icon:"intelligence",description:"Increases your energy regeneration rate",cost:100,maxLvl:10,gold:1200,causesFieldUpdate:true},{name:"Lifesteal",type:"passive",field:"lifesteal",mod:0.045,zombieMod:0.1,icon:"lifesteal",description:"Makes you gain life when dealing damage",cost:100,maxLvl:10,gold:1700},{name:"Shield",type:"shield",reduceDmgTo:10,cooldown:10*20,duration:1*20,energy:30,icon:"shieldIcon",humanOnly:true,description:"Reduces incoming damage to 10. Only lasts 1 sec.",isInstant:true,cost:100,maxLvl:1,gold:2000},{name:"Play Dead",type:"playdead",cooldown:10*20,duration:20,duration2:6,energy:5,icon:"playDead",description:"Play dead.",isInstant:true,zombieOnly:true,maxLvl:1,cost:100,causesAbilityUpdate:true},{name:"Summon Zombie",type:"summon",energy:40,range:5,icon:"summonZombie",cooldown:1,description:"Summon a zombie.",zombieOnly:true,maxLvl:5,cost:100,causesAbilityUpdate:true},{name:"Summon Stronger Zombie",type:"summon",energy:50,range:5,icon:"summonZombie2",cooldown:1,description:"Summon a stronger zombie.",rangedZombie:true,zombieOnly:true,maxLvl:5,cost:100,causesAbilityUpdate:true},{name:"Zombie Sense",type:"passive",range:5,field:"zombieSense",mod:5,zombieMod:5,icon:"zombieSenseIcon",description:"Show invisible players near you.",zombieOnly:true,maxLvl:3,cost:100,causesFieldUpdate:true},{name:"Summon Dark Zombie",type:"summon",energy:80,range:4,icon:"summonZombie3",cooldown:1,description:"Summon a dark zombie.",zombieOnly:true,maxLvl:5,cost:100,special:"dark",requiredLvl:8,causesAbilityUpdate:true},{name:"Damage",type:"passive",field:"dmg",mod:0,zombieMod:10,icon:"zombie_weapon",zombieOnly:true,description:"Increases your damage",cost:100,maxLvl:10},{name:"Summon Crawler",type:"summon",energy:30,range:4,icon:"crawler",cooldown:1,description:"Summon a crawler.",zombieOnly:true,maxLvl:5,cost:100,special:"crawler",requiredLvl:4,causesAbilityUpdate:true}];var abilityProro={get isAbility(){return true;},get name(){return F_&&F_("abilities."+this.id+".name")||this.locales.name;},get description(){return F_&&F_("abilities."+this.id+".desc")||this.locales.description;},get activeMsg(){return F_&&F_("abilities."+this.id+".activeMsg")||this.locales.activeMsg;},get levelUpFieldsName(){if(!F_){return this.locales.levelUpFieldsName;}var names=[];if(this.levelUpFields){for(var i=0;i<this.levelUpFields.length;i++){names[i]=F_("abilities."+this.id+".levelUp."+this.levelUpFields[i]);}}return names;}};for(var i=0;i<abilities.length;i++){var src=abilities[i];src.id=i;if(typeof exports!=='undefined'){src.isAbility=true;}else{var dist=Object.create(abilityProro);dist.locales={};for(var key in src){if(['name','description','activeMsg','levelUpFieldsName'].indexOf(key)>=0){dist.locales[key]=src[key];}else{dist[key]=src[key];}}abilities[i]=dist;}}function getDefaultAbilityObj(abs){var obj=[];for(var i=0;i<abs.length;i++){var o={lvl:abs[i].defaultLvl?abs[i].defaultLvl:0};obj.push(o);if(abs[i].levelUpFields){o.attributes=[];for(var k=0;k<abs[i].levelUpFields.length;k++){o.attributes.push(0);}}}return obj;};function getTutorialAbilityObj(abs){var obj=[];for(var i=0;i<abs.length;i++){var o={lvl:abs[i].tutorialLvl?abs[i].tutorialLvl:0};obj.push(o);if(abs[i].levelUpFields){o.attributes=[];for(var k=0;k<abs[i].levelUpFields.length;k++){o.attributes.push(0);}}}return obj;};function getDefaultZombieAbilityObj(abs,config){var obj=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=config[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var c=_step.value;var o={lvl:c.humanOnly?0:abs[c.id].lvl,attributes:null};if(c.levelUpFields){o.attributes=new Array(c.levelUpFields.length).fill(0);}obj.push(o);}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}return obj;};var killStreaks={"5":{msg_start_self:"game.msg.streak5.self",msg_start_others:"game.msg.streak5.others",msg_ended_self:"game.msg.streak5.ended_self",msg_ended_others:"game.msg.streak5.ended_others",sound:"KILLING_SPREE",xp:15},"10":{msg_start_self:"game.msg.streak10.self",msg_start_others:"game.msg.streak10.others",msg_ended_self:"game.msg.streak10.ended_self",msg_ended_others:"game.msg.streak10.ended_others",sound:"RAMPAGE",xp:30},"15":{msg_start_self:"game.msg.streak15.self",msg_start_others:"game.msg.streak15.others",msg_ended_self:"game.msg.streak15.ended_self",msg_ended_others:"game.msg.streak15.ended_others",sound:"DOMINATING",xp:50},"20":{msg_start_self:"game.msg.streak20.self",msg_start_others:"game.msg.streak20.others",msg_ended_self:"game.msg.streak20.ended_self",msg_ended_others:"game.msg.streak20.ended_others",sound:"UNSTOPPABLE",xp:75},"25":{msg_start_self:"game.msg.streak25.self",msg_start_others:"game.msg.streak25.others",msg_ended_self:"game.msg.streak25.ended_self",msg_ended_others:"game.msg.streak25.ended_others",sound:"GODLIKE",xp:120}};var multiKills={"2":{name:"Double Kill",sound:"DOUBLE_KILL",xp:12},"3":{name:"Multi Kill",sound:"MULTI_KILL",xp:18},"4":{name:"Ultra Kill",sound:"ULTRA_KILL",xp:25},"5":{name:"MONSTER Kill",sound:"MONSTER_KILL",xp:35}};var emotes=[{name:"wink",command:"/wink",imgString:"emotesBlink"},{name:"cry",command:"/cry",imgString:"emotesCry"},{name:"angry",command:"/angry",imgString:"emotesDevil"},{name:"love",command:"/love",imgString:"emotesHeart"},{name:"dislike",command:"/dislike",imgString:"emotesDislike"},{name:"happy",command:"/happy",imgString:"emotesSmile"},{name:"evil",command:"/evil",imgString:"emotesGrin"},{name:"suprise",command:"/suprise",imgString:"emotesO"},{name:"like",command:"/like",imgString:"emotesLike"},{name:"smirk",command:"/smirk",imgString:"emotesSmirk"},{name:"pokerface",command:"/pokerface",imgString:"emotesPokerface"},{name:"hold",command:"/hold",imgString:"emotesHold"},{name:"go",command:"/go",imgString:"emotesGo"},{name:"fire",command:"/fire",imgString:"emotesFire"},{name:"back",command:"/back",imgString:"emotesBack"},{name:"safe",command:"/safe",imgString:"emotesOK"},{name:"come",command:"/come",imgString:"emotesFist"},{name:"giveup",command:"/giveup",imgString:"emotesFlagWhite"},{name:"flag",command:"/flag",imgString:"emotesFlagRed"},{name:"cry",command:"cry",imgString:"emotesCry"},{name:"sniper",command:"/sniper",imgString:"emotesSniper"},{name:"infected",command:"/infected",imgString:"emotesInfected"},{name:"fist",command:"/fist",imgString:"emotesPunch"},{name:"victory",command:"/victory",imgString:"emotesPeace"},{name:"cool",command:"/cool",imgString:"emotesCool"},{name:"hype",command:"/hype",imgString:"emotesHype"},{name:"gg",command:"/gg",imgString:"emotesGG"},{name:"troll",command:"/troll",imgString:"emotesTroll"},{name:"facepalm",command:"/facepalm",imgString:"emotesFacepalm"},{name:"comeon",command:"/comeon",imgString:"emotesElvis"}];var treasureChests=[{id:0,waitTime:1800,loot:{skinDefault:'Common',skin:{Common:0.9459,Rare:0.0514,Epic:0.0026,Legendary:0.0001},gold:[30,42]}},{id:1,waitTime:7200,loot:{skinDefault:'Rare',skin:{Common:0.0255,Rare:0.9259,Epic:0.0463,Legendary:0.0023},gold:[120,168]}},{id:2,waitTime:28800,loot:{skinDefault:'Epic',skin:{Common:0,Rare:0.1250,Epic:0.8333,Legendary:0.0417},gold:[480,672]}},{id:3,waitTime:86400,loot:{skinDefault:'Epic',skin:{Common:0,Rare:0,Epic:0.5000,Legendary:0.5000},gold:[1920,2688]}}];var roundEndChestRewards=[2,0,3,0,0,1,0,0,0,0,2,0,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,2,0,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,2,0,0,1,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,2,0,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,2,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0];var hatExtraConfigCommon={1:{upgradeSkinCost:5,upgradeGoldCost:50},2:{upgradeSkinCost:10,upgradeGoldCost:200},3:{upgradeSkinCost:15,upgradeGoldCost:800},4:{upgradeSkinCost:20,upgradeGoldCost:3200},5:{upgradeSkinCost:25,upgradeGoldCost:10000},6:{upgradeSkinCost:30,upgradeGoldCost:30000},7:{upgradeSkinCost:35,upgradeGoldCost:90000},8:{upgradeSkinCost:40,upgradeGoldCost:270000},9:{upgradeSkinCost:45,upgradeGoldCost:540000},10:{upgradeSkinCost:-1,upgradeGoldCost:-1}};var hatExtraConfigRare={1:{upgradeSkinCost:5,upgradeGoldCost:100},2:{upgradeSkinCost:10,upgradeGoldCost:400},3:{upgradeSkinCost:15,upgradeGoldCost:1600},4:{upgradeSkinCost:20,upgradeGoldCost:6400},5:{upgradeSkinCost:25,upgradeGoldCost:20000},6:{upgradeSkinCost:30,upgradeGoldCost:60000},7:{upgradeSkinCost:35,upgradeGoldCost:180000},8:{upgradeSkinCost:40,upgradeGoldCost:540000},9:{upgradeSkinCost:45,upgradeGoldCost:1080000},10:{upgradeSkinCost:-1,upgradeGoldCost:-1}};var hatExtraConfigEpic={1:{upgradeSkinCost:5,upgradeGoldCost:200},2:{upgradeSkinCost:10,upgradeGoldCost:800},3:{upgradeSkinCost:15,upgradeGoldCost:3200},4:{upgradeSkinCost:20,upgradeGoldCost:12800},5:{upgradeSkinCost:25,upgradeGoldCost:40000},6:{upgradeSkinCost:30,upgradeGoldCost:120000},7:{upgradeSkinCost:35,upgradeGoldCost:360000},8:{upgradeSkinCost:40,upgradeGoldCost:1080000},9:{upgradeSkinCost:45,upgradeGoldCost:2160000},10:{upgradeSkinCost:-1,upgradeGoldCost:-1}};var SKIN_AUTHOR={71:"Katydid",72:"Katydid",73:"Bubbles",74:"Bubbles",75:"Bubbles",76:"Demoness",77:"Iris Isotheis",78:"FLUFFY",79:"Demoness",80:"Demoness",81:"Katydid",82:"Katydid",83:"Katydid"};var NAME_COLOR={50:{name:'bot',code:'#d2d2d2'},100:{name:'guest',code:'#fff'},200:{name:'player',code:'rgb(255, 255, 120)'},210:{name:'veteran',code:'#ea9'},400:{name:'steam',code:'#a4d007',isReward:true},500:{name:'community',code:'#cae',isReward:true},800:{name:'modder',code:'#e6a',isReward:true},1000:{name:'admin',code:'#6de'}};var hatExtraConfigLegendary={1:{upgradeSkinCost:5,upgradeGoldCost:250},2:{upgradeSkinCost:10,upgradeGoldCost:1000},3:{upgradeSkinCost:15,upgradeGoldCost:4000},4:{upgradeSkinCost:20,upgradeGoldCost:16000},5:{upgradeSkinCost:25,upgradeGoldCost:50000},6:{upgradeSkinCost:30,upgradeGoldCost:150000},7:{upgradeSkinCost:35,upgradeGoldCost:450000},8:{upgradeSkinCost:40,upgradeGoldCost:1350000},9:{upgradeSkinCost:45,upgradeGoldCost:2700000},10:{upgradeSkinCost:-1,upgradeGoldCost:-1}};var hatQualityPlus={Common:0.4,Rare:0.4,Epic:0.8,Legendary:1};var hats=[{name:"Basic skin",offset:0,legs:0,noItem:true,isFree:true,Strength:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Hat",offset:1,legs:0,lvl:2,Intelligence:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Sun Glasses",offset:3,legs:0,gold:100,Intelligence:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Soldier",offset:5,legs:1,lvl:3,Strength:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Soldier 2",offset:9,legs:1,lvl:4,Strength:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Space",offset:6,legs:3,lvl:5,Strength:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Skeleton",offset:4,legs:2,lvl:6,Strength:1,Lifesteal:1,quality:'Rare',extra:hatExtraConfigRare},{name:"Grampa",offset:7,legs:0,lvl:7,Intelligence:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Mage",offset:8,legs:0,lvl:8,Intelligence:1,Agility:1,quality:'Rare',extra:hatExtraConfigRare},{name:"Zombie",offset:10,legs:0,gold:500,Strength:1,Regeneration:1,quality:'Rare',extra:hatExtraConfigRare},{name:"Soldier 3",offset:13,legs:5,lvl:10,Strength:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Lundmar",offset:14,legs:0,lvl:11,Agility:1,Lifesteal:1,quality:'Rare',extra:hatExtraConfigRare},{name:"Pleasure",offset:16,legs:6,lvl:13,Strength:1,Lifesteal:1,quality:'Rare',extra:hatExtraConfigRare},{name:"Rabbit",offset:12,legs:8,lvl:15,Agility:2,Regeneration:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Eye",offset:18,legs:7,lvl:17,Agility:1,Lifesteal:1,quality:'Rare',extra:hatExtraConfigRare},{name:"Gentleman",offset:2,legs:0,lvl:19,Strength:2,Regeneration:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Dark",offset:17,legs:9,lvl:21,Lifesteal:1,Agility:1,quality:'Rare',extra:hatExtraConfigRare},{name:"Police",offset:25,legs:11,gold:1500,hatOnly:true,Intelligence:1,Strength:2,quality:'Epic',extra:hatExtraConfigEpic},{name:"Cowboy",offset:27,legs:12,lvl:23,hatOnly:true,Agility:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Cowboy 2",offset:29,legs:13,lvl:25,hatOnly:true,Strength:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Snowcoat",offset:30,legs:14,lvl:27,hatOnly:true,Lifesteal:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Snowcoat 2",offset:31,legs:15,gold:1650,hatOnly:true,Regeneration:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Santa",offset:32,legs:16,lvl:29,hatOnly:true,Intelligence:2,Regeneration:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Girl 2",offset:33,legs:8,lvl:31,Intelligence:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Princess",offset:34,legs:17,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Girl 3",offset:39,legs:8,isFree:true,Lifesteal:1,quality:'Common',extra:hatExtraConfigCommon},{name:"Painter",offset:19,legs:9,lvl:37,Regeneration:2,Intelligence:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Rambo",offset:40,legs:9,lvl:40,Strength:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Grim Reaper",offset:41,legs:18,lvl:45,Lifesteal:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Phonecats",offset:42,legs:19,gold:6000,Agility:3,Lifesteal:2,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"Godenot",offset:43,legs:20,gold:6000,hatOnly:true,Strength:3,Lifesteal:2,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"Elf",offset:44,legs:14,gold:6000,hatOnly:true,Agility:3,Intelligence:2,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"Cat",offset:45,legs:21,gold:6000,Agility:3,Regeneration:2,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"Wolf",offset:46,legs:23,gold:6000,Strength:2,Lifesteal:3,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"Heaven Bul",offset:47,legs:9,gold:9000,Strength:3,Intelligence:2,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"iRaphael",offset:48,legs:7,gold:9000,Regeneration:3,Agility:2,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"Dido D",offset:49,legs:22,gold:9000,Agility:3,Intelligence:2,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"Wu Kong",offset:50,legs:24,gold:9000,Strength:2,Agility:3,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"Terror Bionic",offset:51,legs:25,gold:9000,Strength:3,Agility:2,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"RobleisUTU",offset:53,legs:27,gold:9000,Strength:3,Regeneration:2,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"Hippie",offset:54,legs:28,gold:9000,Intelligence:2,Lifesteal:3,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"cazum8",offset:55,legs:29,gold:9000,Intelligence:3,Regeneration:2,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"Pozzitifon",offset:56,legs:30,gold:9000,Intelligence:4,Strength:1,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"EeOneGuy",offset:58,legs:32,gold:9000,Lifesteal:4,Agility:1,quality:'Legendary',extra:hatExtraConfigLegendary},{name:"Girl 4",offset:35,hatOnly:true,legs:9,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"USA",offset:64,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"China",offset:65,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Switzerland",offset:66,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Vietnam",offset:67,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Turkey",offset:68,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Taiwan",offset:69,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Denmark",offset:70,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Indonesia",offset:71,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Singapore",offset:72,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Poland",offset:73,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Canada",offset:74,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Russia",offset:75,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Philippines",offset:76,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Ukraine",offset:77,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Germany",offset:78,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"France",offset:79,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"UK",offset:80,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Argentina",offset:81,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Brazil",offset:82,hatOnly:false,legs:34,lvl:34,Intelligence:2,Agility:1,quality:'Epic',isCountry:true,extra:hatExtraConfigEpic},{name:"Headphones",offset:83,hatOnly:false,legs:14,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Foxy",offset:84,hatOnly:false,legs:35,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Blue Helmet",offset:85,hatOnly:false,legs:12,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Lion",offset:86,hatOnly:false,legs:35,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Dark5",offset:87,hatOnly:false,legs:1,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Inuit",offset:88,hatOnly:false,legs:12,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Bubblegum",offset:89,hatOnly:false,legs:6,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Katydid",offset:93,hatOnly:false,legs:36,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Witch",offset:97,hatOnly:false,legs:37,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Hedgehog",offset:98,hatOnly:false,legs:7,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Gem",offset:99,hatOnly:false,legs:38,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Sungod",offset:100,hatOnly:false,legs:39,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Tempest",offset:101,hatOnly:false,legs:40,lvl:34,Intelligence:2,Agility:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Miku",offset:102,hatOnly:false,legs:41,lvl:34,Intelligence:2,Agility:2,Regeneration:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Robot",offset:103,hatOnly:false,legs:1,lvl:34,Strength:2,quality:'Rare',extra:hatExtraConfigEpic},{name:"Demoness",offset:104,hatOnly:false,legs:6,lvl:34,Regeneration:2,quality:'Rare',extra:hatExtraConfigEpic},{name:"Demon",offset:105,hatOnly:false,legs:42,lvl:34,Strength:2,quality:'Rare',extra:hatExtraConfigEpic},{name:"Doggo",offset:106,hatOnly:false,legs:43,lvl:34,Strength:1,Agility:1,Intelligence:1,quality:'Epic',extra:hatExtraConfigEpic},{name:"Mohawk",offset:107,hatOnly:false,legs:44,lvl:34,Strength:1,Agility:1,quality:'Rare',extra:hatExtraConfigEpic},{name:"Dragon",offset:110,hatOnly:false,legs:45,lvl:34,Intelligence:2,Strength:1,quality:'Epic',extra:hatExtraConfigEpic}];var hatProto={get isHat(){return true;},get name(){return F_&&F_("hats."+this.id+".name")||this.locales.name;}};for(var i=0;i<hats.length;i++){var src=hats[i];src.id=i;if(typeof exports!=='undefined'){src.isHat=true;}else{var dist=Object.create(hatProto);dist.locales={};for(var key in src){if(['name'].indexOf(key)>=0){dist.locales[key]=src[key];}else{dist[key]=src[key];}}hats[i]=dist;}}var pl_hat=hats[0];var hatsByQuality={Common:[],Rare:[],Epic:[],Legendary:[]};for(var i=0;i<hats.length;i++){hatsByQuality[hats[i].quality].push(hats[i]);}var tileTypes=[{"name":"Metal_Ground_1","img":{"x":0,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Crate","img":{"x":166,"y":100,"w":18,"h":32},"pathing":5,"w":1,"h":1,"ground":false},{"name":"Wall Top","img":{"x":0,"y":44,"w":16,"h":53},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Top 2","img":{"x":16,"y":44,"w":16,"h":53},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Top 3","img":{"x":32,"y":44,"w":16,"h":53},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Top 4","img":{"x":48,"y":44,"w":16,"h":53},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Left","img":{"x":0,"y":97,"w":24,"h":56},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Left 2 ","img":{"x":24,"y":97,"w":24,"h":56},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Left 3","img":{"x":48,"y":97,"w":24,"h":56},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Left 4","img":{"x":72,"y":97,"w":24,"h":56},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Right","img":{"x":0,"y":152,"w":24,"h":56},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Right 2 ","img":{"x":24,"y":152,"w":24,"h":56},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Right 3","img":{"x":48,"y":152,"w":24,"h":56},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Right 4","img":{"x":72,"y":152,"w":24,"h":56},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Bottom","img":{"x":0,"y":204,"w":16,"h":42},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Bottom 2","img":{"x":16,"y":204,"w":16,"h":42},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Bottom 3","img":{"x":32,"y":204,"w":16,"h":42},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Wall Bottom 4","img":{"x":48,"y":204,"w":16,"h":42},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true,"isBorder":true},{"name":"Metal_Ground_2","img":{"x":16,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_3","img":{"x":32,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_4","img":{"x":48,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_5","img":{"x":64,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_6","img":{"x":80,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Wall Corner 1","img":{"x":64,"y":43,"w":24,"h":54},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Corner 2","img":{"x":88,"y":43,"w":24,"h":54},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Corner 3","img":{"x":176,"y":43,"w":24,"h":54},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Corner 4","img":{"x":196,"y":43,"w":24,"h":54},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Bottom High 1","img":{"x":112,"y":43,"w":16,"h":54},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Bottom High 2","img":{"x":128,"y":43,"w":16,"h":54},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Bottom High 3","img":{"x":144,"y":43,"w":16,"h":54},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Bottom High 4","img":{"x":160,"y":43,"w":16,"h":54},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Crate Placeholder","img":{"x":166,"y":100,"w":18,"h":32},"pathing":5,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Metal_Ground_7","img":{"x":96,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_8","img":{"x":112,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_9","img":{"x":128,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_10","img":{"x":144,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_11","img":{"x":160,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_12","img":{"x":176,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_13","img":{"x":192,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_14","img":{"x":208,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_15","img":{"x":224,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Metal_Ground_16","img":{"x":240,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Black Block","img":{"x":220,"y":43,"w":16,"h":54},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Top 1","img":{"x":0,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1,2,3]},{"name":"Wall Lower Top 2","img":{"x":16,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Top 3","img":{"x":32,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Top 4","img":{"x":48,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Right Bottom","img":{"x":64,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Lower Left Bottom","img":{"x":88,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Lower Top 1","img":{"x":112,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1,2,3]},{"name":"Wall Lower Top 2","img":{"x":128,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Top 3","img":{"x":144,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Top 4","img":{"x":160,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Left Top","img":{"x":176,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Lower Right Top","img":{"x":196,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Lower Black","img":{"x":220,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Lower Left 1","img":{"x":0,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1,2,3]},{"name":"Wall Lower Left 2","img":{"x":24,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Left 3","img":{"x":48,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Left 4","img":{"x":72,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Right 1","img":{"x":0,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1,2,3]},{"name":"Wall Lower Right 2","img":{"x":24,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Right 3","img":{"x":48,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lower Right 4","img":{"x":72,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Spawning Point","img":{"x":0,"y":16,"w":1,"h":1},"pathing":0,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Waypoint","img":{"x":0,"y":16,"w":1,"h":1},"pathing":0,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Torch North","img":{"x":117,"y":98,"w":7,"h":34},"pathing":10,"w":1,"h":1,"ground":false,"isTorch":true,"hideOnMinimap":true},{"name":"Torch Left","img":{"x":129,"y":99,"w":18,"h":36},"pathing":10,"w":1,"h":1,"ground":false,"isTorch":true,"flameOffsetX":-0.25,"flameOffsetY":-0.2,"hideOnMinimap":true},{"name":"Torch Right","img":{"x":135,"y":99,"w":18,"h":36},"pathing":10,"w":1,"h":1,"ground":false,"isTorch":true,"flameOffsetX":0.25,"flameOffsetY":-0.2,"hideOnMinimap":true},{"name":"Low Crate","img":{"x":184,"y":100,"w":18,"h":32},"pathing":6,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Spikes","img":{"x":204,"y":108,"w":16,"h":24},"pathing":8,"w":1,"h":1,"ground":false},{"name":"Grass 1","img":{"x":256,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"collection":[0,1,2,3]},{"name":"Grass 2","img":{"x":272,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Grass 3","img":{"x":288,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Grass 4","img":{"x":304,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Grass 5","img":{"x":320,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Grass 6","img":{"x":336,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Grass 7","img":{"x":352,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Grass 8","img":{"x":368,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Grass 9","img":{"x":384,"y":0,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Grass 10","img":{"x":352,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Grass 11","img":{"x":368,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Grass 12","img":{"x":384,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Plate 1","img":{"x":224,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Plate 2","img":{"x":240,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Plate 3","img":{"x":256,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Wall 1x1","img":{"x":243,"y":54,"w":24,"h":43},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall 1x1 2","img":{"x":267,"y":54,"w":24,"h":43},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Water 1","img":{"x":384,"y":32,"w":16,"h":16},"img2":{"x":368,"y":32,"w":16,"h":16},"w":1,"h":1,"ground":true,"pathing":9},{"name":"Water Border Top","img":{"x":352,"y":32,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Border Bottom","img":{"x":304,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Water Border Right","img":{"x":320,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Water Border Left","img":{"x":336,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Border Top","img":{"x":336,"y":32,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Border Right","img":{"x":320,"y":32,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Border Left","img":{"x":304,"y":32,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Tree 2x2","img":{"x":363,"y":48,"w":36,"h":45},"pathing":0,"w":2,"h":2,"ground":false,"isNotFull":true},{"name":"Tree 2x2 2","img":{"x":327,"y":48,"w":36,"h":45},"pathing":0,"w":2,"h":2,"ground":false,"isNotFull":true},{"name":"Grass B 1","img":{"x":160,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"collection":[0,1,2,3]},{"name":"Grass B 2","img":{"x":176,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Grass B 3","img":{"x":192,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Grass B 4","img":{"x":208,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Grass C 1","img":{"x":336,"y":96,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"collection":[0,1,2,3]},{"name":"Grass C 2","img":{"x":352,"y":96,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Grass C 3","img":{"x":368,"y":96,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Grass C 4","img":{"x":384,"y":96,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Grass D 1","img":{"x":336,"y":112,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"collection":[0,1,2,3]},{"name":"Grass D 2","img":{"x":352,"y":112,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Grass D 3","img":{"x":368,"y":112,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Grass D 4","img":{"x":384,"y":112,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Dirt 1","img":{"x":336,"y":128,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"collection":[0,1,2,3]},{"name":"Dirt 2","img":{"x":352,"y":128,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"GDirt 3","img":{"x":368,"y":128,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Dirt 4","img":{"x":384,"y":128,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Moving Walkway Right","img":{"x":136,"y":16,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"shiftX":0.15,"editable":["shiftX"],"editableCaption":["speed"]},{"name":"Moving Walkway Left","img":{"x":124,"y":140,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"shiftX":-0.15,"editable":["shiftX"],"editableCaption":["speed"]},{"name":"Moving Walkway Up","img":{"x":116,"y":164,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"shiftY":-0.15,"editable":["shiftY"],"editableCaption":["speed"]},{"name":"Moving Walkway Down","img":{"x":132,"y":164,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"shiftY":0.15,"editable":["shiftY"],"editableCaption":["speed"]},{"name":"Teleporter","img":{"x":186,"y":134,"w":24,"h":22},"pathing":10,"w":1,"h":1,"channel":1,"editable":["channel"],"editableCaption":["channel"],"ground":true,"isTeleporter":true,"isNotFull":true},{"name":"Wall Inner Top Left","img":{"x":240,"y":271,"w":16,"h":43},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Inner Top Right","img":{"x":260,"y":271,"w":16,"h":43},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Inner Bot Left","img":{"x":280,"y":271,"w":16,"h":43},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Inner Bot Right","img":{"x":300,"y":271,"w":16,"h":43},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Pillar N 1","img":{"x":106,"y":218,"w":18,"h":49},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Pillar N 2","img":{"x":130,"y":222,"w":20,"h":41},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Pillar N 3","img":{"x":213,"y":148,"w":18,"h":32},"pathing":5,"w":1,"h":1,"ground":false},{"name":"Pillar N 4","img":{"x":267,"y":151,"w":18,"h":30},"pathing":5,"w":1,"h":1,"ground":false},{"name":"Trunk 1","img":{"x":262,"y":110,"w":20,"h":38},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Trunk 2","img":{"x":282,"y":109,"w":20,"h":38},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Stone N 1 2x2","img":{"x":154,"y":182,"w":32,"h":32},"pathing":10,"w":2,"h":2,"ground":true,"isNotFull":true},{"name":"Stone N 2 2x2","img":{"x":267,"y":182,"w":32,"h":32},"pathing":10,"w":2,"h":2,"ground":true,"isNotFull":true},{"name":"Stone N 1","img":{"x":188,"y":180,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Stone N 2","img":{"x":208,"y":180,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Stone N 3","img":{"x":228,"y":180,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Stone N 4","img":{"x":248,"y":180,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Stone N 5","img":{"x":188,"y":198,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Stone N 6","img":{"x":208,"y":198,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Stone N 7","img":{"x":228,"y":198,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Stone N 8","img":{"x":248,"y":198,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Stone N 9","img":{"x":301,"y":180,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Stone N 10","img":{"x":301,"y":198,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Carpet Red Top Left","img":{"x":154,"y":217,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Red Top","img":{"x":170,"y":217,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Red Top Right","img":{"x":186,"y":217,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Red Mid Left","img":{"x":154,"y":233,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Red Mid","img":{"x":170,"y":233,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Red Mid Left","img":{"x":186,"y":233,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Red Bot Left","img":{"x":154,"y":249,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Red Bot Mid","img":{"x":170,"y":249,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Red Bot Right","img":{"x":186,"y":249,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Blue Top Left","img":{"x":204,"y":217,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Blue Top","img":{"x":220,"y":217,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Blue Top Right","img":{"x":236,"y":217,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Blue Mid Left","img":{"x":204,"y":233,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Blue Mid","img":{"x":220,"y":233,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Blue Mid Left","img":{"x":236,"y":233,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Blue Bot Left","img":{"x":204,"y":249,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Blue Bot Left","img":{"x":220,"y":249,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Carpet Blue Bot Left","img":{"x":236,"y":249,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Ground Stones","img":{"x":234,"y":146,"w":22,"h":15},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Ground Stones 2","img":{"x":234,"y":164,"w":16,"h":11},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Plant","img":{"x":252,"y":165,"w":14,"h":13},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Plant 2","img":{"x":133,"y":197,"w":17,"h":17},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Plant 3","img":{"x":86,"y":236,"w":17,"h":14},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Plant 4","img":{"x":86,"y":253,"w":17,"h":14},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Ground Stones 3","img":{"x":325,"y":240,"w":29,"h":14},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Ground Stones 4","img":{"x":356,"y":241,"w":14,"h":13},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Ground Stones 5","img":{"x":372,"y":241,"w":18,"h":13},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Ground Stones 6","img":{"x":392,"y":242,"w":18,"h":12},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Ground Stones 7","img":{"x":413,"y":243,"w":22,"h":10},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Ground Stones 8","img":{"x":437,"y":247,"w":8,"h":6},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Ground Stones 9","img":{"x":448,"y":245,"w":13,"h":7},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Flag","img":{"x":252,"y":221,"w":15,"h":30},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Flag 2","img":{"x":269,"y":221,"w":15,"h":30},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Flag 3","img":{"x":285,"y":221,"w":15,"h":30},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Flag 4","img":{"x":301,"y":221,"w":15,"h":30},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Ground Stones 10","img":{"x":287,"y":149,"w":19,"h":12},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Candles","img":{"x":289,"y":165,"w":14,"h":12},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Candles","img":{"x":306,"y":168,"w":4,"h":8},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Books","img":{"x":320,"y":96,"w":13,"h":18},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Books 2","img":{"x":319,"y":116,"w":16,"h":12},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Table","img":{"x":354,"y":144,"w":16,"h":23},"pathing":8,"w":1,"h":1,"ground":false},{"name":"Table 2","img":{"x":372,"y":144,"w":31,"h":23},"pathing":8,"w":2,"h":1,"ground":false},{"name":"Table 3","img":{"x":336,"y":167,"w":33,"h":23},"pathing":8,"w":2,"h":1,"ground":false},{"name":"Table 4","img":{"x":371,"y":167,"w":33,"h":23},"pathing":8,"w":2,"h":1,"ground":false},{"name":"Tree 2x2 3","img":{"x":340,"y":190,"w":34,"h":45},"pathing":0,"w":2,"h":2,"ground":false,"isNotFull":true},{"name":"Tree 2x2 4","img":{"x":378,"y":190,"w":34,"h":45},"pathing":0,"w":2,"h":2,"ground":false,"isNotFull":true},{"name":"Lab Floor 1","img":{"x":320,"y":261,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Floor 2","img":{"x":320,"y":277,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Floor 3","img":{"x":320,"y":293,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Floor 2x2","img":{"x":336,"y":261,"w":32,"h":32},"pathing":10,"w":2,"h":2,"ground":true},{"name":"Lab Floor Top Left","img":{"x":368,"y":261,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Floor Top","img":{"x":384,"y":261,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Floor Top Right","img":{"x":400,"y":261,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Floor Mid Left","img":{"x":368,"y":277,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Floor Mid","img":{"x":384,"y":277,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Floor Mid Right","img":{"x":400,"y":277,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Floor Bot Left","img":{"x":368,"y":293,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Floor Bot","img":{"x":384,"y":293,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Floor Bot Right","img":{"x":400,"y":293,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true},{"name":"Lab Grass 1","img":{"x":416,"y":261,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"collection":[0,1,2,3,4,5]},{"name":"Lab Grass 2","img":{"x":432,"y":261,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Lab Gras 3","img":{"x":448,"y":261,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Lab Grass 4","img":{"x":416,"y":277,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Lab Grass 5","img":{"x":432,"y":277,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Lab Grass 6","img":{"x":448,"y":277,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Lab Grass 7","img":{"x":416,"y":293,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"collection":[0,1,2,3]},{"name":"Lab Grass 8","img":{"x":432,"y":293,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Lab Grass 9","img":{"x":448,"y":293,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Lab Grass 10","img":{"x":464,"y":293,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Ground Stones Lab","img":{"x":417,"y":188,"w":22,"h":16},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Lab Lamp","img":{"x":435,"y":206,"w":20,"h":29},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Lab Lamp 2","img":{"x":441,"y":154,"w":14,"h":25},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Tires","img":{"x":418,"y":207,"w":16,"h":28},"pathing":5,"w":1,"h":1,"ground":false},{"name":"Lab Obstacle 1","img":{"x":401,"y":311,"w":24,"h":43},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Lab Obstacle 2","img":{"x":425,"y":311,"w":24,"h":43},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Lab Obstacle 3","img":{"x":449,"y":311,"w":24,"h":43},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Lab Top 0","img":{"x":484,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1,2,3,4]},{"name":"Wall Lab Top 1","img":{"x":500,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lab Top 2","img":{"x":516,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lab Top 3","img":{"x":532,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lab Top 4","img":{"x":548,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lab Right Bottom","img":{"x":564,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Lab Left Bottom","img":{"x":588,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Lab Bot 1","img":{"x":612,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1]},{"name":"Wall Lab Bot 2","img":{"x":628,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lab Left Top","img":{"x":676,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Lab Right Top","img":{"x":696,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Lab Black","img":{"x":720,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Lab Left 1","img":{"x":500,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1,2,3]},{"name":"Wall Lab Left 2","img":{"x":524,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lab Left 3","img":{"x":548,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lab Left 4","img":{"x":572,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lab Right 1","img":{"x":500,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1,2,3]},{"name":"Wall Lab Right 2","img":{"x":524,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lab Right 3","img":{"x":548,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Lab Right 4","img":{"x":572,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Spiderweb","img":{"x":482,"y":39,"w":44,"h":33},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Halloween Lamps 1","img":{"x":530,"y":42,"w":34,"h":27},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Hallowen Lamps 2","img":{"x":575,"y":39,"w":34,"h":27},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Hallowen Crate 1","img":{"x":482,"y":74,"w":16,"h":33},"w":1,"h":1,"pathing":5},{"name":"Hallowen Crate 1","img":{"x":502,"y":74,"w":16,"h":33},"w":1,"h":1,"pathing":5},{"name":"Hallowen Crate 1","img":{"x":502,"y":74,"w":16,"h":33},"w":1,"h":1,"pathing":5,"nowShow":true},{"name":"Hallowen Heap","img":{"x":541,"y":71,"w":38,"h":33},"w":2,"h":1,"pathing":5},{"name":"Hallowen Trunk","img":{"x":581,"y":78,"w":18,"h":34},"w":1,"h":1,"pathing":0},{"name":"Coffin","img":{"x":605,"y":70,"w":21,"h":42},"w":1,"h":1,"pathing":0},{"name":"Halloween Grass 1","img":{"x":462,"y":116,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"collection":[0,1,2,3,4,5,6,7,8]},{"name":"Halloween Grass 2","img":{"x":478,"y":116,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Halloween Grass 3","img":{"x":494,"y":116,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Halloween Grass 4","img":{"x":462,"y":132,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Halloween Grass 5","img":{"x":478,"y":132,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Halloween Grass 6","img":{"x":494,"y":132,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Halloween Grass 7","img":{"x":462,"y":148,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Halloween Grass 8","img":{"x":478,"y":148,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Halloween Grass 9","img":{"x":494,"y":148,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Halloween Grass 10","img":{"x":510,"y":116,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"collection":[0,1,2,3]},{"name":"Halloween Grass 11","img":{"x":526,"y":116,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Halloween Grass 12","img":{"x":542,"y":116,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Halloween Grass 13","img":{"x":558,"y":116,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Halloween Water","img":{"x":462,"y":164,"w":16,"h":16},"img2":{"x":478,"y":164,"w":16,"h":16},"w":1,"h":1,"ground":true,"pathing":9},{"name":"Halloween Water Border Top","img":{"x":558,"y":148,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Halloween Border Bottom","img":{"x":510,"y":132,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Halloween Water Border Right","img":{"x":526,"y":132,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Halloween Water Border Left","img":{"x":542,"y":132,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Halloween Border Top","img":{"x":542,"y":148,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Halloween Border Right","img":{"x":526,"y":148,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Halloween Border Left","img":{"x":510,"y":148,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Dark Dirt 1","img":{"x":462,"y":180,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"collection":[0,1,2,3]},{"name":"Dark Dirt 2","img":{"x":478,"y":180,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Dark Dirt 3","img":{"x":494,"y":180,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Dark Dirt 4","img":{"x":510,"y":180,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Invisible Blocker Low (only movement)","img":{"x":0,"y":16,"w":1,"h":1},"pathing":8,"w":1,"h":1},{"name":"Invisible Blocker Medium (projectiles)","img":{"x":0,"y":16,"w":1,"h":1},"pathing":5,"w":1,"h":1},{"name":"Invisible Blocker High (everything)","img":{"x":0,"y":16,"w":1,"h":1},"pathing":0,"w":1,"h":1},{"name":"Wall Winter Top 0","img":{"x":834,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1]},{"name":"Wall Winter Top 1","img":{"x":850,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Winter Right Bottom","img":{"x":914,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Winter Left Bottom","img":{"x":938,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Winter Bot 1","img":{"x":962,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1]},{"name":"Wall Winter Bot 2","img":{"x":978,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Winter Left Top","img":{"x":1026,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Winter Right Top","img":{"x":1046,"y":270,"w":24,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Winter Black","img":{"x":1070,"y":270,"w":16,"h":44},"pathing":0,"w":1,"h":1,"ground":false},{"name":"Wall Winter Left 1","img":{"x":850,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1,2,3]},{"name":"Wall Winter Left 2","img":{"x":874,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Winter Left 3","img":{"x":898,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Winter Left 4","img":{"x":922,"y":325,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Winter Right 1","img":{"x":850,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"collection":[0,1,2,3]},{"name":"Wall Winter Right 2","img":{"x":874,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Winter Right 3","img":{"x":898,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Wall Winter Right 4","img":{"x":922,"y":380,"w":24,"h":45},"pathing":0,"w":1,"h":1,"ground":false,"noShow":true},{"name":"Christmas Lights 1","img":{"x":703,"y":0,"w":33,"h":45},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Christmas Lights 2","img":{"x":744,"y":0,"w":33,"h":45},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Christmas Lights 3","img":{"x":783,"y":0,"w":33,"h":32},"pathing":10,"noGrid":true,"isNotFull":true},{"name":"Ice 1","img":{"x":635,"y":63,"w":16,"h":16},"pathing":10,"ground":true,"w":1,"h":1,"isNotFull":false},{"name":"Spikes 2","img":{"x":651,"y":61,"w":16,"h":23},"pathing":8,"ground":false,"w":1,"h":1,"isNotFull":false},{"name":"Spikes 3","img":{"x":667,"y":61,"w":16,"h":23},"pathing":8,"ground":false,"w":1,"h":1,"isNotFull":false},{"name":"Tree Winter","img":{"x":688,"y":52,"w":19,"h":39},"pathing":0,"ground":false,"w":1,"h":1},{"name":"Winter Block 1","img":{"x":711,"y":52,"w":18,"h":40},"pathing":0,"ground":false,"w":1,"h":1},{"name":"Winter Block 2","img":{"x":736,"y":53,"w":18,"h":40},"pathing":0,"ground":false,"w":1,"h":1},{"name":"Gift","img":{"x":757,"y":55,"w":18,"h":33},"pathing":5,"ground":false,"w":1,"h":1},{"name":"Winter Crate 1","img":{"x":780,"y":57,"w":20,"h":35},"pathing":5,"ground":false,"w":1,"h":1},{"name":"Winter Crate 2","img":{"x":801,"y":57,"w":20,"h":36},"pathing":5,"ground":false,"w":1,"h":1,"noShow":true},{"name":"Winter Crate 1","img":{"x":780,"y":57,"w":20,"h":35},"pathing":5,"ground":false,"w":1,"h":1,"noShow":true},{"name":"Winter Crate 2","img":{"x":801,"y":57,"w":20,"h":36},"pathing":5,"ground":false,"w":1,"h":1},{"name":"Winter Block 3","img":{"x":631,"y":129,"w":23,"h":55},"pathing":0,"ground":false,"w":1,"h":1},{"name":"Winter Block 4","img":{"x":662,"y":134,"w":18,"h":50},"pathing":0,"ground":false,"w":1,"h":1},{"name":"Winter Block 5","img":{"x":683,"y":141,"w":24,"h":43},"pathing":0,"ground":false,"w":1,"h":1},{"name":"Winter Block 6","img":{"x":711,"y":138,"w":24,"h":45},"pathing":0,"ground":false,"w":1,"h":1},{"name":"Winter Block 7","img":{"x":739,"y":139,"w":24,"h":45},"pathing":0,"ground":false,"w":1,"h":1},{"name":"Winter Block 8","img":{"x":768,"y":149,"w":24,"h":36},"pathing":5,"ground":false,"w":1,"h":1},{"name":"Winter Statue","img":{"x":677,"y":93,"w":16,"h":36},"pathing":5,"ground":false,"w":1,"h":1},{"name":"Snow Stain 1","img":{"x":658,"y":104,"w":15,"h":10},"pathing":10,"ground":true,"noGrid":true},{"name":"Snow Stain 2","img":{"x":635,"y":81,"w":16,"h":16},"pathing":10,"ground":true,"noGrid":true},{"name":"Snow Stones","img":{"x":632,"y":101,"w":24,"h":13},"pathing":10,"ground":true,"noGrid":true},{"name":"Snow Tree 2x2 1","img":{"x":614,"y":0,"w":38,"h":58},"pathing":0,"w":2,"h":2},{"name":"Snow Tree 2x2 2","img":{"x":653,"y":0,"w":36,"h":59},"pathing":0,"w":2,"h":2},{"name":"Snow Border Top","img":{"x":683,"y":190,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Snow Border Left","img":{"x":683,"y":206,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Snow Border Right","img":{"x":699,"y":206,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Snow Border Bottom","img":{"x":715,"y":206,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"isNotFull":true},{"name":"Snow 1","img":{"x":619,"y":206,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"collection":[0,1,2,3]},{"name":"Snow 2","img":{"x":635,"y":206,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Snow 3","img":{"x":651,"y":206,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Snow 4","img":{"x":667,"y":206,"w":16,"h":16},"pathing":10,"w":1,"h":1,"ground":true,"noShow":true},{"name":"Barrel","img":{"x":97,"y":97,"w":16,"h":28},"img2":{"x":757,"y":104,"w":16,"h":28},"img3":{"x":777,"y":105,"w":16,"h":28},"deathImg1":{"x":828,"y":5,"w":38,"h":34},"deathImg2":{"x":880,"y":13,"w":32,"h":26},"deathImg3":{"x":922,"y":23,"w":32,"h":15},"deathImg4":{"x":959,"y":24,"w":35,"h":14},"pathing":5,"w":1,"h":1,"ground":false,"movable":true,"radius":0.6,"hp":100},{"name":"Hallowen Barrel","img":{"x":523,"y":81,"w":16,"h":25},"img2":{"x":757,"y":104,"w":16,"h":25},"img3":{"x":777,"y":105,"w":16,"h":25},"deathImg1":{"x":828,"y":5,"w":38,"h":34},"deathImg2":{"x":880,"y":13,"w":32,"h":26},"deathImg3":{"x":922,"y":23,"w":32,"h":15},"deathImg4":{"x":959,"y":24,"w":35,"h":14},"w":1,"h":1,"pathing":5,"movable":true,"radius":0.6,"hp":100},{"name":"Winter Barrel 1","img":{"x":823,"y":65,"w":16,"h":29},"img2":{"x":821,"y":169,"w":16,"h":29},"img4":{"x":842,"y":170,"w":16,"h":29},"deathImg1":{"x":1006,"y":5,"w":38,"h":34},"deathImg2":{"x":1058,"y":13,"w":32,"h":26},"deathImg3":{"x":1100,"y":23,"w":32,"h":15},"deathImg4":{"x":1131,"y":24,"w":35,"h":14},"pathing":5,"ground":false,"w":1,"h":1,"movable":true,"radius":0.6,"hp":100},{"name":"Winter Barrel 2","img":{"x":843,"y":65,"w":16,"h":29},"img2":{"x":821,"y":169,"w":16,"h":29},"img4":{"x":842,"y":170,"w":16,"h":29},"deathImg1":{"x":1006,"y":5,"w":38,"h":34},"deathImg2":{"x":1058,"y":13,"w":32,"h":26},"deathImg3":{"x":1100,"y":23,"w":32,"h":15},"deathImg4":{"x":1131,"y":24,"w":35,"h":14},"pathing":5,"ground":false,"w":1,"h":1,"movable":true,"radius":0.6,"hp":100},{"name":"Bush 1","img":{"x":864,"y":48,"w":16,"h":40},"pathing":10,"w":1,"h":1,"blockVision":true,"collection":[0,1,2,3]},{"name":"Bush 2","img":{"x":881,"y":48,"w":16,"h":40},"pathing":10,"w":1,"h":1,"blockVision":true,"noShow":true},{"name":"Bush 3","img":{"x":898,"y":48,"w":16,"h":40},"pathing":10,"w":1,"h":1,"blockVision":true,"noShow":true},{"name":"Bush 4","img":{"x":915,"y":48,"w":16,"h":40},"pathing":10,"w":1,"h":1,"blockVision":true,"noShow":true}];for(var i=0;i<tileTypes.length;i++){tileTypes[i].id=i;}var playerLevelXp=[40,60,80,100,120,140,160,180,200,235,270,290,310,330,350,370,390,410,430,450,470,490,520,580,640,740,840,940,1140,1340,1540,1740,1940,2140,2300,2460,2620,2780,2940,3020,3100,3180,3260,3340,3420,3440,3460,3480,3500,3520];var playerLevelXpTotal=[40,100,180,280,400,540,700,880,1080,1315,1585,1875,2185,2515,2865,3235,3625,4035,4465,4915,5385,5875,6395,6975,7615,8355,9195,10135,11275,12615,14155,15895,17835,19975,22275,24735,27355,30135,33075,36095,39195,42375,45635,48975,52395,55835,59295,62775,66275,69795];function getTotalXPRequiredForLvl(lvl){var len=playerLevelXpTotal.length;var idx=lvl-2;if(idx<0){return 0;}else if(idx<len){return playerLevelXpTotal[idx];}else{return playerLevelXpTotal[len-1]+(idx-len+1)*playerLevelXp[len-1];}}function getXPRequiredForLvl(lvl){var len=playerLevelXp.length;var idx=lvl-2;if(idx<0){return 0;}else if(idx<len){return playerLevelXp[idx];}else{return playerLevelXp[len-1];}}function getLvlFromXp(xp){var len=playerLevelXpTotal.length;var xpTotal=playerLevelXpTotal[len-1];var lvl=1;if(xp<=xpTotal){for(var i=0;i<len;i++){if(xp>=playerLevelXpTotal[i]){lvl=i+2;}else{break;}}}else{lvl=len+1+Math.floor((xp-xpTotal)/playerLevelXp[len-1]);}return lvl;}function getCrystalsRequiredForLvl(lvl){return lvl<=1?0:Math.floor(Math.pow(lvl-1,1.56)*50+50);};function getLvlFromSouls(xp){var lvl=1;while(getCrystalsRequiredForLvl(lvl+1)<=xp){lvl++;}return lvl;};function getFlagXPFromPlayerCount(playerCount){if(playerCount<=1)return 0;if(playerCount==2)return 10;if(playerCount==3)return 15;if(playerCount==4)return 20;if(playerCount==5)return 25;return CONST.XP_FLAG_RETURN;};function createBounce(player,projectile,objX,objY,objAOE,killer,obj,flameDeath,weapon){var vecX=0;var vecY=0;var vecH=0;var speed=0;if(weapon&&weapon.isBeam&&killer){var gunWeight=weapon.bounceSpeed/(weapon.bounceSpeed+0.25);var projVecX=player.x-killer.x;var projVecY=player.y-killer.y;var projVecLen=Math.sqrt(projVecX*projVecX+projVecY*projVecY);var plVecLen=Math.sqrt(Math.pow(player.x-player.x0,2)+Math.pow(player.y-player.y0,2));if(projVecLen==0)projVecLen=0.001;if(plVecLen==0)plVecLen=0.001;vecX=projVecX/projVecLen*gunWeight+(player.x-player.x0)/plVecLen*(1-gunWeight);vecY=projVecY/projVecLen*gunWeight+(player.y-player.y0)/plVecLen*(1-gunWeight);vecH=weapon.bouncePower;speed=weapon.bounceSpeed*1.5;}if(flameDeath){var projVecLen=0;var plVecLen=Math.sqrt(Math.pow(player.x-player.x0,2)+Math.pow(player.y-player.y0,2));if(plVecLen==0)plVecLen=0.001;vecX=(player.x-player.x0)/plVecLen;vecY=(player.y-player.y0)/plVecLen;vecH=weapons[2].bouncePower;speed=weapons[2].bounceSpeed*1.5;}else if(projectile&&projectile.weapon.aoe){vecX=player.x-projectile.x;vecY=player.y-projectile.y;if(vecX==0&&vecY==0)vecX=0.01;vecH=Math.max((Math.min(Math.max(projectile.weapon.aoe-Math.sqrt(vecX*vecX+vecY*vecY),1.0),1.8)+0.2)*0.2,0.001);speed=vecH*2.5;if(typeof soundManager!=='undefined'&&soundManager&&soundManager.playSound)soundManager.playSound(SOUND.PUNCH,player.x,player.y,0.95);}else if(typeof objX!='undefined'&&typeof objY!='undefined'&&typeof objAOE!='undefined'&&(objX||objY||objAOE)){vecX=player.x-objX;vecY=player.y-objY;if(vecX==0&&vecY==0)vecX=0.01;vecH=Math.max((Math.min(Math.max(objAOE-Math.sqrt(vecX*vecX+vecY*vecY),1.0),1.8)+0.2)*0.2,0.001);speed=vecH*2.5;if(typeof soundManager!=='undefined'&&soundManager&&soundManager.playSound)soundManager.playSound(SOUND.PUNCH,player.x,player.y,0.95);}else if(!projectile&&typeof killer=='undefined'||obj&&obj.object&&obj.object.noBounce){vecX=Math.random()-0.5;vecY=Math.random()-0.5;vecH=0.12;speed=0.10;if(typeof soundManager!=='undefined'&&soundManager&&soundManager.playSound)soundManager.playSound(SOUND.GUN_IMPACT,player.x,player.y,0.55);}else if(projectile&&!projectile.weapon.aoe){var gunWeight=projectile.weapon.bounceSpeed/(projectile.weapon.bounceSpeed+0.25);var projVecLen=Math.sqrt(projectile.vecX*projectile.vecX+projectile.vecY*projectile.vecY);var plVecLen=Math.sqrt(Math.pow(player.x-player.x0,2)+Math.pow(player.y-player.y0,2));if(projVecLen==0)projVecLen=0.001;if(plVecLen==0)plVecLen=0.001;vecX=projectile.vecX/projVecLen*gunWeight+(player.x-player.x0)/plVecLen*(1-gunWeight);vecY=projectile.vecY/projVecLen*gunWeight+(player.y-player.y0)/plVecLen*(1-gunWeight);vecH=projectile.weapon.bouncePower;speed=projectile.weapon.bounceSpeed*1.5;}else if(killer&&killer.isZombie){vecX=player.x-killer.x;vecY=player.y-killer.y;vecH=0.15;speed=0.11;}if(vecX==0&&vecY==0){vecX=0.01;vecY=0.01;vecH=0.01;speed=0.02;}var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=speed/len;vecY*=speed/len;return{x:vecX,y:vecY,z:vecH};};function createBounce2(x,y,vecX,vecY,vecH,game){var h=0;var points=[];var running=true;while(running){var wallSmash=false;var oldX=x;var oldY=y;x+=vecX;y+=vecY;var block=game.getHeight3(Math.floor(x),Math.floor(y));if(block>h){x-=vecX*2;wallSmash=vecX>0?"right":"left";block=game.getHeight3(Math.floor(x),Math.floor(y));if(block>h){x+=vecX*2;y-=vecY*2;wallSmash=vecY>0?"bottom":"top";block=game.getHeight3(Math.floor(x),Math.floor(y));if(block>h){x-=vecX*2;if(vecX>0&&vecY>0)wallSmash="rightbottom";else if(vecX>0&&vecY<0)wallSmash="righttop";else if(vecX<0&&vecY>0)wallSmash="leftbottom";else if(vecX<0&&vecY<0)wallSmash="lefttop";}}}vecX=x-oldX;vecY=y-oldY;if(wallSmash){vecX*=0.5;vecY*=0.5;}var hitsGround=false;h+=vecH;if(h<block){h=block;vecH*=-0.6;vecX*=0.75;vecY*=0.75;if(vecH<0.05)running=false;else hitsGround=true;}vecH-=0.04;vecX*=0.97;vecY*=0.97;points.push({x:x,y:y,h:h,hitsGround:hitsGround,wallSmash:wallSmash,vecH:vecH});}return points;};function getBit(integer,index){return integer>>index&0x1;}function setBit(integer,index,bitVal){return integer&~(1<<index)|(bitVal&0x1)<<index;}var sku={1:{id:1,type:"gold",title:"sku.gold.title",amount:1000,icon:"icon_gold02_200.png",description:"sku.gold.description",prices:[{currency:'USD',amount:197}]},2:{id:2,type:"gold",title:"sku.gold.title",amount:2875,icon:"icon_gold02_200.png",description:"sku.gold.description",prices:[{currency:'USD',amount:497}]},3:{id:3,type:"gold",title:"sku.gold.title",amount:6500,icon:"icon_gold02_200.png",description:"sku.gold.description",prices:[{currency:'USD',amount:997}]},4:{id:4,type:"gold",title:"sku.gold.title",amount:14500,icon:"icon_gold02_200.png",description:"sku.gold.description",prices:[{currency:'USD',amount:1997}]},5:{id:5,type:"gold",title:"sku.gold.title",amount:40000,icon:"icon_gold02_200.png",description:"sku.gold.description",prices:[{currency:'USD',amount:4997}]},6:{id:6,type:"gold",title:"sku.gold.title",amount:87500,icon:"icon_gold02_200.png",description:"sku.gold.description",prices:[{currency:'USD',amount:9997}]}};var hatAbilities={Strength:11,Agility:12,Regeneration:13,Intelligence:14,Lifesteal:15};if(typeof exports!=='undefined'){exports.weapons=weapons;exports.itemTypes=itemTypes;exports.tileTypes=tileTypes;exports.constants=CONST;exports.creationFreeMaps=CREATION_FREE_MAPS;exports.authLevel=AUTH_LEVEL;exports.getTotalXPRequiredForLvl=getTotalXPRequiredForLvl;exports.getXPRequiredForLvl=getXPRequiredForLvl;exports.getLvlFromXp=getLvlFromXp;exports.getCrystalsRequiredForLvl=getCrystalsRequiredForLvl;exports.getLvlFromSouls=getLvlFromSouls;exports.hats=hats;exports.nameColor=NAME_COLOR;exports.hatsByQuality=hatsByQuality;exports.MAP_TYPE=MAP_TYPE;exports.MAP_TYPE_SETTINGS=MAP_TYPE_SETTINGS;exports.objects=objects;exports.hero=hero;exports.abilities=abilities;exports.nbs=nbs;exports.killStreaks=killStreaks;exports.multiKills=multiKills;exports.getDefaultAbilityObj=getDefaultAbilityObj;exports.getTutorialAbilityObj=getTutorialAbilityObj;exports.getDefaultZombieAbilityObj=getDefaultZombieAbilityObj;exports.getFlagXPFromPlayerCount=getFlagXPFromPlayerCount;exports.createBounce=createBounce;exports.createBounce2=createBounce2;exports.getBit=getBit;exports.setBit=setBit;exports.sku=sku;exports.treasureChests=treasureChests;exports.questTypes=questTypes;exports.roundEndChestRewards=roundEndChestRewards;exports.qualityPlus=hatQualityPlus;exports.hatAbilities=hatAbilities;}"use strict";var win;if(window.nw){win=nw.Window.get();}if(isDesktop&&isSteam){if(win){SteamInfo=win.onSteam();if(SteamInfo){if(!(localStorage.getItem('not-fullscreen')|0)){win.enterFullscreen();}}}else{ipcRenderer.on('steam',function(_,arg){SteamInfo=arg;});ipcRenderer.send('steam',true);}}var Desktop=function(){function Desktop(){_classCallCheck(this,Desktop);}_createClass(Desktop,null,[{key:"close",value:function close(){if(win){win.close();}else{Desktop._cmd('toggleFullscreen');}}},{key:"toggleFullscreen",value:function toggleFullscreen(){if(win){localStorage.setItem('not-fullscreen',win.isFullscreen|0);win.toggleFullscreen();}else{Desktop._cmd('toggleFullscreen');}}},{key:"_cmd",value:function _cmd(s){if(win){return false;}ipcRenderer.send('cmd',s);if(window.debugMode){console.log('_cmd send',s);}}}]);return Desktop;}();var Steam=function(){function Steam(){_classCallCheck(this,Steam);}_createClass(Steam,null,[{key:"login",value:function login(){var data={id:SteamInfo.user.steamId,nick:SteamInfo.user.screenName,ticket:SteamInfo.ticket};network.send('loginSteam$'+JSON.stringify(data));}}]);return Steam;}();function steamInitWait(box){if(!isSteam){return;}if(localStorage.getItem('steamPrepareLoading')){return;}var o=steamInitWaitText();if(box){o.className='steamPrepareLoading';box.appendChild(o);return;}if(document.getElementById('steamPrepareLoading')){return;}o.id='steamPrepareLoading';document.body.appendChild(o);}function steamInitWaitHide(){localStorage.setItem('steamPrepareLoading',1);var o=document.getElementById('steamPrepareLoading');if(o){o.style.display='none';}}function steamInitWaitText(){var o=document.createElement('div');o.innerText=F_('steam.text.createWait');return o;}var isSteamBindSend=false;function canvasToTab(c){var dataURL=c.toDataURL("image/png");open().document.write('<img src="'+dataURL+'" />');}var canvasDebugCount=0;var canvasDebugLog=[];var isDevSnap=false;function canvasSnap(){if(!isDevSnap){return;}canvasToTab(c.canvas);}var drawTimeLog=[];var drawTimeLogTotal={};var drawTimeLogKey=false;var miniMapCount=0;function addDrawLog(s){if(!debugMode){return;}drawTimeLog.push({name:s,time:Date.now()});}function drawBenchmark(){var info=game.benchmarkInfo;info.count++;if(info.count==10){info.time=Date.now();}if(info.count==20){game.benchmark=false;var t=Date.now()-info.time;if(debugMode){console.warn('benchmark time =',t);}if(t>170){game.isLowGraphicEffect=true;}}}function makeDrawLog(){var cost=Date.now();drawTimeLog=[];game.draw();cost=Date.now()-cost;var current={};var preT=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=drawTimeLog[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var t=_step2.value;if(preT){current[t.name]=t.time-preT;}preT=t.time;}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}if(drawTimeLogKey){for(var k in current){drawTimeLogTotal[k]+=current[k];}}else{drawTimeLogKey=true;for(var k in current){drawTimeLogTotal[k]=current[k];}}if(cost>16){console.log('game.draw()',cost,drawTimeLogTotal,current);}}function gameDraw(){if(game.benchmark){drawBenchmark();}var now=Date.now();var fps=game.calcFps(now);addDrawLog('start');if(game.playingPlayer&&!game.playingPlayer.dieAt&&KeyManager.leftMouse&&game.playingPlayer.weapon&&game.lastTimeMousePosSent+65<now){var wpn=game.playingPlayer.weapon;var msTillNextShoot=(Math.max(game.playingPlayer.weaponCooldowns[wpn.id],0)+Math.max(game.playingPlayer.switchWeaponUntil-game.ticksCounter,0))*50;if(!isMobile&&msTillNextShoot-network.lastPing-150<0){game.mouseUpdate();game.lastTimeMousePosSent=now;}if(msTillNextShoot<=0&&game.lastEmptyClipSound+500<now&&!game.playingPlayerClips[wpn.id]&&!game.playingPlayerAmmo[wpn.id]&&game.playingPlayer.weaponCooldowns[wpn.id]<=0&&(game.playingPlayer.weaponCooldowns2[wpn.id]<=0||game.playingPlayer.weaponCooldowns2[wpn.id]>=wpn.cooldown2)){game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.no_ammo"),"grey","textInGrey");soundManager.playSound(SOUND.EMPTY_CLIP,game.playingPlayer.x,game.playingPlayer.y,0.75);game.lastEmptyClipSound=now;}}else if(game.playingPlayerCountActiveHeatseeking2Missiles>0&&game.lastTimeMousePosSent+65<now){game.mouseUpdate();game.lastTimeMousePosSent=now;}if(isMobile&&game.playingPlayer&&KeyManager){drawMobileMovement();}var percentageOfCurrentTickPassed=Math.min((now-lastUpdate)/window.replayOption.tickTime,1);var exactTicks=game.ticksCounter<0?game.roundTime:game.ticksCounter+percentageOfCurrentTickPassed;if(game.ticksCounter<0)percentageOfCurrentTickPassed=0;addDrawLog('before scale');WIDTH=window.innerWidth;HEIGHT=window.innerHeight;if(game.playingPlayer)SCALE_CONST=0.06;FIELD_SIZE=Math.sqrt(WIDTH*HEIGHT)*SCALE_CONST;SCALE_FACTOR=FIELD_SIZE/16;if(!game.editingMode&&!game.fastForward){var x=0;var y=0;var p=null;if(game.playingPlayer){var playerWeight=1;if(game.playingPlayer.standTime&&game.playingPlayer.weapon&&game.playingPlayer.weapon.requiredStandTime){var extraWeight=Math.min((game.playingPlayer.standTime+percentageOfCurrentTickPassed)/game.playingPlayer.weapon.requiredStandTime,1);playerWeight+=-(Math.pow(extraWeight*1.26,3)-Math.pow(extraWeight*1.26-0.04,2)*2)*1.5;}x=((game.playingPlayer.x0+percentageOfCurrentTickPassed*(game.playingPlayer.x-game.playingPlayer.x0)-game.cameraX)*FIELD_SIZE*2+KeyManager.x*playerWeight)/(2+playerWeight)/FIELD_SIZE+game.cameraX;y=((game.playingPlayer.y0+percentageOfCurrentTickPassed*(game.playingPlayer.y-game.playingPlayer.y0)-game.cameraY)*FIELD_SIZE*2+KeyManager.y*playerWeight)/(2+playerWeight)/FIELD_SIZE+game.cameraY;}else if(game.players.length>0){if(game.iAmSpec){p=game.specPlayer;}else{p=game.players[Math.floor(game.ticksCounter/80)%game.players.length];}if(p){x=((p.x0+percentageOfCurrentTickPassed*(p.x-p.x0)-game.cameraX)*FIELD_SIZE*2+KeyManager.x)/3/FIELD_SIZE+game.cameraX;y=((p.y0+percentageOfCurrentTickPassed*(p.y-p.y0)-game.cameraY)*FIELD_SIZE*2+KeyManager.y)/3/FIELD_SIZE+game.cameraY;}}if(game.players.length>0){game.cameraX=-(WIDTH/2)/FIELD_SIZE+x;game.cameraY=-(HEIGHT/2)/FIELD_SIZE+y;}if(game.iAmSpec&&!p){if(KeyManager.keys[commandKeys[COMMAND.UP]])game.specY-=timeDiff*0.019;if(KeyManager.keys[commandKeys[COMMAND.DOWN]])game.specY+=timeDiff*0.019;if(KeyManager.keys[commandKeys[COMMAND.LEFT]])game.specX-=timeDiff*0.019;if(KeyManager.keys[commandKeys[COMMAND.RIGHT]])game.specX+=timeDiff*0.019;game.cameraX=game.specX;game.cameraY=game.specY;}}addDrawLog('c1');if(game.rumbleUntil>now){var power=game.rumblePower*(1-(now-game.rumbleStart)/(game.rumbleUntil-game.rumbleStart));game.cameraX+=Math.random()*power*2-power;game.cameraY+=Math.random()*power*2-power;}game.cameraX2=game.cameraX+WIDTH/FIELD_SIZE;game.cameraY2=game.cameraY+HEIGHT/FIELD_SIZE;c.fillStyle="#30302C";c.fillRect(0,0,WIDTH,HEIGHT);addDrawLog('clear screen');if(!game.fastForward){var canv=game.groundCanvas[Math.floor(exactTicks/10)%game.groundCanvas.length];var drawW=Math.min(WIDTH,canv.width*SCALE_FACTOR);var drawH=Math.min(HEIGHT,canv.height*SCALE_FACTOR);c.drawImage(canv,(game.cameraX-game.groundMinX)*16,(game.cameraY-game.groundMinY)*16,drawW/SCALE_FACTOR,drawH/SCALE_FACTOR,0,0,drawW,drawH);addDrawLog('ground');var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=game.walkways[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var w=_step3.value;if(w.x+1>=game.cameraX&&w.y+1>=game.cameraY&&w.x-1<=game.cameraX2&&w.y-1<=game.cameraY2){var t=w.type;var sX=w.shiftX?t.img.x+8*Math.sign(w.shiftX)-w.shiftX*16*exactTicks%16:t.img.x;var sY=w.shiftY?t.img.y+8*Math.sign(w.shiftY)-w.shiftY*16*exactTicks%16:t.img.y;var x=(w.x-game.cameraX)*FIELD_SIZE;var y=(w.y-game.cameraY)*FIELD_SIZE;c.drawImage(imgs.tileSheet,sX,sY,t.img.w,t.img.h,x,y,t.w*FIELD_SIZE,t.h*FIELD_SIZE);}}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}for(var i=0;i<game.whiteCircles.length;i++){var wc=game.whiteCircles[i];if(wc.time+30>game.ticksCounter){var age=exactTicks-wc.time;var img=wc.img;var scale=age*6.0;var drawX=g2rx(wc.x)-img.w/2*scale;var drawY=g2ry(wc.y)-img.h/2*scale;c.globalAlpha=Math.max(0.4-age/20,0);c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,drawX,drawY,img.w*scale,img.h*scale);c.globalAlpha=1;}else{game.whiteCircles.splice(i,1);i--;}}addDrawLog('before fog');var fieldsCount=imgCoords.fog.w/16;drawFog(c,exactTicks,imgCoords,fieldsCount);addDrawLog('before obj');var objs=game.objectsToDraw.slice();for(var i=0;i<objs.length;i++){objs[i].draw(exactTicks,game.cameraX,game.cameraY,game.cameraX2,game.cameraY2,percentageOfCurrentTickPassed);}addDrawLog('after obj');if(game.editingMode){game.editor.draw();return;}if(game.playingPlayer&&game.playingPlayer.weapon&&game.playingPlayer.weapon.isHeatSeeking){game.refreshLockedPlayer(getMouseGamePlayX(),getMouseGamePlayY());if(game.targetLockedPlayer){var scale=SCALE_FACTOR*(1.7-Math.floor(game.ticksCounter*0.4)%4*0.1);var p=game.targetLockedPlayer;var x_=(p.x0+percentageOfCurrentTickPassed*(p.x-p.x0)-game.cameraX)*FIELD_SIZE-imgCoords.aimLock.w/2*scale;var y_=(p.y0+percentageOfCurrentTickPassed*(p.y-p.y0)-game.cameraY)*FIELD_SIZE-imgCoords.aimLock.h*0.75*scale;c.drawImage(imgs.miscSheet,imgCoords.aimLock.x,imgCoords.aimLock.y,imgCoords.aimLock.w,imgCoords.aimLock.h,x_,y_,scale*imgCoords.aimLock.w,scale*imgCoords.aimLock.h);}}else game.targetLockedPlayer=null;if(game.playingPlayer&&game.playingPlayer.weapon&&game.playingPlayer.weapon.autoAimRange){var p=game.getClosestAlly(getMouseGamePlayX(),getMouseGamePlayY(),game.playingPlayer.weapon.autoAimRange);if(p){var scale=SCALE_FACTOR*(1.7-Math.floor(game.ticksCounter*0.4)%4*0.1);var x_=(p.x0+percentageOfCurrentTickPassed*(p.x-p.x0)-game.cameraX)*FIELD_SIZE-imgCoords.aimLockGreen.w/2*scale;var y_=(p.y0+percentageOfCurrentTickPassed*(p.y-p.y0)-game.cameraY)*FIELD_SIZE-imgCoords.aimLockGreen.h*0.75*scale;c.drawImage(imgs.miscSheet,imgCoords.aimLockGreen.x,imgCoords.aimLockGreen.y,imgCoords.aimLockGreen.w,imgCoords.aimLockGreen.h,x_,y_,scale*imgCoords.aimLockGreen.w,scale*imgCoords.aimLockGreen.h);}}for(var i=0;i<game.floatingTexts.length;i++){game.floatingTexts[i].draw();}var x1=game.cameraX+(game.cameraX2-game.cameraX)/2;if(!game.isLowGraphicEffect){c.globalAlpha=0.05;for(var x=0-fieldsCount-exactTicks/73.27%fieldsCount;x<game.map.x+fieldsCount;x+=fieldsCount){for(var y=0-fieldsCount-exactTicks/77.41%fieldsCount;y<game.map.y+fieldsCount;y+=fieldsCount){var x_=(x1+(x-x1)*1.5-game.cameraX)*FIELD_SIZE;var y_=(game.cameraY2+(y-game.cameraY2)*1.5-game.cameraY)*FIELD_SIZE;if(x_<=WIDTH&&y_<=HEIGHT&&x_+imgCoords.fog.w*SCALE_FACTOR*1.5>=0&&y_+imgCoords.fog.h*SCALE_FACTOR*1.5>=0)c.drawImage(imgs.tileSheet,imgCoords.fog.x,imgCoords.fog.y,imgCoords.fog.w,imgCoords.fog.h,x_,y_,SCALE_FACTOR*1.5*imgCoords.fog.w,SCALE_FACTOR*1.5*imgCoords.fog.h);}}c.globalAlpha=1;}addDrawLog('after fog 2');if(game.playingPlayer&&game.playingPlayer.weapon&&game.playingPlayer.weapon.range&&game.playingPlayer.switchWeaponUntil<=game.ticksCounter){var x=(game.playingPlayer.x0+percentageOfCurrentTickPassed*(game.playingPlayer.x-game.playingPlayer.x0)-game.cameraX)*FIELD_SIZE;var y=(game.playingPlayer.y0+percentageOfCurrentTickPassed*(game.playingPlayer.y-game.playingPlayer.y0)-game.cameraY)*FIELD_SIZE;c.globalAlpha=0.2;drawCircle(x,y,FIELD_SIZE*(game.playingPlayer.weapon.range+CONST.PLAYER_RADIUS),"white");c.globalAlpha=1;}if(game.playingPlayer&&KeyManager.activeAbility&&KeyManager.activeAbility.range){var x=(game.playingPlayer.x0+percentageOfCurrentTickPassed*(game.playingPlayer.x-game.playingPlayer.x0)-game.cameraX)*FIELD_SIZE;var y=(game.playingPlayer.y0+percentageOfCurrentTickPassed*(game.playingPlayer.y-game.playingPlayer.y0)-game.cameraY)*FIELD_SIZE;c.globalAlpha=0.2;drawCircle(x,y,FIELD_SIZE*game.getAbilityFieldValue(KeyManager.activeAbility,"range"),"white");c.globalAlpha=1;}if(game.playingPlayer&&KeyManager.activeAbility&&KeyManager.activeAbility.type=="place"&&KeyManager.activeAbility.object){var target=game.getPotentialPlaceTarget(KeyManager.activeAbility);if(target){var obj=objects[KeyManager.activeAbility.object];var ani=animationData[obj.animation];var scale=SCALE_FACTOR*(obj.imgScale?obj.imgScale:1);var img=imgCoords[obj.img[0]];var x=(target.x-game.cameraX)*FIELD_SIZE+-img.w/2*scale;var y=(target.y+(obj.yOffset?obj.yOffset:0)/16-0.2-game.cameraY)*FIELD_SIZE+(8-img.h)*scale;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x,y,img.w*scale,img.h*scale);if(ani&&ani.imgTurret01){img=ani.imgTurret01;var x2=(target.x-game.cameraX)*FIELD_SIZE+-img.w/2*scale;var y2=(target.y-0.2-game.cameraY)*FIELD_SIZE+(8-img.h)*scale;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x2,y2,img.w*scale,img.h*scale);}}}addDrawLog('before fairies');if(!game.isLowGraphicEffect){var x1=game.cameraX+(game.cameraX2-game.cameraX)/2;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=game.fairies[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var fairy=_step4.value;fairy.draw(exactTicks,x1,game.cameraY2);}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}}if(!game.isLowGraphicEffect){c.globalAlpha=0.6;c.drawImage(imgs.miscSheet,imgCoords.filter.x,imgCoords.filter.y,imgCoords.filter.w,imgCoords.filter.h,0,0,WIDTH,HEIGHT);c.globalAlpha=1;}addDrawLog('fairies');if(game.miniMap){miniMapCount++;if(miniMapCount==5){miniMapCount=0;game.miniMap.render(percentageOfCurrentTickPassed);}}addDrawLog('mini map');if(game.redScreen>0){c.fillStyle="rgba(255, 0, 0, "+game.redScreen/650+")";c.fillRect(0,0,WIDTH,HEIGHT);game.redScreen-=timeDiff;}if(game.lastPickUp+250>=now){c.fillStyle="rgba(255, 255, 255, "+(125-Math.abs(125-(now-game.lastPickUp)))/450+")";c.fillRect(0,0,WIDTH,HEIGHT);}addDrawLog('full screen');}var str="";if(game.editingMode||game.interface_.hoverWeapon>=0||game.interface_.hoverAbility>=0||game.interface_.hoverChoice||game.interface_.buttonIsHovered||game.interface_.skipButtonHover||game.interface_.unskipButtonHover)str="url(\""+window.ResourcePath+"imgs/cursor.cur\"), auto";else if(game.playingPlayer&&KeyManager.activeAbility&&(KeyManager.activeAbility.type=="blink"&&game.playingPlayer.carriesFlag()||KeyManager.activeAbility.energy>game.playingPlayerEnergy||game.lastAbilityUses[pl_active_abilities[0]==KeyManager.activeAbility?0:1]+KeyManager.activeAbility.cooldown>game.ticksCounter))str="url(\""+window.ResourcePath+"imgs/cx.cur\"), auto";else if(game.playingPlayer&&KeyManager.activeAbility&&KeyManager.activeAbility.type=="blink")str="url(\""+window.ResourcePath+"imgs/cb.cur\"), auto";else if(game.playingPlayerCountActiveHeatseeking2Missiles>0)str="url(\""+window.ResourcePath+"imgs/crosshair"+(game.ticksCounter%10<5?"2":"")+".png\") 26 26, auto";else if(game.playingPlayer&&game.playingPlayer.weapon&&game.playingPlayer.weapon.aoeCursor&&!game.playingPlayer.dieAt){drawCircle(KeyManager.x,KeyManager.y,game.playingPlayer.weapon.aoe*FIELD_SIZE,null,"rgba(255, 150, 150, 0.2)",0.9);drawCircle(KeyManager.x,KeyManager.y,0.066*FIELD_SIZE,null,"rgba(255, 255, 255, 0.15)",0.9);str="none";}else if(game.playingPlayer&&game.playingPlayer.weapon&&!game.playingPlayer.weapon.aoeCursor&&!game.playingPlayer.dieAt){var cur=0;if(KeyManager.leftMouse)cur=6;str="url(\""+window.ResourcePath+"imgs/c"+cur+".cur\"), auto";}else{str="url(\""+window.ResourcePath+"imgs/cursor.cur\"), auto";}if(game.lastCursorStr!=str){game.lastCursorStr=str;canvas.style.cursor=str;}addDrawLog('cursor');if(!game.mapWelcome)game.interface_.draw(exactTicks);addDrawLog('exactTicks');}function drawFog(c,exactTicks,imgCoords,fieldsCount){if(game.isLowGraphicEffect){return;}c.globalAlpha=0.06;for(var x=-fieldsCount+exactTicks/67%fieldsCount;x<game.map.x;x+=fieldsCount){for(var y=-fieldsCount+exactTicks/63.23%fieldsCount;y<game.map.y;y+=fieldsCount){var x_cut_1=0;if(x<0)x_cut_1=-x;var y_cut_1=0;if(y<0)y_cut_1=-y;var x_cut_2=0;if(x+fieldsCount>game.map.x)x_cut_2=x+fieldsCount-game.map.x;var y_cut_2=0;if(y+fieldsCount>game.map.y)y_cut_2=y+fieldsCount-game.map.y;var x_target=(x+x_cut_1-game.cameraX)*FIELD_SIZE;var y_target=(y+y_cut_1-game.cameraY)*FIELD_SIZE;var x_source=imgCoords.fog.x+x_cut_1*16;var y_source=imgCoords.fog.y+y_cut_1*16;var w_source=imgCoords.fog.w-(x_cut_1+x_cut_2)*16;var h_source=imgCoords.fog.h-(y_cut_1+y_cut_2)*16;var w_target=w_source*SCALE_FACTOR;var h_target=h_source*SCALE_FACTOR;if(x_target<=WIDTH&&y_target<=HEIGHT&&x_target+w_target>=0&&y_target+h_target>=0)c.drawImage(imgs.tileSheet,x_source,y_source,w_source,h_source,x_target,y_target,w_target,h_target);}}c.globalAlpha=1;}function drawMobileMovement(){for(var k=0;k<game.interface_.buttons.length;k++){game.interface_.buttons[k].isPressedOld=game.interface_.buttons[k].isPressed;game.interface_.buttons[k].isPressed=false;}for(var i=0;i<KeyManager.ongoingTouches.length;i++){var touch=KeyManager.ongoingTouches[i];for(var k=0;k<game.interface_.buttons.length;k++){if(game.interface_.buttons[k].contains(touch.pageX,touch.pageY))game.interface_.buttons[k].isPressed=true;}}for(var k=0;k<game.interface_.buttons.length;k++){if(game.interface_.buttons[k].isPressed!=game.interface_.buttons[k].isPressedOld)network.send((game.interface_.buttons[k].isPressed?"kdn$":"kup$")+keyCodes[game.interface_.buttons[k].key]);}}(function(window){var BlockAdBlock=function BlockAdBlock(options){this._options={checkOnLoad:false,resetOnEnd:false,loopCheckTime:50,loopMaxNumber:5,baitClass:'pub_300x250 pub_300x250m pub_728x90 text-ad textAd text_ad text_ads text-ads text-ad-links',baitStyle:'width: 1px !important; height: 1px !important; position: absolute !important; left: -10000px !important; top: -1000px !important;',debug:false};this._var={version:'3.2.1',bait:null,checking:false,loop:null,loopNumber:0,event:{detected:[],notDetected:[]}};if(options!==undefined){this.setOption(options);}var self=this;var eventCallback=function eventCallback(){setTimeout(function(){if(self._options.checkOnLoad===true){if(self._options.debug===true){self._log('onload->eventCallback','A check loading is launched');}if(self._var.bait===null){self._creatBait();}setTimeout(function(){self.check();},1);}},1);};if(window.addEventListener!==undefined){window.addEventListener('load',eventCallback,false);}else{window.attachEvent('onload',eventCallback);}};BlockAdBlock.prototype._options=null;BlockAdBlock.prototype._var=null;BlockAdBlock.prototype._bait=null;BlockAdBlock.prototype._log=function(method,message){console.log('[BlockAdBlock]['+method+'] '+message);};BlockAdBlock.prototype.setOption=function(options,value){if(value!==undefined){var key=options;options={};options[key]=value;}for(var option in options){this._options[option]=options[option];if(this._options.debug===true){this._log('setOption','The option "'+option+'" he was assigned to "'+options[option]+'"');}}return this;};BlockAdBlock.prototype._creatBait=function(){var bait=document.createElement('div');bait.setAttribute('class',this._options.baitClass);bait.setAttribute('style',this._options.baitStyle);this._var.bait=window.document.body.appendChild(bait);this._var.bait.offsetParent;this._var.bait.offsetHeight;this._var.bait.offsetLeft;this._var.bait.offsetTop;this._var.bait.offsetWidth;this._var.bait.clientHeight;this._var.bait.clientWidth;if(this._options.debug===true){this._log('_creatBait','Bait has been created');}};BlockAdBlock.prototype._destroyBait=function(){window.document.body.removeChild(this._var.bait);this._var.bait=null;if(this._options.debug===true){this._log('_destroyBait','Bait has been removed');}};BlockAdBlock.prototype.check=function(loop){if(loop===undefined){loop=true;}if(this._options.debug===true){this._log('check','An audit was requested '+(loop===true?'with a':'without')+' loop');}if(this._var.checking===true){if(this._options.debug===true){this._log('check','A check was canceled because there is already an ongoing');}return false;}this._var.checking=true;if(this._var.bait===null){this._creatBait();}var self=this;this._var.loopNumber=0;if(loop===true){this._var.loop=setInterval(function(){self._checkBait(loop);},this._options.loopCheckTime);}setTimeout(function(){self._checkBait(loop);},1);if(this._options.debug===true){this._log('check','A check is in progress ...');}return true;};BlockAdBlock.prototype._checkBait=function(loop){var detected=false;if(this._var.bait===null){this._creatBait();}if(window.document.body.getAttribute('abp')!==null||this._var.bait.offsetParent===null||this._var.bait.offsetHeight==0||this._var.bait.offsetLeft==0||this._var.bait.offsetTop==0||this._var.bait.offsetWidth==0||this._var.bait.clientHeight==0||this._var.bait.clientWidth==0){detected=true;}if(window.getComputedStyle!==undefined){var baitTemp=window.getComputedStyle(this._var.bait,null);if(baitTemp&&(baitTemp.getPropertyValue('display')=='none'||baitTemp.getPropertyValue('visibility')=='hidden')){detected=true;}}if(this._options.debug===true){this._log('_checkBait','A check ('+(this._var.loopNumber+1)+'/'+this._options.loopMaxNumber+' ~'+(1+this._var.loopNumber*this._options.loopCheckTime)+'ms) was conducted and detection is '+(detected===true?'positive':'negative'));}if(loop===true){this._var.loopNumber++;if(this._var.loopNumber>=this._options.loopMaxNumber){this._stopLoop();}}if(detected===true){this._stopLoop();this._destroyBait();this.emitEvent(true);if(loop===true){this._var.checking=false;}}else if(this._var.loop===null||loop===false){this._destroyBait();this.emitEvent(false);if(loop===true){this._var.checking=false;}}};BlockAdBlock.prototype._stopLoop=function(detected){clearInterval(this._var.loop);this._var.loop=null;this._var.loopNumber=0;if(this._options.debug===true){this._log('_stopLoop','A loop has been stopped');}};BlockAdBlock.prototype.emitEvent=function(detected){if(this._options.debug===true){this._log('emitEvent','An event with a '+(detected===true?'positive':'negative')+' detection was called');}var fns=this._var.event[detected===true?'detected':'notDetected'];for(var i in fns){if(this._options.debug===true){this._log('emitEvent','Call function '+(parseInt(i)+1)+'/'+fns.length);}if(fns.hasOwnProperty(i)){fns[i]();}}if(this._options.resetOnEnd===true){this.clearEvent();}return this;};BlockAdBlock.prototype.clearEvent=function(){this._var.event.detected=[];this._var.event.notDetected=[];if(this._options.debug===true){this._log('clearEvent','The event list has been cleared');}};BlockAdBlock.prototype.on=function(detected,fn){this._var.event[detected===true?'detected':'notDetected'].push(fn);if(this._options.debug===true){this._log('on','A type of event "'+(detected===true?'detected':'notDetected')+'" was added');}return this;};BlockAdBlock.prototype.onDetected=function(fn){return this.on(true,fn);};BlockAdBlock.prototype.onNotDetected=function(fn){return this.on(false,fn);};window.BlockAdBlock=BlockAdBlock;if(window.blockAdBlock===undefined){window.blockAdBlock=new BlockAdBlock({checkOnLoad:true,resetOnEnd:true});}})(window);Object.defineProperty(String.prototype,"literal",{get:function get(){try{return JSON.parse(this);}catch(e){return this;}}});if(!Math.sign){Math.sign=function(x){x=+x;if(x===0||isNaN(x)){return Number(x);}return x>0?1:-1;};}if(typeof Object.values!="function"){Object.values=function(obj){if(Array.isArray(obj)){return obj;}var values=[];for(var key in obj){if(obj.hasOwnProperty(key)){values.push(obj[key]);}}return values;};}if(!Object.assign){Object.defineProperty(Object,'assign',{enumerable:false,configurable:true,writable:true,value:function value(target){'use strict';if(target===undefined||target===null){throw new TypeError('Cannot convert first argument to object');}var to=Object(target);for(var i=1;i<arguments.length;i++){var nextSource=arguments[i];if(nextSource===undefined||nextSource===null){continue;}nextSource=Object(nextSource);var keysArray=Object.keys(Object(nextSource));for(var nextIndex=0,len=keysArray.length;nextIndex<len;nextIndex++){var nextKey=keysArray[nextIndex];var desc=Object.getOwnPropertyDescriptor(nextSource,nextKey);if(desc!==undefined&&desc.enumerable){to[nextKey]=nextSource[nextKey];}}}return to;}});}if(!Array.from){Array.from=function(){var toStr=Object.prototype.toString;var isCallable=function isCallable(fn){return typeof fn==='function'||toStr.call(fn)==='[object Function]';};var toInteger=function toInteger(value){var number=Number(value);if(isNaN(number)){return 0;}if(number===0||!isFinite(number)){return number;}return(number>0?1:-1)*Math.floor(Math.abs(number));};var maxSafeInteger=Math.pow(2,53)-1;var toLength=function toLength(value){var len=toInteger(value);return Math.min(Math.max(len,0),maxSafeInteger);};return function from(arrayLike){var C=this;var items=Object(arrayLike);if(arrayLike==null){throw new TypeError("Array.from requires an array-like object - not null or undefined");}var mapFn=arguments.length>1?arguments[1]:void undefined;var T;if(typeof mapFn!=='undefined'){if(!isCallable(mapFn)){throw new TypeError('Array.from: when provided, the second argument must be a function');}if(arguments.length>2){T=arguments[2];}}var len=toLength(items.length);var A=isCallable(C)?Object(new C(len)):new Array(len);var k=0;var kValue;while(k<len){kValue=items[k];if(mapFn){A[k]=typeof T==='undefined'?mapFn(kValue,k):mapFn.call(T,kValue,k);}else{A[k]=kValue;}k+=1;}A.length=len;return A;};}();}(function(){if(typeof window.CustomEvent==="function")return false;function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent;})();if(!document.documentElement.dataset&&(!Object.getOwnPropertyDescriptor(Element.prototype,'dataset')||!Object.getOwnPropertyDescriptor(Element.prototype,'dataset').get)){var propDescriptor={enumerable:true,get:function get(){'use strict';var i,that=this,HTML5_DOMStringMap,attrVal,attrName,propName,attribute,attributes=this.attributes,attsLength=attributes.length,toUpperCase=function toUpperCase(n0){return n0.charAt(1).toUpperCase();},getter=function getter(){return this;},setter=function setter(attrName,value){return typeof value!=='undefined'?this.setAttribute(attrName,value):this.removeAttribute(attrName);};try{({}).__defineGetter__('test',function(){});HTML5_DOMStringMap={};}catch(e1){HTML5_DOMStringMap=document.createElement('div');}for(i=0;i<attsLength;i++){attribute=attributes[i];if(attribute&&attribute.name&&/^data-\w[\w\-]*$/.test(attribute.name)){attrVal=attribute.value;attrName=attribute.name;propName=attrName.substr(5).replace(/-./g,toUpperCase);try{Object.defineProperty(HTML5_DOMStringMap,propName,{enumerable:this.enumerable,get:getter.bind(attrVal||''),set:setter.bind(that,attrName)});}catch(e2){HTML5_DOMStringMap[propName]=attrVal;}}}return HTML5_DOMStringMap;}};try{Object.defineProperty(Element.prototype,'dataset',propDescriptor);}catch(e){propDescriptor.enumerable=false;Object.defineProperty(Element.prototype,'dataset',propDescriptor);}}(function(){var regExp=function regExp(name){return new RegExp('(^| )'+name+'( |$)');};var forEach=function forEach(list,fn,scope){for(var i=0;i<list.length;i++){fn.call(scope,list[i]);}};function ClassList(element){this.element=element;}ClassList.prototype={add:function add(){forEach(arguments,function(name){if(!this.contains(name)){this.element.className+=this.element.className.length>0?' '+name:name;}},this);},remove:function remove(){forEach(arguments,function(name){this.element.className=this.element.className.replace(regExp(name),'');},this);},toggle:function toggle(name){return this.contains(name)?(this.remove(name),false):(this.add(name),true);},contains:function contains(name){return regExp(name).test(this.element.className);},replace:function replace(oldName,newName){this.remove(oldName),this.add(newName);}};if(!('classList'in Element.prototype)){Object.defineProperty(Element.prototype,'classList',{get:function get(){return new ClassList(this);}});}if(window.DOMTokenList&&DOMTokenList.prototype.replace==null){DOMTokenList.prototype.replace=ClassList.prototype.replace;}})();HTMLElement.prototype.on=HTMLElement.prototype.addEventListener;HTMLElement.prototype.off=HTMLElement.prototype.removeEventListener;HTMLElement.prototype.fire=HTMLElement.prototype.dispatchEvent;HTMLElement.prototype.getClasses=function(){if(this.classList){var ret=[];for(var i=0,length=this.classList.length;i<length;i++){ret.push(this.classList.item(i));}return ret;}else{return this.className.split(/\s+/).filter(function(e){return e!='';});}};HTMLElement.prototype.hasClass=function(className){if(this.classList){return this.classList.contains(className);}else{return this.getClasses().indexOf(className)>=0;}};HTMLElement.prototype.addClass=function(className){if(!this.hasClass(className)){if(this.classList){this.classList.add(className);}else{this.className+=' '+className;}}};HTMLElement.prototype.removeClass=function(className){if(this.classList){this.classList.remove(className);}else{this.className=this.getClasses().filter(function(e){return e!=className;}).join(' ');}};HTMLElement.prototype.getSubComponent=function(className){var ret=this.getSubComponents(className,1);if(ret.length>0){return ret[0];}return null;};HTMLElement.prototype.getSubComponents=function(className,limit){var list=this.getElementsByClassName(className);var ret=[];for(var i=0,length=list.length;i<length;i++){var ele=list.item(i);if(ele.parentNode==this){ret.push(ele);if(limit<=list.length){break;}}}return ret;};HTMLElement.prototype.presentSubComponent=function(){var className=arguments[0];var tagName=null;var created=null;var Reference=FunUI.utils.Reference;for(var i=1;i<arguments.length;i++){if(typeof arguments[i]=="string"){tagName=arguments[i];}else if(arguments[i]instanceof Reference){created=arguments[i];created.set(false);}}var subComponent=this.getSubComponent(className);if(!subComponent){subComponent=this.appendChild(function(){var element=document.createElement(tagName||'div');element.className=className;return element;}());if(created){created.set(true);}}return subComponent;};HTMLElement.prototype.presentLabelChild=function(force){var label=this.getSubComponent('label');if(!label){var childNodes=this.childNodes;var contentNode=null;for(var i=0,length=childNodes.length;i<length;i++){var childNode=childNodes[i];if(childNode.nodeType==Node.TEXT_NODE&&childNode.nodeValue.trim()!=''){contentNode=childNode;break;}}if(contentNode!=null||force){label=document.createElement('span');label.className='label';if(contentNode!=null){label.innerHTML=contentNode.nodeValue;this.replaceChild(label,contentNode);}else{this.appendChild(label);}}}return label;};HTMLElement.prototype.delayCall=function(callback){if(typeof callback!='function'){throw new Error('callback must be a function');}if(!this._delayedCalls){this._delayedCalls=[];}if(arguments.length>=2){callback=Function.prototype.bind.apply(callback,Array.prototype.slice.call(arguments,1));}this._delayedCalls.push(callback);this.invalidate();};HTMLElement.prototype.initFunUI=function(){var mutationObserver=new MutationObserver(function(mutations){mutations.forEach(function(mutation){var addedNodes=mutation.addedNodes;for(var i=0,length=addedNodes.length;i<length;i++){var addedNode=addedNodes[i];if(addedNode.nodeType!=Node.ELEMENT_NODE){continue;}var node,walk=document.createTreeWalker(addedNode,NodeFilter.SHOW_ELEMENT,null,false);while(node=walk.nextNode()){if(node._invalid===true){node.invalidate();}}}});});document.addEventListener("DOMContentLoaded",function(){mutationObserver.observe(document.body,{childList:true,subtree:true});});return function(){if(this.funUIInitialized){return false;}var embedded=false;var extraTraits=[];for(var i=0,length=arguments.length;i<length;i++){var arg=arguments[i];if(typeof arg==="boolean"){embedded=arg;}else{extraTraits.push(arg);}}for(i=0,length=this.childNodes.length;i<length;i++){var child=this.childNodes[i];if(child.nodeType===Node.ELEMENT_NODE){child.initFunUI(embedded);}else if(embedded&&child.nodeType===Node.TEXT_NODE&&FunUI.lang.isEnabled()){child.nodeValue=FunUI.lang.apply(child.nodeValue);}}var componentTrait=null,customizedTrait=null;var prefix="F-";var classes=this.getClasses();for(i=0,length=classes.length;i<length;i++){var componentClass=classes[i];if(componentClass.indexOf(prefix)!=0){continue;}var componentName=componentClass.substr(prefix.length);if(!!FunUI.components[componentName]){componentTrait=FunUI.components[componentName];break;}}if(!!this.id&&FunUI.traits[this.id]){customizedTrait=FunUI.traits[this.id];delete FunUI.traits[this.id];}var dataSet={};for(var propName in this.dataset){if(this.dataset.hasOwnProperty(propName)){var value=this.dataset[propName];value=FunUI.lang.apply(value);dataSet[propName]=value.literal;}}if(!!this.id){FunUI.views[this.id]=this;}mixin(this,componentTrait,extraTraits,customizedTrait,dataSet);this.funUIInitialized=true;var that=this;this.delayCall(function(){that.fire(new CustomEvent(FunUI.events.INITIALIZED));});return true;};function mixin(){var args=Array.from(arguments);var element=args.shift();var traits=flattenTraits(args);var init="__init__";var initializers=[];if(!Array.isArray(element._validators)){element._validators=[];}for(var i=0,length=traits.length;i<length;i++){var trait=traits[i];for(var prop in trait){if(!trait.hasOwnProperty(prop)){continue;}if(prop==init){initializers.push(trait[prop]);continue;}if(prop=="commitProperties"){element._validators.push(trait[prop]);continue;}var propertyDescriptor=Object.getOwnPropertyDescriptor(trait,prop);if(propertyDescriptor.get||propertyDescriptor.set){var originPropertyDescriptor=Object.getOwnPropertyDescriptor(element,prop);if(!originPropertyDescriptor){Object.defineProperty(element,prop,propertyDescriptor);}else{originPropertyDescriptor.set=propertyDescriptor.set;originPropertyDescriptor.get=propertyDescriptor.get;}}else{var value=trait[prop];var nameRef=new FunUI.utils.Reference();var annotations=FunUI.utils.parseAnnotations(prop,nameRef);if(annotations){for(var i=0;i<annotations.length;i++){value=annotations[i].apply(element,value)||value;}}else if(typeof value=="function"){value=value.bind(element);}var name=nameRef.get();if(name&&name.length>0){element[name]=value;}}}}for(var i=0,length=initializers.length;i<length;i++){initializers[i].call(element);}}function flattenTraits(traits){var ret=[];for(var i=0,length=traits.length;i<length;i++){var trait=traits[i];if(trait==null){continue;}if(trait.constructor==Object){ret.push(trait);}else if(trait.constructor==Array){Array.prototype.push.apply(ret,flattenTraits.call(null,trait));}else{throw new Error("Traits must be simple object");}}return ret;}}();HTMLElement.prototype._delayedCalls=null;HTMLElement.prototype.getStylePixel=function(styleName){var value=getComputedStyle(this,null).getPropertyValue(styleName);var posPx=value.lastIndexOf("px");if(posPx<0||posPx!=value.length-2){return 0;}return parseInt(value);};HTMLElement.prototype.invalidate=function(){if(typeof this._invalid=="number"){return;}if(!this.hasOwnProperty("validate")){this.validate=this.validate.bind(this);}if(document.body.contains(this)){this._invalid=setTimeout(this.validate,0);}else{this._invalid=true;}};HTMLElement.prototype.validate=function(){if(!this._invalid){return;}if(Array.isArray(this._validators)){var that=this;this._validators.forEach(function(callback){callback.call(that);});}while(this._delayedCalls&&this._delayedCalls.length){this._delayedCalls.shift().call(null);}if(typeof this._invalid=="number"){clearTimeout(this._invalid);}this._invalid=null;};Object.defineProperty(HTMLElement.prototype,"explicitWith",{set:function set(width){this.style.width=width-this.getStylePixel("padding-left")-this.getStylePixel("padding-right")-this.getStylePixel("border-left-width")-this.getStylePixel("border-right-width")+"px";}});Object.defineProperty(HTMLElement.prototype,"explicitHeight",{set:function set(height){this.style.height=height-this.getStylePixel("padding-top")-this.getStylePixel("padding-bottom")-this.getStylePixel("border-top-width")-this.getStylePixel("border-bottom-width")+"px";}});Object.defineProperty(HTMLElement.prototype,"tooltipData",function(){function showTooltip(event){var target=event.currentTarget;var renderer=F$(target.tooltipRenderer);if(renderer){renderer.show(target,target.tooltipData);}else{console.warn("invalid tooltip renderer "+target.tooltipRenderer);}target.on('mouseout',hideTooltip);}function hideTooltip(event){var target=event.currentTarget;var renderer=F$(target.tooltipRenderer);if(renderer){renderer.hide();}else{console.warn("invalid tooltip renderer "+target.tooltipRenderer);}target.off('mouseout',hideTooltip);}return{set:function set(data){if(data==null){if(this._tooltipData!=null){this.off('mouseover',showTooltip);}}else if(this._tooltipData==null){this.on('mouseover',showTooltip);}this._tooltipData=data;},get:function get(){return this._tooltipData;}};}());Object.defineProperty(HTMLElement.prototype,"tooltipRenderer",{set:function set(renderer){this._tooltipRenderer=renderer;},get:function get(){return this._tooltipRenderer||"tooltipSimple";}});Object.defineProperty(HTMLElement.prototype,"disabled",function(){function stopEvent(event){event.stopPropagation();event.stopImmediatePropagation();event.preventDefault();}return{set:function set(value){if(this._disabled===value){return;}if(value){this.addClass('disabled');this.on('click',stopEvent,true);}else{this.removeClass('disabled');this.off('click',stopEvent,true);}this._disabled=value;},get:function get(){if(typeof this._disabled=='undefined'){this.disabled=this.hasClass('disabled');}return this._disabled;}};}());document.documentElement.on('mousemove',function(event){document.mouseX=event.clientX;document.mouseY=event.clientY;},true);HTMLElement.prototype.containsMouse=function(){var rect=this.getBoundingClientRect();return rect.left<=document.mouseX&&rect.right>=document.mouseX&&rect.top<=document.mouseY&&rect.bottom>=document.mouseY;};var FunUI={};FunUI.CSS_PREFIX='F-';FunUI.utils={};FunUI.utils.alert=function(content,onYes,title){F$('alert').show(title||F_('alert.title'),content,onYes);};FunUI.utils.confirm=function(content,onYes,onNo,title){F$('confirm').show(title||F_('confirm.title'),content,onYes,onNo);};FunUI.utils.attachSound=function(targetNode){targetNode.addClass("withClickSound");};FunUI.utils.Reference=function(){function Reference(){}Reference.prototype.set=function(v){this._value=v;};Reference.prototype.get=function(){return this._value;};return Reference;}();FunUI.utils.extend=function(){var target={};for(var i=0,length=arguments.length;i<length;i++){var source=arguments[i];if((typeof source==="undefined"?"undefined":_typeof(source))!='object'){continue;}for(var key in source){if(!source.hasOwnProperty(key)){continue;}var propertyDescriptor=Object.getOwnPropertyDescriptor(source,key);if(propertyDescriptor.get||propertyDescriptor.set){var originPropertyDescriptor=Object.getOwnPropertyDescriptor(target,key);if(!originPropertyDescriptor){Object.defineProperty(target,key,propertyDescriptor);}else{originPropertyDescriptor.set=propertyDescriptor.set;originPropertyDescriptor.get=propertyDescriptor.get;}}else{target[key]=source[key];}}}return target;};FunUI.utils.getBoundMethod=function(obj,methodName){if(typeof obj[methodName]!='function'){throw new Error('invalid method '+methodName);}if(!obj.hasOwnProperty(methodName)){obj[methodName]=obj[methodName].bind(obj);}return obj[methodName];};FunUI.utils.parseAnnotations=function(){function nodeToAnnotation(node){var name=node.tagName;if(name=="parsererror"){throw new Error(node.querySelector("div").innerHTML);}var definition=FunUI.annotations[name];if(!definition){throw new Error("Can't find annotation definition FunUI.annotations."+name);}var annotation=Object.create(definition);var attributes=node.attributes;for(var i=0,length=attributes.length;i<length;i++){var attribute=attributes[i];annotation[attribute.name]=attribute.value.literal;}var children=node.childNodes;annotation.children=[];for(i=0,length=children.length;i<length;i++){var child=child[i];if(child.nodeType==Node.ELEMENT_NODE){annotation.children.push(nodeToAnnotation(child));}}return annotation;}return function(key,nameRef){key=key.trim();if(key.indexOf("<")!=0){if(nameRef instanceof FunUI.utils.Reference){nameRef.set(key);}return null;}var term=key.lastIndexOf(">");if(term<0){throw new Error("invalidate annotation format");}if(nameRef instanceof FunUI.utils.Reference){nameRef.set(key.substr(term+1).trim());}var text=key.substr(0,term+1);text="<Annotations>"+text+"</Annotations>";var parser=new DOMParser();var doc=parser.parseFromString(text,"application/xml");var nodes=doc.documentElement.childNodes;var annotations=[];for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType==Node.ELEMENT_NODE){annotations.push(nodeToAnnotation(nodes[i]));}}return annotations;};}();FunUI.utils.relay=document.createElement("div");(function(){FunUI.lang={KEY_PATTERN:/_\(([^)]+)\)/g,_embeddedLanguages:null,_language:null,isEnabled:function isEnabled(){return typeof F_=="function";},apply:function apply(str){if(FunUI.lang.isEnabled()){return str.replace(FunUI.lang.KEY_PATTERN,replaceText);}return str;},getEmbeddedText:function getEmbeddedText(key,params){if(this._embeddedLanguages==null){this._embeddedLanguages={};var langElements=document.getElementsByClassName('F-Lang');for(var i=0,length=langElements.length;i<length;i++){var langElement=langElements.item(i);var lang=langElement.getAttribute("id");this._embeddedLanguages[lang]=JSON.parse(langElement.innerText);if(this._language==null||(document.documentElement.lang||navigator.language).indexOf(lang)==0){this._language=lang;}}}var text=this._embeddedLanguages&&this._embeddedLanguages[this._language][key]||"";if(params){text=text.replace(/\[\[([^\]]+)]]/g,function(pattern,key){return params[key];});}return text;}};function replaceText(){try{return F_(arguments[1]);}catch(e){return arguments[0];}}})();FunUI.utils.getView=function(viewId){var view=null;if(viewId instanceof HTMLElement){view=viewId;viewId=view.id;}if(viewId instanceof String){viewId=viewId.toString();}if(typeof viewId!="string"){throw new Error('invalid arguments');}if(!!FunUI.views[viewId]){return FunUI.views[viewId];}view=view||document.getElementById(viewId);if(!view){var layout=FunUI.layouts[viewId];if(layout){layout=FunUI.lang.apply(layout);FunUI.utils.relay.innerHTML=layout;view=FunUI.utils.relay.firstElementChild;if(!view){throw new Error("invalid view, please check if view's Id and filename are identical");}FunUI.utils.relay.removeChild(view);delete FunUI.layouts[viewId];view.initFunUI();}else{return FunUI.traits[viewId];}}else{view.initFunUI(true);}return view;};FunUI.utils.EventTarget=function(){var eventDelegate=document.createDocumentFragment();this.dispatchEvent=eventDelegate.dispatchEvent.bind(eventDelegate);this.addEventListener=eventDelegate.addEventListener.bind(eventDelegate);this.removeEventListener=eventDelegate.removeEventListener.bind(eventDelegate);this.fire=this.dispatchEvent;this.on=this.addEventListener;this.off=this.removeEventListener;};FunUI.utils.ArrayView=function(){FunUI.utils.EventTarget.call(this);this._validate=function(){if(!this._invalid){return;}clearTimeout(this._invalid);this._invalid=null;this._tidy();this.fire(new CustomEvent(FunUI.events.ARRAY_VIEW_UPDATE));}.bind(this);this._follow=function(){this.invalidate();}.bind(this);for(var i=0,length=arguments.length;i<length;i++){var arg=arguments[i];if(typeof arg=='number'){this.pageSize=arg;}else if(typeof arg=='boolean'){this.pending=arg;}else if(Array.isArray(arg)){this.source=arg;}else if(arg instanceof FunUI.utils.ArrayView){this.sourceView=arg;}else if(arg.constructor==Object){for(var key in arg){if(arg.hasOwnProperty(key)&&['pageSize','source','pending','filter','sourceView','sort'].indexOf(key)>=0){this[key]=arg[key];}else{throw new Error("invalid option key "+key);}}}else{throw new Error("invalid arguments");}}if(this.source==null&&this.sourceView==null){this.source=[];}};FunUI.utils.ArrayView.prototype.item=function(index){return this.currentView[index];};Object.defineProperty(FunUI.utils.ArrayView.prototype,"source",{set:function set(src){if(Array.isArray(src)){this._source=src;}else{this._source=[];}this.invalidate();},get:function get(){return this._source;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"sourceView",{set:function set(srcView){if(this._sourceView==srcView){return;}if(!srcView instanceof FunUI.utils.ArrayView){srcView=null;}if(this._sourceView){this._sourceView.off(FunUI.events.ARRAY_VIEW_UPDATE,this._follow);}if(srcView){srcView.on(FunUI.events.ARRAY_VIEW_UPDATE,this._follow);this._source=srcView.currentView;}else{this._source=[];}this._sourceView=srcView;this.invalidate();},get:function get(){return this._sourceView;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"currentView",{get:function get(){this._tidy();return this._currentView;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"filter",{set:function set(filter){if(filter&&typeof filter!='function'){throw new Error('filter must be a function');}this._filter=filter;this.invalidate();},get:function get(){return this._filter;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"sort",{set:function set(sort){if(sort&&typeof sort!='function'){throw new Error('sort must be a function');}this._sort=sort;this.invalidate();},get:function get(){return this._sort;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"length",{get:function get(){return this.source.length;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,'filteredLength',{get:function get(){this._tidy();return this._filteredLength;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"pageSize",{set:function set(size){size=parseInt(size)||0;if(this.pageSize!=size){this._pageSize=size;this.invalidate();}},get:function get(){return this._pageSize||0;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"pageCount",{get:function get(){this._tidy();return this._pageCount;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"page",{set:function set(index){index=parseInt(index)||0;if(index<0){throw new Error("index cannot be less than 0");}if(this.page!=index){this._page=index;this.invalidate();}},get:function get(){return this._page||0;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"pending",{set:function set(pending){if(this.sourceView){console.warn("Invalid operation");return;}pending=!!pending;if(this._pending!=pending){this._pending=pending;this.invalidate();}},get:function get(){return this.sourceView?this.sourceView.pending:this._pending||false;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,'pended',{set:function set(v){if(this.sourceView){this.sourceView.pended=v;return;}if(this._pended==v){return;}this._pended=v;if(v){this.fire(new CustomEvent(FunUI.events.ARRAY_VIEW_PENDED));}},get:function get(){return this.sourceView?this.sourceView.pended:this._pended;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"isFirstPage",{get:function get(){return this.page==0;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"isDirty",{get:function get(){return this._dirty;}});Object.defineProperty(FunUI.utils.ArrayView.prototype,"isLastPage",{get:function get(){return!this.pending&&this.page>=this.pageCount-1;}});FunUI.utils.ArrayView.prototype.invalidate=function(){this._dirty=true;if(!this._invalid){this._invalid=setTimeout(this._validate,0);}};FunUI.utils.ArrayView.prototype.append=function(fragment){if(this.sourceView){throw new Error('sourceView must be null');}if(!this.pending){throw new Error('not a pending ArrayView');}Array.prototype.push.apply(this.source,fragment);this.pended=false;this.invalidate();};FunUI.utils.ArrayView.prototype.push=function(item){if(this.sourceView){throw new Error('sourceView must be null');}if(!this.pending){throw new Error('not a pending ArrayView');}this.source.push(item);this.pended=false;this.invalidate();};FunUI.utils.ArrayView.prototype._tidy=function(){if(!this._dirty){return;}this._dirty=false;if(this.sourceView){this._source=this.sourceView.currentView;}var view=this.source.concat();if(this.filter){view=view.filter(this.filter);}if(this.sort){view=view.sort(this.sort);}this._filteredLength=view.length;if(this.pageSize<=0){this._pageSize=0;this._currentView=view;this._pageCount=this._filteredLength==0?0:1;this._page=0;return;}this._pageCount=Math.ceil(this._filteredLength/this.pageSize);this._page=this._page||0;if(this.pending){var pended=false;if(this._filteredLength%this.pageSize!=0){if(this._page>=this.pageCount-1){this._page=this._pageCount-1;pended=true;}}else if(this._page>=this._pageCount){this._page=this._pageCount;pended=true;}if(!this._pended&&pended){this.pended=true;}}else{this._page=Math.min(this._pageCount-1,this._page);}this._page=Math.max(this._page,0);var start=this._page*this._pageSize;this._currentView=view.slice(start,start+this.pageSize);};FunUI.utils.ajax=function(){function param(a){if(typeof a=="string"){return a;}var s=[],rbracket=/\[\]$/,isArray=function isArray(obj){return Object.prototype.toString.call(obj)==='[object Array]';},add=function add(k,v){v=typeof v==='function'?v():v===null?'':v===undefined?'':v;s[s.length]=encodeURIComponent(k)+'='+encodeURIComponent(v);},buildParams=function buildParams(prefix,obj){var i,len,key;if(prefix){if(isArray(obj)){for(i=0,len=obj.length;i<len;i++){if(rbracket.test(prefix)){add(prefix,obj[i]);}else{buildParams(prefix+'['+(_typeof(obj[i])==='object'?i:'')+']',obj[i]);}}}else if(obj&&String(obj)==='[object Object]'){for(key in obj){buildParams(prefix+'['+key+']',obj[key]);}}else{add(prefix,obj);}}else if(isArray(obj)){for(i=0,len=obj.length;i<len;i++){add(obj[i].name,obj[i].value);}}else{for(key in obj){buildParams(key,obj[key]);}}return s;};return buildParams('',a).join('&').replace(/%20/g,'+');}function createRequest(){if(window.XMLHttpRequest){return new XMLHttpRequest();}else{return new ActiveXObject("Microsoft.XMLHTTP");}}function send(method,url,callback,data,headers){var request=createRequest();request.onreadystatechange=function(){if(this.readyState==4&&callback&&typeof callback==='function'){callback(this);}};request.open(method,url);if((method=='POST'||method=="PUT")&&(!headers||!headers["Content-type"])){request.setRequestHeader("Content-type","application/x-www-form-urlencoded");}if(headers){for(var k in headers){request.setRequestHeader(k,headers[k]);}}if(data){request.send(param(data));}else{request.send();}}var methods=['HEAD','OPTIONS','GET','PUT','PATCH','POST','DELETE'];var ajax={};for(var i=0;i<methods.length;i++){ajax[methods[i].toLocaleLowerCase()]=send.bind(null,methods[i]);}return ajax;}();FunUI.events={INITIALIZED:'initialized',SELECTED_CHANGED:'selectedChanged',ADD_POP_UP:'addPopUp',REMOVE_POP_UP:'removePopUp',ARRAY_VIEW_UPDATE:'arrayViewUpdate',ARRAY_VIEW_PENDED:'arrayViewPended',ALL_SELECTED_CHANGED:'allSelectedChanged',TEXT_CHANGED:'textChanged',INPUT_SUBMIT:'inputSubmit'};FunUI.managers={};FunUI.managers.PopUpManager={LAYER_BASIC:"basic",LAYER_TOP:"top",LAYER_PERIPHERY:"periphery"};FunUI.utils.EventTarget.call(FunUI.managers.PopUpManager);FunUI.managers.PopUpManager.addPopUp=function(view,modal,layer){if(!this._layers){this._layers={};this._layers[this.LAYER_BASIC]=this._createPopUpLayer(this.LAYER_BASIC);this._layers[this.LAYER_TOP]=this._createPopUpLayer(this.LAYER_TOP);this._layers[this.LAYER_PERIPHERY]=this._createPopUpLayer(this.LAYER_PERIPHERY);}if(!this._modalLayer){this._modalLayer=document.createElement("div");this._modalLayer.addClass("modal");}layer=layer||this.LAYER_BASIC;var popUpLayer=this._layers[layer];if(!popUpLayer){throw new Error('invalid layer');}view=F$(view);view.setAttribute("data-modal",modal?'true':'false');view.modal=modal||false;if(modal){popUpLayer.appendChild(this._modalLayer);}if(!popUpLayer.parentNode){document.body.appendChild(popUpLayer);}popUpLayer.appendChild(view);var popUpEvent=new CustomEvent(FunUI.events.ADD_POP_UP,{view:view});view.fire(popUpEvent);FunUI.managers.PopUpManager.fire(popUpEvent);};FunUI.managers.PopUpManager.removePopUp=function(view){if(!this._layers){return;}view=F$(view);var popUpLayer=view.parentNode;if(!popUpLayer){return;}var validLayer=false;for(var layer in this._layers){if(this._layers.hasOwnProperty(layer)&&popUpLayer==this._layers[layer]){validLayer=true;break;}}if(!validLayer){return;}var event=new CustomEvent(FunUI.events.REMOVE_POP_UP,{view:view});if(!this.fire(event)||!view.fire(event)){return;}popUpLayer.removeChild(view);if(popUpLayer.children.length==0){popUpLayer.parentNode.removeChild(popUpLayer);}if(!view.modal||this._modalLayer.parentNode==null){return;}var keepModal=false;for(var i=popUpLayer.children.length-1;i>=0;i--){var child=popUpLayer.children[i];if(child==this._modalLayer){continue;}if(child.modal){if(child.previousSibling!=this._modalLayer){popUpLayer.insertBefore(this._modalLayer,child);}keepModal=true;break;}}if(!keepModal&&this._modalLayer.parentNode==popUpLayer){popUpLayer.removeChild(this._modalLayer);}};FunUI.managers.PopUpManager._createPopUpLayer=function(layer){var layerElement=document.createElement("div");layerElement.addClass(FunUI.CSS_PREFIX+"popUpLayer");layerElement.addClass(layer);return layerElement;};FunUI.components={};FunUI.components.Button={_label:null,_labelField:null,__init__:function __init__(){FunUI.utils.attachSound(this);this._labelField=this.presentLabelChild(true);this._label=this._labelField.innerHTML;this.presentSubComponent("hover");},set label(v){this._label=v;this._labelChanged=true;this.invalidate();},get label(){return this._label;},commitProperties:function commitProperties(){if(this._labelChanged){this._labelField.innerHTML=this._label;this._labelChanged=false;}}};FunUI.components.Selectable={_selected:false,select:function select(){this.selected=true;},deselect:function deselect(){this.selected=false;},set selected(selected){if(this._selected==selected){return;}if(selected){this.addClass("selected");}else{this.removeClass("selected");}this._selected=selected;this.fire(new CustomEvent(FunUI.events.SELECTED_CHANGED));},get selected(){return this._selected;}};FunUI.components.TextInput={multiline:false,password:false,placeholder:"",_lastText:"",_maxLength:-1,__init__:function __init__(){var node,walk=document.createTreeWalker(this,NodeFilter.SHOW_TEXT,null,false);var defaultValue="";if(node=walk.nextNode()){defaultValue=node.nodeValue.trim();this.removeChild(node);}var input=null;if(!this.multiline){input=document.createElement("input");input.setAttribute("type",this.password?"password":"text");}else{input=document.createElement("textarea");}input.setAttribute("placeholder",this.placeholder);input.on("input",this.fire.bind(this,new CustomEvent(FunUI.events.TEXT_CHANGED)));if(this._maxLength>=0){input.setAttribute("maxlength",this._maxLength);}input.on('keydown',this.onKeyDown);this.appendChild(input);this.input=input;this.text=defaultValue;},onKeyDown:function onKeyDown(event){if(event.key=="Enter"){this.fire(new CustomEvent(FunUI.events.INPUT_SUBMIT));}},set maxLength(value){value=parseInt(value);if(this.input){this.input.setAttribute("maxlength",value);}else{this._maxLength=value;}},get maxLength(){if(this.input){return parseInt(this.input.getAttribute('maxlength'));}else{return this._maxLength;}},set text(value){if(this.input.tagName.toLowerCase()=="input"){if(this.input.value!=value){this.input.value=value;this.fire(new CustomEvent(FunUI.events.TEXT_CHANGED));}}else if(this.input.innerHTML!=value){this.input.innerHTML=value;this.fire(new CustomEvent(FunUI.events.TEXT_CHANGED));}},get text(){return this.input.value;}};FunUI.components.Window={drawingBg:true,modal:false,_title:null,_titleField:null,__init__:function __init__(){if(this.drawingBg){this.presentSubComponent("bg");}this._titleField=this.getSubComponent('title');var closeButton=this.getSubComponent("close");if(closeButton){closeButton.on("click",this.close);}},set title(v){this._title=v;this._titleChanged=true;this.invalidate();},get title(){return this._title;},commitProperties:function commitProperties(){if(this._titleChanged){this._titleField.innerHTML=this._title;this._titleChanged=false;}},open:function open(){FunUI.managers.PopUpManager.addPopUp(this,this.modal);},close:function close(){FunUI.managers.PopUpManager.removePopUp(this);}};FunUI.components.ViewStack={__init__:function __init__(){this._subViews=this.getSubComponents("subView");for(var i=0,length=this._subViews.length;i<length;i++){var subView=this._subViews[i];if(subView.hasClass("selected")){this.selectSubView(i);}}if(this._selectedIndex==-1){this.selectSubView(0);}},_subViews:null,_selectedIndex:-1,get selectedIndex(){return this._selectedIndex;},get currentSubView(){if(this._selectedIndex>=0&&this._selectedIndex<this._subViews.length){return this._subViews[this._selectedIndex];}return null;},selectSubView:function selectSubView(index){var beforeIndex=this._selectedIndex;if(beforeIndex==index){return;}var currentView=this.currentSubView;if(currentView){currentView.removeClass("selected");}this._subViews[index].addClass("selected");this._selectedIndex=index;this.fire(new CustomEvent(FunUI.events.SELECTED_CHANGED,{beforeIndex:beforeIndex,currentIndex:index}));}};FunUI.components.TabPage={_pagesChanged:false,__init__:function __init__(){this._pages=this.getSubComponents("F-TabSubPage");for(var i=0;i<this._pages.length;i++){var page=this._pages[i];page.pageIndex=i;page.on(FunUI.events.SELECTED_CHANGED,this._onPageSelectedChanged);}this._excludedPages={};this._pagesChanged=true;this.invalidate();},excludePage:function excludePage(pageIndex){if(pageIndex>=0&&pageIndex<this._pages.length&&!this._excludedPages[pageIndex]){this._excludedPages[pageIndex]=true;this._pagesChanged=true;this.invalidate();}},includePage:function includePage(pageIndex){if(pageIndex>=0&&pageIndex<this._pages.length&&!!this._excludedPages[pageIndex]){delete this._excludedPages[pageIndex];this._pagesChanged=true;this.invalidate();}},commitProperties:function commitProperties(){if(!this._pagesChanged){return;}var pages=this._pages;var pageTitles=[];var pageContents=[];var pageContent;var maxHeight=0,maxWidth=0,maxContentWidth=0,maxContentHeight=0,pageBarWidth=0;var lastPage=null;for(var i=0,length=pages.length;i<length;i++){var page=pages[i];if(!!this._excludedPages[i]){if(page.parentNode==this){this.removeChild(page);}continue;}if(page.parentNode!=this){if(lastPage==null){this.appendChild(page);}else{this.insertBefore(page,lastPage);}}var pageTitle=page.title;if(pageTitle){pageTitles.push(pageTitle);pageBarWidth=pageBarWidth+pageTitle.offsetWidth;}pageContent=page.content;maxContentHeight=Math.max(pageContent.offsetHeight,maxContentHeight);maxContentWidth=Math.max(pageContent.offsetWidth,maxContentWidth);maxHeight=Math.max(maxHeight,page.offsetTop+pageContent.offsetTop+maxContentHeight);maxWidth=Math.max(maxWidth,page.offsetLeft+pageContent.offsetLeft+maxContentWidth);pageContents.push(pageContent);lastPage=page;}this.explicitWith=maxWidth;this.explicitHeight=maxHeight;for(i=0,length=pageContents.length;i<length;i++){pageContent=pageContents[i];pageContent.explicitWith=maxContentWidth;pageContent.explicitHeight=maxContentHeight;}var pageBarOffsetLeft;if(this.barAlign=="left"){pageBarOffsetLeft=0;}else if(this.barAlign=="right"){pageBarOffsetLeft=maxWidth-pageBarWidth;}else{pageBarOffsetLeft=(maxWidth-pageBarWidth)/2;}pageBarOffsetLeft+=this.barOffsetLeft;for(i=0,length=pageTitles.length;i<length;i++){pageTitles[i].style.left=pageBarOffsetLeft+"px";pageBarOffsetLeft+=pageTitles[i].offsetWidth;}if(this.selectedIndex<0||this._excludedPages[this.selectedIndex]){this.selectedIndex=0;}this._pagesChanged=false;},_barAlign:"center",_barOffsetLeft:0,set barAlign(align){this._barAlign=align;this.invalidate();},get barAlign(){return this._barAlign;},set barOffsetLeft(value){this._barOffsetLeft=value;this.invalidate();},get barOffsetLeft(){return this._barOffsetLeft;},_selectedIndex:-1,set selectedIndex(index){if(this._excludedPages[index]){return;}var pages=this._pages;if(index<0||pages.length<=index){index=-1;}if(this._selectedIndex==index){return;}if(this._selectedIndex!=-1){pages[this._selectedIndex].selected=false;}if(index>=0){pages[index].selected=true;pages[index].style.zIndex=++this._zIndexSeq;}this._selectedIndex=index;this.fire(new CustomEvent(FunUI.events.SELECTED_CHANGED));},get selectedIndex(){return this._selectedIndex;},_onPageSelectedChanged:function _onPageSelectedChanged(event){var page=event.currentTarget;if(!page.selected){return;}this.selectedIndex=this._pages.indexOf(page);},_excludedPages:null,_pages:null,_zIndexSeq:0};FunUI.components.TabSubPage=FunUI.utils.extend(FunUI.components.Selectable,{_title:null,_content:null,__init__:function __init__(){this._title=this.getSubComponent('title');this._content=this.getSubComponent('content');FunUI.utils.attachSound(this);this._title.presentLabelChild();this._title.presentSubComponent("hover");this._title.on("click",this.select);if(this.hasClass("selected")){this.selected=true;}},get title(){return this._title;},get content(){return this._content;}});FunUI.components.Tooltip={gap:10,_host:null,_data:null,show:function show(host,data){this._host=host;this._data=data;this.style.visibility='hidden';FunUI.managers.PopUpManager.addPopUp(this,false,FunUI.managers.PopUpManager.LAYER_PERIPHERY);document.addEventListener('click',this.tryHide,true);this.delayCall(this._show);},hide:function hide(){document.removeEventListener('click',this.tryHide,true);FunUI.managers.PopUpManager.removePopUp(this);},tryHide:function tryHide(event){if(event.target!=this._host&&!this._host.contains(event.target)){this.hide();}},position:function position(host){if(!this.parentNode){return;}var hostClientRect=host.getBoundingClientRect();var myClientRect=this.getBoundingClientRect();var left=Math.max(0,Math.min(hostClientRect.left,this.parentNode.offsetWidth-myClientRect.width));var top,candidateTop;if(hostClientRect.bottom+myClientRect.height+this.gap<=this.parentNode.offsetHeight||(candidateTop=hostClientRect.top-myClientRect.height-this.gap)<0){top=hostClientRect.bottom+this.gap;}else{top=candidateTop;}this.style.left=left+"px";this.style.top=top+"px";},render:function render(data){this.innerHTML=data;},_show:function _show(){this.render(this._data);this.position(this._host);this.style.visibility='visible';}};FunUI.components.List={__init__:function __init__(){this._itemProto=this.getSubComponent(FunUI.CSS_PREFIX+"ItemRenderer");this.removeChild(this._itemProto);this._items=[];this._selectedIndices=[];},multiSelect:false,itemRenderer:null,set dataProvider(dataProvider){if(dataProvider!=null&&!(dataProvider instanceof FunUI.utils.ArrayView)){throw new Error('F$ArrayView required');}if(this._arrayView!=dataProvider){if(this._arrayView){this._arrayView.off(FunUI.events.ARRAY_VIEW_UPDATE,this.render);}if(dataProvider){dataProvider.on(FunUI.events.ARRAY_VIEW_UPDATE,this.render);}this._arrayView=dataProvider;if(!this._selectedIndices||this._selectedIndices.length!=0){this._selectedIndices=[];this._selectedChanged=true;this.invalidate();}if(!dataProvider||!dataProvider.isDirty){this.render();}}},get dataProvider(){return this._arrayView;},render:function render(){var data;if(!this._arrayView){data=[];}else{data=this._arrayView.currentView;}var items=this._items;if(!items){items=[];this._items=items;}for(var i=0,length=data.length;i<length;i++){var datum=data[i];var item;if(items.length>i){item=items[i];}else{item=this._itemProto.cloneNode(true);item.initFunUI(this.itemRenderer);item.list=this;this.appendChild(item);items.push(item);}if(typeof item.render=='function'){item.render(datum,i);item.data=datum;item.index=i;}if(this.isIndexSelected(i)){item.select();}else{item.deselect();}}for(i=data.length,length=items.length;i<length;i++){item=items.pop();if(typeof item.clear=='function'){item.clear();}item.data=null;item.index=-1;this.removeChild(item);}this._items.splice(data.length,items.length-data.length);},selectItem:function selectItem(index){if(this._selectedIndices.indexOf(index)>=0){return;}if(!this.multiSelect){while(this._selectedIndices.length>0){this.deselectItem(this._selectedIndices[0]);}}this._selectedIndices.push(index);if(this._items.length>index){this._items[index].select();}this._selectedChanged=true;this.invalidate();},deselectItem:function deselectItem(index){if(this._selectedIndices.indexOf(index)<0){return;}this._selectedIndices.splice(this._selectedIndices.indexOf(index),1);if(this._items.length>index){this._items[index].deselect();}this._selectedChanged=true;this.invalidate();},selectAll:function selectAll(){if(!this.multiSelect){throw new Error("this operation is not allowed with multiSelect is true");}for(var i=0,length=this._items.length;i<length;i++){this.selectItem(i);}},deselectAll:function deselectAll(){if(!this.multiSelect){throw new Error("this operation is not allowed with multiSelect is true");}for(var i=0,length=this._items.length;i<length;i++){this.deselectItem(i);}},get allSelected(){return this._allSelected;},get selectedIndices(){return this._selectedIndices;},set selectedIndices(v){if(!Array.isArray(v)){throw new Error('Invalid param');}this._selectedIndices=v;this._selectedChanged=true;this.invalidate();},get selectedIndex(){return this._selectedIndices&&this._selectedIndices.length>0?this._selectedIndices[0]:-1;},isIndexSelected:function isIndexSelected(index){return this._selectedIndices&&this._selectedIndices.indexOf(index)>=0;},get selectedData(){if(!this._arrayView){return null;}var ret=[];for(var i=0,length=this._selectedIndices.length;i<length;i++){ret=this._arrayView.item(i);}return ret;},get selectedDatum(){var index=this.selectedIndex;if(index<0){return null;}return this._arrayView.item(index);},commitProperties:function commitProperties(){if(this._selectedChanged){this.fire(new CustomEvent(FunUI.events.SELECTED_CHANGED));var allSelected=this._items?this._selectedIndices.length==this._items.length:false;if(this._allSelected!=allSelected){this._allSelected=allSelected;this.fire(new CustomEvent(FunUI.events.ALL_SELECTED_CHANGED));}this._selectedChanged=false;}},_allSelected:false,_selectedIndices:null,_items:null,_arrayView:null,_itemProto:null};FunUI.components.ItemRenderer=FunUI.utils.extend(FunUI.components.Selectable,{list:null,index:-1,data:null,__init__:function __init__(){this.on(FunUI.events.SELECTED_CHANGED,this._onSelectChanged);},_onSelectChanged:function _onSelectChanged(){var list=this.list;if(this.selected&&list){list.selectItem(this.index);}},render:function render(data,index){this.innerHTML=data;},clear:function clear(){}});FunUI.components.CheckBox=FunUI.utils.extend(FunUI.components.Selectable,{__init__:function __init__(){FunUI.utils.attachSound(this);this.presentSubComponent("hover");this.selected=this.hasClass("selected");this.on("click",this.toggle);},toggle:function toggle(){var stat=!this._selected;this.selected=stat;return stat;}});FunUI.components.RadioButton=FunUI.utils.extend(FunUI.components.Selectable,{index:-1,__init__:function __init__(){FunUI.utils.attachSound(this);this.presentSubComponent("hover");if(this.hasClass("selected")){this.select();}this.on('click',this.select);}});FunUI.components.RadioGroup={_buttons:null,_selectedIndex:-1,__init__:function __init__(){this._buttons=this.getElementsByClassName('F-RadioButton');for(var i=0,length=this._buttons.length;i<length;i++){var button=this._buttons[i];button.index=i;button.on(FunUI.events.SELECTED_CHANGED,this.selectIndex.bind(this,i));if(button.selected){this.selectIndex(i);}}},selectIndex:function selectIndex(index){if(this._selectedIndex==index){return;}if(this._selectedIndex!=-1){this._buttons[this._selectedIndex].selected=false;}if(index){this._buttons[index].selected=true;}this._selectedIndex=index;this.fire(new CustomEvent(FunUI.events.SELECTED_CHANGED));},get selectedIndex(){return this._selectedIndex;}};FunUI.components.SelectAllCtrl={_list:null,__init__:function __init__(){FunUI.utils.attachSound(this);this.presentLabelChild();this.presentSubComponent("hover");this.on("click",this.toggle);},listenTo:function listenTo(list){if(list&&(typeof list.on!="function"||typeof list.off!="function")){throw new Error("target must be a EventTarget");}if(this._list==list){return;}if(this._list){this._list.off(FunUI.events.ALL_SELECTED_CHANGED,this.render);}if(list){list.on(FunUI.events.ALL_SELECTED_CHANGED,this.render);}this._list=list;this.render();},get list(){return this._list;},toggle:function toggle(){if(!this._list){return false;}if(this._list.allSelected){this._list.deselectAll();return false;}this._list.selectAll();return true;},render:function render(){if(this._list.allSelected){this.addClass("selected");}else{this.removeClass("selected");}}};FunUI.components.PageLabel={set dataProvider(arrayView){if(!(arrayView instanceof FunUI.utils.ArrayView)){throw new Error('F$ArrayView required');}if(this._arrayView!=arrayView){if(this._arrayView){this._arrayView.off(FunUI.events.ARRAY_VIEW_UPDATE,this.render);}if(arrayView){arrayView.on(FunUI.events.ARRAY_VIEW_UPDATE,this.render);}this._arrayView=arrayView;this.render();}},get dataProvider(){return this._arrayView;},render:function render(){if(!this._arrayView){this.innerHTML="";}else{this.innerHTML=this._arrayView.page+(this._arrayView.pageCount==0?0:1)+"/"+this._arrayView.pageCount;}}};FunUI.components.PageCtrl={_mouseDown:false,__init__:function __init__(){FunUI.utils.attachSound(this);this.presentLabelChild();this.presentSubComponent("hover");this.on("click",this.perform);},set dataProvider(arrayView){if(!(arrayView instanceof FunUI.utils.ArrayView)){throw new Error('F$ArrayView required');}if(this._arrayView!=arrayView){if(this._arrayView){this._arrayView.off(FunUI.events.ARRAY_VIEW_UPDATE,this.render);}if(arrayView){arrayView.on(FunUI.events.ARRAY_VIEW_UPDATE,this.render);}this._arrayView=arrayView;this.render();}},get dataProvider(){return this._arrayView;},perform:function perform(event){var arrayView=this.dataProvider;if(!arrayView){return;}if(this.hasClass("prevPage")){arrayView.page--;}else if(this.hasClass("nextPage")){arrayView.page++;}else if(this.hasClass("firstPage")){arrayView.page=0;}else if(this.hasClass("lastPage")){arrayView.page=arrayView.pageCount-1;}if(!!event&&event instanceof MouseEvent&&event.type=="mousedown"){}},render:function render(){var arrayView=this.dataProvider;if(!arrayView){this.disabled=true;return;}if(this.hasClass("prevPage")||this.hasClass("firstPage")){this.disabled=arrayView.isFirstPage;}else if(this.hasClass("nextPage")||this.hasClass("lastPage")){this.disabled=arrayView.isLastPage;}}};FunUI.components.DropDownList={_label:null,list:null,itemRenderer:{_label:null,__init__:function __init__(){FunUI.utils.attachSound(this);this.on('click',function(){this.list.selectItem(this.index);});this._label=this.presentLabelChild(true);this.presentSubComponent('hover');},render:function render(data){this._label.innerHTML=data;}},__init__:function __init__(){this._label=this.presentLabelChild(true);this.list=document.createElement("ul");this.list.className="F-List forDropDownList";this.list.presentSubComponent("F-ItemRenderer","li");this.list.initFunUI({itemRenderer:this.itemRenderer});var self=this;this.list.on(FunUI.events.SELECTED_CHANGED,function(event){self.renderLabel(self._label,self.selectedItem);});this.deactivate();},renderLabel:function renderLabel(label,data){label.innerHTML=data;},set dataProvider(arrayView){this.list.dataProvider=arrayView;},activate:function activate(event){this.off('click',this.activate);this.addClass('active');FunUI.managers.PopUpManager.addPopUp(this.list,false,FunUI.managers.PopUpManager.LAYER_PERIPHERY);this.positionList(this.list);if(event!=null){event.stopPropagation();}document.documentElement.on('click',this.deactivate);},deactivate:function deactivate(event){document.documentElement.off('click',this.deactivate);this.removeClass('active');FunUI.managers.PopUpManager.removePopUp(this.list);this.on('click',this.activate);},selectItem:function selectItem(index){this.list.selectItem(index);},get selectedItem(){return this.list.selectedDatum;},positionList:function positionList(list){var clientRect=this.getBoundingClientRect();list.style.width=clientRect.width+'px';list.style.left=clientRect.left+"px";list.style.top=clientRect.bottom+this.list.height>document.documentElement.offsetHeight?clientRect.top-this.list.height+"px":clientRect.bottom+"px";}};FunUI.components.ProgressBar={_indicators:null,_base:null,_progresses:null,__init__:function __init__(){this._indicators=this.querySelectorAll('.indicator');},setProgresses:function setProgresses(){this._base=arguments[0];this._progresses=Array.prototype.slice.call(arguments,1);this.invalidate();},getProgress:function getProgress(index){return Math.floor(this._progresses[index]*100/this._base)/100;},commitProperties:function commitProperties(){if(!this._progresses){return;}for(var i=0;i<this._indicators.length;i++){this._indicators[i].style.width=Math.floor(this._progresses[i]*100/this._base)+"%";}}};FunUI.components.Prompt={_titleElement:null,_contentElement:null,_queue:null,__init__:function __init__(){this._titleElement=this.getSubComponent("title");this._contentElement=this.getSubComponent("content");var yesButton=this.querySelector(".F-Button.yes");if(yesButton){yesButton.on("click",this._yesHandler);}var noButton=this.querySelector(".F-Button.no");if(noButton){noButton.on("click",this._noHandler);}},show:function show(title,content,onYes,onNo){if(this._queue==null){this._queue=[];}this._queue.push({title:title,content:content,onYes:onYes,onNo:onNo});if(this._queue.length==1){this._renderFirst();}FunUI.managers.PopUpManager.addPopUp(this,true,FunUI.managers.PopUpManager.LAYER_TOP);},hide:function hide(){FunUI.managers.PopUpManager.removePopUp(this);},_renderFirst:function _renderFirst(){var obj=this._queue[0];this._titleElement.innerHTML=obj.title;this._contentElement.innerHTML=obj.content;},_renderNext:function _renderNext(){this._queue.shift();if(this._queue.length==0){this.hide();}else{this._renderFirst();}},_yesHandler:function _yesHandler(){var obj=this._queue[0];if(obj.onYes){obj.onYes();}this._renderNext();},_noHandler:function _noHandler(){var obj=this._queue[0];if(!!obj.onNo){obj.onNo();}this._renderNext();}};FunUI.annotations={};FunUI.annotations.Observer={selector:null,event:null,useCapture:false,apply:function apply(obj,value){if(typeof value!="function"){throw new Error("invalid listener");}value=value.bind(obj);if(!this.selector){obj.on(this.event,value,this.useCapture);}else{var elements=obj.querySelectorAll(this.selector);for(var i=0;i<elements.length;i++){elements[i].on(this.event,value,this.useCapture);}}return value;}};FunUI.annotations.Delay={apply:function apply(obj,value){if(typeof value!="function"){throw new Error("invalid function");}return obj.delayCall.bind(obj,value,obj);}};FunUI.layouts={};FunUI.traits={};FunUI.views={};Object.freeze(FunUI.utils);Object.freeze(FunUI.events);Object.freeze(FunUI.managers);Object.freeze(FunUI.components);Object.freeze(FunUI);var F$=FunUI.utils.getView;var F$ArrayView=FunUI.utils.ArrayView;var F$ajax=FunUI.utils.ajax;var F$alert=FunUI.utils.alert;var F$confirm=FunUI.utils.confirm;var F_=FunUI.lang.getEmbeddedText;var has=Object.prototype.hasOwnProperty;function _require(path,parent,orig){var resolved=_require.resolve(path);if(null==resolved){orig=orig||path;parent=parent||'root';var err=new Error('Failed to require "'+orig+'" from "'+parent+'"');err.path=orig;err.parent=parent;err.require=true;throw err;}var module=_require.modules[resolved];if(!module.exports){module.exports={};module.client=module.component=true;module.call(this,module.exports,_require.relative(resolved),module);}return module.exports;}_require.modules={};_require.aliases={};_require.resolve=function(path){if(path.charAt(0)==='/')path=path.slice(1);var index=path+'/index.js';var paths=[path,path+'.js',path+'.json',path+'/index.js',path+'/index.json'];for(var i=0;i<paths.length;i++){var path=paths[i];if(has.call(_require.modules,path))return path;}if(has.call(_require.aliases,index)){return _require.aliases[index];}};_require.normalize=function(curr,path){var segs=[];if('.'!=path.charAt(0))return path;curr=curr.split('/');path=path.split('/');for(var i=0;i<path.length;++i){if('..'==path[i]){curr.pop();}else if('.'!=path[i]&&''!=path[i]){segs.push(path[i]);}}return curr.concat(segs).join('/');};_require.register=function(path,definition){_require.modules[path]=definition;};_require.alias=function(from,to){if(!has.call(_require.modules,from)){throw new Error('Failed to alias "'+from+'", it does not exist');}_require.aliases[to]=from;};_require.relative=function(parent){var p=_require.normalize(parent,'..');function lastIndexOf(arr,obj){var i=arr.length;while(i--){if(arr[i]===obj)return i;}return-1;}function localRequire(path){var resolved=localRequire.resolve(path);return _require(resolved,parent,path);}localRequire.resolve=function(path){var c=path.charAt(0);if('/'==c)return path.slice(1);if('.'==c)return _require.normalize(p,path);var segs=parent.split('/');var i=lastIndexOf(segs,'deps')+1;if(!i)i=0;path=segs.slice(0,i+1).join('/')+'/deps/'+path;return path;};localRequire.exists=function(path){return has.call(_require.modules,localRequire.resolve(path));};return localRequire;};_require.register("component-indexof/index.js",function(exports,require,module){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i;}return-1;};});_require.register("component-emitter/index.js",function(exports,require,module){var index=require('indexof');module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj);};function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key];}return obj;}Emitter.prototype.on=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this;};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments);}fn._off=on;this.on(event,on);return this;};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this;}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this;}var i=index(callbacks,fn._off||fn);if(~i)callbacks.splice(i,1);return this;};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args);}}return this;};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[];};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length;};});_require.register("NetEase-pomelo-protocol/lib/protocol.js",function(exports,require,module){(function(exports,ByteArray,global){var Protocol=exports;var PKG_HEAD_BYTES=4;var MSG_FLAG_BYTES=1;var MSG_ROUTE_CODE_BYTES=2;var MSG_ID_MAX_BYTES=5;var MSG_ROUTE_LEN_BYTES=1;var MSG_ROUTE_CODE_MAX=0xffff;var MSG_COMPRESS_ROUTE_MASK=0x1;var MSG_TYPE_MASK=0x7;var Package=Protocol.Package={};var Message=Protocol.Message={};Package.TYPE_HANDSHAKE=1;Package.TYPE_HANDSHAKE_ACK=2;Package.TYPE_HEARTBEAT=3;Package.TYPE_DATA=4;Package.TYPE_KICK=5;Message.TYPE_REQUEST=0;Message.TYPE_NOTIFY=1;Message.TYPE_RESPONSE=2;Message.TYPE_PUSH=3;Protocol.strencode=function(str){var byteArray=new ByteArray(str.length*3);var offset=0;for(var i=0;i<str.length;i++){var charCode=str.charCodeAt(i);var codes=null;if(charCode<=0x7f){codes=[charCode];}else if(charCode<=0x7ff){codes=[0xc0|charCode>>6,0x80|charCode&0x3f];}else{codes=[0xe0|charCode>>12,0x80|(charCode&0xfc0)>>6,0x80|charCode&0x3f];}for(var j=0;j<codes.length;j++){byteArray[offset]=codes[j];++offset;}}var _buffer=new ByteArray(offset);copyArray(_buffer,0,byteArray,0,offset);return _buffer;};Protocol.strdecode=function(buffer){var bytes=new ByteArray(buffer);var array=[];var offset=0;var charCode=0;var end=bytes.length;var strings=[],chunkSize=0xffff;while(offset<end){if(bytes[offset]<128){charCode=bytes[offset];offset+=1;}else if(bytes[offset]<224){charCode=((bytes[offset]&0x3f)<<6)+(bytes[offset+1]&0x3f);offset+=2;}else{charCode=((bytes[offset]&0x0f)<<12)+((bytes[offset+1]&0x3f)<<6)+(bytes[offset+2]&0x3f);offset+=3;}array.push(charCode);if(array.length==chunkSize){strings.push(String.fromCharCode.apply(null,array));array=[];}}strings.push(String.fromCharCode.apply(null,array));return strings.join('');};Package.encode=function(type,body){var length=body?body.length:0;var buffer=new ByteArray(PKG_HEAD_BYTES+length);var index=0;buffer[index++]=type&0xff;buffer[index++]=length>>16&0xff;buffer[index++]=length>>8&0xff;buffer[index++]=length&0xff;if(body){copyArray(buffer,index,body,0,length);}return buffer;};Package.decode=function(buffer){var bytes=new ByteArray(buffer);var type=bytes[0];var index=1;var length=(bytes[index++]<<16|bytes[index++]<<8|bytes[index++])>>>0;var body=length?new ByteArray(length):null;copyArray(body,0,bytes,PKG_HEAD_BYTES,length);return{'type':type,'body':body};};Message.encode=function(id,type,compressRoute,route,msg){var idBytes=msgHasId(type)?caculateMsgIdBytes(id):0;var msgLen=MSG_FLAG_BYTES+idBytes;if(msgHasRoute(type)){if(compressRoute){if(typeof route!=='number'){throw new Error('error flag for number route!');}msgLen+=MSG_ROUTE_CODE_BYTES;}else{msgLen+=MSG_ROUTE_LEN_BYTES;if(route){route=Protocol.strencode(route);if(route.length>255){throw new Error('route maxlength is overflow');}msgLen+=route.length;}}}if(msg){msgLen+=msg.length;}var buffer=new ByteArray(msgLen);var offset=0;offset=encodeMsgFlag(type,compressRoute,buffer,offset);if(msgHasId(type)){offset=encodeMsgId(id,idBytes,buffer,offset);}if(msgHasRoute(type)){offset=encodeMsgRoute(compressRoute,route,buffer,offset);}if(msg){offset=encodeMsgBody(msg,buffer,offset);}return buffer;};Message.decode=function(buffer){var bytes=new ByteArray(buffer);var bytesLen=bytes.length||bytes.byteLength;var offset=0;var id=0;var route=null;var flag=bytes[offset++];var compressRoute=flag&MSG_COMPRESS_ROUTE_MASK;var type=flag>>1&MSG_TYPE_MASK;if(msgHasId(type)){var byte=bytes[offset++];id=byte&0x7f;while(byte&0x80){id<<=7;byte=bytes[offset++];id|=byte&0x7f;}}if(msgHasRoute(type)){if(compressRoute){route=bytes[offset++]<<8|bytes[offset++];}else{var routeLen=bytes[offset++];if(routeLen){route=new ByteArray(routeLen);copyArray(route,0,bytes,offset,routeLen);route=Protocol.strdecode(route);}else{route='';}offset+=routeLen;}}var bodyLen=bytesLen-offset;var body=new ByteArray(bodyLen);copyArray(body,0,bytes,offset,bodyLen);return{'id':id,'type':type,'compressRoute':compressRoute,'route':route,'body':body};};var copyArray=function copyArray(dest,doffset,src,soffset,length){if('function'===typeof src.copy){src.copy(dest,doffset,soffset,soffset+length);}else{for(var index=0;index<length;index++){dest[doffset++]=src[soffset++];}}};var msgHasId=function msgHasId(type){return type===Message.TYPE_REQUEST||type===Message.TYPE_RESPONSE;};var msgHasRoute=function msgHasRoute(type){return type===Message.TYPE_REQUEST||type===Message.TYPE_NOTIFY||type===Message.TYPE_PUSH;};var caculateMsgIdBytes=function caculateMsgIdBytes(id){var len=0;do{len+=1;id>>=7;}while(id>0);return len;};var encodeMsgFlag=function encodeMsgFlag(type,compressRoute,buffer,offset){if(type!==Message.TYPE_REQUEST&&type!==Message.TYPE_NOTIFY&&type!==Message.TYPE_RESPONSE&&type!==Message.TYPE_PUSH){throw new Error('unkonw message type: '+type);}buffer[offset]=type<<1|(compressRoute?1:0);return offset+MSG_FLAG_BYTES;};var encodeMsgId=function encodeMsgId(id,idBytes,buffer,offset){var index=offset+idBytes-1;buffer[index--]=id&0x7f;while(index>=offset){id>>=7;buffer[index--]=id&0x7f|0x80;}return offset+idBytes;};var encodeMsgRoute=function encodeMsgRoute(compressRoute,route,buffer,offset){if(compressRoute){if(route>MSG_ROUTE_CODE_MAX){throw new Error('route number is overflow');}buffer[offset++]=route>>8&0xff;buffer[offset++]=route&0xff;}else{if(route){buffer[offset++]=route.length&0xff;copyArray(buffer,offset,route,0,route.length);offset+=route.length;}else{buffer[offset++]=0;}}return offset;};var encodeMsgBody=function encodeMsgBody(msg,buffer,offset){copyArray(buffer,offset,msg,0,msg.length);return offset+msg.length;};module.exports=Protocol;})('object'===(typeof module==="undefined"?"undefined":_typeof(module))?module.exports:{},'object'===(typeof module==="undefined"?"undefined":_typeof(module))?Buffer:Uint8Array,this);});_require.register("pomelonode-pomelo-protobuf/lib/client/protobuf.js",function(exports,require,module){(function(exports,global){var Protobuf=exports;Protobuf.init=function(opts){Protobuf.encoder.init(opts.encoderProtos);Protobuf.decoder.init(opts.decoderProtos);};Protobuf.encode=function(key,msg){return Protobuf.encoder.encode(key,msg);};Protobuf.decode=function(key,msg){return Protobuf.decoder.decode(key,msg);};module.exports=Protobuf;})('object'===(typeof module==="undefined"?"undefined":_typeof(module))?module.exports:{},this);(function(exports,global){var constants=exports.constants={};constants.TYPES={uInt32:0,sInt32:0,int32:0,double:1,string:2,message:2,float:5};})('undefined'!==typeof protobuf?protobuf:module.exports,this);(function(exports,global){var Util=exports.util={};Util.isSimpleType=function(type){return type==='uInt32'||type==='sInt32'||type==='int32'||type==='uInt64'||type==='sInt64'||type==='float'||type==='double';};})('undefined'!==typeof protobuf?protobuf:module.exports,this);(function(exports,global){var Codec=exports.codec={};var buffer=new ArrayBuffer(8);var float32Array=new Float32Array(buffer);var float64Array=new Float64Array(buffer);var uInt8Array=new Uint8Array(buffer);Codec.encodeUInt32=function(n){var n=parseInt(n);if(isNaN(n)||n<0){return null;}var result=[];do{var tmp=n%128;var next=Math.floor(n/128);if(next!==0){tmp=tmp+128;}result.push(tmp);n=next;}while(n!==0);return result;};Codec.encodeSInt32=function(n){var n=parseInt(n);if(isNaN(n)){return null;}n=n<0?Math.abs(n)*2-1:n*2;return Codec.encodeUInt32(n);};Codec.decodeUInt32=function(bytes){var n=0;for(var i=0;i<bytes.length;i++){var m=parseInt(bytes[i]);n=n+(m&0x7f)*Math.pow(2,7*i);if(m<128){return n;}}return n;};Codec.decodeSInt32=function(bytes){var n=this.decodeUInt32(bytes);var flag=n%2===1?-1:1;n=(n%2+n)/2*flag;return n;};Codec.encodeFloat=function(float){float32Array[0]=float;return uInt8Array;};Codec.decodeFloat=function(bytes,offset){if(!bytes||bytes.length<offset+4){return null;}for(var i=0;i<4;i++){uInt8Array[i]=bytes[offset+i];}return float32Array[0];};Codec.encodeDouble=function(double){float64Array[0]=double;return uInt8Array.subarray(0,8);};Codec.decodeDouble=function(bytes,offset){if(!bytes||bytes.length<8+offset){return null;}for(var i=0;i<8;i++){uInt8Array[i]=bytes[offset+i];}return float64Array[0];};Codec.encodeStr=function(bytes,offset,str){for(var i=0;i<str.length;i++){var code=str.charCodeAt(i);var codes=encode2UTF8(code);for(var j=0;j<codes.length;j++){bytes[offset]=codes[j];offset++;}}return offset;};Codec.decodeStr=function(bytes,offset,length){var array=[];var end=offset+length;while(offset<end){var code=0;if(bytes[offset]<128){code=bytes[offset];offset+=1;}else if(bytes[offset]<224){code=((bytes[offset]&0x3f)<<6)+(bytes[offset+1]&0x3f);offset+=2;}else{code=((bytes[offset]&0x0f)<<12)+((bytes[offset+1]&0x3f)<<6)+(bytes[offset+2]&0x3f);offset+=3;}array.push(code);}var str='';for(var i=0;i<array.length;){str+=String.fromCharCode.apply(null,array.slice(i,i+10000));i+=10000;}return str;};Codec.byteLength=function(str){if(typeof str!=='string'){return-1;}var length=0;for(var i=0;i<str.length;i++){var code=str.charCodeAt(i);length+=codeLength(code);}return length;};function encode2UTF8(charCode){if(charCode<=0x7f){return[charCode];}else if(charCode<=0x7ff){return[0xc0|charCode>>6,0x80|charCode&0x3f];}else{return[0xe0|charCode>>12,0x80|(charCode&0xfc0)>>6,0x80|charCode&0x3f];}}function codeLength(code){if(code<=0x7f){return 1;}else if(code<=0x7ff){return 2;}else{return 3;}}})('undefined'!==typeof protobuf?protobuf:module.exports,this);(function(exports,global){var protobuf=exports;var MsgEncoder=exports.encoder={};var codec=protobuf.codec;var constant=protobuf.constants;var util=protobuf.util;MsgEncoder.init=function(protos){this.protos=protos||{};};MsgEncoder.encode=function(route,msg){var protos=this.protos[route];if(!checkMsg(msg,protos)){return null;}var length=codec.byteLength(JSON.stringify(msg));var buffer=new ArrayBuffer(length);var uInt8Array=new Uint8Array(buffer);var offset=0;if(!!protos){offset=encodeMsg(uInt8Array,offset,protos,msg);if(offset>0){return uInt8Array.subarray(0,offset);}}return null;};function checkMsg(msg,protos){if(!protos){return false;}for(var name in protos){var proto=protos[name];switch(proto.option){case'required':if(typeof msg[name]==='undefined'){return false;}case'optional':if(typeof msg[name]!=='undefined'){if(!!protos.__messages[proto.type]){checkMsg(msg[name],protos.__messages[proto.type]);}}break;case'repeated':if(!!msg[name]&&!!protos.__messages[proto.type]){for(var i=0;i<msg[name].length;i++){if(!checkMsg(msg[name][i],protos.__messages[proto.type])){return false;}}}break;}}return true;}function encodeMsg(buffer,offset,protos,msg){for(var name in msg){if(!!protos[name]){var proto=protos[name];switch(proto.option){case'required':case'optional':offset=writeBytes(buffer,offset,encodeTag(proto.type,proto.tag));offset=encodeProp(msg[name],proto.type,offset,buffer,protos);break;case'repeated':if(msg[name].length>0){offset=encodeArray(msg[name],proto,offset,buffer,protos);}break;}}}return offset;}function encodeProp(value,type,offset,buffer,protos){switch(type){case'uInt32':offset=writeBytes(buffer,offset,codec.encodeUInt32(value));break;case'int32':case'sInt32':offset=writeBytes(buffer,offset,codec.encodeSInt32(value));break;case'float':writeBytes(buffer,offset,codec.encodeFloat(value));offset+=4;break;case'double':writeBytes(buffer,offset,codec.encodeDouble(value));offset+=8;break;case'string':var length=codec.byteLength(value);offset=writeBytes(buffer,offset,codec.encodeUInt32(length));codec.encodeStr(buffer,offset,value);offset+=length;break;default:if(!!protos.__messages[type]){var tmpBuffer=new ArrayBuffer(codec.byteLength(JSON.stringify(value)));var length=0;length=encodeMsg(tmpBuffer,length,protos.__messages[type],value);offset=writeBytes(buffer,offset,codec.encodeUInt32(length));for(var i=0;i<length;i++){buffer[offset]=tmpBuffer[i];offset++;}}break;}return offset;}function encodeArray(array,proto,offset,buffer,protos){var i=0;if(util.isSimpleType(proto.type)){offset=writeBytes(buffer,offset,encodeTag(proto.type,proto.tag));offset=writeBytes(buffer,offset,codec.encodeUInt32(array.length));for(i=0;i<array.length;i++){offset=encodeProp(array[i],proto.type,offset,buffer);}}else{for(i=0;i<array.length;i++){offset=writeBytes(buffer,offset,encodeTag(proto.type,proto.tag));offset=encodeProp(array[i],proto.type,offset,buffer,protos);}}return offset;}function writeBytes(buffer,offset,bytes){for(var i=0;i<bytes.length;i++,offset++){buffer[offset]=bytes[i];}return offset;}function encodeTag(type,tag){var value=constant.TYPES[type]||2;return codec.encodeUInt32(tag<<3|value);}})('undefined'!==typeof protobuf?protobuf:module.exports,this);(function(exports,global){var protobuf=exports;var MsgDecoder=exports.decoder={};var codec=protobuf.codec;var util=protobuf.util;var buffer;var offset=0;MsgDecoder.init=function(protos){this.protos=protos||{};};MsgDecoder.setProtos=function(protos){if(!!protos){this.protos=protos;}};MsgDecoder.decode=function(route,buf){var protos=this.protos[route];buffer=buf;offset=0;if(!!protos){return decodeMsg({},protos,buffer.length);}return null;};function decodeMsg(msg,protos,length){while(offset<length){var head=getHead();var type=head.type;var tag=head.tag;var name=protos.__tags[tag];switch(protos[name].option){case'optional':case'required':msg[name]=decodeProp(protos[name].type,protos);break;case'repeated':if(!msg[name]){msg[name]=[];}decodeArray(msg[name],protos[name].type,protos);break;}}return msg;}function isFinish(msg,protos){return!protos.__tags[peekHead().tag];}function getHead(){var tag=codec.decodeUInt32(getBytes());return{type:tag&0x7,tag:tag>>3};}function peekHead(){var tag=codec.decodeUInt32(peekBytes());return{type:tag&0x7,tag:tag>>3};}function decodeProp(type,protos){switch(type){case'uInt32':return codec.decodeUInt32(getBytes());case'int32':case'sInt32':return codec.decodeSInt32(getBytes());case'float':var float=codec.decodeFloat(buffer,offset);offset+=4;return float;case'double':var double=codec.decodeDouble(buffer,offset);offset+=8;return double;case'string':var length=codec.decodeUInt32(getBytes());var str=codec.decodeStr(buffer,offset,length);offset+=length;return str;default:if(!!protos&&!!protos.__messages[type]){var length=codec.decodeUInt32(getBytes());var msg={};decodeMsg(msg,protos.__messages[type],offset+length);return msg;}break;}}function decodeArray(array,type,protos){if(util.isSimpleType(type)){var length=codec.decodeUInt32(getBytes());for(var i=0;i<length;i++){array.push(decodeProp(type));}}else{array.push(decodeProp(type,protos));}}function getBytes(flag){var bytes=[];var pos=offset;flag=flag||false;var b;do{b=buffer[pos];bytes.push(b);pos++;}while(b>=128);if(!flag){offset=pos;}return bytes;}function peekBytes(){return getBytes(true);}})('undefined'!==typeof protobuf?protobuf:module.exports,this);});_require.register("pomelonode-pomelo-jsclient-websocket/lib/pomelo-client.js",function(exports,require,module){(function(){var JS_WS_CLIENT_TYPE='js-websocket';var JS_WS_CLIENT_VERSION='0.0.1';var Protocol=window.Protocol;var Package=Protocol.Package;var Message=Protocol.Message;var EventEmitter=window.EventEmitter;var RES_OK=200;var RES_FAIL=500;var RES_OLD_CLIENT=501;if(typeof Object.create!=='function'){Object.create=function(o){function F(){}F.prototype=o;return new F();};}var root=window;var pomelo=Object.create(EventEmitter.prototype);root.pomelo=pomelo;var socket=null;var reqId=0;var callbacks={};var handlers={};var routeMap={};var heartbeatInterval=0;var heartbeatTimeout=0;var nextHeartbeatTimeout=0;var gapThreshold=100;var heartbeatId=null;var heartbeatTimeoutId=null;var handshakeCallback=null;var handshakeBuffer={'sys':{type:JS_WS_CLIENT_TYPE,version:JS_WS_CLIENT_VERSION},'user':{}};var initCallback=null;pomelo.init=function(params,cb){initCallback=cb;var host=params.host;var port=params.port;var url='wss://'+host;if(port){url+=':'+port;}handshakeBuffer.user=params.user;handshakeCallback=params.handshakeCallback;initWebSocket(url,cb);};var initWebSocket=function initWebSocket(url,cb){var onopen=function onopen(event){var obj=Package.encode(Package.TYPE_HANDSHAKE,Protocol.strencode(JSON.stringify(handshakeBuffer)));send(obj);};var onmessage=function onmessage(event){processPackage(Package.decode(event.data),cb);if(heartbeatTimeout){nextHeartbeatTimeout=Date.now()+heartbeatTimeout;}};var onerror=function onerror(event){pomelo.emit('io-error',event);console.error('socket error: ',event);};var onclose=function onclose(event){pomelo.emit('close',event);};socket=new WebSocket(url);socket.binaryType='arraybuffer';socket.onopen=onopen;socket.onmessage=onmessage;socket.onerror=onerror;socket.onclose=onclose;};pomelo.disconnect=function(){if(socket){if(socket.disconnect)socket.disconnect();if(socket.close)socket.close();socket=null;}if(heartbeatId){clearTimeout(heartbeatId);heartbeatId=null;}if(heartbeatTimeoutId){clearTimeout(heartbeatTimeoutId);heartbeatTimeoutId=null;}};pomelo.request=function(route,msg,cb){if(arguments.length===2&&typeof msg==='function'){cb=msg;msg={};}else{msg=msg||{};}route=route||msg.route;if(!route){return;}reqId++;sendMessage(reqId,route,msg);callbacks[reqId]=cb;routeMap[reqId]=route;};pomelo.notify=function(route,msg){msg=msg||{};sendMessage(0,route,msg);};var sendMessage=function sendMessage(reqId,route,msg){if(!socket){return;}var type=reqId?Message.TYPE_REQUEST:Message.TYPE_NOTIFY;var protos=!!pomelo.data.protos?pomelo.data.protos.client:{};if(!!protos[route]){msg=protobuf.encode(route,msg);}else{msg=Protocol.strencode(JSON.stringify(msg));}var compressRoute=0;if(pomelo.dict&&pomelo.dict[route]){route=pomelo.dict[route];compressRoute=1;}msg=Message.encode(reqId,type,compressRoute,route,msg);var packet=Package.encode(Package.TYPE_DATA,msg);send(packet);};var send=function send(packet){socket.send(packet.buffer);};var handler={};var heartbeat=function heartbeat(data){if(!heartbeatInterval){return;}var obj=Package.encode(Package.TYPE_HEARTBEAT);if(heartbeatTimeoutId){clearTimeout(heartbeatTimeoutId);heartbeatTimeoutId=null;}if(heartbeatId){return;}heartbeatId=setTimeout(function(){heartbeatId=null;send(obj);nextHeartbeatTimeout=Date.now()+heartbeatTimeout;heartbeatTimeoutId=setTimeout(heartbeatTimeoutCb,heartbeatTimeout);},heartbeatInterval);};var heartbeatTimeoutCb=function heartbeatTimeoutCb(){var gap=nextHeartbeatTimeout-Date.now();if(gap>gapThreshold){heartbeatTimeoutId=setTimeout(heartbeatTimeoutCb,gap);}else{console.error('server heartbeat timeout');pomelo.emit('heartbeat timeout');pomelo.disconnect();}};var handshake=function handshake(data){data=JSON.parse(Protocol.strdecode(data));if(data.code===RES_OLD_CLIENT){pomelo.emit('error','client version not fullfill');return;}if(data.code!==RES_OK){pomelo.emit('error','handshake fail');return;}handshakeInit(data);var obj=Package.encode(Package.TYPE_HANDSHAKE_ACK);send(obj);if(initCallback){initCallback(socket);initCallback=null;}};var onData=function onData(data){var msg=Message.decode(data);if(msg.id>0){msg.route=routeMap[msg.id];delete routeMap[msg.id];if(!msg.route){return;}}msg.body=deCompose(msg);processMessage(pomelo,msg);};var onKick=function onKick(data){pomelo.emit('onKick');};handlers[Package.TYPE_HANDSHAKE]=handshake;handlers[Package.TYPE_HEARTBEAT]=heartbeat;handlers[Package.TYPE_DATA]=onData;handlers[Package.TYPE_KICK]=onKick;var processPackage=function processPackage(msg){handlers[msg.type](msg.body);};var processMessage=function processMessage(pomelo,msg){if(!msg.id){pomelo.emit(msg.route,msg.body);return;}var cb=callbacks[msg.id];delete callbacks[msg.id];if(typeof cb!=='function'){return;}cb(msg.body);return;};var processMessageBatch=function processMessageBatch(pomelo,msgs){for(var i=0,l=msgs.length;i<l;i++){processMessage(pomelo,msgs[i]);}};var deCompose=function deCompose(msg){var protos=!!pomelo.data.protos?pomelo.data.protos.server:{};var abbrs=pomelo.data.abbrs;var route=msg.route;if(msg.compressRoute){if(!abbrs[route]){return{};}route=msg.route=abbrs[route];}if(!!protos[route]){return protobuf.decode(route,msg.body);}else{return JSON.parse(Protocol.strdecode(msg.body));}return msg;};var handshakeInit=function handshakeInit(data){if(data.sys&&data.sys.heartbeat){heartbeatInterval=data.sys.heartbeat*1000;heartbeatTimeout=heartbeatInterval*2;}else{heartbeatInterval=0;heartbeatTimeout=0;}initData(data);if(typeof handshakeCallback==='function'){handshakeCallback(data.user);}};var initData=function initData(data){if(!data||!data.sys){return;}pomelo.data=pomelo.data||{};var dict=data.sys.dict;var protos=data.sys.protos;if(dict){pomelo.data.dict=dict;pomelo.data.abbrs={};for(var route in dict){pomelo.data.abbrs[dict[route]]=route;}}if(protos){pomelo.data.protos={server:protos.server||{},client:protos.client||{}};if(!!protobuf){protobuf.init({encoderProtos:protos.client,decoderProtos:protos.server});}}};module.exports=pomelo;})();});_require.register("boot/index.js",function(exports,require,module){var Emitter=require('emitter');window.EventEmitter=Emitter;var protocol=require('pomelo-protocol');window.Protocol=protocol;var protobuf=require('pomelo-protobuf');window.protobuf=protobuf;var pomelo=require('pomelo-jsclient-websocket');window.pomelo=pomelo;});_require.alias("boot/index.js","pomelo-client/deps/boot/index.js");_require.alias("component-emitter/index.js","boot/deps/emitter/index.js");_require.alias("component-indexof/index.js","component-emitter/deps/indexof/index.js");_require.alias("NetEase-pomelo-protocol/lib/protocol.js","boot/deps/pomelo-protocol/lib/protocol.js");_require.alias("NetEase-pomelo-protocol/lib/protocol.js","boot/deps/pomelo-protocol/index.js");_require.alias("NetEase-pomelo-protocol/lib/protocol.js","NetEase-pomelo-protocol/index.js");_require.alias("pomelonode-pomelo-protobuf/lib/client/protobuf.js","boot/deps/pomelo-protobuf/lib/client/protobuf.js");_require.alias("pomelonode-pomelo-protobuf/lib/client/protobuf.js","boot/deps/pomelo-protobuf/index.js");_require.alias("pomelonode-pomelo-protobuf/lib/client/protobuf.js","pomelonode-pomelo-protobuf/index.js");_require.alias("pomelonode-pomelo-jsclient-websocket/lib/pomelo-client.js","boot/deps/pomelo-jsclient-websocket/lib/pomelo-client.js");_require.alias("pomelonode-pomelo-jsclient-websocket/lib/pomelo-client.js","boot/deps/pomelo-jsclient-websocket/index.js");_require.alias("pomelonode-pomelo-jsclient-websocket/lib/pomelo-client.js","pomelonode-pomelo-jsclient-websocket/index.js");_require('boot');var saveAs=saveAs||navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(view){var doc=view.document,get_URL=function get_URL(){return view.URL||view.webkitURL||view;},URL=view.URL||view.webkitURL||view,save_link=doc.createElementNS("http://www.w3.org/1999/xhtml","a"),can_use_save_link=!view.externalHost&&"download"in save_link,click=function click(node){var event=doc.createEvent("MouseEvents");event.initMouseEvent("click",true,false,view,0,0,0,0,0,false,false,false,false,0,null);node.dispatchEvent(event);},webkit_req_fs=view.webkitRequestFileSystem,req_fs=view.requestFileSystem||webkit_req_fs||view.mozRequestFileSystem,throw_outside=function throw_outside(ex){(view.setImmediate||view.setTimeout)(function(){throw ex;},0);},force_saveable_type="application/octet-stream",fs_min_size=0,deletion_queue=[],process_deletion_queue=function process_deletion_queue(){var i=deletion_queue.length;while(i--){var file=deletion_queue[i];if(typeof file==="string"){URL.revokeObjectURL(file);}else{file.remove();}}deletion_queue.length=0;},dispatch=function dispatch(filesaver,event_types,event){event_types=[].concat(event_types);var i=event_types.length;while(i--){var listener=filesaver["on"+event_types[i]];if(typeof listener==="function"){try{listener.call(filesaver,event||filesaver);}catch(ex){throw_outside(ex);}}}},FileSaver=function FileSaver(blob,name){var filesaver=this,type=blob.type,blob_changed=false,object_url,target_view,get_object_url=function get_object_url(){var object_url=get_URL().createObjectURL(blob);deletion_queue.push(object_url);return object_url;},dispatch_all=function dispatch_all(){dispatch(filesaver,"writestart progress write writeend".split(" "));},fs_error=function fs_error(){if(blob_changed||!object_url){object_url=get_object_url(blob);}if(target_view){target_view.location.href=object_url;}else{window.open(object_url,"_blank");}filesaver.readyState=filesaver.DONE;dispatch_all();},abortable=function abortable(func){return function(){if(filesaver.readyState!==filesaver.DONE){return func.apply(this,arguments);}};},create_if_not_found={create:true,exclusive:false},slice;filesaver.readyState=filesaver.INIT;if(!name){name="download";}if(can_use_save_link){object_url=get_object_url(blob);save_link.href=object_url;save_link.download=name;click(save_link);filesaver.readyState=filesaver.DONE;dispatch_all();return;}if(view.chrome&&type&&type!==force_saveable_type){slice=blob.slice||blob.webkitSlice;blob=slice.call(blob,0,blob.size,force_saveable_type);blob_changed=true;}if(webkit_req_fs&&name!=="download"){name+=".download";}if(type===force_saveable_type||webkit_req_fs){target_view=view;}if(!req_fs){fs_error();return;}fs_min_size+=blob.size;req_fs(view.TEMPORARY,fs_min_size,abortable(function(fs){fs.root.getDirectory("saved",create_if_not_found,abortable(function(dir){var save=function save(){dir.getFile(name,create_if_not_found,abortable(function(file){file.createWriter(abortable(function(writer){writer.onwriteend=function(event){target_view.location.href=file.toURL();deletion_queue.push(file);filesaver.readyState=filesaver.DONE;dispatch(filesaver,"writeend",event);};writer.onerror=function(){var error=writer.error;if(error.code!==error.ABORT_ERR){fs_error();}};"writestart progress write abort".split(" ").forEach(function(event){writer["on"+event]=filesaver["on"+event];});writer.write(blob);filesaver.abort=function(){writer.abort();filesaver.readyState=filesaver.DONE;};filesaver.readyState=filesaver.WRITING;}),fs_error);}),fs_error);};dir.getFile(name,{create:false},abortable(function(file){file.remove();save();}),abortable(function(ex){if(ex.code===ex.NOT_FOUND_ERR){save();}else{fs_error();}}));}),fs_error);}),fs_error);},FS_proto=FileSaver.prototype,saveAs=function saveAs(blob,name){return new FileSaver(blob,name);};FS_proto.abort=function(){var filesaver=this;filesaver.readyState=filesaver.DONE;dispatch(filesaver,"abort");};FS_proto.readyState=FS_proto.INIT=0;FS_proto.WRITING=1;FS_proto.DONE=2;FS_proto.error=FS_proto.onwritestart=FS_proto.onprogress=FS_proto.onwrite=FS_proto.onabort=FS_proto.onerror=FS_proto.onwriteend=null;view.addEventListener("unload",process_deletion_queue,false);return saveAs;}(self);if(typeof module!=='undefined')module.exports=saveAs;(function(f){if((typeof exports==="undefined"?"undefined":_typeof(exports))==="object"&&typeof module!=="undefined"){module.exports=f();}else if(typeof define==="function"&&define.amd){define([],f);}else{var g;if(typeof window!=="undefined"){g=window;}else if(typeof global!=="undefined"){g=global;}else if(typeof self!=="undefined"){g=self;}else{g=this;}g.GIF=f();}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof _require=="function"&&_require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f;}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e);},l,l.exports,e,t,n,r);}return n[o].exports;}var i=typeof _require=="function"&&_require;for(var o=0;o<r.length;o++){s(r[o]);}return s;}({1:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined;}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this;};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er;}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err;}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args);}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++){listeners[i].apply(this,args);}}return true;};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners;}else{m=EventEmitter.defaultMaxListeners;}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace();}}}return this;};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments);}}g.listener=listener;this.on(type,g);return this;};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener);}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break;}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type];}else{list.splice(position,1);}if(this._events.removeListener)this.emit("removeListener",type,listener);}return this;};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this;}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key);}this.removeAllListeners("removeListener");this._events={};return this;}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners);}else if(listeners){while(listeners.length){this.removeListener(type,listeners[listeners.length-1]);}}delete this._events[type];return this;};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret;};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length;}return 0;};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type);};function isFunction(arg){return typeof arg==="function";}function isNumber(arg){return typeof arg==="number";}function isObject(arg){return(typeof arg==="undefined"?"undefined":_typeof(arg))==="object"&&arg!==null;}function isUndefined(arg){return arg===void 0;}},{}],2:[function(require,module,exports){var UA,browser,mode,platform,ua;ua=navigator.userAgent.toLowerCase();platform=navigator.platform.toLowerCase();UA=ua.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0];mode=UA[1]==="ie"&&document.documentMode;browser={name:UA[1]==="version"?UA[3]:UA[1],version:mode||parseFloat(UA[1]==="opera"&&UA[4]?UA[4]:UA[2]),platform:{name:ua.match(/ip(?:ad|od|hone)/)?"ios":(ua.match(/(?:webos|android)/)||platform.match(/mac|win|linux/)||["other"])[0]}};browser[browser.name]=true;browser[browser.name+parseInt(browser.version,10)]=true;browser.platform[browser.platform.name]=true;module.exports=browser;},{}],3:[function(require,module,exports){var EventEmitter,GIF,browser,extend=function extend(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key];}function ctor(){this.constructor=child;}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child;},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i;}return-1;},slice=[].slice;EventEmitter=require("events").EventEmitter;browser=require("./browser.coffee");GIF=function(superClass){var defaults,frameDefaults;extend(GIF,superClass);defaults={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:false,dither:false};frameDefaults={delay:500,copy:false};function GIF(options){var base,key,value;this.running=false;this.options={};this.frames=[];this.freeWorkers=[];this.activeWorkers=[];this.setOptions(options);for(key in defaults){value=defaults[key];if((base=this.options)[key]==null){base[key]=value;}}}GIF.prototype.setOption=function(key,value){this.options[key]=value;if(this._canvas!=null&&(key==="width"||key==="height")){return this._canvas[key]=value;}};GIF.prototype.setOptions=function(options){var key,results,value;results=[];for(key in options){if(!hasProp.call(options,key))continue;value=options[key];results.push(this.setOption(key,value));}return results;};GIF.prototype.addFrame=function(image,options){var frame,key;if(options==null){options={};}frame={};frame.transparent=this.options.transparent;for(key in frameDefaults){frame[key]=options[key]||frameDefaults[key];}if(this.options.width==null){this.setOption("width",image.width);}if(this.options.height==null){this.setOption("height",image.height);}if(typeof ImageData!=="undefined"&&ImageData!==null&&image instanceof ImageData){frame.data=image.data;}else if(typeof CanvasRenderingContext2D!=="undefined"&&CanvasRenderingContext2D!==null&&image instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext!=="undefined"&&WebGLRenderingContext!==null&&image instanceof WebGLRenderingContext){if(options.copy){frame.data=this.getContextData(image);}else{frame.context=image;}}else if(image.childNodes!=null){if(options.copy){frame.data=this.getImageData(image);}else{frame.image=image;}}else{throw new Error("Invalid image");}return this.frames.push(frame);};GIF.prototype.render=function(){var i,j,numWorkers,ref;if(this.running){throw new Error("Already running");}if(this.options.width==null||this.options.height==null){throw new Error("Width and height must be set prior to rendering");}this.running=true;this.nextFrame=0;this.finishedFrames=0;this.imageParts=function(){var j,ref,results;results=[];for(i=j=0,ref=this.frames.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){results.push(null);}return results;}.call(this);numWorkers=this.spawnWorkers();if(this.options.globalPalette===true){this.renderNextFrame();}else{for(i=j=0,ref=numWorkers;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){this.renderNextFrame();}}this.emit("start");return this.emit("progress",0);};GIF.prototype.abort=function(){var worker;while(true){worker=this.activeWorkers.shift();if(worker==null){break;}this.log("killing active worker");worker.terminate();}this.running=false;return this.emit("abort");};GIF.prototype.spawnWorkers=function(){var j,numWorkers,ref,results;numWorkers=Math.min(this.options.workers,this.frames.length);(function(){results=[];for(var j=ref=this.freeWorkers.length;ref<=numWorkers?j<numWorkers:j>numWorkers;ref<=numWorkers?j++:j--){results.push(j);}return results;}).apply(this).forEach(function(_this){return function(i){var worker;_this.log("spawning worker "+i);worker=new Worker(_this.options.workerScript);worker.onmessage=function(event){_this.activeWorkers.splice(_this.activeWorkers.indexOf(worker),1);_this.freeWorkers.push(worker);return _this.frameFinished(event.data);};return _this.freeWorkers.push(worker);};}(this));return numWorkers;};GIF.prototype.frameFinished=function(frame){var i,j,ref;this.log("frame "+frame.index+" finished - "+this.activeWorkers.length+" active");this.finishedFrames++;this.emit("progress",this.finishedFrames/this.frames.length);this.imageParts[frame.index]=frame;if(this.options.globalPalette===true){this.options.globalPalette=frame.globalPalette;this.log("global palette analyzed");if(this.frames.length>2){for(i=j=1,ref=this.freeWorkers.length;1<=ref?j<ref:j>ref;i=1<=ref?++j:--j){this.renderNextFrame();}}}if(indexOf.call(this.imageParts,null)>=0){return this.renderNextFrame();}else{return this.finishRendering();}};GIF.prototype.finishRendering=function(){var data,frame,i,image,j,k,l,len,len1,len2,len3,offset,page,ref,ref1,ref2;len=0;ref=this.imageParts;for(j=0,len1=ref.length;j<len1;j++){frame=ref[j];len+=(frame.data.length-1)*frame.pageSize+frame.cursor;}len+=frame.pageSize-frame.cursor;this.log("rendering finished - filesize "+Math.round(len/1e3)+"kb");data=new Uint8Array(len);offset=0;ref1=this.imageParts;for(k=0,len2=ref1.length;k<len2;k++){frame=ref1[k];ref2=frame.data;for(i=l=0,len3=ref2.length;l<len3;i=++l){page=ref2[i];data.set(page,offset);if(i===frame.data.length-1){offset+=frame.cursor;}else{offset+=frame.pageSize;}}}image=new Blob([data],{type:"image/gif"});return this.emit("finished",image,data);};GIF.prototype.renderNextFrame=function(){var frame,task,worker;if(this.freeWorkers.length===0){throw new Error("No free workers");}if(this.nextFrame>=this.frames.length){return;}frame=this.frames[this.nextFrame++];worker=this.freeWorkers.shift();task=this.getTask(frame);this.log("starting frame "+(task.index+1)+" of "+this.frames.length);this.activeWorkers.push(worker);return worker.postMessage(task);};GIF.prototype.getContextData=function(ctx){return ctx.getImageData(0,0,this.options.width,this.options.height).data;};GIF.prototype.getImageData=function(image){var ctx;if(this._canvas==null){this._canvas=document.createElement("canvas");this._canvas.width=this.options.width;this._canvas.height=this.options.height;}ctx=this._canvas.getContext("2d");ctx.setFill=this.options.background;ctx.fillRect(0,0,this.options.width,this.options.height);ctx.drawImage(image,0,0);return this.getContextData(ctx);};GIF.prototype.getTask=function(frame){var index,task;index=this.frames.indexOf(frame);task={index:index,last:index===this.frames.length-1,delay:frame.delay,transparent:frame.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:browser.name==="chrome"};if(frame.data!=null){task.data=frame.data;}else if(frame.context!=null){task.data=this.getContextData(frame.context);}else if(frame.image!=null){task.data=this.getImageData(frame.image);}else{throw new Error("Invalid frame");}return task;};GIF.prototype.log=function(){var args;args=1<=arguments.length?slice.call(arguments,0):[];if(!this.options.debug){return;}return console.log.apply(console,args);};return GIF;}(EventEmitter);module.exports=GIF;},{"./browser.coffee":2,events:1}]},{},[3])(3);});var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++){t[o][o.charAt(n)]=n;}}return t[o][r];}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},i={compressToBase64:function compressToBase64(o){if(null==o)return"";var r=i._compress(o,6,function(o){return n.charAt(o);});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"=";}},decompressFromBase64:function decompressFromBase64(r){return null==r?"":""==r?null:i._decompress(r.length,32,function(e){return o(n,r.charAt(e));});},compressToUTF16:function compressToUTF16(o){return null==o?"":i._compress(o,15,function(o){return r(o+32);})+" ";},decompressFromUTF16:function decompressFromUTF16(o){return null==o?"":""==o?null:i._decompress(o.length,16384,function(r){return o.charCodeAt(r)-32;});},compressToUint8Array:function compressToUint8Array(o){for(var r=i.compress(o),n=new Uint8Array(2*r.length),e=0,t=r.length;t>e;e++){var s=r.charCodeAt(e);n[2*e]=s>>>8,n[2*e+1]=s%256;}return n;},decompressFromUint8Array:function decompressFromUint8Array(o){if(null===o||void 0===o)return i.decompress(o);for(var n=new Array(o.length/2),e=0,t=n.length;t>e;e++){n[e]=256*o[2*e]+o[2*e+1];}var s=[];return n.forEach(function(o){s.push(r(o));}),i.decompress(s.join(""));},compressToEncodedURIComponent:function compressToEncodedURIComponent(o){return null==o?"":i._compress(o,6,function(o){return e.charAt(o);});},decompressFromEncodedURIComponent:function decompressFromEncodedURIComponent(r){return null==r?"":""==r?null:(r=r.replace(/ /g,"+"),i._decompress(r.length,32,function(n){return o(e,r.charAt(n));}));},compress:function compress(o){return i._compress(o,16,function(o){return r(o);});},_compress:function _compress(o,r,n){if(null==o)return"";var e,t,i,s={},p={},u="",c="",a="",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<o.length;i+=1){if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,p[u]=!0),c=a+u,Object.prototype.hasOwnProperty.call(s,c))a=c;else{if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++){m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;}for(t=a.charCodeAt(0),e=0;8>e;e++){m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;}}else{for(t=1,e=0;h>e;e++){m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;}for(t=a.charCodeAt(0),e=0;16>e;e++){m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;}}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a];}else for(t=s[a],e=0;h>e;e++){m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;}l--,0==l&&(l=Math.pow(2,h),h++),s[c]=f++,a=String(u);}}if(""!==a){if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++){m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;}for(t=a.charCodeAt(0),e=0;8>e;e++){m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;}}else{for(t=1,e=0;h>e;e++){m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;}for(t=a.charCodeAt(0),e=0;16>e;e++){m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;}}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a];}else for(t=s[a],e=0;h>e;e++){m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;}l--,0==l&&(l=Math.pow(2,h),h++);}for(t=2,e=0;h>e;e++){m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;}for(;;){if(m<<=1,v==r-1){d.push(n(m));break;}v++;}return d.join("");},decompress:function decompress(o){return null==o?"":""==o?null:i._decompress(o.length,32768,function(r){return o.charCodeAt(r);});},_decompress:function _decompress(o,n,e){var t,i,s,p,u,c,a,l,f=[],h=4,d=4,m=3,v="",w=[],A={val:e(0),position:n,index:1};for(i=0;3>i;i+=1){f[i]=i;}for(p=0,c=Math.pow(2,2),a=1;a!=c;){u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;}switch(t=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;){u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;}l=r(p);break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;){u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;}l=r(p);break;case 2:return"";}for(f[3]=l,s=l,w.push(l);;){if(A.index>o)return"";for(p=0,c=Math.pow(2,m),a=1;a!=c;){u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;}switch(l=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;){u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;}f[d++]=r(p),l=d-1,h--;break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;){u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;}f[d++]=r(p),l=d-1,h--;break;case 2:return w.join("");}if(0==h&&(h=Math.pow(2,m),m++),f[l])v=f[l];else{if(l!==d)return null;v=s+s.charAt(0);}w.push(v),f[d++]=s+v.charAt(0),h--,s=v,0==h&&(h=Math.pow(2,m),m++);}}};return i;}();"function"==typeof define&&define.amd?define(function(){return LZString;}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);var BIUtils={biEventCache:{},sendError:function sendError(){return;pomelo.notify('lobby.biHandler.error',arguments);},startEvent:function startEvent(type,name){return;if(!BIUtils.biEventCache[type]){BIUtils.biEventCache[type]={};}BIUtils.biEventCache[type][name]={start:Date.now()};},endEvent:function endEvent(type,name,tag){return;if(network.blockCustomBI){console.log('bi blocked: endEvent',type,name,tag);return;}if(!BIUtils.biEventCache[type]){BIUtils.biEventCache[type]={};}var cache=BIUtils.biEventCache[type][name];if(!cache){BIUtils.sendError('failed to find cache.',type,name,tag);return;}var now=Date.now();var msg={event:{"d_c1":{"key":type,"value":name},"m1":{"key":"start","value":cache.start.toString()},"m2":{"key":"end","value":now.toString()},"m3":{"key":"duration","value":(now-cache.start).toString()}}};if(!!tag){msg.event.d_c2={"key":'tag',"value":tag};}pomelo.notify('lobby.biHandler.custom',msg);},startWindowEvent:function startWindowEvent(windowName){return;if(!BIUtils.biEventCache.window){BIUtils.biEventCache.window={};}BIUtils.biEventCache.window[windowName]=Date.now();},endWindowEvent:function endWindowEvent(windowName){return;if(network.blockCustomBI){console.log('bi blocked: endWindowEvent',windowName);return;}if(!BIUtils.biEventCache.window){BIUtils.biEventCache.window={};}var start=BIUtils.biEventCache.window[windowName];var now=Date.now();pomelo.notify('lobby.biHandler.custom',{event:{"d_c1":{"key":"window","value":windowName},"m1":{"key":"start","value":start.toString()},"m2":{"key":"end","value":now.toString()},"m3":{"key":"duration","value":(now-start).toString()}}});}};(function(window,document){window.slayOne={views:{}};var canvas=document.getElementById('canvas');window.canvasGIF=document.createElement('canvas');window.c=canvas.getContext("2d");window.WIDTH=window.innerWidth;window.HEIGHT=window.innerHeight;window.FIELD_SIZE=1;window.FIELD_SIZE_BASE=1;window.SCALE_FACTOR=1;window.SCALE_FACTOR_BASE=1;window.SHOT_HEIGHT=0.39;window.SCALE_CONST=0.06;window.SCALE_CONST_BASE=SCALE_CONST;window.GAME=Object.freeze({LOGIN:0,REGISTER:1,PLAYING:3,LOBBY:6,RECOVERY:8,ACCEPT_AGB:9});window.GAME_VERSION=0.1;window.timestamp=Date.now();window.timeDiff=0;window.show_fps=false;window.timestampArchives=[0,0,0,0,0,0,0,0,0,0];window.fps=0;window.newTime=0;window.lastFramesTick=0;window.lastFramesExactTick=0;window.tickDiff=0;window.exactTickDiff=0;window.tickTimes=[0,0,0,0,0];window.sentActivationCode=false;window.ressourcesToLoad=1;window.isMobile=false;window.lastUpdate=0;window.lastPlayerListPage=0;window.backButtonContentStr="";window.networkPlayerName="";window.authLevel=0;window.currentSelectedMapID=-1;window.pl_xp=0;window.pl_lvl=0;window.pl_gold=0;window.pl_gem=0;window.db_id=0;window.unlocks2Show=[];window.zombieSkins=[17];window.replayFile=[];window.playingReplay=[];window.playingReplayVersion=0;window.pl_items={};window.pl_abilities=getDefaultAbilityObj(abilities);window.pl_abilities_unlocked="";window.pl_active_abilities=[];window.pl_clan_tag="";window.pl_clan_role=AUTH_LEVEL.NONE;window.pl_tutorials=0;window.pl_chests='';window.serverTimeDiff=0;window.pl_daily_quests=null;window.pl_daily_quests_refesh_timeout_id=null;window.leavingGame=false;window.joinGamePurpose=null;window.preStore={newPlayers:[],newZombies:[],pid:null};window.top3Colors=["#f6f432","#EAD497","#EAD497"];window.top3ColorsRank=["#F6F432","#D0CBBF","#D0CBBF"];window.imgCoords={fire1:{x:0,y:4,w:3,h:3},fire2:{x:4,y:3,w:4,h:4},fire3:{x:9,y:2,w:5,h:5},fire4:{x:15,y:1,w:7,h:7},fire5:{x:23,y:0,w:9,h:9},fire1red:{x:444,y:95,w:3,h:3},fire2red:{x:448,y:94,w:4,h:4},fire3red:{x:453,y:93,w:5,h:5},fire4red:{x:459,y:921,w:7,h:7},fire5red:{x:467,y:91,w:9,h:9},fireGreen1:{x:302,y:428,w:3,h:3},fireGreen2:{x:306,y:427,w:4,h:4},fireGreen3:{x:311,y:426,w:5,h:5},fireGreen4:{x:317,y:425,w:7,h:7},fireGreen5:{x:325,y:424,w:9,h:9},particle:{x:0,y:0,w:1,h:1},particlePurple:{x:1,y:0,w:1,h:1},particle2:{x:2,y:0,w:1,h:1},particleRed:{x:3,y:0,w:1,h:1},particleWhite:{x:4,y:0,w:1,h:1},particleYellow:{x:5,y:0,w:1,h:1},particleBlue:{x:6,y:0,w:1,h:1},particleGreen:{x:7,y:0,w:1,h:1},soot:{x:31,y:173,w:59,h:59},whiteCircle:{x:266,y:22,w:34,h:30},greenCircle:{x:1,y:272,w:53,h:45},laserHit:{x:264,y:0,w:10,h:10},pillar_of_light:{x:299,y:56,w:1,h:16},pillar_of_light_blue:{x:300,y:56,w:1,h:16},pillar_of_light_yellow:{x:301,y:56,w:1,h:16},heal:{x:11,y:34,w:3,h:3},healRed:{x:24,y:52,w:3,h:3},dust1:{x:32,y:0,w:7,h:7},dust2:{x:32,y:7,w:7,h:7},dust1red:{x:477,y:86,w:7,h:7},dust2red:{x:477,y:93,w:7,h:7},light_yellow:{x:108,y:0,w:20,h:20},light_purple:{x:130,y:0,w:19,h:19},light_white:{x:149,y:0,w:19,h:19},light_red:{x:167,y:0,w:19,h:19},light_blue:{x:186,y:0,w:19,h:19},light_green:{x:205,y:0,w:19,h:19},light_light_yellow:{x:110,y:52,w:18,h:18},weapon_laser:{x:339,y:0,w:29,h:18},weapon_gl:{x:312,y:18,w:26,h:15},weapon_flame:{x:306,y:36,w:30,h:18},weapon_mg:{x:310,y:0,w:28,h:14},weapon_rl:{x:309,y:57,w:26,h:17},weapon_homing:{x:342,y:55,w:26,h:17},weapon_homing_2:{x:324,y:77,w:26,h:17},weapon_laser_r:{x:340,y:20,w:29,h:18},weapon_sniper:{x:324,y:98,w:36,h:13},weapon_shotgun:{x:344,y:40,w:29,h:12},weapon_rapid_rl:{x:375,y:40,w:27,h:15},weapon_rapid_gl:{x:370,y:58,w:30,h:20},weapon_asmd:{x:397,y:139,w:40,h:14},weapon_heal:{x:400,y:121,w:32,h:15},waypoint:{x:19,y:27,w:19,h:14},spawningPoint:{x:60,y:20,w:18,h:21},spawningPointRed:{x:81,y:20,w:18,h:21},spawningPointBlue:{x:39,y:20,w:18,h:21},redFlag:{x:178,y:29,w:13,h:23},blueFlag:{x:192,y:29,w:13,h:23},wpn_ui:{x:85,y:117,w:215,h:25},button:{x:280,y:0,w:20,h:19},buttonBlue:{x:135,y:29,w:20,h:19},buttonWhite:{x:156,y:29,w:20,h:19},minimap_ui:{x:236,y:381,w:64,h:64},bullet1:{x:274,y:0,w:2,h:1},bullet2:{x:274,y:1,w:2,h:2},bullet3:{x:275,y:3,w:1,h:2},bullet4:{x:274,y:5,w:2,h:2},ammoMG:{x:249,y:0,w:14,h:11},ammoFlame:{x:237,y:0,w:11,h:12},ammoGL:{x:248,y:13,w:15,h:17},ammoNapalm:{x:265,y:76,w:15,h:17},ammoRL:{x:248,y:33,w:15,h:17},ammoHoming:{x:265,y:96,w:15,h:17},ammoLaser:{x:247,y:56,w:17,h:14},ammoShotgun:{x:242,y:86,w:17,h:19},ammoSniper:{x:283,y:98,w:14,h:12},ammoLaserSmall:{x:0,y:322,w:9,h:11},ammoGrenadeSmall:{x:0,y:334,w:9,h:9},ammoFlameSmall:{x:0,y:344,w:9,h:11},ammoMGSmall:{x:0,y:356,w:7,h:7},ammoRocketSmall:{x:0,y:365,w:9,h:9},ammoRocket2Small:{x:0,y:387,w:9,h:9},ammoRocket3Small:{x:0,y:397,w:9,h:9},ammoLaser2Small:{x:0,y:375,w:9,h:11},ammoShotgunSmall:{x:0,y:419,w:11,h:11},ammoSniperSmall:{x:0,y:407,w:7,h:10},ammoHealSmall:{x:0,y:431,w:9,h:11},ammoASMDSmall:{x:0,y:443,w:9,h:11},muzzleFlashMG:{x:151,y:679,w:416,h:156},muzzleFlashLaserBlue:{x:151,y:856,w:416,h:156},muzzleFlashLaserGreen:{x:151,y:1064,w:416,h:156},muzzleFlashMGTurret:{x:158,y:1314,w:44,h:44},medikit:{x:390,y:95,w:20,h:17},armor:{x:364,y:93,w:24,h:18},itemShine:{x:377,y:0,w:16,h:36},itemShineFloor:{x:393,y:0,w:16,h:36},fog:{x:144,y:344,w:256,h:256},filter:{x:100,y:144,w:200,h:200},armorBar:{x:27,y:57,w:26,h:4},armorBarRed:{x:109,y:718,w:26,h:4},armorBarBlue:{x:109,y:713,w:26,h:4},hpBar1:{x:27,y:62,w:26,h:4},hpBar2:{x:27,y:67,w:26,h:4},hpBar3:{x:27,y:72,w:26,h:4},hpBar4:{x:18,y:390,w:108,h:100},barBlue:{x:54,y:62,w:26,h:4},barGrey:{x:54,y:67,w:26,h:4},barPurp:{x:54,y:72,w:26,h:4},barBlue2:{x:73,y:305,w:26,h:4},barYellow:{x:73,y:310,w:26,h:4},aimLock:{x:27,y:77,w:17,h:21},aimLockGreen:{x:11,y:322,w:17,h:21},ok:{x:45,y:77,w:10,h:10},blackLine:{x:25,y:57,w:1,h:5},whiteLine:{x:24,y:57,w:1,h:5},healWard:{x:196,y:60,w:20,h:31},healWard2:{x:300,y:79,w:20,h:31},block:{x:177,y:62,w:18,h:29},block2:{x:17,y:99,w:18,h:29},block3:{x:17,y:130,w:18,h:29},blink:{x:60,y:118,w:23,h:22},scan:{x:53,y:143,w:24,h:24},autoTurretBase:{x:223,y:37,w:13,h:12},autoTurretIcon:{x:224,y:54,w:19,h:16},autoTurretGun00:{x:47,y:92,w:24,h:24},autoTurretGun01:{x:71,y:92,w:24,h:24},autoTurretGun02:{x:95,y:92,w:24,h:24},autoTurretGun03:{x:119,y:92,w:24,h:24},autoTurretGun04:{x:143,y:92,w:24,h:24},autoTurretGun05:{x:167,y:92,w:24,h:24},autoTurretGun06:{x:191,y:92,w:24,h:24},autoTurretGun07:{x:215,y:92,w:24,h:24},autoTurretGun10:{x:47,y:346,w:24,h:24},autoTurretGun11:{x:71,y:346,w:24,h:24},autoTurretGun12:{x:95,y:346,w:24,h:24},autoTurretGun13:{x:119,y:346,w:24,h:24},autoTurretGun14:{x:143,y:346,w:24,h:24},autoTurretGun15:{x:167,y:346,w:24,h:24},autoTurretGun16:{x:191,y:346,w:24,h:24},autoTurretGun17:{x:215,y:346,w:24,h:24},missileTurretIcon:{x:32,y:500,w:15,h:16},missileTurretGun0:{x:47,y:500,w:24,h:24},missileTurretGun1:{x:71,y:500,w:24,h:24},missileTurretGun2:{x:95,y:500,w:24,h:24},missileTurretGun3:{x:119,y:500,w:24,h:24},missileTurretGun4:{x:143,y:500,w:24,h:24},missileTurretGun5:{x:167,y:500,w:24,h:24},missileTurretGun6:{x:191,y:500,w:24,h:24},missileTurretGun7:{x:215,y:500,w:24,h:24},grenadeTurretIcon:{x:33,y:525,w:13,h:17},grenadeTurretGun0:{x:47,y:525,w:24,h:24},grenadeTurretGun1:{x:71,y:525,w:24,h:24},grenadeTurretGun2:{x:95,y:525,w:24,h:24},grenadeTurretGun3:{x:119,y:525,w:24,h:24},grenadeTurretGun4:{x:143,y:525,w:24,h:24},grenadeTurretGun5:{x:167,y:525,w:24,h:24},grenadeTurretGun6:{x:191,y:525,w:24,h:24},grenadeTurretGun7:{x:215,y:525,w:24,h:24},laserTurretIcon:{x:351,y:501,w:18,h:16},laserTurretGun0:{x:347,y:525,w:24,h:24},laserTurretGun1:{x:371,y:525,w:24,h:24},laserTurretGun2:{x:395,y:525,w:24,h:24},laserTurretGun3:{x:419,y:525,w:24,h:24},laserTurretGun4:{x:443,y:525,w:24,h:24},laserTurretGun5:{x:467,y:525,w:24,h:24},laserTurretGun6:{x:491,y:525,w:24,h:24},laserTurretGun7:{x:515,y:525,w:24,h:24},mine1:{x:146,y:75,w:13,h:11},mine2:{x:160,y:75,w:13,h:11},invis:{x:82,y:144,w:17,h:28},strength:{x:0,y:167,w:21,h:21},agility:{x:0,y:188,w:19,h:22},intelligence:{x:0,y:211,w:21,h:23},regeneration:{x:4,y:11,w:19,h:19},lifesteal:{x:69,y:275,w:28,h:26},grenade1:{x:62,y:78,w:7,h:10},grenade2:{x:71,y:79,w:9,h:9},grenade3:{x:81,y:81,w:10,h:7},grenade4:{x:92,y:81,w:9,h:9},grenade5:{x:103,y:81,w:7,h:10},grenade6:{x:111,y:81,w:9,h:9},grenade7:{x:132,y:81,w:11,h:7},grenade8:{x:133,y:79,w:9,h:9},grenadeYellow1:{x:7,y:241,w:7,h:10},grenadeYellow2:{x:16,y:242,w:9,h:9},grenadeYellow3:{x:26,y:244,w:10,h:7},grenadeYellow4:{x:37,y:244,w:9,h:9},grenadeYellow5:{x:48,y:244,w:7,h:10},grenadeYellow6:{x:58,y:244,w:9,h:9},grenadeYellow7:{x:66,y:244,w:11,h:7},grenadeYellow8:{x:78,y:242,w:9,h:9},grenadeBlue1:{x:7,y:256,w:7,h:10},grenadeBlue2:{x:16,y:257,w:9,h:9},grenadeBlue3:{x:26,y:259,w:10,h:7},grenadeBlue4:{x:37,y:259,w:9,h:9},grenadeBlue5:{x:48,y:259,w:7,h:10},grenadeBlue6:{x:58,y:259,w:9,h:9},grenadeBlue7:{x:66,y:259,w:11,h:7},grenadeBlue8:{x:78,y:257,w:9,h:9},bubble1:{x:281,y:447,w:19,h:19},bubble2:{x:262,y:447,w:19,h:19},bubble3:{x:243,y:447,w:19,h:19},bubble4:{x:224,y:447,w:19,h:19},bubbleRed:{x:205,y:447,w:19,h:19},bubbleGreen:{x:184,y:471,w:19,h:19},shield:{x:205,y:467,w:19,h:19},shield2:{x:224,y:467,w:19,h:19},shield3:{x:243,y:467,w:19,h:19},shieldIcon:{x:178,y:445,w:26,h:26},arrowLeft:{x:185,y:395,w:16,h:16},arrowRight:{x:219,y:395,w:16,h:16},arrowBottom:{x:202,y:395,w:16,h:16},arrowTop:{x:202,y:378,w:16,h:16},arrowLeftActive:{x:185,y:429,w:16,h:16},arrowRightActive:{x:219,y:429,w:16,h:16},arrowBottomActive:{x:202,y:429,w:16,h:16},arrowTopActive:{x:202,y:412,w:16,h:16},upgTop:{x:0,y:550,w:100,h:46},upgLine:{x:0,y:597,w:87,h:23},soulsBar:{x:102,y:550,w:12,h:12},souls:{x:102,y:563,w:10,h:12},star:{x:431,y:0,w:13,h:11},crystals:{x:102,y:576,w:9,h:9},plusButton:{x:102,y:587,w:22,h:17},crownYellow:{x:102,y:606,w:13,h:10},crownGreen:{x:102,y:617,w:13,h:10},crownWhite:{x:116,y:617,w:13,h:10},crownRed:{x:130,y:617,w:13,h:10},crosshairGreen:{x:239,y:636,w:9,h:9},crosshairWhite:{x:248,y:636,w:9,h:9},crosshairRed:{x:257,y:636,w:9,h:9},abilityFrame:{x:129,y:550,w:34,h:42},abilityFrameGreen:{x:302,y:550,w:34,h:42},weaponFrame:{x:164,y:550,w:68,h:42},weaponFrameGreen:{x:233,y:550,w:68,h:42},weaponFrame2:{x:164,y:593,w:68,h:39},weaponFrame2Green:{x:233,y:593,w:68,h:39},weaponFrameCurrent:{x:161,y:633,w:74,h:45},hpFrame:{x:0,y:621,w:55,h:15},hpFrame2:{x:0,y:637,w:55,h:10},energyBar:{x:56,y:621,w:2,h:2},laserBlue:{x:319,y:114,w:17,h:288},laserGreen:{x:337,y:114,w:17,h:288},projectile:{x:301,y:114,w:17,h:288},rocket:{x:356,y:115,w:10,h:80},homingRocket:{x:368,y:115,w:10,h:80},homingRocket2:{x:380,y:115,w:10,h:80},grenade:{x:356,y:197,w:30,h:80},shieldHit1:{x:269,y:475,w:26,h:18},shieldHit2:{x:295,y:475,w:26,h:18},shieldHit3:{x:321,y:475,w:26,h:18},shieldHit4:{x:347,y:475,w:26,h:18},shieldHit5:{x:373,y:475,w:26,h:18},shieldHit6:{x:399,y:475,w:26,h:18},newUpgFrame:{x:0,y:648,w:147,h:28},newStatsFrame:{x:0,y:677,w:147,h:35},newUpgFrameYellow:{x:0,y:742,w:147,h:28},newUps1:{x:0,y:771,w:146,h:30},newUps2:{x:0,y:802,w:146,h:30},newUps3:{x:0,y:833,w:146,h:30},cureButton:{x:0,y:1508,w:110,h:32},newUpsFrame1:{x:0,y:864,w:150,h:70},newUpsFrame2:{x:0,y:935,w:150,h:70},newUpsFrame3:{x:0,y:1006,w:150,h:70},newUpsFrame4:{x:0,y:1077,w:150,h:70},upgSkip:{x:57,y:632,w:87,h:16},upgUnskip:{x:0,y:713,w:87,h:16},passiveStateBoxLeft:{x:0,y:1147,w:5,h:16},passiveStateBoxMid:{x:5,y:1147,w:1,h:16},passiveStateBoxRight:{x:31,y:1147,w:5,h:16},abilityHover:{x:39,y:1147,w:97,h:61},weaponBottom:{x:0,y:1210,w:68,h:18},rangedZombieImpact:{x:528,y:48,w:96,h:24,frameW:24},splash:{x:246,y:527,w:95,h:19,frameW:19},splashSingle:{x:268,y:530,w:14,h:11},itemSpawn:{x:249,y:500,w:96,h:16},flame1:{x:0,y:1396,w:144,h:32,frameW:24},flame2:{x:0,y:1438,w:456,h:40,frameW:24},poisonFog1:{x:490,y:361,w:59,h:58},poisonFog2:{x:550,y:360,w:59,h:58},filler0:{x:537,y:0,w:12,h:12},filler1:{x:549,y:0,w:12,h:12},filler2:{x:561,y:0,w:12,h:12},filler3:{x:573,y:0,w:12,h:12},filler4:{x:585,y:0,w:12,h:12},filler5:{x:597,y:0,w:12,h:12},filler6:{x:609,y:0,w:12,h:12},filler7:{x:621,y:0,w:12,h:12},filler8:{x:633,y:0,w:12,h:12},zombie_weapon:{x:405,y:41,w:24,h:23},blank:{x:0,y:1,w:1,h:1},replayBar:{x:417,y:22,w:87,h:17},replayPos:{x:505,y:22,w:4,h:17},startGif:{x:510,y:22,w:48,h:17},stopGif:{x:559,y:22,w:48,h:17},whiteGif:{x:608,y:22,w:48,h:17},main_logo:{x:433,y:45,w:82,h:30},replayPlusMinus:{x:657,y:22,w:9,h:17},replayWhite:{x:667,y:22,w:9,h:8},playDead:{x:159,y:480,w:21,h:11},eatFromCorpse:{x:159,y:462,w:16,h:15},summonZombie:{x:153,y:442,w:22,h:15},summonZombie2:{x:155,y:420,w:22,h:17},summonZombie3:{x:156,y:401,w:22,h:15},zombieSpawn1:{x:342,y:559,w:256,h:32},zombieSpawn2:{x:342,y:599,w:256,h:32},zombieSpawn3:{x:438,y:480,w:256,h:32},zombieSpawn4:{x:438,y:444,w:256,h:32},zombieSenseCircle:{x:358,y:360,w:26,h:19},zombieSenseIcon:{x:162,y:384,w:19,h:15},speech:{x:0,y:1230,w:87,h:35},nextPlayers:{x:0,y:1488,w:56,h:7},crawler:{x:268,y:634,w:18,h:19},emotesBlink:{x:548,y:1246,w:14,h:15},emotesCry:{x:572,y:1246,w:14,h:15},emotesDevil:{x:596,y:1246,w:14,h:15},emotesHeart:{x:620,y:1246,w:14,h:15},emotesDislike:{x:644,y:1245,w:16,h:16},emotesSmile:{x:537,y:1268,w:14,h:15},emotesGrin:{x:561,y:1268,w:14,h:15},emotesO:{x:585,y:1268,w:14,h:15},emotesLike:{x:609,y:1268,w:15,h:15},emotesSmirk:{x:633,y:1268,w:14,h:15},emotesPokerface:{x:657,y:1268,w:14,h:15},emotesHold:{x:539,y:1286,w:10,h:14},emotesGo:{x:561,y:1290,w:14,h:10},emotesFire:{x:584,y:1288,w:16,h:12},emotesBack:{x:609,y:1289,w:15,h:11},emotesOK:{x:635,y:1285,w:10,h:15},emotesFist:{x:658,y:1288,w:11,h:12},emotesFlagWhite:{x:569,y:1317,w:12,h:13},emotesFlagRed:{x:598,y:1317,w:12,h:13},emotesSniper:{x:624,y:1315,w:15,h:15},emotesInfected:{x:655,y:1317,w:12,h:15},emotesPunch:{x:543,y:1350,w:14,h:12},emotesPeace:{x:568,y:1348,w:11,h:14},emotesCool:{x:600,y:1349,w:14,h:15},emotesTroll:{x:628,y:1348,w:14,h:15},emotesElvis:{x:655,y:1345,w:15,h:18},emotesFacepalm:{x:541,y:1372,w:16,h:20},emotesHype:{x:569,y:1371,w:22,h:20},emotesGG:{x:604,y:1370,w:14,h:21},emotesBubble:{x:623,y:1370,w:19,h:20},tutorialMouse:{x:542,y:1397,w:16,h:32},tutorialQ:{x:561,y:1397,w:15,h:14},tutorialMouseLeft:{x:580,y:1397,w:16,h:32},tutorialWASD:{x:597,y:1397,w:43,h:27},tutorialDMouseRight:{x:642,y:1396,w:36,h:32},fireballBig:{x:395,y:339,w:18,h:14},fireballMedium:{x:416,y:339,w:9,h:11},fireballSmall:{x:427,y:342,w:5,h:5}};window.sound_volume=localStorage.getItem("sound_volume")===null?0.8:localStorage.getItem("sound_volume");window.minimapSizeFactor=localStorage.getItem("minimapSizeFactor")===null?1.13:localStorage.getItem("minimapSizeFactor");window.graphicSettings=localStorage.getItem("graphicSettings")===null?10:localStorage.getItem("graphicSettings")|0;var storeWeaponsUnclickable=localStorage.getItem('weaponsUnclickable');if(storeWeaponsUnclickable=='true'){storeWeaponsUnclickable=1;}window.weaponsUnclickable=storeWeaponsUnclickable|0;window.forcePlayerNameColor=localStorage.getItem('forcePlayerNameColor')|0;window.defaultGameMode=localStorage.getItem("defaultGameMode");window.hideChat=localStorage.getItem("hideChat")=="true";document.getElementById("chatDisplayDiv").style.display=hideChat?"none":"block";window.ignoreList=localStorage.getItem("ignoreList")?localStorage.getItem("ignoreList").split(";"):[];window.ignoreListTemp=[];if(!MAP_TYPE_SETTINGS[defaultGameMode]){window.defaultGameMode=MAP_TYPE.TOURNAMENT_UNRANKED;}window.graphics=[];graphics[0]={exposionParticles:10,torchEmitTime:11,spawnBullets:false,additionalFTFire:false};graphics[10]={exposionParticles:30,torchEmitTime:5,spawnBullets:true,additionalFTFire:true};window.replayOptions=[{tickTime:200,loops:0,display:0},{tickTime:200,loops:1,display:0.25},{tickTime:100,loops:1,display:0.5},{tickTime:50,loops:1,display:1},{tickTime:25,loops:1,display:2},{tickTime:12,loops:1,display:4},{tickTime:6,loops:1,display:8},{tickTime:6,loops:2,display:16},{tickTime:6,loops:4,display:32},{tickTime:6,loops:8,display:64},{tickTime:6,loops:32,display:128}];window.replayOptionsIndex=3;window.oldReplayOptionsIndex=3;window.replayOption=window.replayOptions[window.replayOptionsIndex];window.lastReplaySpeedChange=-9999;window.authLevelNames=window.authLevelNames=[];authLevelNames[AUTH_LEVEL.NONE]="Member";authLevelNames[AUTH_LEVEL.GUEST]="";authLevelNames[AUTH_LEVEL.PLAYER]="";authLevelNames[AUTH_LEVEL.MOD]="Moderator";authLevelNames[AUTH_LEVEL.ADMIN]="Admin";window.teamColors=["rgba(255, 255, 255, 0)","rgba(255, 107, 107, 0.25)","rgba(153, 153, 255, 0.35)"];window.teamColors2=["rgba(255, 255, 255, 0.2)","rgba(255, 107, 107, 0.85)","rgba(153, 153, 255, 0.9)"];window.animationData={autoturret:{imgTurret00:imgCoords.autoTurretGun00,imgTurret01:imgCoords.autoTurretGun01,imgTurret02:imgCoords.autoTurretGun02,imgTurret03:imgCoords.autoTurretGun03,imgTurret04:imgCoords.autoTurretGun04,imgTurret05:imgCoords.autoTurretGun05,imgTurret06:imgCoords.autoTurretGun06,imgTurret07:imgCoords.autoTurretGun07,imgTurret10:imgCoords.autoTurretGun10,imgTurret11:imgCoords.autoTurretGun11,imgTurret12:imgCoords.autoTurretGun12,imgTurret13:imgCoords.autoTurretGun13,imgTurret14:imgCoords.autoTurretGun14,imgTurret15:imgCoords.autoTurretGun15,imgTurret16:imgCoords.autoTurretGun16,imgTurret17:imgCoords.autoTurretGun17,countFrames:2,muzzleFlash:imgCoords.muzzleFlashMGTurret},missileturret:{imgTurret00:imgCoords.missileTurretGun0,imgTurret01:imgCoords.missileTurretGun1,imgTurret02:imgCoords.missileTurretGun2,imgTurret03:imgCoords.missileTurretGun3,imgTurret04:imgCoords.missileTurretGun4,imgTurret05:imgCoords.missileTurretGun5,imgTurret06:imgCoords.missileTurretGun6,imgTurret07:imgCoords.missileTurretGun7},grenadeturret:{imgTurret00:imgCoords.grenadeTurretGun0,imgTurret01:imgCoords.grenadeTurretGun1,imgTurret02:imgCoords.grenadeTurretGun2,imgTurret03:imgCoords.grenadeTurretGun3,imgTurret04:imgCoords.grenadeTurretGun4,imgTurret05:imgCoords.grenadeTurretGun5,imgTurret06:imgCoords.grenadeTurretGun6,imgTurret07:imgCoords.grenadeTurretGun7},laserturret:{imgTurret00:imgCoords.laserTurretGun0,imgTurret01:imgCoords.laserTurretGun1,imgTurret02:imgCoords.laserTurretGun2,imgTurret03:imgCoords.laserTurretGun3,imgTurret04:imgCoords.laserTurretGun4,imgTurret05:imgCoords.laserTurretGun5,imgTurret06:imgCoords.laserTurretGun6,imgTurret07:imgCoords.laserTurretGun7}};window.SOUND=Object.freeze({GREANDE_LAUNCH:1,EXPLODE:2,LASER:3,SWITCH_WEAPON:4,KICK:5,SIZZLE:6,FRAG1:7,FRAG2:8,FRAG3:9,FRAG4:10,FRAG5:11,FLAMETHROWER:12,MG:13,GRENADE_BOUNCE:14,PLACE:15,CLICK:16,CARTRIDGE1:17,CARTRIDGE2:18,SIZZLE2:19,GUN_IMPACT:20,GUN_IMPACT_2:21,PUNCH:22,COCK:23,EMPTY_CLIP:24,RELOAD_MG:25,RELOAD_FLAME:26,RELOAD_GL:27,ROCKET_LAUNCH:29,ROCKET_FLY:30,RELOAD_RL:31,REFLECT:32,AMMO_SPAWN:33,PLAYER_SPAWN:34,LASER_RECHARGE:35,HEAL:36,ARMOR:37,ROCKET_BEEP:38,FLAME_BURN:39,FLAME_EXPLODE:40,SNIPER:41,BING:42,SHOTGUN:43,SHOTGUN_RELOAD:44,SHOTGUN_RELOAD_LONG:45,ZOOM:46,ZIP:47,LVLUP:48,UNLOCK:49,HEAL_AURA:50,BLINK:51,TURRET_INIT:52,NEGATIVE:53,INVIS1:54,INVIS2:55,SPELL:56,SWITCH:57,CHAT1:58,DOUBLE_KILL:59,MULTI_KILL:60,ULTRA_KILL:61,MONSTER_KILL:62,KILLING_SPREE:63,RAMPAGE:64,DOMINATING:65,UNSTOPPABLE:66,GODLIKE:67,SMOKE_START:68,SMOKE_LOOP:69,THROW:70,FLASH:71,FLASH_START:72,STEP:73,SCAN:74,WIN:75,LOSE:76,END:77,START:78,TEAMKILL:79,RELOAD_RL_2:80,ZOMBIE_BITE:81,ZOMBIE_DEATH:82,LVL_UP:83,ATT_UP:84,BEEBEEP:85,ZOMBIE_ATT:86,SPLASH:87,SHIELD:88,SHIELD_HIT:89,WOODCRACK:90,MECH_IMPACT:91,CRAWLER_IMPACT:92,OPEN_CHEST:93,UPGRADE_ITEM:94,ZOMBIE_BOSS_HIT:95,ZOMBIE_TRANSFORM:96,HUMAN_TRANSFORM:97,HEAL_WPN:98,ASMD1:99,ASMD2:100,ASMD_RELOAD:101,ASMD_FLY:102,ASMD_BALL_LAUNCH:103,ASMD_EXPLO_1:104,ASMD_EXPLO_2:105});window.KEY=Object.freeze({UP:38,DOWN:40,LEFT:37,RIGHT:39,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,SHIFT:16,CTRL:17,ALT:18,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,NUM0:48,CIRCUMFLEX:window.chrome?220:160,ENTER:13,BACKSPACE:8,DELETE:46,PAUSE:19,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,ESC:27,TAB:9,PLUS:107,MINUS:109,SPACE:32,CAPSLOCK:20,AE:192,RIGHTMOUSE:1002});var keyNames=window.keyNames=[];keyNames[9]="TAB";keyNames[16]="SHIFT";keyNames[17]="CTRL";keyNames[18]="ALT";keyNames[19]="PAUSE";keyNames[20]="CAPSLOCK";keyNames[32]="SPACE";keyNames[37]="LEFT";keyNames[38]="UP";keyNames[39]="RIGHT";keyNames[40]="DOWN";keyNames[46]="DEL";keyNames[48]="0";keyNames[49]="1";keyNames[50]="2";keyNames[51]="3";keyNames[52]="4";keyNames[53]="5";keyNames[54]="6";keyNames[55]="7";keyNames[56]="8";keyNames[57]="9";keyNames[8]="BACKSPACE";keyNames[13]="ENTER";keyNames[27]="ESC";keyNames[65]="A";keyNames[66]="B";keyNames[67]="C";keyNames[68]="D";keyNames[69]="E";keyNames[70]="F";keyNames[71]="G";keyNames[72]="H";keyNames[73]="I";keyNames[74]="J";keyNames[75]="K";keyNames[76]="L";keyNames[77]="M";keyNames[78]="N";keyNames[79]="O";keyNames[80]="P";keyNames[81]="Q";keyNames[82]="R";keyNames[83]="S";keyNames[84]="T";keyNames[85]="U";keyNames[86]="V";keyNames[87]="W";keyNames[88]="X";keyNames[89]="Y";keyNames[90]="Z";keyNames[112]="F1";keyNames[113]="F2";keyNames[114]="F3";keyNames[115]="F4";keyNames[116]="F5";keyNames[117]="F6";keyNames[118]="F7";keyNames[119]="F8";keyNames[120]="F9";keyNames[121]="F10";keyNames[192]="`";keyNames[window.chrome?220:160]="^";keyNames[1002]="Right Mouse";window.getKeyName=function(key){return F_("keys."+key)||keyNames[key]||"";};window.COMMAND=Object.freeze({UP:1,DOWN:2,LEFT:3,RIGHT:4,RELOAD:5,STAND:6,ABILITY1:7,ABILITY2:8,WPN1:9,WPN2:10,WPN3:11,WPN4:12,WPN5:13,WPN6:14,WPN7:15,WPN8:16,WPN9:17,WPN10:18,WPN11:19,WPN12:20,WPN16:21,JUMP:100,PICK_UPGRADE:101,FIRE_2:102});var commandKeys=window.commandKeys=[];commandKeys[COMMAND.UP]=KEY.W;commandKeys[COMMAND.DOWN]=KEY.S;commandKeys[COMMAND.LEFT]=KEY.A;commandKeys[COMMAND.RIGHT]=KEY.D;commandKeys[COMMAND.RELOAD]=KEY.R;commandKeys[COMMAND.STAND]=KEY.F;commandKeys[COMMAND.FIRE_2]=KEY.Y;commandKeys[COMMAND.ABILITY1]=KEY.Q;commandKeys[COMMAND.ABILITY2]=KEY.E;commandKeys[COMMAND.JUMP]=KEY.RIGHTMOUSE;commandKeys[COMMAND.PICK_UPGRADE]=KEY.SPACE;commandKeys[COMMAND.WPN1]=KEY.NUM1;commandKeys[COMMAND.WPN2]=KEY.NUM2;commandKeys[COMMAND.WPN3]=KEY.NUM3;commandKeys[COMMAND.WPN4]=KEY.NUM4;commandKeys[COMMAND.WPN5]=KEY.NUM5;commandKeys[COMMAND.WPN6]=KEY.NUM6;commandKeys[COMMAND.WPN7]=KEY.NUM7;commandKeys[COMMAND.WPN8]=KEY.NUM8;commandKeys[COMMAND.WPN9]=KEY.NUM9;commandKeys[COMMAND.WPN10]=KEY.NUM0;commandKeys[COMMAND.WPN11]=KEY.N;commandKeys[COMMAND.WPN12]=KEY.M;commandKeys[COMMAND.WPN16]=KEY.H;var commandNames=window.commandNames={};commandNames[COMMAND.UP]="Move Up";commandNames[COMMAND.DOWN]="Move down";commandNames[COMMAND.LEFT]="Move left";commandNames[COMMAND.RIGHT]="Move right";commandNames[COMMAND.RELOAD]="Reload";commandNames[COMMAND.STAND]="Stand / aim with sniper";commandNames[COMMAND.ABILITY1]="Use ability 1";commandNames[COMMAND.ABILITY2]="Use ability 2";commandNames[COMMAND.JUMP]="Jump";commandNames[COMMAND.PICK_UPGRADE]="Pick upgrade";commandNames[COMMAND.FIRE_2]="2nd fire mode";var commandNameLabels=window.commandNameLabels=[];commandNameLabels[COMMAND.UP]="config.keyname.up";commandNameLabels[COMMAND.DOWN]="config.keyname.down";commandNameLabels[COMMAND.LEFT]="config.keyname.left";commandNameLabels[COMMAND.RIGHT]="config.keyname.right";commandNameLabels[COMMAND.RELOAD]="config.keyname.reload";commandNameLabels[COMMAND.STAND]="config.keyname.stand";commandNameLabels[COMMAND.ABILITY1]="config.keyname.ability1";commandNameLabels[COMMAND.ABILITY2]="config.keyname.ability2";commandNameLabels[COMMAND.JUMP]="config.keyname.jump";commandNameLabels[COMMAND.PICK_UPGRADE]="config.keyname.pickupgrade";commandNameLabels[COMMAND.FIRE_2]="config.keyname.fire2";function getCommandName(i){return"Select "+weapons[i].name;}var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=weapons[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var weapon=_step5.value;if(weapon.noWeapon){continue;}var cmd=COMMAND["WPN"+(weapon.id+1)];Object.defineProperty(commandNames,cmd,{enumerable:true,get:getCommandName.bind(null,i)});commandNameLabels[cmd]={'weapon':weapon.id};}}catch(err){_didIteratorError5=true;_iteratorError5=err;}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return();}}finally{if(_didIteratorError5){throw _iteratorError5;}}}var lsHotkeyStr=localStorage.getItem("hotkeys");if(lsHotkeyStr&&lsHotkeyStr.length>0){var hotkeys=lsHotkeyStr.split("_");for(var i=0;i<hotkeys.length;i++){var hotkeysplit=hotkeys[i].split(":");if(hotkeysplit[0]&&hotkeysplit[1])commandKeys[parseInt(hotkeysplit[0])]=parseInt(hotkeysplit[1]);}}window.keyCodes=[];window.scf1="showEn";window.scf2="emiesOnMinimapUntil";})(window,window.document);function refreshKeyCodes(){var keyCodes=window.keyCodes=[];keyCodes[KEY.UP]=1;keyCodes[KEY.DOWN]=2;keyCodes[KEY.LEFT]=3;keyCodes[KEY.RIGHT]=4;for(var i=1;i<commandKeys.length;i++){keyCodes[commandKeys[i]]=i;}};refreshKeyCodes();var rAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,16);};}();function Z$(s){return document.querySelector(s);}var forceQuit=false;var forceQuitConfirm=false;function downloadAbilities(){var ab=JSON.parse(JSON.stringify(abilities));ab=ab.map(function(a){a.name=a.locales.name;a.levelUpFieldsName=a.locales.levelUpFieldsName;delete a.locales;return a;});var aTag=document.createElement('a');var blob=new Blob([JSON.stringify(ab,null,'\t')+"\n"]);aTag.download='abilities.json';aTag.href=URL.createObjectURL(blob);aTag.click();URL.revokeObjectURL(blob);}window.addEventListener("beforeunload",function(e){if(forceQuitConfirm||!isInBattle()){return;}if(isDesktop&&!forceQuit){forceQuit=true;forceQuitConfirm=false;attemptExitGame();}(e||window.event).returnValue=false;return false;});function time(){return Date.now()/1000|0;}var SteamTransData;function steamTrans(){if(!SteamInfo){console.log('no steam info when steamTrans');return;}if(SteamTransData&&SteamTransData.trans_ts<time()-3600){SteamTransData=false;}if(SteamTransData){NetworkRespondMsgJson.steamTrans(false);}else{network.send('steamTrans$'+SteamInfo.user.steamId);}}function ajax(url,callback){var xmlhttp=new XMLHttpRequest();xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==XMLHttpRequest.DONE)callback(xmlhttp.responseText);};xmlhttp.open("GET",url,true);xmlhttp.send();};function isInGame(){return game&&game.map!=map1;}function isInBattle(){return!!(isInGame()&&game.isBattle&&game.ticksCounter>0&&game.playingPlayer&&!leavingGame);}function trim(s){return String.prototype.trim?s.trim():s.replace(/^\s+|\s+$/gm,'');}function capitalize(str){return str[0].toUpperCase()+str.substr(1);}function now(){return Date.now()/1000|0;}function addClass(current,toAdd){if(!current){current='';}var classes=current.split(' ');if(classes.indexOf(toAdd)>=0){return current;}classes.push(toAdd);return classes.join(' ');}function removeClass(current,toRemove){if(!current){current='';}return current.split(' ').filter(function(cn){return cn!=toRemove;}).join(' ');}function addClassToDom(dom,toAdd){dom.className=addClass(dom.className,toAdd);}function removeClassFromDom(dom,toRemove){dom.className=removeClass(dom.className,toRemove);}function g2rx(x){return(x-game.cameraX)*FIELD_SIZE;};function g2ry(y){return(y-game.cameraY)*FIELD_SIZE;};function escapeHtml(text){return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");};var circleX=[0,Math.SQRT1_2,1,Math.SQRT1_2,0,-Math.SQRT1_2,-1,Math.SQRT1_2];var circleY=[-1,-Math.SQRT1_2,0,Math.SQRT1_2,1,Math.SQRT1_2,0,-Math.SQRT1_2];function getMouseGamePlayX(){if(window.KeyManager&&window.game){return KeyManager.x/FIELD_SIZE+game.cameraX;}return 0;};function getMouseGamePlayY(){if(window.KeyManager&&window.game){return KeyManager.y/FIELD_SIZE+game.cameraY+(game.playingPlayer&&game.playingPlayer.weapon&&game.playingPlayer.weapon.addHeight?SHOT_HEIGHT:0);}return 0;};function getAngle(x,y,x2,y2){var angle=Math.atan((y2-y)/(x2-x));angle-=x2-x<0?Math.PI:0;angle+=angle<-Math.PI?Math.PI*2:0;angle-=angle>Math.PI?Math.PI*2:0;return angle;};function getDirectionFromAgle(x,y,x2,y2){var angle=getAngle(x,y,x2,y2);var direction=0;if(angle>=Math.PI*3/8&&angle<=Math.PI*5/8)direction=0;else if(angle<=-Math.PI*3/8&&angle>=-Math.PI*5/8)direction=4;else if(angle>=Math.PI*7/8||angle<=-Math.PI*7/8)direction=2;else if(angle<=Math.PI*1/8&&angle>=0||angle>=-Math.PI*1/8&&angle<=0)direction=6;else if(angle<=Math.PI*7/8&&angle>=Math.PI*5/8)direction=1;else if(angle<=Math.PI*3/8&&angle>=Math.PI*1/8)direction=7;else if(angle>=-Math.PI*7/8&&angle<=-Math.PI*5/8)direction=3;else direction=5;return direction;};function getDirectionFromAgle16(x,y,x2,y2){var angle=getAngle(x,y,x2,y2);var direction=0;if(angle<=-Math.PI*7/16&&angle>=-Math.PI*9/16)direction=0;else if(angle<=-Math.PI*5/16&&angle>=-Math.PI*7/16)direction=1;else if(angle<=-Math.PI*3/16&&angle>=-Math.PI*5/16)direction=2;else if(angle<=-Math.PI*1/16&&angle>=-Math.PI*3/16)direction=3;else if(angle<=Math.PI*1/16&&angle>=-Math.PI*1/16)direction=4;else if(angle<=Math.PI*3/16&&angle>=Math.PI*1/16)direction=5;else if(angle<=Math.PI*5/16&&angle>=Math.PI*3/16)direction=6;else if(angle<=Math.PI*7/16&&angle>=Math.PI*5/16)direction=7;else if(angle<=Math.PI*9/16&&angle>=Math.PI*7/16)direction=8;else if(angle<=Math.PI*11/16&&angle>=Math.PI*9/16)direction=9;else if(angle<=Math.PI*13/16&&angle>=Math.PI*11/16)direction=10;else if(angle<=Math.PI*15/16&&angle>=Math.PI*13/16)direction=11;else if(angle<=-Math.PI*15/16||angle>=Math.PI*15/16)direction=12;else if(angle<=-Math.PI*13/16&&angle>=-Math.PI*15/16)direction=13;else if(angle<=-Math.PI*11/16&&angle>=-Math.PI*13/16)direction=14;else if(angle<=-Math.PI*9/16&&angle>=-Math.PI*11/16)direction=15;return direction;};function sortStatsTable(){var tableData=document.getElementById('statsTable1');var rowData=tableData.getElementsByTagName('tr');if(rowData.item(0).getElementsByTagName('td').item(4))for(var i=0;i<rowData.length-1;i++){for(var j=0;j<rowData.length-(i+1);j++){if(parseInt(rowData.item(j).getElementsByTagName('td').item(4).innerHTML)<parseInt(rowData.item(j+1).getElementsByTagName('td').item(4).innerHTML))tableData.insertBefore(rowData.item(j+1),rowData.item(j));}}};function getGameTickRng(from,to,seed){if(typeof seed==="undefined")seed=game?game.ticksCounter:0;return from+(seed*93071+49297)%233280/233280*(to-from);};function getGameTickRng2(from,to,seed){if(typeof seed==="undefined")seed=game?game.ticksCounter:0;return from+(seed*34873+49297)%233280/233280*(to-from);};function getStreakByKills(kills){var k=999;while(kills>0){if(killStreaks[kills])return killStreaks[kills];kills--;k--;if(k<0)return null;}return null;};function sortBy(arr2,func){var arr=arr2.slice();for(var i=0;i<arr.length-1;i++){if(arr[i]&&arr[i+1]&&func(arr[i+1])<func(arr[i])){var el=arr[i];arr[i]=arr[i+1];arr[i+1]=el;i-=2;}}return arr;};function extend(a,b){for(var field in b){a[field]=b[field];}};function createPoundSmoke(x,y,size,count,alpha,startAngle,finishAngle){if(game.fastForward)return;var step=count?Math.PI*4/count:0.5;var startAngle=startAngle?startAngle:0;var finishAngle=finishAngle?finishAngle:Math.PI*2;for(var i=startAngle;i<finishAngle;i+=Math.random()*step){new Sprite({x:x,y:y,img:imgCoords.dust1,scaleFunction:function scaleFunction(){return this.r1;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.6*this.alpha_;},age:(1.7+Math.random())*20,r1:(Math.random()*5+2.5)*size,r2:Math.cos(i)*size,r3:Math.sin(i)*size,_size:size,alpha_:alpha?alpha:1,zFunction:function zFunction(age){return 1;},xFunction:function xFunction(age){return(-1/(age/4+0.3)+this._size+2)*this.r2;},yFunction:function yFunction(age){return(-1/(age/4+0.3)+this._size+2)*this.r3;}});}};function createExplosionGreen(x,y,size){if(game.fastForward)return;soundManager.playSound(SOUND.CRAWLER_IMPACT,x,y,0.8);game.addCircle(x,y,imgCoords.whiteCircle);var dist=Math.sqrt(Math.pow(x-(game.cameraX+WIDTH/FIELD_SIZE/2),2)+Math.pow(y-(game.cameraY+HEIGHT/FIELD_SIZE/2),2));var screenSpan=(WIDTH/FIELD_SIZE/2+HEIGHT/FIELD_SIZE/2)/2;var power=dist>screenSpan?1-(dist/screenSpan-1)*0.75:1;if(power>0){var now=Date.now();game.rumbleUntil=now+500;game.rumblePower=size*0.05*power;game.rumbleStart=now;}var pos=new Field(x,y);for(var i=0;i<graphics[graphicSettings].exposionParticles*0.5;i++){var field=pos.add2(Math.random()*Math.PI*2,Math.random());new Sprite({x:field.x,y:field.y,img:imgCoords.particleGreen,scaleFunction:function scaleFunction(){return this.r0*this._size;},age:(2.2+Math.random())*20,r0:Math.random()*2.5+2,r1:Math.random()*2+1,r2:Math.random()*4-2,r3:Math.random()*4-2,_size:size*0.5,zFunction:function zFunction(age){return this._size*1.2*Math.max(0.3,Math.abs(Math.sin((age+this.r1)/2))/Math.max(1,age*0.2));},xFunction:function xFunction(age){return(-1/(Math.min(age,this.ticksToLive-35)/40+0.12)+5)*this.r2*this._size;},yFunction:function yFunction(age){return(-1/(Math.min(age,this.ticksToLive-35)/40+0.12)+5)*this.r3*this._size;}});}for(var i=0;i<Math.PI*2;i+=Math.random()*1){var field=new Field(x,y,true).add2(Math.random()*Math.PI*2,Math.random()*0.25*size);new Sprite({x:field.x,y:field.y,img:imgCoords["fireGreen"+(Math.floor(Math.random()*4)+1)],scaleFunction:function scaleFunction(age){return((1/(age/4+0.25)+age/4-4)*-2+this.r1)*this._size;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.5;},r1:1+Math.random()*2,r2:Math.cos(i)*Math.random(),r3:Math.sin(i)*Math.random(),_size:size*0.5,zFunction:function zFunction(age){return age*0.07*this._size;},xFunction:function xFunction(age){return(-1/(age/4+0.3)+2)*this.r2*this._size;},yFunction:function yFunction(age){return(-1/(age/4+0.3)+2)*this.r3*this._size;}});}for(var i=0;i<Math.PI*2;i+=Math.random()*0.5){new Sprite({x:pos.x,y:pos.y,img:imgCoords.poisonFog1,scaleFunction:function scaleFunction(){return this.r1*this._size;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.6;},age:(1.7+Math.random())*20,r1:Math.random()*5+1.5,r2:Math.cos(i),r3:Math.sin(i),_size:size*0.13,zFunction:function zFunction(age){return 0.5;},xFunction:function xFunction(age){return(-1/(age/4+0.3)+4)*this.r2*this._size;},yFunction:function yFunction(age){return(-1/(age/4+0.3)+4)*this.r3*this._size;}});}new Sprite({x:pos.x,y:pos.y-0.5,img:imgCoords.light_green,scaleFunction:function scaleFunction(age){return 2*Math.max(0.9-age/this.ticksToLive,0)*this._size;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.5;},age:(1.2+Math.random()*0.4)*20,_size:size*2});new Sprite({x:pos.x,y:pos.y-1.0,img:imgCoords.light_green,scaleFunction:function scaleFunction(){return 2*this._size;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.5;},age:(0.25+Math.random()*0.05)*20,_size:size*3.5});};function createExplosion(x,y,size,sootAlpha,red){if(game.fastForward)return;game.addCircle(x,y,imgCoords.whiteCircle);var dist=Math.sqrt(Math.pow(x-(game.cameraX+WIDTH/FIELD_SIZE/2),2)+Math.pow(y-(game.cameraY+HEIGHT/FIELD_SIZE/2),2));var screenSpan=(WIDTH/FIELD_SIZE/2+HEIGHT/FIELD_SIZE/2)/2;var power=dist>screenSpan?1-(dist/screenSpan-1)*0.75:1;if(power>0){var now=Date.now();game.rumbleUntil=now+1000;game.rumblePower=size*0.1*power;game.rumbleStart=now;}var pos=new Field(x,y);if(!red)for(var i=0;i<graphics[graphicSettings].exposionParticles;i++){var field=pos.add2(Math.random()*Math.PI*2,Math.random());new Sprite({x:field.x,y:field.y,img:imgCoords.particle,scaleFunction:function scaleFunction(){return this.r0*this._size;},age:(2.2+Math.random())*20,r0:Math.random()*2.5+2,r1:Math.random()*2+1,r2:Math.random()*4-2,r3:Math.random()*4-2,_size:size*0.5,zFunction:function zFunction(age){return this._size*1.2*Math.max(0.3,Math.abs(Math.sin((age+this.r1)/2))/Math.max(1,age*0.2));},xFunction:function xFunction(age){return(-1/(Math.min(age,this.ticksToLive-35)/40+0.12)+5)*this.r2*this._size;},yFunction:function yFunction(age){return(-1/(Math.min(age,this.ticksToLive-35)/40+0.12)+5)*this.r3*this._size;}});}for(var i=0;i<Math.PI*2;i+=Math.random()*1){var field=new Field(x,y,true).add2(Math.random()*Math.PI*2,Math.random()*0.25*size);new Sprite({x:field.x,y:field.y,img:imgCoords["fire"+(Math.floor(Math.random()*4)+1)+(red?"red":"")],scaleFunction:function scaleFunction(age){return((1/(age/4+0.25)+age/4-4)*-2+this.r1)*this._size;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.5;},r1:1+Math.random()*2,r2:Math.cos(i)*Math.random(),r3:Math.sin(i)*Math.random(),_size:size*0.5,zFunction:function zFunction(age){return age*0.07*this._size;},xFunction:function xFunction(age){return(-1/(age/4+0.3)+2)*this.r2*this._size;},yFunction:function yFunction(age){return(-1/(age/4+0.3)+2)*this.r3*this._size;}});}for(var i=0;i<Math.PI*2;i+=Math.random()*0.5){new Sprite({x:pos.x,y:pos.y,img:imgCoords["dust1"+(red?"red":"")],scaleFunction:function scaleFunction(){return this.r1*this._size;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.6;},age:(1.7+Math.random())*20,r1:Math.random()*5+1.5,r2:Math.cos(i),r3:Math.sin(i),_size:size*0.5,zFunction:function zFunction(age){return 0.5;},xFunction:function xFunction(age){return(-1/(age/4+0.3)+4)*this.r2*this._size;},yFunction:function yFunction(age){return(-1/(age/4+0.3)+4)*this.r3*this._size;}});}new Sprite({x:pos.x,y:pos.y-0.5,img:red?imgCoords.light_red:imgCoords.light_yellow,scaleFunction:function scaleFunction(age){return 2*Math.max(0.9-age/this.ticksToLive,0)*this._size;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.5;},age:(1.2+Math.random()*0.4)*20,_size:size*2});new Sprite({x:pos.x,y:pos.y-1.0,img:imgCoords.light_white,scaleFunction:function scaleFunction(){return 2*this._size;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.5;},age:(0.25+Math.random()*0.05)*20,_size:size*3.5});if(game.pathingArray[Math.floor(x)]&&game.pathingArray[Math.floor(x)][Math.floor(y)]!=9)for(var j=0;j<game.groundCanvas.length;j++){game.groundCanvas[j].getContext('2d').globalAlpha=sootAlpha?sootAlpha:0.65;game.groundCanvas[j].getContext('2d').drawImage(imgs.miscSheet,imgCoords.soot.x,imgCoords.soot.y,imgCoords.soot.w,imgCoords.soot.h,x*FIELD_SIZE/SCALE_FACTOR-imgCoords.soot.w/2-game.groundMinX*16,y*FIELD_SIZE/SCALE_FACTOR-imgCoords.soot.h/2-game.groundMinY*16,imgCoords.soot.w,imgCoords.soot.h);game.groundCanvas[j].getContext('2d').globalAlpha=1;}};function createBlinkEffect(x,y){if(game.fastForward)return;createPoundSmoke(x,y+0.5,0.5,9,0.4);for(var i=0;i<10;i++){new Sprite({x:x+Math.random()*1.4-0.7,y:y+Math.random()*1.4-0.7-0.5,img:imgCoords.whiteLine,scaleFunction:function scaleFunction(){return Math.random()*2.5;},alphaFunction:function alphaFunction(){return 0.8-Math.random()*0.3;},age:4+Math.random()*2,r0:Math.random()*0.05-0.025,r1:Math.random()*0.05-0.025,zFunction:function zFunction(age){return age*this.r0;},xFunction:function xFunction(age){return age*this.r1;}});}for(var i=0;i<7;i++){new Sprite({x:x+Math.random()*1.4-0.7,y:y+Math.random()*1.0-0.5-0.5,z:Math.random()*1+0.3,img:imgCoords.particleWhite,alphaFunction:function alphaFunction(){return this.ticksLeft>10?0.5:this.ticksLeft*0.5/10;},age:40+Math.random()*20,scaleFunction:function scaleFunction(){return this.scale;},scale:1.2+Math.random()*0.6,zFunction:function zFunction(age){return Math.max(-Math.pow(age*0.07,2),-this.z);}});}new Sprite({x:x,y:y-0.5,img:imgCoords.light_white,alphaFunction:function alphaFunction(age){return age<=6?Math.random()*0.66:Math.min(0.2,this.ticksLeft*0.025)*(Math.random()*0.3+0.85);},age:40+Math.random()*20,scale:5,scaleFunction:function scaleFunction(){return this.scale;}});};function createBlinkEffectSmall(x,y){if(game.fastForward)return;for(var i=0;i<7;i++){new Sprite({x:x+Math.random()*1.4-0.7,y:y+Math.random()*1.4-0.7-0.5,img:imgCoords.whiteLine,scaleFunction:function scaleFunction(){return Math.random()*2.5;},alphaFunction:function alphaFunction(){return 0.8-Math.random()*0.3;},age:4+Math.random()*2,r0:Math.random()*0.05-0.025,r1:Math.random()*0.05-0.025,zFunction:function zFunction(age){return age*this.r0;},xFunction:function xFunction(age){return age*this.r1;}});}for(var i=0;i<4;i++){new Sprite({x:x+Math.random()*1.4-0.7,y:y+Math.random()*1.0-0.5-0.5,z:Math.random()*1+0.3,img:imgCoords.particleWhite,alphaFunction:function alphaFunction(){return this.ticksLeft>10?0.5:this.ticksLeft*0.5/10;},age:40+Math.random()*20,scaleFunction:function scaleFunction(){return this.scale;},scale:1.2+Math.random()*0.6,zFunction:function zFunction(age){return Math.max(-Math.pow(age*0.07,2),-this.z);}});}new Sprite({x:x,y:y-0.5,img:imgCoords.light_white,alphaFunction:function alphaFunction(age){return age<=6?Math.random()*0.66:Math.min(0.2,this.ticksLeft*0.025)*(Math.random()*0.3+0.85);},age:12+Math.random()*7,scale:3.5,scaleFunction:function scaleFunction(){return this.scale;}});};function createBlinkEffectVerySmall(x,y){if(game.fastForward)return;for(var i=0;i<4;i++){new Sprite({x:x+Math.random()*1.4-0.7,y:y+Math.random()*1.4-0.7-0.5,img:imgCoords.whiteLine,scaleFunction:function scaleFunction(){return Math.random()*2.5;},alphaFunction:function alphaFunction(){return 0.8-Math.random()*0.3;},age:4+Math.random()*2,r0:Math.random()*0.05-0.025,r1:Math.random()*0.05-0.025,zFunction:function zFunction(age){return age*this.r0;},xFunction:function xFunction(age){return age*this.r1;}});}for(var i=0;i<2;i++){new Sprite({x:x+Math.random()*1.4-0.7,y:y+Math.random()*1.0-0.5-0.5,z:Math.random()*1+0.3,img:imgCoords.particleWhite,alphaFunction:function alphaFunction(){return this.ticksLeft>10?0.5:this.ticksLeft*0.5/10;},age:30+Math.random()*10,scaleFunction:function scaleFunction(){return this.scale;},scale:1.2+Math.random()*0.6,zFunction:function zFunction(age){return Math.max(-Math.pow(age*0.07,2),-this.z);}});}new Sprite({x:x,y:y-0.5,img:imgCoords.light_white,alphaFunction:function alphaFunction(age){return age<=6?Math.random()*0.66:Math.min(0.2,this.ticksLeft*0.025)*(Math.random()*0.3+0.85);},age:8+Math.random()*4,scale:2.5,scaleFunction:function scaleFunction(){return this.scale;}});};function drawCircle(x,y,size,color,fillColor,yScale,lineWidth){var yScale_=yScale?yScale:1;c.scale(1,yScale_);c.lineWidth=SCALE_FACTOR*(lineWidth?lineWidth:1);c.beginPath();c.arc(x,y/yScale_,size,0,2*Math.PI,false);if(color){c.strokeStyle=color;c.stroke();}if(fillColor){c.fillStyle=fillColor;c.fill();}c.scale(1,1/yScale_);};function drawText(ctx,text,color,size,x,y,w,align,alpha,fillStyle,height,maxWidth,shadowColor,shadowBlur,fontFamily){if(!fontFamily){if(drawText.fontFamily==undefined){drawText.fontFamily=window.getComputedStyle(document.documentElement)["font-family"];}fontFamily=drawText.fontFamily;}var text2=text;var w2=w?w:99999;alpha=alpha?alpha:1;var returnValue=1;ctx.font="bold "+size+"px "+fontFamily;ctx.textAlign=align?align:"left";ctx.shadowColor=shadowColor?shadowColor:"black";ctx.shadowBlur=0;if(ctx.measureText(text).width>w2){var words=text.split(" ");var line=words[0];var lastFittingLine;var i=1;while(ctx.measureText(line).width<=w2&&i<words.length){lastFittingLine=line;line=line+" "+words[i];i++;}text2=lastFittingLine?lastFittingLine:line;words.splice(0,Math.max(i-1,1));if(words.length>0)returnValue+=drawText(ctx,words.join(" "),color,size,x,y+height+4,w2,align,alpha,fillStyle,height,maxWidth,shadowColor,shadowBlur,fontFamily);}var textWidth=ctx.measureText(text2).width;var x2=Math.floor(x);var y2=Math.floor(y);if(fillStyle){var x3=x2;if(align=="center")x3-=(textWidth+6)/2;else if(align=="right")x3-=textWidth+6;ctx.globalAlpha=alpha;ctx.fillStyle=fillStyle;ctx.fillRect(x3,y2-height*0.9,textWidth+6,height*1.1);}if(alpha)ctx.globalAlpha=alpha;ctx.fillStyle=color;if(maxWidth)ctx.fillText(text2,x2,y2,maxWidth);else ctx.fillText(text2,x2,y2);ctx.globalAlpha=1;ctx.shadowBlur=0;return returnValue;};function fpsColor(i){return numColor(i,40,20);}function pingColor(i){i=1000-i;return numColor(i,900,700);}function numColor(i,fine,poor){var s='255, 255, 128';if(i>fine){s='192, 255, 192';}else if(i<poor){s='255, 192, 192';}return'rgba('+s+', 0.8)';}function obtainHat(itemId){if(!hats[itemId]){console.warn('invalid item '+itemId);return;}if(pl_items[itemId]){pl_items[itemId].count+=1;}else{pl_items[itemId]={id:itemId,count:1,level:1};}};function unlockAbility(ab){while(pl_abilities_unlocked.length<=ab.id){pl_abilities_unlocked+="0";}pl_abilities_unlocked=pl_abilities_unlocked.substr(0,ab.id)+"1"+pl_abilities_unlocked.substr(ab.id+1);};var specFocusBest=0;function specFocusBestLoop(next){if(!specFocusBestDo()){return;}if(!next){specFocusBest++;next=specFocusBest;}window.setTimeout(function(){if(next!=specFocusBest){return;}specFocusBestLoop(next);},5000);}function specFocusBestDo(){if(!game||game.playingPlayer){return false;}var bestScore=-999;var best=null;var key='elo';if(game.type.zombies||game.type.coopZombieMode){key='souls';}var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=game.players[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var p=_step6.value;if(!p.db_id){continue;}if(bestScore<p[key]){bestScore=p[key];best=p;}}}catch(err){_didIteratorError6=true;_iteratorError6=err;}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return();}}finally{if(_didIteratorError6){throw _iteratorError6;}}}if(best){game.specPlayer=best;cameraReset();}return true;}function cameraReset(){KeyManager.x=WIDTH/2|0;KeyManager.y=HEIGHT/2|0;}function switchSpec(inc){specFocusBest++;soundManager.playSound(SOUND.SWITCH,undefined,undefined,0.7);if(game.players.length==0)game.specPlayer=null;else{if(!game.specPlayer)game.specPlayer=inc>0?game.players[0]:game.players[game.players.length-1];else{var found=false;for(var i=0;i<game.players.length;i++){if(game.players[i]==game.specPlayer){i+=inc;if(game.players[i])game.specPlayer=game.players[i];else game.specPlayer=null;i=game.players.length;found=true;}}if(!found)game.specPlayer=null;}}if(game.specPlayer)game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.spectate.follow",{playerName:game.specPlayer.unsafeName}),"#BEBEBE","textInGrey");else game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.spectate.free"),"#BEBEBE","textInGrey");return;};function attemptExitApp(){return Desktop.close();var promptWnd=slayOne.viewHelpers.showPrompt({title:slayOne.widgets.lang.get("msg.exitApp.confirm.title"),content:slayOne.widgets.lang.get("msg.exitApp.confirm.content"),buttons:['cancel','ok'],onClick:function onClick(btnName){promptWnd.close();if(btnName=='ok'){Desktop.close();}}});}function attemptExitGame(){if(game.editor||game.replayMode){exitGame();return;}function doExitGame(){slayOne.viewHelpers.showFullScreenLoading();network.send("leave-game");network.ignoreGuestMsg=false;uiManager.hideDeathScreen();window.leavingGame=true;window.leaveGameLeftTicks=game.ticksCounter;window.leaveGameFloatTip=slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("msg.leave_game",{seconds:''}),duration:-1});}if(game.ticksCounter<0){return doExitGame();}if(!game.playingPlayer){return doExitGame();}var promptWnd=slayOne.viewHelpers.showPrompt({title:slayOne.widgets.lang.get("msg.leave_game.confirm.title"),content:slayOne.widgets.lang.get("msg.leave_game.confirm.content"),buttons:['cancel','ok'],onClick:function onClick(btnName){promptWnd.close();if(btnName=='ok'){if(forceQuit){forceQuitConfirm=true;window.close();}if(isTutorialMap(game.mapId)){gaEventOnce('player-stopped-tutorial');}BIUtils.endEvent('flow','home.buttons.play','send:leave-game');doExitGame();}else{forceQuit=false;forceQuitConfirm=false;}}});};function preExitGame(){if(window.leavingGame){window.leavingGame=false;slayOne.viewHelpers.hideFullScreenLoading();slayOne.viewHelpers.hideFloatTip(window.leaveGameFloatTip);window.leaveGameFloatTip=-1;window.leaveGameLeftTicks=0;}uiManager.hideDeathScreen();}function exitGame(){network.triggerMessage(NetworkMessages.GameExit);soundManager.playSound(SOUND.CLICK);document.getElementById("optionsWindow").style.display="none";if(authLevel>=AUTH_LEVEL.PLAYER){F$('resourceBar').show();}var isTutorial=game.isTutorial();game=new Game(map1);if(document.getElementById('editorElementsDiv'))document.getElementById('editorElementsDiv').style.display="none";if(document.getElementById('editorDiv2'))document.getElementById('editorDiv2').style.display="none";F$('rankInGame').hide();if(game.editor)game.editor.refreshItemInfo();document.getElementById("editorItemInfo").style.display="none";slayOne.viewHelpers.showAd();uiManager.refreshMenuButtons();if(!db_id&&isTutorial){uiManager.showRegister();}else{uiManager.showMainScene();}};function createTile(o){var type=tileTypes[o.id];if(!type)type=tileTypes[0];var tile={x:o.x,y:o.y,type:type};if(type.editable)for(var i=0;i<type.editable.length;i++){tile[type.editable[i]]=parseFloat(typeof o[type.editable[i]]!=="undefined"?o[type.editable[i]]:type[type.editable[i]]);}return tile;};function iHaveItem(item){return!!pl_items[item.id];}function parseItems(str1){var items={};var a1=str1.split(';');for(var i=0;i<a1.length;i++){if(a1[i]){var a2=a1[i].split(',');var id=parseInt(a2[0]);items[id]={id:id,level:parseInt(a2[1]),count:parseInt(a2[2])};}}return items;};function parseChests(str1){var chests={};var a1=str1.split(';');for(var i=0;i<a1.length;i++){if(a1[i]){var a2=a1[i].split(',');var id=parseInt(a2[0]);chests[id]={count:parseInt(a2[1]),openTime:parseInt(a2[2])};}}return chests;}function getChestName(id){return F_('chest.name.'+id);}function iHaveAbility(ab){if(ab.isFree)return true;return pl_abilities_unlocked.length>ab.id&&pl_abilities_unlocked.substr(ab.id,1)=="1";};function _setHat(i){if(iHaveItem(hats[i])){network.send("setHat$"+i);pl_hat=hats[i];}};function joinTeam(team){if(team==-1){game.iAmSpec=true;network.send("spectate");F$('rankInGame').hide();return;}game.iAmSpec=false;network.send("joinTeam$"+team);};function getMapThumbnail(mapId,mapVersion){return window.mapPath+'/'+mapId+"."+mapVersion+".jpg";};function holdPlaceMapThumbnail(event){var img=event.currentTarget;if(event.type!='load'||img.naturalWidth==1&&img.naturalHeight==1){img.src=window.ResourcePath+'imgs/main_ui/map_placeholder.png';}};function toggleFullscreen(element){if(isDesktop){Desktop.toggleFullscreen();return;}if(element.requestFullScreenWithKeys){if(!document.fullScreen)element.requestFullScreenWithKeys();else document.exitFullScreen();}if(element.requestFullScreen){if(!document.fullScreen)element.requestFullscreen();else document.exitFullScreen();}else if(element.mozRequestFullScreen){if(!document.mozFullScreen)element.mozRequestFullScreen();else document.mozCancelFullScreen();}else if(element.webkitRequestFullScreen){if(!document.webkitIsFullScreen)element.webkitRequestFullScreen(element.ALLOW_KEYBOARD_INPUT);else document.webkitCancelFullScreen();}resize();};Array.prototype.erease=function(element){var i=this.indexOf(element);if(i>=0){this.splice(i,1);return true;}return false;};Array.prototype.contains=function(element){for(var i=0,j=this.length;i<j;i++){if(this[i]==element){return true;}}return false;};function acceptAGB(){network.send("i-accept-agb");soundManager.playSound(SOUND.CLICK);};function showPlayerInfo(p){network.send("plInfo$"+p);slayOne.viewHelpers.showFullScreenLoading();};function _formatNick(s,skipCheckShort){if(typeof s!='string'){s='';}s=s.replace(/[\x00-\x1F]/,'');s=s.replace(/\s+/g,' ');s=s.trim();if(s.length>15){s=s.substr(0,15);}var len=0;var output='';for(var i in s){var char=s[i];var len_add=1;var ord=char.charCodeAt(0);if(ord>=8192&&ord<=65376||ord>65440){len_add=2;}if(len+len_add>15){break;}len+=len_add;output+=char;}output=output.trim();output=output.replace(/(Elo|EIo|E1o)\s*:\s*\d+/i,'');if(!skipCheckShort&&output.length<3){output='Player';}return output;}function showClanInfo(clanTag){_requestClanInfo(clanTag,function(clan){if(clan){F$('clanMain').show(clan,true);}});};function _requestClanInfo(clanTag,callback){network.once(NetworkMessages.ClanInfo,function(clan){slayOne.viewHelpers.hideFullScreenLoading();callback(clan);});network.send("clInfo$"+clanTag);slayOne.viewHelpers.showFullScreenLoading();};var check=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=true;})(navigator.userAgent||navigator.vendor||window.opera);isMobile=check;function resize(){WIDTH=window.innerWidth;HEIGHT=window.innerHeight;canvas.width=WIDTH;canvas.height=HEIGHT;FIELD_SIZE=Math.sqrt(WIDTH*HEIGHT)*SCALE_CONST;FIELD_SIZE_BASE=Math.sqrt(WIDTH*HEIGHT)*SCALE_CONST_BASE;SCALE_FACTOR=FIELD_SIZE/16;SCALE_FACTOR_BASE=FIELD_SIZE_BASE/16;c.mozImageSmoothingEnabled=false;c.msImageSmoothingEnabled=false;c.imageSmoothingEnabled=false;var el=document.getElementById("chatDisplayDiv");if(el){el.style.left=87*(FIELD_SIZE/16)+"px";el.style.right=FIELD_SIZE/16*70+"px";el.style.bottom=FIELD_SIZE/16*2+"px";}};function ban(name){network.send("ban$"+name);};function playerIsBeeingIgnored(name){name=name.toLowerCase();return ignoreList.indexOf(name)>=0||ignoreListTemp.indexOf(name)>=0;}function toggleIgnore(button,name,isGuest){var el=document.getElementById("button_ignore_"+name);name=name.toLowerCase();for(var i=0;i<ignoreList.length;i++){if(ignoreList[i]==name){ignoreList.splice(i,1);localStorage.ignoreList=ignoreList.join(";");if(el)el.innerHTML="ignore";game.interface_.addMsg(slayOne.widgets.lang.get("game.msg.ignore.off",{playerName:name}),"white");return;}}for(var i=0;i<ignoreListTemp.length;i++){if(ignoreListTemp[i]==name){ignoreListTemp.splice(i,1);if(el)el.innerHTML="ignore";game.interface_.addMsg(slayOne.widgets.lang.get("game.msg.ignore.off",{playerName:name}),"white");return;}}(isGuest?ignoreListTemp:ignoreList).push(name);localStorage.ignoreList=ignoreList.join(";");if(el)el.innerHTML="unignore";game.interface_.addMsg(slayOne.widgets.lang.get("game.msg.ignore.on",{playerName:name}),"white");};function saveReplay(){var blob=new Blob([JSON.stringify(["replay-version=4"].concat(window.replayFile))],{type:"text/plain;charset=utf-8"});var d=new Date();saveAs(blob,"replay-"+d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+".json");soundManager.playSound(SOUND.CLICK);};function loadReplay(){var fileInput=document.createElement("input");fileInput.type="file";fileInput.click();fileInput.onchange=function(){var file=fileInput.files[0];if(file){slayOne.views.optionsScreen.hideWindow();slayOne.viewHelpers.showFullScreenLoading();var reader=new FileReader();reader.readAsText(file);reader.onload=function(e){setTimeout(function(){var r=JSON.parse(e.target.result);if(r[0]&&r[0].split&&r[0].split("=")[0]=="replay-version"){r.splice(0,1);playingReplay=r;playingReplayVersion=parseInt(r[0].split("=")[1]);}else{playingReplay=r;playingReplayVersion=1;}startReplay();},50);};reader.onerror=function(e){slayOne.viewHelpers.hideFullScreenLoading();};}};soundManager.playSound(SOUND.CLICK);};function startReplay(){for(var i=0;i<playingReplay.length;i++){var row=playingReplay[i];var splitMsg=row.split("$");var cmd=splitMsg[0];if(cmd=='initPreload'){var json=row.substr(row.indexOf('$')+1);json=JSON.parse(json);console.log('json',json,row);NetworkRespondMsgJson.initPreload(json);continue;}if(cmd=="init"){var mapId=splitMsg[2];var mapVersion=splitMsg[3];gameCommandBuffer.waitMap(mapId,mapVersion);mapService.loadMap(mapId,mapVersion,function(map){slayOne.viewHelpers.hideFullScreenLoading();enterGame(splitMsg);game=new Game(map);game.replayMode=true;game.iAmSpec=true;game.init(splitMsg,playingReplay[i]);game.interface_.analyzeReplay(playingReplay);uiManager.refreshMenuButtons();});return;}}};function sendRespawn(){network.send("respawn");uiManager.hideDeathScreen();slayOne.viewHelpers.hideAd();};function logout(){if(isSteam){return Desktop.close();}soundManager.playSound(SOUND.CLICK);network.send("logout");F$('resourceBar').hide();clearLocal();networkPlayerName="";authLevel=AUTH_LEVEL.GUEST;pl_xp=0;pl_lvl=0;pl_gold=0;db_id=0;pl_items={};pl_abilities_unlocked="";pl_hat=hats[0];pl_abilities=getDefaultAbilityObj(abilities);pl_clan_tag="";pl_clan_role=AUTH_LEVEL.NONE;pl_tutorials=0;pl_chests='';pl_daily_quests=null;uiManager.resetWelcomeTip();uiManager.showMainScene();uiManager.refreshMenuButtons();FacebookUtils.closeBottomBar();FacebookUtils.authInfo=null;FacebookUtils.fbReady=false;clearLocal();if(pl_daily_quests_refesh_timeout_id){clearTimeout(pl_daily_quests_refesh_timeout_id);pl_daily_quests_refesh_timeout_id=null;}};function launchEditor(){soundManager.playSound(SOUND.CLICK);enterGame();var map={x:32,y:32,maxPlayers:10,name:"New map",description:"",tiles:[],defaultTiles:0,groundTiles:[],type:MAP_TYPE.DEATHMATCH};game=new Game(map,true);game.editor=new Editor();game.startEditingMode();uiManager.refreshMenuButtons();};function getCanvasFromImgObj(img,sheet,size){var cv=document.createElement("canvas");var scale=size/Math.max(img.w,img.h);cv.width=img.w*scale;cv.height=img.h*scale;cv.getContext("2d").mozImageSmoothingEnabled=false;cv.getContext("2d").msImageSmoothingEnabled=false;cv.getContext("2d").imageSmoothingEnabled=false;cv.getContext("2d").drawImage(sheet,img.x,img.y,img.w,img.h,0,0,img.w*scale,img.h*scale);return cv;};function ticks2TimeStr(ticks){var time=Math.floor(ticks/20);return humanizeSeconds(time);}function formatCountdown(deadline){var seconds=Math.round((deadline-serverTime())/1000);return humanizeSeconds(seconds);}function humanizeSeconds(seconds){if(seconds>=0){var hour=Math.floor(seconds/3600);var min=Math.floor(seconds/60)%60;var sec=seconds%60;var str="";if(hour>0){hour=hour<10?"0"+hour:hour;str=hour+":";}min=min<10?"0"+min:min;sec=sec<10?"0"+sec:sec;return str+min+":"+sec;}else{return"--:--";}}function serverTime(){return Date.now()+serverTimeDiff;}function changeReplaySpeed(inc){if(game.fastForward||game.interface_.fastForwardTo>=0){game.fastForward=false;game.interface_.fastForwardTo=-1;window.oldReplayOptionsIndex=window.replayOptionsIndex;window.replayOptionsIndex=window.replayOptions.length-1;window.replayOption=window.replayOptions[window.replayOptionsIndex];return;}window.replayOptionsIndex=Math.max(Math.min(window.replayOptionsIndex+inc,window.replayOptions.length-2),0);window.replayOption=window.replayOptions[window.replayOptionsIndex];window.lastReplaySpeedChange=Date.now();};function replayLoop(){if(typeof game!=="undefined"&&game&&game.replayMode){for(var k=0;k<window.replayOption.loops;k++){for(var i=game.replayIndex;i<playingReplay.length;i++){if(game.fastForward&&game.interface_.fastForwardTo-200<=game.interface_.replayTimer){game.fastForward=false;window.replayOptionsIndex=window.replayOptions.length-3;window.replayOption=window.replayOptions[window.replayOptionsIndex];}if(game.interface_.fastForwardTo==game.interface_.replayTimer){game.interface_.fastForwardTo=-1;window.replayOptionsIndex=window.oldReplayOptionsIndex;window.replayOption=window.replayOptions[window.replayOptionsIndex];}var splitMsg=playingReplay[i].split("$");network.handleGameMsg(splitMsg,playingReplay[i]);if(splitMsg[0]=="upd"){game.interface_.replayTimer++;game.replayIndex=i+1;i=playingReplay.length;}}}}window.setTimeout(replayLoop,window.replayOption.tickTime);};replayLoop();function mainLoop(){rAF(mainLoop);newTime=Date.now();timeDiff=newTime-timestamp;timestamp=newTime;if(game){tickDiff=game.ticksCounter-lastFramesTick;lastFramesTick=game.ticksCounter;exactTickDiff=game.ticksCounter+Math.min((Date.now()-lastUpdate)/window.replayOption.tickTime,1)-lastFramesExactTick;lastFramesExactTick=game.ticksCounter+Math.min((Date.now()-lastUpdate)/window.replayOption.tickTime,1);if(game.mapWelcome){if(Math.floor(newTime/50)>Math.floor((newTime-timeDiff)/50))game.receiveUpdate([]);if(game.cameraX<0||game.cameraY<0||game.cameraX2>game.map.x||game.cameraY2>game.map.y||game.camFlyX==0&&game.camFlyY==0){var angle=Math.random()*Math.PI*2;game.camFlyX=Math.cos(angle)*0.001;game.camFlyY=Math.sin(angle)*0.001;game.cameraX=Math.random()*(game.map.x-WIDTH/FIELD_SIZE);game.cameraY=Math.random()*(game.map.y-HEIGHT/FIELD_SIZE);}else{game.cameraX+=game.camFlyX*timeDiff;game.cameraY+=game.camFlyY*timeDiff;}}}else{c.fillStyle="black";c.fillRect(0,0,WIDTH,HEIGHT);}if(document.getElementById("optionsWindow").style.display!="none")for(var i=0;document.getElementById("hats_canvas_"+i);i++){refreshHatCanvasOld(document.getElementById("hats_canvas_"+i),hats[i]);}if(game&&game.mapWelcome&&uiManager.canvasChangeSkinsButton){refreshHatCanvas(uiManager.canvasChangeSkinsButton,window.pl_hat);}timestampArchives.push(timestamp);if(Math.random()<0.1)fps=Math.floor(10*1000/(timestamp-timestampArchives[0]));timestampArchives.splice(0,1);if(game){if(window.debugMode){makeDrawLog();}else{game.draw();}}};function refreshHatCanvas(ca_,hat){ca_.width=ca_.offsetWidth;ca_.height=ca_.offsetHeight;var imgs=window.imgs,noAnimate=ca_.getAttribute("data-no-animate")=="yes",c_=ca_.getContext("2d"),baseSize=32,scale=3.7,scaledSize=Math.max(1,Math.round(baseSize*scale)),xOffset=-Math.round(baseSize/2),yOffset=-Math.round(baseSize/3),direction=2,frame=noAnimate?1:parseInt(window.newTime/66*0.6%8);c_.mozImageSmoothingEnabled=false;c_.msimageSmoothingEnabled=false;c_.imageSmoothingEnabled=false;try{c_.drawImage(imgs.shadow,0,0,scaledSize,scaledSize,xOffset,yOffset,scaledSize,scaledSize);}catch(err){}c_.drawImage(imgs.weaponsMinus,direction*baseSize,0,baseSize,baseSize,Math.sin(frame*(Math.PI/2))*scale/3+xOffset,-(frame%2)*scale/2+yOffset,scaledSize,scaledSize);c_.drawImage(imgs.legs,frame*baseSize,baseSize*direction+hat.legs*288,baseSize,baseSize,xOffset,yOffset,scaledSize,scaledSize);if(hat.hatOnly)c_.drawImage(imgs.heads,direction*baseSize,0,baseSize,baseSize,xOffset,0-frame%2*scale/2+yOffset,scaledSize,scaledSize);c_.drawImage(imgs.heads,direction*baseSize,baseSize*hat.offset,baseSize,baseSize,xOffset,0-frame%2*scale/2+yOffset,scaledSize,scaledSize);c_.drawImage(imgs.weaponsPlus,direction*baseSize,0,baseSize,baseSize,Math.sin(frame*(Math.PI/2))*scale/2+xOffset,-(frame%2)*scale/1.8+yOffset,scaledSize,scaledSize);}function refreshHatCanvasOld(ca_,hat){var noAnimate=ca_.getAttribute("data-no-animate")=="yes";ca_.width=164;ca_.height=164;var c_=ca_.getContext("2d");var scale=5;c_.mozImageSmoothingEnabled=false;c_.msImageSmoothingEnabled=false;c_.imageSmoothingEnabled=false;var direction=2;var frame=noAnimate?1:parseInt(newTime/66*0.6%8);c_.drawImage(imgs.shadow,0,0,32*scale,32*scale);c_.drawImage(imgs.weaponsMinus,direction*32,0,32,32,Math.sin(frame*(Math.PI/2))*scale/3,-(frame%2)*scale/2,32*scale,32*scale);c_.drawImage(imgs.legs,frame*32,32*direction+hat.legs*288,32,32,0,0,32*scale,32*scale);if(hat.hatOnly)c_.drawImage(imgs.heads,direction*32,0,32,32,0,0-frame%2*scale/2,32*scale,32*scale);c_.drawImage(imgs.heads,direction*32,32*hat.offset,32,32,0,0-frame%2*scale/2,32*scale,32*scale);c_.drawImage(imgs.weaponsPlus,direction*32,0,32,32,Math.sin(frame*(Math.PI/2))*scale/2,-(frame%2)*scale/1.8,32*scale,32*scale);};function imageTransforms(){var canv=document.createElement('canvas');canv.height=imgs.miscSheet.height;canv.width=imgs.miscSheet.width;var ctx=canv.getContext('2d');ctx.drawImage(imgs.miscSheet,0,0);var imgData=ctx.getImageData(0,0,canv.width,canv.height);for(var i=0;i<imgData.data.length;i+=4){var newValue=(imgData.data[i]+imgData.data[i+1]+imgData.data[i+2])/3;imgData.data[i]=newValue;imgData.data[i+1]=newValue;imgData.data[i+2]=newValue;}ctx.putImageData(imgData,0,0);imgs.miscSheetGrey=canv;canv=document.createElement('canvas');canv.height=imgs.miscSheet.height;canv.width=imgs.miscSheet.width;ctx=canv.getContext('2d');ctx.drawImage(imgs.miscSheet,0,0);imgData=ctx.getImageData(0,0,canv.width,canv.height);for(var i=0;i<imgData.data.length;i+=4){imgData.data[i]=255;imgData.data[i+1]=255;imgData.data[i+2]=255;}ctx.putImageData(imgData,0,0);imgs.miscSheetWhite=canv;var imgs_=["heads","hands","legs","zombieDeath","tileSheet","rangedZombie","crawler"];for(var k=0;k<imgs_.length;k++){var img=imgs[imgs_[k]];canv=document.createElement('canvas');ctx=canv.getContext('2d');canv.height=img.height;canv.width=img.width;ctx.drawImage(img,0,0);imgData=ctx.getImageData(0,0,canv.width,canv.height);for(var i=0;i<imgData.data.length;i+=4){if(imgData.data[i+3]>0){imgData.data[i]=0;imgData.data[i+1]=0;imgData.data[i+2]=0;}}ctx.putImageData(imgData,0,0);imgs[imgs_[k]+"Black"]=canv;canv=document.createElement('canvas');ctx=canv.getContext('2d');canv.height=img.height;canv.width=img.width;for(var i=0;i<imgData.data.length;i+=4){if(imgData.data[i+3]>0){imgData.data[i]=255;imgData.data[i+1]=255;imgData.data[i+2]=255;}}ctx.putImageData(imgData,0,0);imgs[imgs_[k]+"White"]=canv;}for(var i=0;i<tileTypes.length;i++){if(!tileTypes[i].hideOnMinimap){var img=tileTypes[i].img;canv=document.createElement('canvas');ctx=canv.getContext('2d');canv.width=img.w;canv.height=img.h;ctx.drawImage(imgs.tileSheet,img.x,img.y,img.w,img.h,0,0,img.w,img.h);imgData=ctx.getImageData(0,0,canv.width,canv.height);var r_=0;var g_=0;var b_=0;var counter_=0;for(var k=0;k<imgData.data.length;k+=8){if(imgData.data[k+3]>0){r_+=imgData.data[k];g_+=imgData.data[k+1];b_+=imgData.data[k+2];counter_++;}}if(counter_>0)tileTypes[i].avgColor="rgb("+Math.floor(r_/counter_)+", "+Math.floor(g_/counter_)+", "+Math.floor(b_/counter_)+")";}}};function loadImage(imgFile){ressourcesToLoad++;var img=new Image();img.onload=function(){ressourceLoaded(img);};img.crossOrigin="Anonymous";img.src=imgFile;img.srcCpy=imgFile;return img;};function isTutored(tutorialId){return getBit(pl_tutorials,tutorialId-1);}function tutor(tutorialId){if(!isTutored(tutorialId)){pl_tutorials=setBit(pl_tutorials,tutorialId-1,1);network.send('setTutorials$'+pl_tutorials);}}function startTutorial(){var respTimeout=setTimeout(function(){clearTimeout(respTimeout);slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get('msg.error_wait_too_long')});},10000);var respFailCb=function respFailCb(failMessage){clearTimeout(respTimeout);window.network.removeMessageListener(NetworkMessages.GameEntered,respSuccessCb);window.network.removeMessageListener(NetworkMessages.LoginFail,respFailCb);slayOne.viewHelpers.hideFullScreenLoading();};var respSuccessCb=function respSuccessCb(){clearTimeout(respTimeout);window.network.removeMessageListener(NetworkMessages.GameEntered,respSuccessCb);window.network.removeMessageListener(NetworkMessages.LoginFail,respFailCb);};slayOne.viewHelpers.showFullScreenLoading();window.network.addMessageListener(NetworkMessages.GameEntered,respSuccessCb);window.network.addMessageListener(NetworkMessages.LoginFail,respFailCb);window.joinGamePurpose='play';network.send(["create-game",TUTORIALS[1].mapId,1,1,TUTORIALS[1].mapType].join("$"));}function ressourceLoaded(img){if(img&&(!img.complete||!(img.width>0))){img.src="";img.src=img.srcCpy;return;}ressourcesToLoad--;if(ressourcesToLoad==0){slayOne.widgets.lang.initialize(function(){slayOne.viewHelpers.showFullScreenLoading();imageTransforms();renderMainMenu_(document.body);game=new Game(map1);network=new Network();rAF(mainLoop);});}};function copyInput(input){input.select();try{var successful=document.execCommand('copy');if(successful){slayOne.viewHelpers.showFloatTip({tipType:'success',content:slayOne.widgets.lang.get("msg.copy_ok"),duration:2000});}else{slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("msg.copy_fail")});}}catch(err){slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("msg.copy_fail_with_reason",{reason:err.toString()})});}}function shareToTwiter(link){if(!link){return;}window.open('http://twitter.com/share?text='+encodeURIComponent(F_("slogan.twitter"))+'&url='+encodeURIComponent(link),'tweet','height=300,width=550,resizable=1');}function shareToFacebook(link){if(!link){return;}var fbShareUrl="https://www.facebook.com/dialog/share?app_id=353276591718040&display=popup&href="+encodeURIComponent(link);var rect=document.body.getBoundingClientRect();window.open(fbShareUrl,'fbShareWindow','height=450, width=550, top='+(rect.height/2-275)+', left='+(rect.width/2-225)+', toolbar=0, location=0, menubar=0, directories=0, scrollbars=0');}function getSearchQuery(){if(getSearchQuery.result){return getSearchQuery.result;}var result={};var searchStr=window.location.search;if(searchStr.indexOf("?")==0){searchStr=searchStr.substr(1);}var kvPairs=searchStr.split("&");var kvPairIndex;var kvPairCount=kvPairs.length;for(kvPairIndex=0;kvPairIndex<kvPairCount;kvPairIndex++){var kvPairStr=kvPairs[kvPairIndex];if(kvPairStr!=null&&kvPairStr.length>0){var kv=kvPairStr.split("=");if(kv!=null&&kv.length==2){var key=kv[0];var value=kv[1];result[key]=decodeURIComponent(value);}}}getSearchQuery.result=result;return result;}function clearLocal(){localStorage.removeItem('fId');if(debugMode){localStorage.removeItem('showedTutorialHint');}setSessionId(null);}function setSessionId(v){if(!v){docCookies.removeItem('session_id');}else{docCookies.setItem('session_id',v,Infinity);}}function getSessionId(){return docCookies.getItem('session_id');}function getClanLink(clanTag){if(FacebookUtils.embeddedInCanvas){return FacebookUtils.appURL+"?clan="+clanTag;}else{return window.location.origin+"/?clan="+clanTag;}}function getCurrentGameLink(){if(game&&game.map!=map1){var url;if(FacebookUtils.embeddedInCanvas){url=FacebookUtils.appURL;}else{url=window.location.origin+"/";}url+="?server="+network.connectedServerIndex+"&game="+game.id;if(game.mode){url=url+"&mode="+game.mode;}return url;}return"";};function openGameShare(){F$('gameShare').show();}function floatEqual(a,b){var tolerant=0.0001;var diff=a-b;return diff<tolerant&&diff>-tolerant;};var docCookies={getItem:function getItem(sKey){if(!sKey){return null;}return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;},setItem:function setItem(sKey,sValue,vEnd,sPath,sDomain,bSecure){if(!sKey||/^(?:expires|max\-age|path|domain|secure)$/i.test(sKey)){return false;}var sExpires="";if(vEnd){switch(vEnd.constructor){case Number:sExpires=vEnd===Infinity?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+vEnd;break;case String:sExpires="; expires="+vEnd;break;case Date:sExpires="; expires="+vEnd.toUTCString();break;}}document.cookie=encodeURIComponent(sKey)+"="+encodeURIComponent(sValue)+sExpires+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"")+(bSecure?"; secure":"");return true;},removeItem:function removeItem(sKey,sPath,sDomain){if(!this.hasItem(sKey)){return false;}document.cookie=encodeURIComponent(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"");return true;},hasItem:function hasItem(sKey){if(!sKey){return false;}return new RegExp("(?:^|;\\s*)"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie);},keys:function keys(){var aKeys=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);for(var nLen=aKeys.length,nIdx=0;nIdx<nLen;nIdx++){aKeys[nIdx]=decodeURIComponent(aKeys[nIdx]);}return aKeys;}};function drawHat(canvas,hat,scale,direction,width,height){if(!window.imgs){return;}var frame=1;canvas.fillStyle="rgba(0, 0, 0, 0)";canvas.clearRect(0,0,width,height);canvas.drawImage(imgs.shadow,0,0,32*scale,32*scale);canvas.drawImage(imgs.weaponsMinus,direction*32,0,32,32,Math.sin(frame*(Math.PI/2))*scale/3,-(frame%2)*scale/2,32*scale,32*scale);canvas.drawImage(imgs.legs,frame*32,32*direction+hat.legs*288,32,32,0,0,32*scale,32*scale);if(hat.hatOnly)canvas.drawImage(imgs.heads,direction*32,0,32,32,0,0-frame%2*scale/2,32*scale,32*scale);canvas.drawImage(imgs.heads,direction*32,32*hat.offset,32,32,0,0-frame%2*scale/2,32*scale,32*scale);canvas.drawImage(imgs.weaponsPlus,direction*32,0,32,32,Math.sin(frame*(Math.PI/2))*scale/2,-(frame%2)*scale/1.8,32*scale,32*scale);}var FacebookUtils={embeddedInCanvas:false,loadSdk:function loadSdk(){if(this.sdkLoaded){return;}var d=document;var s='script';var id='facebook-jssdk';var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return;}js=d.createElement(s);js.id=id;js.src="//connect.facebook.net/en_US/sdk.js";fjs.parentNode.insertBefore(js,fjs);this.sdkLoaded=true;},locale:null,fbReady:false,onFbReady:function onFbReady(callback){if(FacebookUtils.fbReady){callback();}else{if(!FacebookUtils.fbReadyCallbacks){FacebookUtils.fbReadyCallbacks=[];}FacebookUtils.fbReadyCallbacks.push(callback);}},doReady:function doReady(authInfo){FacebookUtils.authInfo=authInfo;FacebookUtils.fbReady=true;var callbacks=FacebookUtils.fbReadyCallbacks;if(callbacks&&callbacks instanceof Array){for(var i=0;i<callbacks.length;i++){var callback=callbacks[i];if(typeof callback=='function'){callback();}}FacebookUtils.fbReadyCallbacks=null;}},authInfo:null,loginFb:function loginFb(callback){FB.login(function(response){FacebookUtils.doReady(response.authResponse);console.warn("Facebook login complete");if(typeof callback=='function'){callback();}},{scope:"publish_actions,email,user_friends"});},loginGame:function loginGame(callback){if(!FacebookUtils.authInfo){return;}slayOne.viewHelpers.showFullScreenLoading();console.log("=> Start to login game with facebook ...");pomelo.request('lobby.facebookHandler.login',FacebookUtils.authInfo,function(res){slayOne.viewHelpers.hideFullScreenLoading();if(!res){return;}console.log("=> Logged in game with facebook.");if(res.result!=0){slayOne.viewHelpers.showFloatTip({tipType:'error',content:F_(res.msg)||res.msg});}if(typeof callback=='function'){callback(res);}});},loginFbThenGame:function loginFbThenGame(callback){FacebookUtils.loginFb(function(){gaEventOnce('start-to-login-with-facebook-account');FacebookUtils.loginGame(function(res){gaEventOnce('login-with-facebook-account-succeeded');callback(res);});});},register:function register(name,email,callback){pomelo.request('lobby.facebookHandler.register',{name:name,email:email},function(res){if(res.result!=0){slayOne.viewHelpers.showFloatTip({tipType:'error',content:F_(res.msg)||res.msg});}if(typeof callback=='function'){callback(res);}});},fbListInited:false,showBottomBar:function showBottomBar(){if(this.fbListInited==true){return;}F$('bottomBar').showForFb();this.fbArrayView.on(FunUI.events.ARRAY_VIEW_PENDED,this.getFriendList.bind(this,this.fbArrayView.source.length,10,null));this.getFriendList(0,10);this.fbListInited=true;},closeBottomBar:function closeBottomBar(){F$('bottomBar').hideForFb();this.fbListInited=false;this.fbInfoLists={};this.fbArrayView.source=[];},fbInfoLists:{},fbArrayView:new F$ArrayView(),delayedGetFriendList:null,appURL:null,getFriendList:function getFriendList(offset,limit,callback){if(!this.authInfo||!this.authInfo.userID){this.delayedGetFriendList=[offset,limit,callback];return;}if(offset+limit<FacebookUtils.fbInfoLists.length){return;}FB.api('/me/friends?offset='+offset+'&limit='+limit,{fields:'id, picture'},function(response){if(!response||response.error){console.log('fetch fb friend list failed',response.error.message,response.error);return;}var moreFriends=false;if(!!response.padding&&!!response.padding.next){moreFriends=true;}var fids=[];var len=response.data.length;for(var i=0;i<len;i++){var data=response.data[i];fids.push(data.id);FacebookUtils.fbInfoLists[data.id]={pic:data.picture.data.url};}if(fids.length<=0){return;}pomelo.request('lobby.facebookHandler.getBaseInfos',{fids:fids},function(moreFriends,res){if(res.result!=0||!!res.infoList&&res.infoList.length==0){return;}var length=res.infoList.length;for(var i=0;i<length;i++){var info=res.infoList[i];FacebookUtils.fbInfoLists[info.fid].db_id=info.db_id;FacebookUtils.fbInfoLists[info.fid].name=info.name;FacebookUtils.fbInfoLists[info.fid].level=info.level;FacebookUtils.fbArrayView.source.push(FacebookUtils.fbInfoLists[info.fid]);}FacebookUtils.fbArrayView.pending=moreFriends;FacebookUtils.fbArrayView.pended=false;FacebookUtils.fbArrayView.invalidate();}.bind(null,moreFriends));});},inviteFriend:function inviteFriend(callback){FB.ui({method:'apprequests',message:'Help me fight zombies!',max_recipients:50},function(response){});},showFriendInfo:function showFriendInfo(db_id){showPlayerInfo(db_id);},readyInit:function readyInit(){var timeouted=false;var timeout=0;if(!FacebookUtils.embeddedInCanvas){timeout=setTimeout(function(){FacebookUtils.doReady(null);timeouted=true;console.warn("=> Facebook init timeout");},5000);}var authStatusChangeCallback=function authStatusChangeCallback(response){FB.Event.unsubscribe('auth.statusChange',authStatusChangeCallback);if(timeouted){return;}clearTimeout(timeout);if(response.status=='connected'){console.log("=> Facebook connected");FacebookUtils.doReady(response.authResponse);var freindParams=FacebookUtils.delayedGetFriendList;if(freindParams){FacebookUtils.getFriendList(freindParams[0],freindParams[1],freindParams[2]);FacebookUtils.delayedGetFriendList=null;}if(FacebookUtils.embeddedInCanvas&&FacebookUtils.appURL==null){FB.api('/'+facebookConfig.appId,function(ret){FacebookUtils.appURL=ret.link;});}}else{console.warn("=> Facebook didn't connected ");if(FacebookUtils.embeddedInCanvas){FacebookUtils.loginFb();}else{FacebookUtils.doReady(null);}}};FB.Event.subscribe('auth.statusChange',authStatusChangeCallback);}};window.fbAsyncInit=function(){console.log("=> Facebook init ....");if(FacebookUtils.embeddedInCanvas||localStorage.getItem('fId')){FacebookUtils.readyInit();}FB.init(facebookConfig);};FacebookUtils.loadSdk();window.mapService=function(){var maxRetries=2;var mapCache={};var loadingCallbacks={};var retries={};var queue=[];var queuedCallbacks=[];function makeMapKey(id,version){return id+"."+version;}function invokeCallback(callback,mapKey){if(callback.length==0){return callback();}var data=mapCache[mapKey];if(typeof data=="string"){try{data=JSON.parse(data);}catch(error){console.warn("invalid map: ",mapKey,error,data);data=null;}mapCache[mapKey]=data;}return callback(data);}function doLoadMap(mapKey){var retried=retries.hasOwnProperty(mapKey);var url;if(!retried){url=window.mapPath+'/'+mapKey+'.json';}else{url=window.location.origin+'/map/'+mapKey+'.json';}F$ajax.get(url,function(res){var data=null;if(res.status>=400){if(!retried||retries[mapKey]!=0){if(!retried){retries[mapKey]=maxRetries;}else{retries[mapKey]--;}return doLoadMap(mapKey);}console.error("load map error:"+mapKey);}else{data=res.responseText;}mapCache[mapKey]=data;var callbacks=loadingCallbacks[mapKey];if(callbacks){for(var i=0,length=callbacks.length;i<length;i++){invokeCallback(callbacks[i],mapKey);}}delete loadingCallbacks[mapKey];});}function loadMap(id,version,callback){var mapKey=makeMapKey(id,version);if(typeof callback=="function"){if(mapCache.hasOwnProperty(mapKey)){return invokeCallback(callback,mapKey);}if(loadingCallbacks.hasOwnProperty(mapKey)){return loadingCallbacks[mapKey].push(callback);}loadingCallbacks[mapKey]=[callback];}doLoadMap(mapKey);}function loadQueuedMap(){if(queue.length==0){while(queuedCallbacks.length){var callback=queuedCallbacks.shift();callback&&callback();}return;}loadMap(queue.shift(),queue.shift(),loadQueuedMap);}function loadMaps(idVersions,callback){if(idVersions.length==0){console.warn("empty map list");return;}var idle=queue.length==0;queuedCallbacks.push(callback);Array.prototype.push.apply(queue,idVersions);if(idle){loadQueuedMap();}}return{loadMap:loadMap,loadMaps:loadMaps};}();window.gameCommandBuffer=function(){var waitingMapId=0;var waitingMapVersion=0;var buffer=[];function waitMap(id,version){buffer.length=0;waitingMapId=id;waitingMapVersion=version;}function tryBuffer(splitMsg,msg){if(waitingMapId==0||!Game.isIngameCommand(splitMsg[0])){return false;}buffer.push(splitMsg,msg);return true;}function flush(){if(buffer.length==0){waitingMapId=0;waitingMapVersion=0;return;}network.handleGameMsg(buffer.shift(),buffer.shift());setTimeout(flush,0);}return{waitMap:waitMap,tryBuffer:tryBuffer,flush:flush};}();function Field(x,y,p_mode){this.x=x;this.y=y;};Field.prototype.distanceTo=function(otherField){return otherField?Math.sqrt(Math.pow(this.x-otherField.x,2)+Math.pow(this.y-otherField.y,2)):999999;};Field.prototype.isSameGrid=function(otherField){return this.x==otherField.x&&this.y==otherField.y;};Field.prototype.vectorTo=function(otherField){return new Field(otherField.x-this.x,otherField.y-this.y);};Field.prototype.normalize=function(factor){var len=Math.sqrt(this.x*this.x+this.y*this.y);if(len==0)len=0.001;this.px*=factor/len;this.py*=factor/len;return this;};Field.prototype.getLen=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};Field.prototype.add=function(otherField){return new Field(this.x+otherField.x,this.y+otherField.y);};Field.prototype.add3=function(x,y){return new Field(this.x+x,this.y+y);};Field.prototype.mul=function(x,y){return new Field(this.x*x,this.y*y);};Field.prototype.addNormalizedVector=function(otherField,len){var x=otherField.x-this.x;var y=otherField.y-this.y;var len2=Math.sqrt(x*x+y*y);if(len2==0)len2=0.001;x*=len/len2;y*=len/len2;return new Field(this.x+x,this.y+y);};Field.prototype.add2=function(angle,len){return this.add(new Field(Math.cos(angle),Math.sin(angle)).normalize(len));};Field.prototype.getAngleTo=function(otherField){var returnValue=Math.atan((otherField.y-this.y)/(otherField.x-this.x));returnValue-=otherField.x-this.x<0?Math.PI:0;return returnValue;};Field.prototype.equals=function(otherField){return this.x==otherField.x&&this.y==otherField.y;};Field.prototype.toString=function(){return this.x+":"+this.y;};"use strict";var tmpPreload;function Game(map,editorMode){this.players=[];this.corpses=[];this.zombies=[];this.movableObjects=[];this.projectiles=[];this.grenades=[];this.objects=[];this.effects=[];this.floatingTexts=[];this.teleporters=[];this.cameraX=0;this.cameraY=0;this.cameraX2=0;this.cameraY2=0;this.redScreen=0;this.lastEmptyClipSound=-9999;this.targetX=0;this.targetY=0;this.mouseDowned=false;this.fire2Downed=false;this.mouseDownSent=false;this.fire2DownSent=false;this.ticksCounter=0;this.ctime=Date.now();this.playingPlayer=null;this.playingPlayerZombieKillStreak=0;this.playingPlayerAbilities=pl_abilities;this.playingPlayerIsZombie=false;this.playingPlayerID=-1;this.playingPlayerAmmo=[];this.playingPlayerClips=[];this.lastTimeMousePosSent=-999;this.noShootUntil=-999;this.lastPickUp=-999;this.lastAbilityUses=[-9999,-9999,-9999];this.targetLockedPlayer=null;this.switchWeaponSound=null;this.playingPlayerEnergy=CONST.START_ENERGY;this.playingPlayerCountActiveHeatseeking2Missiles=0;this.flashedFrom=-9999;this.flashBonusFactor=1;this.showEnemiesOnMinimapUntil=-999;this.map=map;this.mapWelcome=map==map1;this.benchmark=false;this.benchmarkInfo={count:0,time:0};this.isLowGraphicEffect=window.graphicSettings<1;this.isEffectFairy=true;this.type=MAP_TYPE_SETTINGS[map.type]?MAP_TYPE_SETTINGS[map.type]:MAP_TYPE_SETTINGS[0];this.interface_=new Interface(map);this.groundMinX=0;this.groundMaxX=this.map.x;this.groundMinY=0;this.groundMaxY=this.map.y;this.turnBoss=false;this.fpsAvg=0;this.fpsAvgTs=0;this.fpsFresh=[];this.fpsCount=0;this.fpsTs=0;this.fpsLog={};this.fps=0;this.ping=0;this.pingAvg=0;this.pingNext=0;this.pingInc=0;this.pingTs=0;this.pingLog={};this.pingShow=false;this.isBattle=true;this.editingMode=editorMode;this.objectsToDraw=[];this.tilesCashes=[];this.groundCanvas=[];this.initMap(map);this.createGroundCanvas();this.generateTilesCanvasses();for(var i=0;i<this.tiles.length;i++){if(this.tiles[i].type.blockVision)this.createVisionTile(this.tiles[i]);}this.fairies=[];this.lastCursorStr="";KeyManager.activeAbility=null;this.camFlyX=0;this.camFlyY=0;this.torches=[];for(var i=0;i<this.tiles.length;i++){if(this.tiles[i].type.isTorch)this.torches.push({x:this.tiles[i].x,y:this.tiles[i].y,nextEmit:-9999,offsetX:this.tiles[i].type.flameOffsetX?this.tiles[i].type.flameOffsetX:0,offsetY:this.tiles[i].type.flameOffsetY?this.tiles[i].type.flameOffsetY:0});}this.whiteCircles=[];this.rumbleUntil=0;this.rumblePower=0;this.createBlockArray();this.editor=null;this.replayMode=false;this.replayIndex=0;this.spawningPoints=map.spawningPoints?map.spawningPoints:[];this.spawningPointsRed=map.spawningPointsRed?map.spawningPointsRed:[];this.spawningPointsBlue=map.spawningPointsBlue?map.spawningPointsBlue:[];this.waypoints=map.waypoints?map.waypoints:[];this.redFlag=null;this.blueFlag=null;this.scoreTeam1=0;this.scoreTeam2=0;this.roundTime=0;this.specX=map.x/2-WIDTH/2/FIELD_SIZE;this.specY=map.y/2-HEIGHT/2/FIELD_SIZE;this.specPlayer=null;this.iAmSpec=false;if(!this.editingMode&&!this.mapWelcome){var miniMap=F$('miniMap');miniMap.show(this);this.miniMap=miniMap;}else{var _map=F$('miniMap');if(_map){_map.hide();}this.miniMap=null;}SCALE_CONST=0.06;resize();this.interface_.killAllMsgs();if(!this.mapWelcome&&!editorMode)this.interface_.addMsg("["+slayOne.widgets.lang.get("game.msg.chat.tip")+"]","#8CD882");this.victoryMsg="";this.victoyMshColor="grey";window.replayOptionsIndex=3;window.replayOption=window.replayOptions[window.replayOptionsIndex];this.fastForward=false;this.setNextMaps({});this.updList={wC:2,bZ:7,trn:2,js:3,pa:3,cZ:1,rp:5,p2u:3,o2u:2,nF:3,stu:2,hpU:2,blk:4,blP:5,tB:1,ptz:1,pptz:1,zph:3,blO:5,ab:2,ab2:2,luP:1,rl:1,rl2:4,att:3,abc:3};};Game.isIngameCommand=function(){var ingameCommands=["upd","nP","nZ","pid","pL","proD","hp","hpO","pro","nO","proM","grn","rl2","rsp","next-maps","beam1","beam2"];return function(command){return ingameCommands.indexOf(command)>=0||command.indexOf("chat")>=0;};}();Game.prototype.mouseDown=function(){this.mouseDowned=true;if(!this.playingPlayer||!this.playingPlayer.isShootable()){return;}this._mouseDown();};Game.prototype.fire2Down=function(){this.fire2Downed=true;if(!this.playingPlayer||!this.playingPlayer.isShootable()){return;}this._fire2Down();};Game.prototype._mouseDown=function(){this.targetX=getMouseGamePlayX();this.targetY=getMouseGamePlayY();network.send("md$"+this.targetX+"$"+this.targetY+(this.targetLockedPlayer?"$"+this.targetLockedPlayer.id:""));this.mouseDownSent=true;};Game.prototype._fire2Down=function(){this.targetX=getMouseGamePlayX();this.targetY=getMouseGamePlayY();network.send("f2d$"+this.targetX+"$"+this.targetY+(this.targetLockedPlayer?"$"+this.targetLockedPlayer.id:""));this.fire2DownSent=true;};Game.prototype.mouseUp=function(){this.mouseDowned=false;if(this.mouseDownSent){network.send("mu");this.mouseDownSent=false;}};Game.prototype.fire2Up=function(){this.fire2Downed=false;if(this.fire2DownSent){network.send("f2u");this.fire2DownSent=false;}};Game.prototype.mouseUpdate=function(){var x=getMouseGamePlayX();var y=getMouseGamePlayY();if(!floatEqual(this.targetX,x)||!floatEqual(this.targetY,y)){this.targetX=x;this.targetY=y;network.send("mp$"+x+"$"+y+(this.targetLockedPlayer?"$"+this.targetLockedPlayer.id:""));}};Game.prototype.refreshStatsTable=function(){var str="";if(this.type.coopZombieMode){str='<table id="statsTable1" data-noclick="yes"><tr class="statsDivTitleTR"><td class="minW150">'+slayOne.widgets.lang.get("game.stats.name.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.clan.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_kills.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_death.label")+'</td>';if(this.type.souls)str+='<td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_souls.label")+'</td>';str+='<td></td></tr><tr id="team1header"><td>'+slayOne.widgets.lang.get("game.stats.humans.name")+'</td><td></td><td></td><td id="team1kills">0</td>'+(this.type.souls?'<td></td>':'')+'<td></td></tr></table>';str+='<table id="statsTable2" data-noclick="yes"><tr class="statsDivTitleTR"><td class="minW150">'+slayOne.widgets.lang.get("game.stats.name.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.clan.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_kills.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_death.label")+'</td>';if(this.type.souls)str+='<td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_souls.label")+'</td>';str+='<td></td></tr><tr id="team2header"><td>'+slayOne.widgets.lang.get("game.stats.zombies.name")+'</td><td></td><td></td><td id="team2kills">0</td>'+(this.type.souls?'<td></td>':'')+'<td></td></tr></table>';}else if(this.type.team){str='<table id="statsTable1" data-noclick="yes"><tr class="statsDivTitleTR"><td class="minW150">'+slayOne.widgets.lang.get("game.stats.name.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.clan.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_kill.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_death.label")+'</td>';if(this.type.souls)str+='<td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_souls.label")+'</td>';str+='<td></td></tr><tr id="team1header"><td>'+slayOne.widgets.lang.get("game.stats.team1.name")+'</td><td></td><td></td><td id="team1kills">0</td>'+(this.type.souls?'<td></td>':'')+'<td></td></tr></table>';str+='<table id="statsTable2" data-noclick="yes"><tr class="statsDivTitleTR"><td class="minW150">'+slayOne.widgets.lang.get("game.stats.name.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.clan.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_kill.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_death.label")+'</td>';if(this.type.souls)str+='<td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_souls.label")+'</td>';str+='<td></td></tr><tr id="team2header"><td>'+slayOne.widgets.lang.get("game.stats.team2.name")+'</td><td></td><td></td><td id="team2kills">0</td>'+(this.type.souls?'<td></td>':'')+'<td></td></tr></table>';}else{str='<table id="statsTable1" data-noclick="yes"><tr class="statsDivTitleTR"><td class="minW150">'+slayOne.widgets.lang.get("game.stats.name.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.clan.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_kill.label")+'</td><td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_death.label")+'</td>';if(this.type.souls)str+='<td class="minW80">'+slayOne.widgets.lang.get("game.stats.num_souls.label")+'</td>';if(this.type.ingameElo)str+='<td class="minW80">'+'Score'+'</td>';str+='<td></td></tr></table>';}document.getElementById("statsDiv").innerHTML=str;};Game.prototype.playerSortHandler=function(p1,p2){var key=game.type.winningCondition||"souls";return p2[key]-p1[key]||p2.score-p1.score||(p2.id==game.playingPlayerID)-(p1.id==game.playingPlayerID);};Game.prototype.refreshUIs=function(){if(this.type.team&&this.type.souls){this.scoreTeam1=0;this.scoreTeam2=0;for(var i=0;i<this.players.length;i++){if(this.players[i].team==1)this.scoreTeam1+=this.players[i].souls;else if(this.players[i].team==2)this.scoreTeam2+=this.players[i].souls;}F$("rankInGame").refreshTeamScore();}F$("rankInGame").refreshRank();var myRank=this.interface_.refreshTop3();if(myRank>0){game.myRank=myRank;}};Game.prototype.createDefaultBorder=function(){var default_=[2,3,4,5];for(var x=-1;x<=this.map.x;x++){this.tiles.push(createTile({x:x,y:-1,id:default_[Math.floor(Math.random()*default_.length)]}));}default_=[6,7,8,9];for(var y=0;y<=this.map.y;y++){this.tiles.push(createTile({x:-1,y:y,id:default_[Math.floor(Math.random()*default_.length)]}));}default_=[10,11,12,13];for(var y=0;y<=this.map.y;y++){this.tiles.push(createTile({x:this.map.x,y:y,id:default_[Math.floor(Math.random()*default_.length)]}));}default_=[14,15,16,17];for(var x=-1;x<=this.map.x;x++){this.tiles.push(createTile({x:x,y:this.map.y,id:default_[Math.floor(Math.random()*default_.length)]}));}};Game.prototype.createBlockArray=function(x,y){this.walkways=[];this.pathingArray=[];this.shiftArray=[];this.bushArray=[];for(var x=0;x<this.map.x;x++){this.pathingArray[x]=[];this.shiftArray[x]=[];this.bushArray[x]=[];for(var y=0;y<this.map.y;y++){this.pathingArray[x][y]=10;this.shiftArray[x][y]=[0,0];this.bushArray[x][y]=false;}}for(var i=0;i<this.tiles.length;i++){var tile=this.tiles[i];var type=tile.type;if(type&&!type.movable){if(type.pathing<10)for(var x=0;x<type.w;x++){for(var y=0;y<type.h;y++){if(tile.x>=0&&tile.x<=this.map.x&&tile.y>=0&&tile.y<=this.map.y&&this.pathingArray[x+tile.x])this.pathingArray[x+tile.x][y+tile.y]=type.pathing;}}if(type.shiftX||type.shiftY){if(type.shiftX&&this.shiftArray[tile.x]&&this.shiftArray[tile.x][tile.y])this.shiftArray[tile.x][tile.y][0]=type.shiftX;if(type.shiftY&&this.shiftArray[tile.x]&&this.shiftArray[tile.x][tile.y])this.shiftArray[tile.x][tile.y][1]=type.shiftY;this.walkways.push({x:tile.x,y:tile.y,shiftX:tile.shiftX,shiftY:tile.shiftY,type:type});}}if(type&&type.blockVision)this.bushArray[tile.x][tile.y]=true;}for(var i=0;i<this.groundTiles.length;i++){var tile=this.groundTiles[i];var type=tile.type;if(type){if(tile.x>=0&&tile.x<=this.map.x&&tile.y>=0&&tile.y<=this.map.y&&type.pathing&&type.pathing<10&&this.pathingArray[tile.x])this.pathingArray[tile.x][tile.y]=type.pathing;if(type.shiftX||type.shiftY){if(type.shiftX&&this.shiftArray[tile.x]&&this.shiftArray[tile.x][tile.y])this.shiftArray[tile.x][tile.y][0]=type.shiftX;if(type.shiftY&&this.shiftArray[tile.x]&&this.shiftArray[tile.x][tile.y])this.shiftArray[tile.x][tile.y][1]=type.shiftY;this.walkways.push({x:tile.x,y:tile.y,shiftX:tile.shiftX,shiftY:tile.shiftY,type:type});}if(type.isTeleporter&&this.pathingArray[tile.x]&&this.pathingArray[tile.x][tile.y])this.pathingArray[tile.x][tile.y]=11;}}};Game.prototype.startEditingMode=function(){this.editingMode=true;this.editor=new Editor();};Game.prototype.addCircle=function(x,y,img){this.whiteCircles.push({x:x,y:y,time:this.ticksCounter,img:img});};Game.prototype.getFieldPath=function(x,y){return this.pathingArray[x]?this.pathingArray[x][y]?this.pathingArray[x][y]:0:0;};Game.prototype.getHeight=function(x,y){var block=this.getFieldPath(x,y);var blockHeight=0;if(block<5)blockHeight=9999;else if(block==5)blockHeight=0.6;else if(block==9)blockHeight=0.6;else if(block<10)blockHeight=0.2;return blockHeight;};Game.prototype.getHeight2=function(x,y){var block=this.getFieldPath(x,y);var blockHeight=0;if(block<5)blockHeight=9999;else if(block==5)blockHeight=0.6;else if(block==9)blockHeight=0;else if(block<10)blockHeight=0.2;return blockHeight;};Game.prototype.getHeight3=function(x,y){var block=this.getFieldPath(x,y);var blockHeight=0;if(block<5)blockHeight=9999;else if(block==5)blockHeight=0.6;else if(block==9)blockHeight=9999;else if(block<10)blockHeight=0.2;return blockHeight;};Game.prototype.raytrace=function(fromX,fromY,toX,toY){var vecX=toX-fromX;var vecY=toY-fromY;var dist=Math.sqrt(Math.pow(toX-fromX,2)+Math.pow(toY-fromY,2));var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=0.25/len;vecY*=0.25/len;fromX+=vecX*3;fromY+=vecY*3;dist-=0.75;while(dist>0.75){if(this.getFieldPath(Math.floor(fromX),Math.floor(fromY))<=5)return false;fromX+=vecX;fromY+=vecY;dist-=0.25;}return true;};Game.prototype.reload2=function(data){this.playingPlayerAmmo[data[1]]=parseInt(data[3]);this.playingPlayerClips[data[1]]=parseInt(data[2]);};Game.prototype.generateTilesCanvasses=function(){var min=-1;var max=this.map.y;var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=this.tiles[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var tile=_step7.value;if(!tile.ground&&(!tile.type.movable||this.editingMode)&&!tile.blockVision){var y_=tile.y+tile.type.h-1;min=Math.min(min,y_);max=Math.max(max,y_);}}}catch(err){_didIteratorError7=true;_iteratorError7=err;}finally{try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return();}}finally{if(_didIteratorError7){throw _iteratorError7;}}}for(var y=min;y<=max;y++){this.refreshBlockingTilesCanvas(y);}};Game.prototype.createVisionTile=function(tile){var obj={y_:tile.y,y2_:tile.y+0.5,x_:tile.x,x2_:tile.x+0.5,tile:tile,img:tile.type.img,getYDrawingOffset:function getYDrawingOffset(){return this.y_;},draw:function draw(exactTicks,x1,y1,x2,y2){if(y1<this.y_+2&&y2>this.y_-3&&x1<this.x_+2&&x2>this.x_-2){c.globalAlpha=game.playingPlayer&&game.bushArray[Math.floor(game.playingPlayer.x)]&&game.bushArray[Math.floor(game.playingPlayer.x)][Math.floor(game.playingPlayer.y)]&&Math.sqrt(Math.pow(this.x2_-game.playingPlayer.x,2)+Math.pow(this.y2_-game.playingPlayer.y,2))<=CONST.BUSH_VISION_RANGE?0.4:1;c.drawImage(imgs.tileSheet,this.img.x,this.img.y,this.img.w,this.img.h,(this.x_-x1)*FIELD_SIZE,(this.y_-y1+1)*FIELD_SIZE-this.img.h*SCALE_FACTOR,this.img.w*SCALE_FACTOR,this.img.h*SCALE_FACTOR);c.globalAlpha=1;}}};this.addToObjectsToDraw(obj);};Game.prototype.refreshBlockingTilesCanvas=function(y){var tiles=[];var maxHeight=1;var frames=1;for(var i=0;i<this.tiles.length;i++){if(!this.tiles[i].ground&&(!this.tiles[i].type.movable||this.editingMode)&&!this.tiles[i].type.blockVision){var tile=this.tiles[i];var tileType=tile.type;if(tile.y+tileType.h-1==y){tiles.push(tile);maxHeight=Math.max(maxHeight,tileType.img.h);if(tileType.img2)frames=2;}}}tiles=sortBy(tiles,function(tile){return tile.x;});var obj=null;if(this.tilesCashes[y])this.objectsToDraw.erease(this.tilesCashes[y]);obj={y_:y,getYDrawingOffset:function getYDrawingOffset(){return this.y_;},draw:function draw(exactTicks,x1,y1,x2,y2){var canv=this["canvas"+(Math.floor(exactTicks/10)%2+1)];if(!canv){canv=this.canvas1;}if(y1<this.y_+2&&y2>this.y_-3&&canv.height>1){c.drawImage(canv,-(x1+12)*FIELD_SIZE,(this.y_+1-y1+4/16)*FIELD_SIZE-canv.height*SCALE_FACTOR,canv.width*SCALE_FACTOR,canv.height*SCALE_FACTOR);}}};this.tilesCashes[y]=obj;this.addToObjectsToDraw(obj);for(var k=1;k<=frames;k++){var canvas=document.createElement('canvas');var ctx=canvas.getContext("2d");canvas.width=(this.map.x+24)*16;canvas.height=maxHeight;for(var i=0;i<tiles.length;i++){var tile=tiles[i];var tileType=tile.type;var img=tileType["img"+k]?tileType["img"+k]:tileType.img;var x_=Math.floor((tile.x+12)*16+(tileType.w*16-img.w)/2);var y_=Math.floor(maxHeight-img.h);ctx.drawImage(imgs.tileSheet,img.x,img.y,img.w,img.h,x_,y_,img.w,img.h);}obj["canvas"+k]=canvas;}};Game.prototype.addToObjectsToDraw=function(o){this.objectsToDraw.push(o);};Game.prototype.createGroundCanvas=function(){var frames=1;this.groundMinX=-16;this.groundMaxX=this.map.x+16;this.groundMinY=-10;this.groundMaxY=this.map.y+10;for(var i=0;i<this.groundTiles.length;i++){var tile=this.groundTiles[i];if(tile.type.img2)frames=2;}this.groundCanvas=[];for(var k=1;k<=frames;k++){var canv=document.createElement("canvas");this.groundCanvas.push(canv);canv.width=16*(this.groundMaxX-this.groundMinX);canv.height=16*(this.groundMaxY-this.groundMinY);if(tileTypes[this.map.defaultTiles])for(var x=0;x<this.map.x*16;x+=16){for(var y=0;y<this.map.y*16;y+=16){var tile=tileTypes[this.map.defaultTiles];canv.getContext("2d").drawImage(imgs.tileSheet,tile.img.x,tile.img.y,tile.img.w,tile.img.h,x-this.groundMinX*16,y-this.groundMinY*16,16,16);}}if(tileTypes[this.map.defaultTilesOutter])for(var x=0;x<canv.width;x+=16){for(var y=0;y<canv.height;y+=16){if(x<-this.groundMinX||x>-this.groundMinX+this.map.x||y<-this.groundMinY||y>-this.groundMinY+this.map.y){var tile=tileTypes[this.map.defaultTilesOutter];canv.getContext("2d").drawImage(imgs.tileSheet,tile.img.x,tile.img.y,tile.img.w,tile.img.h,x,y,16,16);}}}for(var i=0;i<this.groundTiles.length;i++){var tile=this.groundTiles[i].type;var img=tile["img"+k];if(!img)img=tile.img;var x=tile.w*8-img.w/2;var y=tile.h*8-img.h/2;canv.getContext("2d").drawImage(imgs.tileSheet,img.x,img.y,img.w,img.h,(this.groundTiles[i].x-this.groundMinX)*16+x,(this.groundTiles[i].y-this.groundMinY)*16+y,img.w,img.h);}}};Game.prototype.getObjectFromID=function(id){for(var k=0;k<this.objects.length;k++){if(this.objects[k].id==id)return this.objects[k];}return null;};Game.prototype.getPlayerFromID=function(id){for(var k=0;k<this.players.length;k++){if(this.players[k].id==id)return this.players[k];}for(var k=0;k<this.zombies.length;k++){if(this.zombies[k].id==id)return this.zombies[k];}for(var k=0;k<this.movableObjects.length;k++){if(this.movableObjects[k].id==id)return this.movableObjects[k];}for(var k=0;k<this.corpses.length;k++){if(this.corpses[k].id==id)return this.corpses[k];}return null;};Game.prototype.resetPlayingPlayerStats=function(){if(this.playingPlayer)for(var i=0;i<20;i++){this.playingPlayer.weaponCooldowns[i]=0;this.playingPlayerAmmo[i]=weapons[i]&&weapons[i].ammoSize?0:99999999;this.playingPlayerClips[i]=weapons[i]&&weapons[i].ammoSize?0:99999999;}this.cureTick=0;this.playingPlayerZombieKillStreak=0;this.playingPlayerEnergy=CONST.START_ENERGY;this.playingPlayerCountActiveHeatseeking2Missiles=0;KeyManager.activeAbility=null;this.showEnemiesOnMinimapUntil=-999;this.lastAbilityUses=[-9999,-9999,-9999];this.noShootUntil=-999;};Game.prototype.init=function(d,str){Skin.close();CustomBuild.close();this.id=parseInt(d[1]);this.mapId=parseInt(d[2]);this.mapVersion=parseInt(d[3]);this.mode=parseInt(d[4]);this.type=MAP_TYPE_SETTINGS[this.mode];this.roundTime=parseInt(d[5]);this.ticksCounter=parseInt(d[6]);this.scoreTeam1=parseInt(d[7]);this.scoreTeam2=parseInt(d[8]);this.tag=d[15];this.fpsAvg=0;this.fpsAvgTs=7+Date.now()/1000|0;this.pingShow=false;this.isBattle=true;var ammo=[];if(this.map.ammo)for(var k=0;k<this.map.ammo.length;k++){ammo[k]=new Ammo(this.map.ammo[k].weapon,this.map.ammo[k].x+0.5,this.map.ammo[k].y+0.5,k);if(ammo[k].itemType&&ammo[k].itemType.special=="redFlag"){this.redFlag=ammo[k];this.redFlag.currentX=parseFloat(d[9]);this.redFlag.currentY=parseFloat(d[10]);}if(ammo[k].itemType&&ammo[k].itemType.special=="blueFlag"){this.blueFlag=ammo[k];this.blueFlag.currentX=parseFloat(d[11]);this.blueFlag.currentY=parseFloat(d[12]);}this.addToObjectsToDraw(ammo[k]);}var splitMsg=str.split("$%split%");if(splitMsg.length==1)splitMsg=str.split("%split%");if(splitMsg[6]){var corpses=splitMsg[6].split("$");for(var i=1;i<corpses.length;i+=3){var x=corpses[i]/CONST.TRANSMUL;var y=corpses[i+1]/CONST.TRANSMUL;this.addCorpses(new Corpse(corpses[i+2],x,y,0,false,Math.random()>0.5?1:0));}}this.initPreload();var itms=splitMsg[2].split("$");for(var i=1;i<itms.length;i+=2){for(var k=0;k<ammo.length;k++){if(ammo[k].id==itms[i]){ammo[k].isActive=false;ammo[k].respawnAt=this.ticksCounter+parseInt(itms[i+1])-2;k=ammo.length;}}}var obs=splitMsg[3].split("$");for(var i=1;i<obs.length;i+=10){this.objects.push(new Object_(obs[i],this.getPlayerFromID(obs[i+4]),abilities[obs[i+3]],obs[i+1],obs[i+2],obs[i+5],obs[i+6],obs[i+7],obs[i+8],obs[i+9]));}if(splitMsg[5]){var mobs=splitMsg[5].split("$");for(var i=1;i<mobs.length;i+=7){var x=mobs[i+1]/CONST.TRANSMUL;var y=mobs[i+2]/CONST.TRANSMUL;var x0=mobs[i+3]/CONST.TRANSMUL;var y0=mobs[i+4]/CONST.TRANSMUL;var hp=parseFloat(mobs[i+6]);this.movableObjects.push(new MovableObject(mobs[i],x,y,x0,y0,tileTypes[mobs[i+5]],hp));}}if(splitMsg[7]){this.voterId=splitMsg[7];}if(!this.replayMode){F$('rankInGame').show();}if(d[13]!=-1){this.redFlag.carriedBy=this.getPlayerFromID(d[13]);this.redFlag.isActive=false;}if(d[14]!=-1){this.blueFlag.carriedBy=this.getPlayerFromID(d[14]);this.blueFlag.isActive=false;}var time=Date.now();if(preStore.pid&&preStore.pid.time+5000>time)this.setPlayingPlayerID(preStore.pid.value);for(var i=0;preStore.newPlayers.length;i++){if(preStore.newPlayers[i].time+5000>time)this.newPlayer(preStore.newPlayers[i].value);}for(var i=0;preStore.newZombies.length;i++){if(preStore.newZombies[i].time+5000>time)this.newZombie(preStore.newZombies[i].value);}preStore={newPlayers:[],newZombies:[],pid:null};this.refreshUIs();};Game.prototype.emote=function(splitMsg){var p=this.getPlayerFromID(splitMsg[1]);if(p&&emotes[splitMsg[2]])p.emote(emotes[splitMsg[2]]);};Game.prototype.playingPlayerIsNotStunned=function(){return this.playingPlayer&&this.playingPlayer.bouncePoints.length==0;};Game.prototype.getGrenadeOrProjectileById=function(id){for(var i=0;i<this.projectiles.length;i++){if(this.projectiles[i].id==id)return this.projectiles[i];}for(var i=0;i<this.grenades.length;i++){if(this.grenades[i].id==id)return this.grenades[i];}return null;};Game.prototype.getNextFreeField=function(x,y,max,x0,y0){x=Math.floor(x);y=Math.floor(y);for(var i=0;i<nbs.length;i++){var x_=x+nbs[i].x;var y_=y+nbs[i].y;if(this.getFieldPath(x_,y_)==10&&(!max||Math.sqrt(Math.pow(x_+0.5-x0,2)+Math.pow(y_+0.5-y0,2))<=max))return{x:x_+0.5,y:y_+0.5};}return null;};Game.prototype.receiveUpdate=function(data){var mode="normal";var step=5;var ticksCounter=this.ticksCounter<0?this.roundTime:this.ticksCounter;var now=Date.now();if(!this.lastSecondTime||now-this.lastSecondTime>1000){this.tps=ticksCounter-this.lastSecondCounter;this.lastSecondCounter=ticksCounter;this.lastSecondTime=now;}if(this.ticksCounter==-1&&this.isTutorial()){this.interface_.setMainKillMsg(F_("game.die"),"#36FF36","textInGreen");}if(window.leavingGame){var secondsLeft=Math.max(Math.floor((window.leaveGameLeftTicks-this.ticksCounter)/20+5.9),0);slayOne.viewHelpers.getFloatTip(window.leaveGameFloatTip).setContent(slayOne.widgets.lang.get("msg.leave_game",{seconds:secondsLeft}));}var modeList=[];var modeListUp=false;for(var i=2,j=data.length;i<j;i+=step){var row=data[i];if(!Number.isInteger(row)&&this.updList[row]){i++;mode=row;step=this.updList[row];}if(GameUpdateMode[mode]){GameUpdateMode[mode](this,data[i],data,i);}}if(modeListUp){console.log('mode',modeList);}if(this.ticksCounter>=0){this.drawFilter('projectiles',true);this.drawFilter('grenades',true);this.drawFilter('effects',true);this.drawFilter('floatingTexts');var playerChanged=false;var _this=this;this.drawFilter('players',function(row){_this.objectsToDraw.erease(row);playerChanged=true;});this.drawFilter('corpses',ticksCounter,true);if(playerChanged){this.refreshUIs();}this.drawFilter('zombies',true);this.drawFilter('movableObjects',true);this.drawFilter('objects',function(row){row.die();});var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=this.objectsToDraw[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var o=_step8.value;if(!o.isActive&&o.isAmmo&&o.respawnAt<=this.ticksCounter&&!o.carriedBy){o.isActive=true;o.createSpawnEffect();}}}catch(err){_didIteratorError8=true;_iteratorError8=err;}finally{try{if(!_iteratorNormalCompletion8&&_iterator8.return){_iterator8.return();}}finally{if(_didIteratorError8){throw _iteratorError8;}}}if(this.ticksCounter%20==17){var th=this.type.humans_souls_per_sec;var tz=this.type.zombies_souls_per_sec;if(th||tz){var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=this.players[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var p=_step9.value;if(p.dieAt){continue;}p.setSouls(p.souls+(p.isHumanZombie?th:tz));}}catch(err){_didIteratorError9=true;_iteratorError9=err;}finally{try{if(!_iteratorNormalCompletion9&&_iterator9.return){_iterator9.return();}}finally{if(_didIteratorError9){throw _iteratorError9;}}}}}}if(!this.fastForward){this.sortObjectsToDraw();}if(this.ticksCounter>=0){if(!this.fastForward){this.torchesEmitFire();this.teleporterPillars();this.updateFairies(ticksCounter);}if(this.playingPlayer){this.playingPlayerEnergy=Math.min(this.playingPlayerEnergy+this.playingPlayer.energyRegeneration+CONST.ENERGY_REG_RATE,100);if(this.playingPlayer.isInvisible){this.playingPlayerEnergy=Math.max(this.playingPlayerEnergy+this.playingPlayer.invisEnergyRate,0);}if(this.mouseDowned&&!this.mouseDownSent&&this.playingPlayer.isShootable()){this._mouseDown();}if(this.fire2Downed&&!this.fire2DownSent&&this.playingPlayer.isShootable()){this._fire2Down();}}}this.ticksCounter=data[1]!==undefined?parseInt(data[1]):this.ticksCounter+1;if(this.roundTime>0&&this.ticksCounter==this.roundTime){this.roundEnd();}if(this.ticksCounter==-1){}else{lastUpdate=Date.now();}};Game.prototype.sortObjectsToDraw=function(){this.objectsToDraw.sort(function(a,b){var ya=a.getYDrawingOffset();var yb=b.getYDrawingOffset();if(ya!=ya){ya=-10;}if(yb!=yb){yb=-10;}if(ya===yb){return 0;}return ya>yb?1:-1;});};Game.prototype.initMap=function(map){this.tiles=[];var _iteratorNormalCompletion10=true;var _didIteratorError10=false;var _iteratorError10=undefined;try{for(var _iterator10=map.tiles[Symbol.iterator](),_step10;!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=true){var row=_step10.value;var tile=createTile(row);this.tiles.push(tile);if(tile.type.isTeleporter){this.teleporters.push({x:tile.x+0.5,y:tile.y+0.5});}}}catch(err){_didIteratorError10=true;_iteratorError10=err;}finally{try{if(!_iteratorNormalCompletion10&&_iterator10.return){_iterator10.return();}}finally{if(_didIteratorError10){throw _iteratorError10;}}}this.groundTiles=[];var _iteratorNormalCompletion11=true;var _didIteratorError11=false;var _iteratorError11=undefined;try{for(var _iterator11=map.groundTiles[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=true){var row=_step11.value;var tile=createTile(row);this.groundTiles.push(tile);if(tile.type.isTeleporter){this.teleporters.push({x:tile.x+0.5,y:tile.y+0.5});}}}catch(err){_didIteratorError11=true;_iteratorError11=err;}finally{try{if(!_iteratorNormalCompletion11&&_iterator11.return){_iterator11.return();}}finally{if(_didIteratorError11){throw _iteratorError11;}}}if(!map.noBorder){this.createDefaultBorder();}this.noGridTiles=[];if(map.noGridTiles){var _iteratorNormalCompletion12=true;var _didIteratorError12=false;var _iteratorError12=undefined;try{for(var _iterator12=map.noGridTiles[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=true){var row=_step12.value;var tile=createTile(row);new Tile(tile.x,tile.y,tile.type,this);}}catch(err){_didIteratorError12=true;_iteratorError12=err;}finally{try{if(!_iteratorNormalCompletion12&&_iterator12.return){_iterator12.return();}}finally{if(_didIteratorError12){throw _iteratorError12;}}}}};Game.prototype.torchesEmitFire=function(){var _this2=this;if(this.isLowGraphicEffect){return;}var _iteratorNormalCompletion13=true;var _didIteratorError13=false;var _iteratorError13=undefined;try{for(var _iterator13=this.torches[Symbol.iterator](),_step13;!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=true){var t=_step13.value;if(this.ticksCounter==1){new Sprite({x:t.x+0.5+t.offsetX,y:t.y+0.3+t.offsetY,img:imgCoords.fire4,scaleFunction:function scaleFunction(){return 1+Math.sin(_this2.ticksCounter*0.4)*0.1;},age:99999999,xFunction:function xFunction(){return Math.sin(_this2.ticksCounter*0.5)*0.02;},yFunction:function yFunction(){return Math.sin(_this2.ticksCounter*0.7324)*0.0223;},zFunction:function zFunction(){return 1.1;}});}if(t.x+5>=this.cameraX&&t.y+5>=this.cameraY&&t.x-5<=this.cameraX2&&t.y-5<=this.cameraY2){if(Math.random()<0.02)new Flare(t.x+0.5+t.offsetX,t.y+t.offsetY,1.2);if(t.nextEmit<=this.ticksCounter){t.nextEmit=this.ticksCounter+graphics[graphicSettings].torchEmitTime+Math.floor(Math.random()*2);new Sprite({x:t.x+0.5+Math.random()*0.2-0.1+t.offsetX,y:t.y+0.3+Math.random()*0.2+t.offsetY,img:imgCoords["fire"+(Math.floor(Math.random()*2)+2)],scaleFunction:function scaleFunction(age){return-1*(1/((age*0.9-125)/500+0.31)+age/4)+16.9;},age:Math.random()*10+35,zFunction:function zFunction(age){return 1.1+age*0.02;}});new Sprite({x:t.x+0.5+Math.random()*0.2-0.1+t.offsetX,y:t.y+Math.random()*0.2+t.offsetY,img:imgCoords.light_yellow,scaleFunction:function scaleFunction(age){return(-1*(1/((age*0.9-125)/500+0.31)+age/4)+16.9)*4.3;},alphaFunction:function alphaFunction(age){return Math.max((-1*(1/((age*0.9-125)/500+0.31)+age/4)+16.9)*3.7,0)*0.012;},age:Math.random()*10+35,zFunction:function zFunction(age){return 0.8+age*0.02;}});}}}}catch(err){_didIteratorError13=true;_iteratorError13=err;}finally{try{if(!_iteratorNormalCompletion13&&_iterator13.return){_iterator13.return();}}finally{if(_didIteratorError13){throw _iteratorError13;}}}};Game.prototype.updateFairies=function(ticksCounter){if(this.isLowGraphicEffect){return;}for(var i=this.fairies.length-1;i>=0;i--){if(!this.fairies[i].update(ticksCounter)){this.fairies.splice(i,1);}}var countFairies=this.map.x*this.map.y/9;while(this.fairies.length<countFairies){this.fairies.push(new Fairy(Math.random()*this.map.x,Math.random()*this.map.y));}};Game.prototype.teleporterPillars=function(){if(this.ticksCounter%3==1)for(var k=0;k<this.teleporters.length;k++){var t=this.teleporters[k];if(t.x+3>=this.cameraX&&t.y+3>=this.cameraY&&t.x-3<=this.cameraX2&&t.y-3<=this.cameraY2){var randomAngle=Math.random()*Math.PI*2;var rand=Math.random()*0.7;new Sprite({x:t.x+Math.cos(randomAngle)*rand,y:t.y-0.3+Math.sin(randomAngle)*rand,z:Math.random(),img:imgCoords.particleWhite,scaleFunction:function scaleFunction(age){return this.scale_;},scale_:Math.random()*2+2,z_:0.04+Math.random()*0.05,zFunction:function zFunction(age){return age*this.z_;},alphaFunction:function alphaFunction(age){return Math.min(age*0.1,0.7,this.ticksLeft*0.05);},age:26});}}if(this.ticksCounter%8==1)for(var k=0;k<this.teleporters.length;k++){var t=this.teleporters[k];if(t.x+3>=this.cameraX&&t.y+3>=this.cameraY&&t.x-3<=this.cameraX2&&t.y-3<=this.cameraY2){var randomAngle=Math.random()*Math.PI*2;var rand=Math.random()*0.7;new Sprite({x:t.x+Math.cos(randomAngle)*rand*0.3,y:t.y-0.3+Math.sin(randomAngle)*rand*0.3,z:Math.random(),img:imgCoords.particlePurple,scaleFunction:function scaleFunction(age){return this.scale_;},scale_:Math.random()*2+2,z_:0.04+Math.random()*0.05,zFunction:function zFunction(age){return age*this.z_*0.5;},xFunction:function xFunction(age){return Math.cos((age+this.offset_)*0.2)*this.radius_;},yFunction:function yFunction(age){return Math.sin((age+this.offset_)*0.2)*this.radius_;},alphaFunction:function alphaFunction(age){return Math.min(age*0.1,0.4,this.ticksLeft*0.05);},radius_:Math.random()*0.3+0.3,offset_:Math.random()*10,age:41});}}if(this.ticksCounter%5==1)for(var k=0;k<this.teleporters.length;k++){var t=this.teleporters[k];if(t.x+3>=this.cameraX&&t.y+3>=this.cameraY&&t.x-3<=this.cameraX2&&t.y-3<=this.cameraY2){var randomAngle=Math.random()*Math.PI*2;var rand=Math.random()*0.7;new Sprite({x:t.x+Math.cos(randomAngle)*rand,y:t.y-1.1+Math.sin(randomAngle)*rand,z:Math.random(),img:imgCoords.pillar_of_light,scaleFunction:function scaleFunction(age){return this.scale_+age*0.04;},alphaFunction:function alphaFunction(age){return Math.min(age*0.05,0.5,this.ticksLeft*0.05);},scale_:Math.random()*0.2+2,z_:0.01+Math.random()*0.02,zFunction:function zFunction(age){return age*this.z_;},age:26});}}};Game.prototype.roundStart=function(){soundManager.playSound(SOUND.START);this.interface_=new Interface(this.map);if(this.type.team){this.scoreTeam1=0;this.scoreTeam2=0;F$("rankInGame").refreshTeamScore();}for(var i=0;i<this.projectiles.length;i++){this.objectsToDraw.erease(this.projectiles[i]);this.projectiles.splice(i,1);i--;}for(var i=0;i<this.grenades.length;i++){this.objectsToDraw.erease(this.grenades[i]);this.grenades.splice(i,1);i--;}for(var i=0;i<this.effects.length;i++){this.objectsToDraw.erease(this.effects[i]);this.effects.splice(i,1);i--;}this.floatingTexts=[];for(var i=0;i<this.objects.length;i++){this.objects[i].die();}this.objects=[];for(var i=0;i<this.players.length;i++){if(this.players[i].removeAt){this.objectsToDraw.erease(this.players[i]);this.players.splice(i,1);i--;}else{if(this.players[i].isHumanZombie)this.players[i].turnHuman();this.players[i].init();this.players[i].weapon=weapons[0];this.players[i].hp=this.players[i].maxHP;this.players[i].armor=0;this.players[i].setKills(0);this.players[i].setDeaths(0);this.players[i].setSouls(0);this.players[i].setElo(0);this.players[i].invincibleUntil=CONST.SPAWN_INVINCIBILITY;this.players[i].createSpawnEffect(this.playingPlayer==this.players[i]);}}for(var i=0;i<this.objectsToDraw.length;i++){if(this.objectsToDraw[i].isAmmo)this.objectsToDraw[i].isActive=true;}this.refreshUIs();for(var i=0;i<this.zombies.length;i++){this.objectsToDraw.erease(this.zombies[i]);}for(var i=0;i<this.corpses.length;i++){this.objectsToDraw.erease(this.corpses[i]);}for(var i=0;i<this.movableObjects.length;i++){this.objectsToDraw.erease(this.movableObjects[i]);}this.zombies=[];this.movableObjects=[];this.corpses=[];var id_counter_mobs=90000;for(var i=0;i<this.map.tiles.length;i++){tile=createTile(this.map.tiles[i]);type=tile.type;if(type&&type.movable)this.movableObjects.push(new MovableObject(id_counter_mobs++,tile.x+0.5,tile.y+0.5,tile.x+0.5,tile.y+0.5,type));}if(this.redFlag){this.redFlag.currentX=this.redFlag.x;this.redFlag.currentY=this.redFlag.y;if(this.redFlag.carriedBy){this.redFlag.carriedBy=null;this.addToObjectsToDraw(this.redFlag);}}if(this.blueFlag){this.blueFlag.currentX=this.blueFlag.x;this.blueFlag.currentY=this.blueFlag.y;if(this.blueFlag.carriedBy){this.blueFlag.carriedBy=null;this.addToObjectsToDraw(this.blueFlag);}}this.resetPlayingPlayerStats();for(var i=0;i<this.torches.length;i++){this.torches[i].nextEmit=1;}for(var i=0;i<this.objectsToDraw.length;i++){if(this.objectsToDraw[i].lastSpawnTick)this.objectsToDraw[i].lastSpawnTick=-99999;}this.setNextMaps({});F$('rankInGame').hide();F$('result').hide();slayOne.viewHelpers.hideAd();uiManager.hideDeathScreen();};Game.prototype.roundEnd=function(){var playerWithTopScore=null;var topScore=0;if(this.type.winningCondition&&!this.type.team)for(var i=0;i<this.players.length;i++){if(this.players[i][this.type.winningCondition]>topScore){topScore=this.players[i][this.type.winningCondition];playerWithTopScore=this.players[i];}}if(this.isTutorial()){this.victoryMsg=F_('tutorial.complete');soundManager.playSound(SOUND.WIN);this.victoyMshColor="green";}else if(this.type.coopZombieMode){var countAliveHumans=0;var humanPlayerName="";for(var i=0;i<this.players.length;i++){if(!this.players[i].isHumanZombie&&!this.players[i].dieAt){countAliveHumans++;humanPlayerName=this.players[i].fullName;}}if(countAliveHumans==1)this.victoryMsg=humanPlayerName+" wins";else if(countAliveHumans==0)this.victoryMsg=slayOne.widgets.lang.get("game.msg.win",{winnerName:slayOne.widgets.lang.get("game.stats.zombies.name")});else if(countAliveHumans>0){var souls=-999;var pl="";for(var i=0;i<this.players.length;i++){if(!this.players[i].isHumanZombie&&!this.players[i].dieAt&&this.players[i].souls>souls){pl=this.players[i];souls=pl.souls;}}this.victoryMsg=pl.name+" wins";}else this.victoryMsg=slayOne.widgets.lang.get("game.msg.win",{winnerName:slayOne.widgets.lang.get("game.stats.zombies.name")});if(!this.playingPlayer||this.playingPlayer.team==1&&countAliveHumans>0||this.playingPlayer.team==2&&countAliveHumans==0){soundManager.playSound(SOUND.WIN);this.victoyMshColor="green";}else{soundManager.playSound(SOUND.LOSE);this.victoyMshColor="red";}}else{if(this.type.team&&this.scoreTeam1>this.scoreTeam2)this.victoryMsg=slayOne.widgets.lang.get("game.msg.win",{winnerName:slayOne.widgets.lang.get("game.stats.team1.name")});else if(this.type.team&&this.scoreTeam2>this.scoreTeam1)this.victoryMsg=slayOne.widgets.lang.get("game.msg.win",{winnerName:slayOne.widgets.lang.get("game.stats.team2.name")});else if(this.type.team)this.victoryMsg=slayOne.widgets.lang.get("game.msg.draw");else if(playerWithTopScore)this.victoryMsg=slayOne.widgets.lang.get("game.msg.win_with_reason",{winnerName:playerWithTopScore.fullName,reason:topScore+" "+slayOne.widgets.lang.get(this.type.winningConditionLabel)});else this.victoryMsg="";if(this.type.team&&this.playingPlayer&&this.playingPlayer.team==1&&this.scoreTeam1>this.scoreTeam2||playerWithTopScore==this.playingPlayer){soundManager.playSound(SOUND.WIN);this.victoyMshColor="green";}else if(this.type.team&&this.playingPlayer.team==1&&this.scoreTeam2>this.scoreTeam1){soundManager.playSound(SOUND.LOSE);this.victoyMshColor="red";}else{soundManager.playSound(SOUND.END);this.victoyMshColor="rgba(200, 200, 200)";}}F$('rankInGame').show(this.playingPlayerID);};Game.prototype.isTutorial=function(){return this.map&&this.map.special=="tutorial1";};Game.prototype.setNextMaps=function(nextMaps){this.nextMaps=nextMaps;if(F$('rankInGame_mapList')instanceof HTMLElement)F$('rankInGame_mapList').maps=Object.values(nextMaps);};Game.prototype.voteNextMap=function(mapId,voterId){var map=this.nextMaps[mapId];if(map){map.votes++;if(voterId==this.voterId){map.voted=true;}F$('rankInGame_mapList').render();}};Game.prototype.getFlagText=function(){if(!this.redFlag||!this.blueFlag)return null;for(var i=1;i<=2;i++){if(this.playingPlayer&&this.playingPlayer.team==i){var ownFlag=i==1?this.redFlag:this.blueFlag;var enemyFlag=i==2?this.redFlag:this.blueFlag;if(ownFlag&&ownFlag.carriedBy)return"game.msg.flag_enemy_has";if(ownFlag&&(ownFlag.currentX!=ownFlag.x||ownFlag.currentY!=ownFlag.y))return"game.msg.flag_not_home";if(enemyFlag&&enemyFlag.carriedBy==this.playingPlayer)return"game.msg.flag_you_have";if(enemyFlag&&enemyFlag.carriedBy&&enemyFlag.carriedBy!=this.playingPlayer)return"game.msg.flag_ally_has";return"game.msg.flag_default";}}};Game.prototype.getZombieCoopText=function(){if(this.ticksCounter<this.type.convertTime){return slayOne.widgets.lang.get("game.msg.zombie_prep",{sec:Math.floor((this.type.convertTime-game.ticksCounter)/20)});}if(this.playingPlayer&&this.playingPlayer.isHumanZombie){var num=2-this.playingPlayerZombieKillStreak;if(this.cureTick){return slayOne.widgets.lang.get("game.msg.zombie_cure");}else if(num>0){return slayOne.widgets.lang.get("game.msg.zombie_zombie",{num:num});}return'';}var human=0;var zombie=0;for(var i in this.players){var p=this.players;if(!p){continue;}if(this.players[i].isHumanZombie){zombie++;}else if(this.players[i].id){human++;}}return slayOne.widgets.lang.get("game.msg.zombie_human",{human:human,zombie:zombie});};Game.prototype.getClosestAlly=function(x,y,range){var bestPlayer=null;var bestDist=range;var players=this.players.concat(this.zombies);for(var i=0;i<players.length;i++){var p=players[i];if(p!=this.playingPlayer&&!p.dieAt&&p.team!=0&&p.team==this.playingPlayer.team){var dist=Math.sqrt(Math.pow(p.x-x,2)+Math.pow(p.y-y,2));if(dist<bestDist){bestPlayer=p;bestDist=dist;}}}return bestPlayer;};Game.prototype.refreshLockedPlayer=function(x,y){var bestPlayer=null;var bestDist=2;var players=this.players.concat(this.zombies);for(var i=0;i<players.length;i++){var p=players[i];if(p!=this.playingPlayer&&!p.dieAt&&!p.isInvisible&&(p.team==0||p.team!=this.playingPlayer.team)){var dist=Math.sqrt(Math.pow(p.x-x,2)+Math.pow(p.y-y,2));if(dist<bestDist){bestPlayer=p;bestDist=dist;}}}if(bestPlayer)this.targetLockedPlayer=bestPlayer;};Game.prototype.newBeam1=function(data){var shooter=this.getPlayerFromID(data[1]);this.projectiles.push(new Beam(shooter,null,data[2],data[3],weapons[data[4]]));this.playerShoots(shooter,data[4],data[5]);};Game.prototype.newBeam2=function(data){var shooter=this.getPlayerFromID(data[1]);var victim=this.getPlayerFromID(data[2]);var wpn=weapons[data[4]];if(!shooter||!victim){return;}var victimOldHP=victim.hp;var shooterOldHP=shooter.hp;victim.hp=parseFloat(data[3]);shooter.hp=parseFloat(data[5]);victim.hpGlideAmount=victim.hp-victimOldHP;victim.hpGlideStart=this.ticksCounter;victim.hpGlideEnd=this.ticksCounter+wpn.lifetime;shooter.hpGlideAmount=shooter.hp-shooterOldHP;shooter.hpGlideStart=this.ticksCounter;shooter.hpGlideEnd=this.ticksCounter+wpn.lifetime;if(shooter.hp>shooterOldHP&&shooter.x+3>=this.cameraX&&shooter.y+3>=this.cameraY&&shooter.x-3<=this.cameraX2&&shooter.y-3<=this.cameraY2&&!this.fastForward)new Sprite({x:shooter.x+Math.random()*0.5-0.25,y:shooter.y+0.5+Math.random()*0.5,img:imgCoords.heal,scaleFunction:function scaleFunction(age){return-1*(1/((age*0.9-125)/500+0.31)+age/4)+16.9;},age:Math.random()*10+35,xR:Math.random()*0.1-0.05,xFunction:function xFunction(age){return Math.pow(age,0.7)*this.xR;},zFunction:function zFunction(age){return 1.4+age*0.02;}});if(victim.hp>victimOldHP&&victim.x+3>=this.cameraX&&victim.y+3>=this.cameraY&&victim.x-3<=this.cameraX2&&victim.y-3<=this.cameraY2&&!this.fastForward)new Sprite({x:victim.x+Math.random()*0.5-0.25,y:victim.y+0.5+Math.random()*0.5,img:imgCoords.heal,scaleFunction:function scaleFunction(age){return-1*(1/((age*0.9-125)/500+0.31)+age/4)+16.9;},age:Math.random()*10+35,xR:Math.random()*0.1-0.05,xFunction:function xFunction(age){return Math.pow(age,0.7)*this.xR;},zFunction:function zFunction(age){return 1.4+age*0.02;}});this.projectiles.push(new Beam(shooter,victim,null,null,wpn));this.playerShoots(shooter,data[4]);};Game.prototype.playerShoots=function(p,weaponID,remainingBullets){var wpn=weapons[weaponID];if(window.debugMode>3){console.log('weaponID',weaponID);}if(wpn.dummyFor){wpn=weapons[wpn.dummyFor];weaponID=wpn.id;}if(window.debugMode>3){console.log('weaponID',weaponID);}if(p&&!p.isZombie){p.lastTickFire=this.ticksCounter;p.noInvisUntil=this.ticksCounter+40;}if(p&&p==this.playingPlayer){this.playingPlayerClips[weaponID]--;this.playingPlayer.weaponCooldowns[weaponID]=this.playingPlayerClips[weaponID]>0?wpn.cooldown:0;if(typeof remainingBullets!=="undefined")this.playingPlayerClips[weaponID]=parseFloat(remainingBullets);}};Game.prototype.newProjectileMulti=function(data){var weapon=weapons[data[3]];for(var i=5;data[i];i+=5){this.projectiles.push(new Projectile(data[i+1],data[i+2],data[i+3],data[i+4],data[1],data[i],weapon,false,data[4],true));}if(data[4]>=0)this.playerShoots(this.getPlayerFromID(data[2]),data[3],data[4]);var x=parseFloat(data[6]);var y=parseFloat(data[7]);var vecX=parseFloat(data[8]);var vecY=parseFloat(data[9]);if(x+4>=this.cameraX&&y+4>=this.cameraY&&x-4<=this.cameraX2&&y-4<=this.cameraY2&&!this.fastForward){if(weapon.soundName)soundManager.playSound(SOUND[weapon.soundName],x,y,weapon.volume?weapon.volume:1);if(weapon.spawnBullets&&graphics[graphicSettings].spawnBullets)new Bullet(x,y);for(var i=1;i<5;i++){new Sprite({x:x+Math.random()*0.3-0.15,y:y-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(2.7+Math.random())*20,x_:vecX*2.25,y_:vecY*2.25,i_:i/5,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.y_;}});}for(var i=1;i<3;i++){new Sprite({x:x+vecX+Math.random()*0.3-0.15,y:y+vecY-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(2.7+Math.random())*20,x_:-vecY*2.25,y_:vecX*2.25,i_:i/5,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.y_;}});}for(var i=1;i<3;i++){new Sprite({x:x+vecX+Math.random()*0.3-0.15,y:y+vecY-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(2.7+Math.random())*20,x_:vecY*2.25,y_:-vecX*2.25,i_:i/5,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.y_;}});}}};Game.prototype.newObject=function(data){var p=this.getPlayerFromID(data[5]);var ab=abilities[data[4]];this.objects.push(new Object_(data[1],p,ab,data[2],data[3],data[8],data[8],data[7],data[9],null,data[10],data[11]));if(p==this.playingPlayer){this.playingPlayerEnergy-=ab.energy;this.lastAbilityUses[pl_active_abilities[0]==ab?0:1]=this.ticksCounter;}if(ab.type=="throw")p.lastThrow=this.ticksCounter;if(ab.type!="throw"&&p.x+2>=this.cameraX&&p.y+2>=this.cameraY&&p.x-2<=this.cameraX2&&p.y-2<=this.cameraY2&&!this.fastForward){for(var k=0;k<9;k++){var randomAngle=Math.random()*Math.PI*2;var rand=Math.random()*0.7;new Sprite({x:p.x+Math.cos(randomAngle)*rand,y:p.y-SHOT_HEIGHT+Math.sin(randomAngle)*rand,z:Math.random(),img:imgCoords.particleWhite,scaleFunction:function scaleFunction(age){return this.scale_;},scale_:Math.random()*2+2,z_:Math.random()*0.09,zFunction:function zFunction(age){return age*this.z_;},age:15+Math.random()*10});}}};Game.prototype.newProjectile=function(data){var weapon=weapons[data[8]];if(weapon==weapons[2]){var x=parseFloat(data[1]);var y=parseFloat(data[2]);if(x+10>=this.cameraX&&y+10>=this.cameraY&&x-10<=this.cameraX2&&y-10<=this.cameraY2&&!this.fastForward){var vecX=parseFloat(data[3]);var vecY=parseFloat(data[4]);var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=weapons[2].projectileSpeed/len;vecY*=weapons[2].projectileSpeed/len;new Sprite({x:x,y:y,img:imgCoords["fire"+(Math.floor(Math.random()*3)+2)],scaleFunction:function scaleFunction(age){return 1.2+age*0.15;},r1:vecX,r2:vecY,age:weapons[2].lifetime,zFunction:function zFunction(age){return SHOT_HEIGHT+age*0.04;},xFunction:function xFunction(age){return age*this.r1;},yFunction:function yFunction(age){return age*this.r2;},dieOnCollision:true});if(graphics[graphicSettings].additionalFTFire)new Sprite({x:x,y:y,img:imgCoords["fire"+(Math.floor(Math.random()*3)+2)],scaleFunction:function scaleFunction(age){return 1.2+age*0.15;},r1:vecX*(Math.random()*0.2+0.9),r2:vecY*(Math.random()*0.2+0.9),age:weapons[2].lifetime,zFunction:function zFunction(age){return SHOT_HEIGHT;},xFunction:function xFunction(age){return age*this.r1;},yFunction:function yFunction(age){return age*this.r2;},dieOnCollision:true});new Sprite({x:x,y:y+SHOT_HEIGHT,img:imgCoords.light_yellow,scaleFunction:function scaleFunction(age){return 4;},r1:vecX*(Math.random()*0.2+0.9),r2:vecY*(Math.random()*0.2+0.9),age:weapons[2].lifetime,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.1;},zFunction:function zFunction(age){return SHOT_HEIGHT+age*0.05;},xFunction:function xFunction(age){return age*this.r1;},yFunction:function yFunction(age){return age*this.r2;},dieOnCollision:true});if(graphics[graphicSettings].additionalFTFire)new Sprite({x:x,y:y,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return 1+age*0.2;},r1:vecX*(Math.random()*0.2+0.9),r2:vecY*(Math.random()*0.2+0.9),age:weapons[2].lifetime,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.3;},zFunction:function zFunction(age){return SHOT_HEIGHT+age*0.05;},xFunction:function xFunction(age){return age*this.r1;},yFunction:function yFunction(age){return age*this.r2;},dieOnCollision:true});}}else{this.projectiles.push(new Projectile(data[1],data[2],data[3],data[4],data[5],data[6],weapon,data[9],data[10],false,data[7],data[12]));if(data[7]==this.playingPlayerID&&weapon.isHeatSeeking2)this.playingPlayerCountActiveHeatseeking2Missiles++;}if(data[11]!="-1"){for(var i=0;i<this.objects.length;i++){if(this.objects[i].id==data[11]){this.objects[i].shoot(0,0,parseFloat(data[3]),parseFloat(data[4]));i=this.objects.length;}}}else this.playerShoots(this.getPlayerFromID(data[7]),data[8],data[10]);};Game.prototype.newGrenade=function(data){var p=this.getPlayerFromID(data[8]);this.grenades.push(new Grenade(data[1],data[2],data[3],data[4],data[5],data[6],data[7],weapons[data[9]],p));if(data[10]!="-1"){for(var i=0;i<this.objects.length;i++){if(this.objects[i].id==data[10]){this.objects[i].shoot(parseFloat(data[1]),parseFloat(data[2]),parseFloat(data[3]),parseFloat(data[4]));i=this.objects.length;}}}else this.playerShoots(p,data[9]);};Game.prototype.newPlayer=function(data){var x=data[2]/CONST.TRANSMUL;var y=data[3]/CONST.TRANSMUL;var isHumanZombie=data[15]=="1";var p=new Player(data[1],x,y,data[4],data[5],data[6],0,0,null,x,y,data[7],data[8],false,data[9],data[10],data[11],data[12],0,data[13],data[14],0,isHumanZombie,null,null,data[16],data[17],data[18]);this.interface_.addMsg(slayOne.widgets.lang.get("game.msg.player_join",{playerName:p.fullName}),"#ACACAC");this.players.push(p);if(!this.playingPlayer)this.checkPlayingPlayer();if(this.ticksCounter>=0)p.invincibleUntil=this.ticksCounter+CONST.SPAWN_INVINCIBILITY;p.createSpawnEffect();this.refreshUIs();};Game.prototype.newZombie=function(data){var x=data[2]/CONST.TRANSMUL;var y=data[3]/CONST.TRANSMUL;var z=new Zombie(data[1],x,y,data[4],x,y,data[5],data[6],data[7],data[8],data[9],data[10]);this.zombies.push(z);z.createSpawnEffect();};Game.prototype.setPlayingPlayerID=function(id){var id=parseInt(id);this.playingPlayerID=id;this.checkPlayingPlayer();F$('rankInGame').refreshPlaying();};Game.prototype.checkPlayingPlayer=function(){if(game.iAmSpec){return;}var _iteratorNormalCompletion14=true;var _didIteratorError14=false;var _iteratorError14=undefined;try{for(var _iterator14=this.players[Symbol.iterator](),_step14;!(_iteratorNormalCompletion14=(_step14=_iterator14.next()).done);_iteratorNormalCompletion14=true){var p=_step14.value;if(p.id!==this.playingPlayerID){continue;}this.playingPlayer=p;this.resetPlayingPlayerStats();var tr=document.getElementById('tr_'+this.playingPlayerID);if(tr){tr.className="playingPlayerTR";}if(this.isTutorial()){this.playingPlayerAbilities=getTutorialAbilityObj(abilities);}else if(this.playingPlayer.isHumanZombie){this.playingPlayerAbilities=getDefaultZombieAbilityObj(pl_abilities,abilities);}else if(this.mode==6){console.log('game mode',this.mode);this.playingPlayerAbilities=loginData.custom_build;}else{this.playingPlayerAbilities=pl_abilities;}F$('rankInGame').hide();this.setActiveAbilities();break;}}catch(err){_didIteratorError14=true;_iteratorError14=err;}finally{try{if(!_iteratorNormalCompletion14&&_iterator14.return){_iterator14.return();}}finally{if(_didIteratorError14){throw _iteratorError14;}}}};Game.prototype.setActiveAbilities=function(){pl_active_abilities=[];var k=0;var _iteratorNormalCompletion15=true;var _didIteratorError15=false;var _iteratorError15=undefined;try{for(var _iterator15=abilities[Symbol.iterator](),_step15;!(_iteratorNormalCompletion15=(_step15=_iterator15.next()).done);_iteratorNormalCompletion15=true){var ab=_step15.value;if(ab.type!="passive"&&this.playingPlayerAbilities[ab.id].lvl>0){pl_active_abilities[k]=ab;k++;if(k>1){return;}}}}catch(err){_didIteratorError15=true;_iteratorError15=err;}finally{try{if(!_iteratorNormalCompletion15&&_iterator15.return){_iterator15.return();}}finally{if(_didIteratorError15){throw _iteratorError15;}}}};Game.prototype.corpseBounce=function(x,y,radius){var players=this.players.concat(this.zombies);for(var i=0;i<players.length;i++){if(players[i].dieAt&&!players[i].noCorpseBounce&&players[i].z<0.8&&Math.sqrt(Math.pow(players[i].x-x,2)+Math.pow(players[i].y-y,2))<=radius){var p=players[i];var vecX=p.x-x;var vecY=p.y-y;var vecH=Math.max((Math.min(Math.max(radius-Math.sqrt(vecX*vecX+vecY*vecY),1.0),1.8)+0.2)*0.2,0.001);var speed=vecH*2.5;var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=speed/len;vecY*=speed/len;p.bouncePoints=createBounce2(p.x,p.y,vecX,vecY,vecH,this);}}};Game.prototype.playerRespawns=function(data){this.getPlayerFromID(data[1]).respawn(data[2],data[3],data[4]);this.refreshUIs();};Game.prototype.playerLeaves=function(data){for(var i=0;i<this.players.length;i++){if(this.players[i].id==data[1]){this.interface_.addMsg(slayOne.widgets.lang.get("game.msg.player_leave",{playerName:this.players[i].fullName}),"#ACACAC");this.players[i].die();this.players[i].removeAt=this.ticksCounter+60;break;}}};Game.prototype.projectileDies=function(data){for(var i=0;i<this.projectiles.length;i++){if(this.projectiles[i].id==data[1]){this.projectiles[i].createDeathEffect(data[2],data[3],data[4]);if(!this.projectiles[i].dieAt&&this.projectiles[i].playerID==this.playingPlayerID&&this.projectiles[i].weapon.isHeatSeeking2)this.playingPlayerCountActiveHeatseeking2Missiles--;this.projectiles[i].dieAt=this.ticksCounter+10;return;}}};Game.prototype.hpUpdateObject=function(data){var attacker=this.getPlayerFromID(data[5]);var o=null;for(var i=0;i<this.objects.length;i++){if(this.objects[i].id==data[1]){o=this.objects[i];o.hp=parseFloat(data[2]);o.hitUntil=this.ticksCounter+2;if(attacker&&attacker.isZombie)attacker.performHit(o);if(attacker&&(attacker.isZombie||attacker.isHumanZombie))soundManager.playSound(SOUND.MECH_IMPACT,o.x,o.y,0.7);if(o.hp<=0){o.die();this.objects.splice(i,1);}i=this.objects.length;}}if(data[3]=="true")for(var i=0;i<this.projectiles.length;i++){if(this.projectiles[i].id==data[4]){this.projectiles[i].createHitEffect(o);return;}}};Game.prototype.hpUpdate=function(data){var victim=this.getPlayerFromID(data[1]);var attacker=this.getPlayerFromID(data[7]);if(victim){if(!victim.isMovableObject&&attacker&&(attacker.isZombie||attacker.isHumanZombie))attacker.performHit(victim);victim.hpUpdate(data[2],data[3],data[19],attacker);if(victim.invincibleUntil<this.ticksCounter){victim.hitUntil=this.ticksCounter+2;victim.lastHit=this.ticksCounter;}if(data.length>9){this.playerDies(victim,attacker,data[5],data[9],data[6],data[10],data[11],data[12],data[13],data[14],data[15],data[16],data[17],data[18],data[19],data[20],data[21],data[22],data[23],data[24],data[25],data[26],data[27],data[28]);}if(data[8]>0&&attacker){if(attacker['performLifesteal']){attacker.performLifesteal(parseFloat(data[8]));}else{console.warn("attacker no performLifesteal",attacker);}}}else if(debugMode){console.warn("Player ["+data[1]+"] lost!");}if(data[4]=="true")for(var i=0;i<this.projectiles.length;i++){if(this.projectiles[i].id==data[5]){this.projectiles[i].createHitEffect(victim);return;}}};Game.prototype.playerDies=function(victim,killer,projectileID,newKillCount,murderWeaponId,newDeathCount,multiKillCount,killStreak,victimKillStreak,soulsKiller,soulsVictim,killerElo,victimElo,splash,objX,objY,objAOE,objID,startX,startY,vecX,vecY,vecH){if(splash=="true"){new Splash(victim.x,victim.y,imgCoords.splash,2);victim.noDraw=true;}var projectile=this.getGrenadeOrProjectileById(projectileID);var obj=null;if(objID&&objID>=0)for(var i=0;i<this.objects.length;i++){if(this.objects[i].id==objID){obj=this.objects[i];i=this.objects.length;}}victim.die(projectile,murderWeaponId,objX,objY,objAOE,killer,obj,startX,startY,vecX,vecY,vecH);if(!killer){return;}if(victim.isZombie){if(killer.isZombie&&killer.db_id&&victim.db_id){console.warn("How ?! Remember to save game for replaying",victim,killer);return;}if(killer.db_id){killer.setSouls(soulsKiller,victim.x,victim.y);}if(killer==this.playingPlayer&&victim.masterId!==db_id){this.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.killed_zombie"),"#36FF36","textInGreen");killer.playFragSound(1,0.8);}this.refreshUIs();return;}var eloDiffKiller=0;var eloDiffVictim=0;if(this.type.ingameElo){if(killer&&killer.setElo)eloDiffKiller=killer.setElo(killerElo,victim.x,victim.y);if(victim&&victim.setElo)eloDiffVictim=victim.setElo(victimElo,victim.x,victim.y);}var soulsVictimBefore=victim.souls;if(killer&&!killer.isZombie)killer.setKills(newKillCount);if(victim)victim.setDeaths(newDeathCount);if(killer&&!killer.isZombie)killer.setSouls(soulsKiller,victim.x,victim.y);if(victim)victim.setSouls(soulsVictim);var soulsLost=soulsVictimBefore-victim.souls;this.refreshUIs();if(victim==killer){if(victim==this.playingPlayer){this.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.killed_self")+(eloDiffKiller?" ("+eloDiffKiller+" "+slayOne.widgets.lang.get("config.resource.score.name")+")":""),"#FF3232","textInRed");if(soulsLost>0)this.floatingTexts.push(new FloatingText("-"+soulsLost,this.playingPlayer.x,this.playingPlayer.y-1.0,1700,1,"#FF3232",SCALE_FACTOR*6,imgCoords.souls));}}else{if(victim==this.playingPlayer){if(soulsLost>0)this.floatingTexts.push(new FloatingText("-"+soulsLost,this.playingPlayer.x,this.playingPlayer.y-1.0,1700,1,"#FF3232",SCALE_FACTOR*6,imgCoords.souls));if(killer.isZombie)this.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.killed_by_zombie"),"#FF3232","textInRed");else this.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.killed_by_player",{playerName:killer.fullName})+(eloDiffVictim?" ("+eloDiffVictim+" "+slayOne.widgets.lang.get("config.resource.score.name")+")":""),"#FF3232","textInRed");}else if(killer==this.playingPlayer){if(killer.team!=0&&killer.team==victim.team){this.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.killed_teammate",{playerName:victim.fullName}),"#FF3232","textInRed");soundManager.playSound(SOUND.TEAMKILL);}else{this.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.killed_player",{playerName:victim.fullName})+(eloDiffKiller?" (+"+eloDiffKiller+" "+slayOne.widgets.lang.get("config.resource.score.name")+")":""),"#36FF36","textInGreen");killer.playFragSound(multiKillCount);}}if(killStreaks[killStreak]){if(killer==this.playingPlayer){soundManager.playSound(SOUND[killStreaks[killStreak].sound],undefined,undefined,0.9);this.interface_.setMainKillMsg(slayOne.widgets.lang.get(killStreaks[killStreak].msg_start_self)+(authLevel>=AUTH_LEVEL.PLAYER?" (+ "+killStreaks[killStreak].xp+" "+slayOne.widgets.lang.get("config.resource.exp.name")+")":""),"#95A6F0","textInBlue",true);}else{soundManager.playSound(SOUND.FRAG1,undefined,undefined,0.5);this.interface_.setMainKillMsg(slayOne.widgets.lang.get(killStreaks[killStreak].msg_start_others,{playerName:killer.fullName}),"#95A6F0","textInBlue",true);}var victimStreak=getStreakByKills(victimKillStreak);if(victimStreak){if(killer==this.playingPlayer)this.interface_.setMainKillMsg(slayOne.widgets.lang.get(killStreaks[killStreak].msg_ended_self,{victimName:victim.fullName})+(authLevel>=AUTH_LEVEL.PLAYER?" (+ "+victimStreak.xp+" "+slayOne.widgets.lang.get("config.resource.exp.name")+")":""),"#95A6F0","textInBlue",true);else this.interface_.setMainKillMsg(slayOne.widgets.lang.get(killStreaks[killStreak].msg_ended_others,{victimName:victim.fullName,killerName:killer.fullName}),"#95A6F0","textInBlue",true);}}}if(!killer.isZombie&&victim&&!victim.isZombie)this.interface_.addKillMsg(killer,victim,projectile,murderWeaponId,obj,splash);};Game.prototype.switchWeapon=function(nr){if(!this.playingPlayer||!this.playingPlayerIsNotStunned()||this.ticksCounter<0||this.playingPlayer.isHumanZombie)return;if(nr==-1)nr+=10;if(weapons[nr]&&weapons[nr]!=this.playingPlayer.weapon&&!weapons[nr].noWeapon){if(this.switchWeaponSound&&this.switchWeaponSound.pause){this.switchWeaponSound.pause();this.switchWeaponSound.currentTime=0;this.switchWeaponSound=null;}network.send("sW$"+nr);}};Game.prototype.getPathForPos=function(x,y){var biggestBlock=10;var xFloor=Math.floor(x);var yFloor=Math.floor(y);var x_=x-xFloor;var y_=y-yFloor;if(x_<CONST.PLAYER_RADIUS)biggestBlock=Math.min(biggestBlock,this.getFieldPath(xFloor-1,yFloor));if(x_>1-CONST.PLAYER_RADIUS)biggestBlock=Math.min(biggestBlock,this.getFieldPath(xFloor+1,yFloor));if(y_<CONST.PLAYER_RADIUS)biggestBlock=Math.min(biggestBlock,this.getFieldPath(xFloor,yFloor-1));if(y_>1-CONST.PLAYER_RADIUS)biggestBlock=Math.min(biggestBlock,this.getFieldPath(xFloor,yFloor+1));if(Math.sqrt(Math.pow(x_,2)+Math.pow(y_,2))<CONST.PLAYER_RADIUS)biggestBlock=Math.min(biggestBlock,this.getFieldPath(xFloor-1,yFloor-1));if(Math.sqrt(Math.pow(1-x_,2)+Math.pow(y_,2))<CONST.PLAYER_RADIUS)biggestBlock=Math.min(biggestBlock,this.getFieldPath(xFloor+1,yFloor-1));if(Math.sqrt(Math.pow(1-x_,2)+Math.pow(1-y_,2))<CONST.PLAYER_RADIUS)biggestBlock=Math.min(biggestBlock,this.getFieldPath(xFloor+1,yFloor+1));if(Math.sqrt(Math.pow(x_,2)+Math.pow(1-y_,2))<CONST.PLAYER_RADIUS)biggestBlock=Math.min(biggestBlock,this.getFieldPath(xFloor-1,yFloor+1));return biggestBlock;};Game.prototype.getPotentialPlaceTarget=function(ability){var x=Math.floor(getMouseGamePlayX())+0.5;var y=Math.floor(getMouseGamePlayY())+0.5;if(Math.sqrt(Math.pow(this.playingPlayer.x-x,2)+Math.pow(this.playingPlayer.y-y,2))<=ability.range&&this.getFieldPath(Math.floor(x),Math.floor(y))==10)return{x:x,y:y};return this.getNextFreeField(x,y,ability.range,this.playingPlayer.x,this.playingPlayer.y);};Game.prototype.getAbilityFieldValue=function(ability,field){var val=ability[field]?ability[field]:0;var pl_ab=this.playingPlayerAbilities[ability.id];if(pl_ab&&pl_ab.attributes)for(var i=0;i<pl_ab.attributes.length;i++){if(pl_ab.attributes[i]&&ability.levelUpFields[i]&&ability.levelUpFields[i]==field)val+=ability.levelUpValues[i]*pl_ab.attributes[i];}return val;};Game.prototype.isGaming=function(){return this.playingPlayer&&!window.leavingGame&&this.isBattle&&this.roundTime>0&&this.ticksCounter>0&&this.ticksCounter<this.roundTime&&this.map&&!this.mapWelcome&&!this.replayMode&&!this.editingMode&&!this.isTutorial();};Game.prototype.addCorpses=function(a){if(this.corpses.length>200){this.corpses.splice(0,20);}this.corpses.push(a);};Game.prototype.calcFps=function(now){var sec=now/1000|0;var fpsTime=now-1000;this.fpsFresh.push(now);while(this.fpsFresh[0]<fpsTime){this.fpsFresh.shift();}this.fpsCount++;if(this.fpsTs!=sec){this.fpsLog[sec]=this.fpsCount;this.fpsCount=0;this.fpsTs=sec;if(sec%2===1){this.pingInc++;this.ping=this.pingNext;this.pingNext=1000;this.pingTs=now;if(this.isGaming()){network.send('ping$'+this.pingInc);}}if(this.pingShow){var fpsLimit=sec-5;var fpsAvg=0;var pingLimit=this.pingInc-5;var pingAvg=0;var i=0;for(var k in this.fpsLog){if(k<=fpsLimit){delete this.fpsLog[k];continue;}i++;fpsAvg+=this.fpsLog[k];}this.fpsAvg=Math.min(Math.round(fpsAvg/i),99);}}this.fps=Math.min(this.fpsFresh.length,99);};Game.prototype.initPreload=function(){this.players=[];this.zombies=[];var _iteratorNormalCompletion16=true;var _didIteratorError16=false;var _iteratorError16=undefined;try{for(var _iterator16=tmpPreload.player[Symbol.iterator](),_step16;!(_iteratorNormalCompletion16=(_step16=_iterator16.next()).done);_iteratorNormalCompletion16=true){var p=_step16.value;this.players.push(new Player(p[0],p[1]/CONST.TRANSMUL,p[2]/CONST.TRANSMUL,p[3],p[4],p[5],p[6],p[7],p[8],p[9]/CONST.TRANSMUL,p[10]/CONST.TRANSMUL,p[11],p[12],!!p[13],p[14],p[15],p[16],p[17],p[18],p[19],p[20],p[21],!!p[22],!!p[23],!!p[24],p[25]|0,p[26]|0,p[27]|0));}}catch(err){_didIteratorError16=true;_iteratorError16=err;}finally{try{if(!_iteratorNormalCompletion16&&_iterator16.return){_iterator16.return();}}finally{if(_didIteratorError16){throw _iteratorError16;}}}var _iteratorNormalCompletion17=true;var _didIteratorError17=false;var _iteratorError17=undefined;try{for(var _iterator17=tmpPreload.zombie[Symbol.iterator](),_step17;!(_iteratorNormalCompletion17=(_step17=_iterator17.next()).done);_iteratorNormalCompletion17=true){var z=_step17.value;this.zombies.push(new Zombie(z[0],z[1]/CONST.TRANSMUL,z[2]/CONST.TRANSMUL,z[3],z[4]/CONST.TRANSMUL,z[5]/CONST.TRANSMUL,z[6],z[7],z[8],z[9],0,z[10]));}}catch(err){_didIteratorError17=true;_iteratorError17=err;}finally{try{if(!_iteratorNormalCompletion17&&_iterator17.return){_iterator17.return();}}finally{if(_didIteratorError17){throw _iteratorError17;}}}};Game.prototype.calcPong=function(ping){if((ping|0)!==this.pingInc){return;}this.pingNext=Date.now()-this.pingTs;if(!this.pingShow){this.pingShow=true;this.ping=this.pingNext;}};Game.prototype.draw=function(){gameDraw();};Game.prototype.drawFilter=function(name,cb){var _this3=this;var list=this[name];var ticksCounter=this.ticksCounter;this[name]=list.filter(function(row){if(row.update(ticksCounter)){return true;}if(cb){if(cb===true){_this3.objectsToDraw.erease(row);}else{cb(row);}}return false;});};var GameUpdateMode={normal:function normal(t,d,data,i){var p=t.getPlayerFromID(d);if(!p){return;}p.x00=p.x0;p.y00=p.y0;p.x0=data[i+3]/CONST.TRANSMUL;p.y0=data[i+4]/CONST.TRANSMUL;p.x=data[i+1]/CONST.TRANSMUL;p.y=data[i+2]/CONST.TRANSMUL;p.lastPosUpdate=t.ticksCounter;},wC:function wC(t,d,data,i){var p=t.getPlayerFromID(d);if(!p){return;}if(p==t.playingPlayer){p.resetCooldowns();}p.isReloading=false;p.lastWeapon=p.weapon;p.weapon=weapons[data[i+1]];p.switchWeaponUntil=t.ticksCounter+CONST.WPN_SWITCH_TICKS;p.resetCooldowns();if(p==t.playingPlayer){t.switchWeaponSound=soundManager.playSound(SOUND.SWITCH_WEAPON,undefined,undefined,0.7);t.playingPlayer.resetCooldowns();}},trn:function trn(t,d,data,i){var p=t.getPlayerFromID(d);if(p&&p!=t.playingPlayer){p.direction2=data[i+1];}},js:function js(t,d,data,i){var p=t.getPlayerFromID(d);if(p){p.z=parseFloat(data[i+1]);p.vz=parseFloat(data[i+2]);}},pa:function pa(t,d,data,i){var _iteratorNormalCompletion18=true;var _didIteratorError18=false;var _iteratorError18=undefined;try{for(var _iterator18=t.objectsToDraw[Symbol.iterator](),_step18;!(_iteratorNormalCompletion18=(_step18=_iterator18.next()).done);_iteratorNormalCompletion18=true){var o=_step18.value;if(!o.isAmmo){continue;}if(o.id!=d){continue;}o.pickUp(data[i+1],data[i+2]);return;}}catch(err){_didIteratorError18=true;_iteratorError18=err;}finally{try{if(!_iteratorNormalCompletion18&&_iterator18.return){_iterator18.return();}}finally{if(_didIteratorError18){throw _iteratorError18;}}}},rp:function rp(t,d,data,i){for(var k=0,j=t.projectiles.length;k<j;k++){var p=t.projectiles[k];if(p.id!=d){continue;}p.reflectionUpdate(data[i+1],data[i+2],data[i+3],data[i+4]);break;}},p2u:function p2u(t,d,data,i){for(var k=0,j=t.projectiles.length;k<j;k++){var p=t.projectiles[k];if(p.id!=d){continue;}p.x0=p.x;p.y0=p.y;p.x=parseFloat(data[i+1]);p.y=parseFloat(data[i+2]);p.vecX=p.x-p.x0;p.vecY=p.y-p.y0;p.skipNextUpdate=true;p.createDrawLens();break;}},o2u:function o2u(t,d,data,i){for(var k=0,j=t.projectiles.length;k<j;k++){var p=t.projectiles[k];if(p.id!=d){continue;}t.objects[k].direction=data[i+1];break;}},zph:function zph(t,d,data,i){var attacker=t.getPlayerFromID(d);var id=data[i+1];var victim=data[i+2]=='1'?t.getObjectFromID(id):t.getPlayerFromID(id);if(attacker&&victim){attacker.performPreHit(victim);}},stu:function stu(t,d,data,i){for(var k=0,j=t.players.length;k<j;k++){var p=t.players[k];if(p.id!=d){continue;}var time=data[i+1]|0;p.standTime=time;if(time==1&&t.playingPlayer==p){soundManager.playSound(SOUND.ZOOM,p.x,p.y,1);}break;}},hpU:function hpU(t,d,data,i){var _this4=this;var p=t.getPlayerFromID(d);if(!p){return;}var oldHP=p.hp;var diff=parseFloat(data[i+1]);p.hp=Math.min(p.hp+diff,p.maxHP);if(p.hp<=oldHP){return;}p.hpGlideAmount=p.hp-oldHP;p.hpGlideStart=t.ticksCounter;p.hpGlideEnd=t.ticksCounter+4*(p.hpGlideAmount/diff);if(p.x+3>=t.cameraX&&p.y+3>=t.cameraY&&p.x-3<=t.cameraX2&&p.y-3<=t.cameraY2&&!t.fastForward){new Sprite({x:p.x+Math.random()*0.5-0.25,y:p.y+0.5+Math.random()*0.5,img:imgCoords.heal,scaleFunction:function scaleFunction(age){return-1*(1/((age*0.9-125)/500+0.31)+age/4)+16.9;},age:Math.random()*10+35,xR:Math.random()*0.1-0.05,xFunction:function xFunction(age){return Math.pow(age,0.7)*_this4.xR;},zFunction:function zFunction(age){return 1.4+age*0.02;}});}},tB:function tB(t,d,data,i){var p=t.getPlayerFromID(d);if(!p){return;}p.turnBoss();if(!p.isHumanZombie){if(t.turnBoss){return;}t.turnBoss=true;}var text='';if(p.isHumanZombie){if(t.playingPlayer==p){text=slayOne.widgets.lang.get("game.msg.turn_boss.zombie_boss");}else{text=slayOne.widgets.lang.get("game.msg.turn_boss.zombie",{boss:p.unsafeName});}}else{var human=0;var _iteratorNormalCompletion19=true;var _didIteratorError19=false;var _iteratorError19=undefined;try{for(var _iterator19=t.players[Symbol.iterator](),_step19;!(_iteratorNormalCompletion19=(_step19=_iterator19.next()).done);_iteratorNormalCompletion19=true){var cp=_step19.value;if(cp.isHumanZombie){continue;}if(cp.hp<=0){continue;}human++;}}catch(err){_didIteratorError19=true;_iteratorError19=err;}finally{try{if(!_iteratorNormalCompletion19&&_iterator19.return){_iterator19.return();}}finally{if(_didIteratorError19){throw _iteratorError19;}}}text=slayOne.widgets.lang.get("game.msg.turn_boss.human",{human:human});}game.interface_.setMainKillMsg(text,"#FF3232","textInRed");},nF:function nF(t,d,data,i){if(t.fastForward){return;}for(var j=0;j<Math.PI*2;j+=0.3+Math.random()*0.3){new Sprite({x:parseInt(data[i])+Math.cos(j)*(data[i+3]-0.9+Math.random()*0.4),y:parseInt(data[i+1])-0.0+Math.sin(j)*(data[i+3]-0.9+Math.random()*0.4),img:imgCoords.poisonFog1,rScale:(Math.random()-0.5)*0.01,rScale2:parseFloat(data[i+3])/2.9,scaleFunction:function scaleFunction(age){return(1.6+this.rScale*age)*this.rScale2;},alphaFunction:function alphaFunction(age){return Math.min(this.ticksLeft>30?0.3:Math.max(this.ticksLeft*0.3/30,0),age*0.02);},age:parseInt(data[i+2])+20,r1:(Math.random()-0.5)*0.01,r2:(Math.random()-0.5)*0.01,r3:(Math.random()-0.5)*0.01,zFunction:function zFunction(age){return 1+this.r1*age;},xFunction:function xFunction(age){return 1+this.r2*age;},yFunction:function yFunction(age){return 1+this.r3*age;}});}for(var j=0;j<Math.PI*2;j+=0.3+Math.random()*0.3){new Sprite({x:parseInt(data[i])+Math.cos(j)*(data[i+3]-0.8)*Math.random(),y:parseInt(data[i+1])-0.0+Math.sin(j)*(data[i+3]-0.8)*Math.random(),img:imgCoords.poisonFog2,rScale:(Math.random()-0.5)*0.01,rScale2:parseFloat(data[i+3])/3,scaleFunction:function scaleFunction(age){return(1.6+this.rScale*age)*this.rScale2;},alphaFunction:function alphaFunction(age){return Math.min(this.ticksLeft>30?0.3:Math.max(this.ticksLeft*0.3/30,0),age*0.02);},age:parseInt(data[i+2])+20,r1:(Math.random()-0.5)*0.01,r2:(Math.random()-0.5)*0.01,r3:(Math.random()-0.5)*0.01,zFunction:function zFunction(age){return 1+this.r1*age;},xFunction:function xFunction(age){return 1+this.r2*age;},yFunction:function yFunction(age){return 1+this.r3*age;}});}},ab:function ab(t,d,data,i){var p=t.getPlayerFromID(d);var ab=abilities[data[i+1]];if(!p||!ab){return;}if(ab.type=="invis"){p.isInvisible=true;if(p.x+3>=t.cameraX&&p.y+3>=t.cameraY&&p.x-3<=t.cameraX2&&p.y-3<=t.cameraY2){createPoundSmoke(p.x,p.y+0.5,0.5,9,0.4);soundManager.playSound(SOUND.INVIS1,p.x,p.y);}}else if(ab.type=="playdead"){p.turnCorpseTill=t.ticksCounter+ab.duration;p.isFakeCorpse=true;}else if(ab.type=="scan"){if(p==t.playingPlayer){t.lastAbilityUses[pl_active_abilities[0]==ab?0:1]=t.ticksCounter;t.showEnemiesOnMinimapUntil=t.ticksCounter+t.getAbilityFieldValue(ab,"duration");t.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.skills.scan.tip"),"rgba(0, 255, 6, 0.7)","textInGreen",true);}if(p.x+5>=t.cameraX&&p.y+5>=t.cameraY&&p.x-5<=t.cameraX2&&p.y-5<=t.cameraY2){t.addCircle(p.x,p.y,imgCoords.greenCircle);soundManager.playSound(SOUND.SCAN,p.x,p.y,p==t.playingPlayer?1:0.66);}}else if(ab.type=="shield"){p.lastShieldActivated=t.ticksCounter;if(p.x+5>=t.cameraX&&p.y+5>=t.cameraY&&p.x-5<=t.cameraX2&&p.y-5<=t.cameraY2)soundManager.playSound(SOUND.SHIELD,p.x,p.y,p==t.playingPlayer?1:0.66);}if(p==t.playingPlayer&&ab.energy){t.playingPlayerEnergy-=ab.energy;}},ab2:function ab2(t,d,data,i){var p=t.getPlayerFromID(d);if(p){p.disableAbility(abilities[data[i+1]]);}},blk:function blk(t,d,data,i){var p=t.getPlayerFromID(d);if(!p){return;}p.blink(data[i+1],data[i+2]);if(p==t.playingPlayer&&data[i+3]=="1"){t.playingPlayerEnergy-=abilities[3].energy;t.lastAbilityUses[pl_active_abilities[0]==abilities[3]?0:1]=t.ticksCounter;t.noShootUntil=t.ticksCounter+CONST.NO_SHOOT_AFTER_BLINK_TICKS;}},blP:function blP(t,d,data,i){for(var k=0,j=t.projectiles.length;k<j;k++){var p=t.projectiles[k];if(p.id==d){p.blink(data[i+1],data[i+2],data[i+3],data[i+4]);break;}}for(var k=0,j=t.grenades.length;k<j;k++){var g=t.grenades[k];if(g.id==d){g.blink(data[i+1],data[i+2],data[i+3],data[i+4]);break;}}},ptz:function ptz(t,d,data,i){var p=t.getPlayerFromID(d);if(p){p.turnZombie();}},cZ:function cZ(t,d,data,i){var p=t.getPlayerFromID(d);if(!p){return;}p.getCured();p.lastZombieToHumanTransformation=t.ticksCounter;if(p==t.playingPlayer){t.playingPlayerIsZombie=false;}},pptz:function pptz(t,d,data,i){var p=t.getPlayerFromID(d);if(p){p.startBlinkingGreen=t.ticksCounter;}},luP:function luP(t,d,data,i){var p=t.getPlayerFromID(d);if(p){p.createLvlUpEffect();}},blO:function blO(t,d,data,i){for(var k=0,j=t.objects.length;k<j;k++){var o=t.objects[k];if(o.id==d){o.blink(data[i+1],data[i+2],data[i+3],data[i+4]);break;}}},rl:function rl(t,d,data,i){var p=t.getPlayerFromID(d);if(!p||!p.weapon){return;}p.isReloading=true;p.weaponCooldowns2[p.weapon.id]=p.weapon.cooldown2;if(p.weapon.reload2Sound&&p==t.playingPlayer){p.reloadSound2=soundManager.playSound(SOUND[p.weapon.reload2Sound],p.x,p.y,0.55);}},att:function att(t,d,data,i){var p=t.getPlayerFromID(d);if(p){p.updateField(data[i+1],data[i+2]);}},abc:function abc(t,d,data,i){var p=t.getPlayerFromID(d);if(p!=t.playingPlayer){return;}t.playingPlayerAbilities[data[i+1]].lvl=parseInt(data[i+2]);t.setActiveAbilities();}};function Humanoid(){this.lastActualHit=-99999;};Humanoid.prototype.performHit=function(victim){this.victim=victim;this.targetX=victim.x;this.targetY=victim.y;if(this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2){soundManager.playSound(SOUND.ZOMBIE_BITE,victim.x,victim.y);this.lastActualHit=game.ticksCounter;}};Humanoid.prototype.getYDrawingOffset=function(){return this.y;};Humanoid.prototype.blink=function(x,y){this.x=parseFloat(x);this.y=parseFloat(y);this.x0=this.x;this.y0=this.y;var vecX=this.x-this.x00;var vecY=this.y-this.y00;var dist=Math.sqrt(Math.pow(vecX,2)+Math.pow(vecY,2));var x=this.x00;var y=this.y00;vecX*=1/dist;vecY*=1/dist;if(!game.fastForward){for(var i=0;i<dist;i+=0.75){x+=vecX;y+=vecY;new Sprite({x:x+Math.random()*0.6-0.3,y:y+Math.random()*0.6-0.3-0.5,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.25,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.25;},age:(1.7+Math.random())*20});new Sprite({x:x+Math.random()*0.6-0.3,y:y+Math.random()*0.6-0.3-0.5,img:imgCoords.particleWhite,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.55,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.8;},age:Math.random()*4+10});}soundManager.playSound(SOUND.BLINK,this.x00,this.y00);createBlinkEffect(this.x00,this.y00);createBlinkEffect(this.x,this.y);}this.laserHitUntil=game.ticksCounter+3;};Humanoid.prototype.getVanishingAlpha=function(ticks){if(game.type.coopZombieMode)return 1;return this.dieAt?Math.min(Math.max((this.finallyRemoveAt-ticks)/40,0),1):1;};Humanoid.prototype.createCorpse=function(){game.addCorpses(new Corpse(parseInt(this.id)+50000,this.x,this.y,this.z,this.flameDeath,this.direction,this.bouncePoints,this.imgScale?this.imgScale:1));};Humanoid.prototype.updateBounce=function(){if(this.bouncePoints.length>0){this.x0=this.x;this.y0=this.y;this.z0=this.z;this.x=this.bouncePoints[0].x;this.y=this.bouncePoints[0].y;this.z=this.bouncePoints[0].h;if(this.bouncePoints[0].hitsGround){var vecH=this.bouncePoints[0].vecH;if(this.x+5>=game.cameraX&&this.y+5>=game.cameraY&&this.x-5<=game.cameraX2&&this.y-5<=game.cameraY2){var vanishingAlpha=this.getVanishingAlpha(game.ticksCounter);createPoundSmoke(this.x,this.y+1.0,Math.min(vecH*2.5,1),parseInt(vecH*40),0.5*vanishingAlpha);soundManager.playSound(SOUND.KICK,this.x,this.y,Math.min(vecH*3,1)*vanishingAlpha);}}if(this.bouncePoints[0].wallSmash&&this.bouncePoints[1]){var p=this.bouncePoints[0];var len=Math.sqrt(Math.pow(this.bouncePoints[1].x-p.x,2)+Math.pow(this.bouncePoints[1].y-p.y,2));var startAngle="";var finishAngle="";var x=this.x;var y=this.y;if(p.wallSmash=="right"){startAngle=Math.PI*0.5;finishAngle=Math.PI*1.5;x+=CONST.PLAYER_RADIUS;}else if(p.wallSmash=="left"){startAngle=Math.PI*-0.5;finishAngle=Math.PI*0.5;x-=CONST.PLAYER_RADIUS;}else if(p.wallSmash=="top"){startAngle=Math.PI*1.0;finishAngle=Math.PI*2.0;y-=CONST.PLAYER_RADIUS;}else if(p.wallSmash=="bottom"){startAngle=Math.PI*0;finishAngle=Math.PI*1.0;y+=CONST.PLAYER_RADIUS;}if(this.x+5>=game.cameraX&&this.y+5>=game.cameraY&&this.x-5<=game.cameraX2&&this.y-5<=game.cameraY2){var vanishingAlpha=this.getVanishingAlpha?this.getVanishingAlpha(game.ticksCounter):1;createPoundSmoke(x,y+1.0-p.h,Math.min(len*1.5,1),parseInt(len*40),0.5*vanishingAlpha,startAngle,finishAngle);soundManager.playSound(SOUND.KICK,this.x,this.y,Math.min(len*2.0,1)*vanishingAlpha);}}this.bouncePoints.splice(0,1);if(this.dieAt&&this.bouncePoints.length==0){this.x=this.x0;this.y=this.y0;this.z=0;this.z0=0;}}};Humanoid.prototype.updateField=function(field,value){if(field=="maxHP"){var rate=this.hp/this.maxHP;this.maxHP=parseFloat(value);this.hp=rate*this.maxHP;return;}this[field]=parseFloat(value);};Humanoid.prototype.updateAndDrawPillar=function(p,age){p.h+=p.vh*exactTickDiff;p.w+=p.vw*exactTickDiff;var x=(p.x-p.w/2-game.cameraX)*FIELD_SIZE;var y=(p.y-p.h-game.cameraY)*FIELD_SIZE;var this_age=age+p.age_offset;c.globalAlpha=(this_age<5?Math.max(this_age/5,0):this_age<10?1:Math.max(2.0-this_age/10,0))*0.4;c.drawImage(imgs.miscSheet,p.img.x,p.img.y,p.img.w,p.img.h,x,y,p.w*FIELD_SIZE,p.h*FIELD_SIZE);c.globalAlpha=1;};Humanoid.prototype.createSpawnEffect=function(ignorePosition){this.lightPillarsTop=[];this.lightPillarsBottom=[];if(!(this.x+5>=game.cameraX&&this.y+5>=game.cameraY&&this.x-5<=game.cameraX2&&this.y-5<=game.cameraY2)&&!ignorePosition||game.fastForward)return;for(var i=0;i<Math.PI*2;i+=0.3+Math.random()*0.15){(i<=Math.PI?this.lightPillarsBottom:this.lightPillarsTop).push({x:Math.sin(i)*0.45+this.x,y:Math.cos(i)*0.45+this.y,w:0.15+Math.random()*0.3,h:Math.random()*1.5,vh:0.05+Math.random()*0.1,vw:Math.random()*0.01,age_offset:Math.random()*8-4,img:imgCoords.pillar_of_light});}for(var k=0;k<9;k++){var randomAngle=Math.random()*Math.PI*2;var rand=Math.random()*0.7;new Sprite({x:this.x+Math.cos(randomAngle)*rand,y:this.y-SHOT_HEIGHT+Math.sin(randomAngle)*rand,z:Math.random(),img:imgCoords.particleWhite,scaleFunction:function scaleFunction(age){return this.scale_;},scale_:Math.random()*2+2,z_:Math.random()*0.09,zFunction:function zFunction(age){return age*this.z_;},age:26});}for(var k=0;k<6;k++){var randomAngle=Math.random()*Math.PI*2;var rand=Math.random()*0.7;new Sprite({x:this.x+Math.cos(randomAngle)*rand,y:this.y-SHOT_HEIGHT+Math.sin(randomAngle)*rand,z:Math.random(),img:imgCoords.particlePurple,scaleFunction:function scaleFunction(age){return this.scale_;},scale_:Math.random()*2+2,z_:Math.random()*0.09,zFunction:function zFunction(age){return age*this.z_;},age:26});}new Sprite({x:this.x,y:this.y,img:imgCoords.light_white,scaleFunction:function scaleFunction(age){return Math.max(0,1-age/this.ticksToLive*0.6)*5;},alphaFunction:function alphaFunction(age){return Math.max((-1*(1/((age*0.9-125)/500+0.31)+age/4)+16.9)*3.7,0)*0.04;},age:44});this.lastSpawnTick=game.ticksCounter;soundManager.playSound(SOUND.PLAYER_SPAWN,undefined,undefined,0.95);};Humanoid.prototype.spillBloodFromMeleeAttack=function(){if(this.lastTickFire+12>game.ticksCounter&&this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2){var attackAge=game.ticksCounter-this.lastActualHit;if(attackAge>=0&&attackAge<=3&&this.victim&&!this.victim.isObject){var vecX=this.x-this.targetX;var vecY=this.y-this.targetY;var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=0.5/len;vecY*=0.5/len;new Blood(this.targetX+vecX,this.targetY+vecY,-vecX,-vecY);new Blood(this.targetX+vecX,this.targetY+vecY,-vecX+Math.random()-0.5,-vecY+Math.random()-0.5,null,true);new Blood(this.targetX+vecX,this.targetY+vecY,-vecX,-vecY,imgCoords.particleWhite,true);}}};Player.prototype=new Humanoid();function Player(id,x,y,name,hp,armor,kills,deaths,weapon,x0,y0,hat,team,isInvisible,maxHP,hpRegeneration,clan_tag,authLevel,souls,energyRegeneration,invisEnergyRate,elo,isHumanZombie,isFakeCorpse,isBoss,db_id,worldElo,nameColor){this.id=parseInt(id);this.db_id=db_id;if(!name){name='Player';if(debugMode){console.trace();}}this.unsafeName=name.substr(0,15);this.name=escapeHtml(this.unsafeName);this.fullName=this.name;if(worldElo>2500){this.fullName+=' (Elo:'+(worldElo|0)+')';}this.authLevel=authLevel;nameColor=nameColor|0;if(!NAME_COLOR[nameColor]){nameColor=50;}if(nameColor>200&&forcePlayerNameColor){nameColor=200;}this.nameColor=nameColor;this.nameColorCode=NAME_COLOR[nameColor].code;this.x=x;this.y=y;this.x0=x0?x0:x;this.y0=y0?y0:y;this.x00=x0;this.y00=y0;this.legFrame=0;this.hp=parseFloat(hp);this.maxHP=parseFloat(maxHP);this.hpRegeneration=parseFloat(hpRegeneration);this.armor=parseFloat(armor);this.elo=elo?parseInt(elo):0;this.kills=kills;this.deaths=deaths;this.weapon=weapon?weapons[weapon]:weapons[0];this.team=parseInt(team);this.armorBar=imgCoords.armorBar;if(this.team==1)this.armorBar=imgCoords.armorBarRed;else if(this.team==2)this.armorBar=imgCoords.armorBarBlue;this.souls=souls|0;this.soulLvl=getLvlFromSouls(this.souls);this.energyRegeneration=parseFloat(energyRegeneration);this.invisEnergyRate=parseFloat(invisEnergyRate);this.hat=hats[parseInt(hat)];if(!this.hat)this.hat=hats[0];this.originalHat=this.hat;this.removeAt=0;this.bleeds=true;this.clan_tag=clan_tag?clan_tag:"";this.reloadSound2=null;this.lastKiller=null;this.noDraw=false;this.lastShieldActivated=-999999;this.isHumanZombie=false;this.handsOffset=0;this.startBlinkingGreen=-9999;this.nextPlayer=null;this.init();this.isFakeCorpse=isFakeCorpse;this.isBoss=isBoss;this.direction2=Math.floor(Math.random()*8);if(this.hp<=0){this.dieAt=game.ticksCounter;this.finallyRemoveAt=game.ticksCounter+50;}game.addToObjectsToDraw(this);this.isInvisible=isInvisible?isInvisible:false;if(this==game.playingPlayer)game.playingPlayerAbilities=pl_abilities;if(isHumanZombie)this.turnZombie(true);};Player.prototype.init=function(){this.z=0;this.vz=0;this.zNegative=0;this.zNegative0=0;this.vzNegative=0;this.z0=0;this.dieAt=0;this.direction=0;this.direction2=0;this.lastTickFire=-999;this.lastTimeFlameSoundStarted=-999;this.lastDirection2Update=-999;this.lastPosUpdate=-999;this.lastWeapon=null;this.standTime=0;this.isInvisible=false;this.noInvisUntil=-9999;this.lastThrow=-9999;this.stepOffset=Math.floor(Math.random()*5);this.smokeTimeOffset=Math.floor(Math.random()*10);this.lastLifeSteal=-999;this.zombieSense=0;this.isBoss=false;this.turnedBossAt=-99999;this.switchWeaponUntil=-999;this.bouncePoints=[];this.flameSound=null;this.flameDeath=false;this.flameDeathAndNowBouncing=false;this.path=[];this.laserHitUntil=-999;this.lastHit=-999;this.lockDirection2=0;this.lockDirection=0;this.finallyRemoveAt=0;this.hitUntil=-999;this.isReloading=false;this.startBlinkingGreen=-9999;this.noCorpseBounce=false;this.lastHumanToZombieTransformation=-999;this.lastDeathToZombieTransformation=-999;this.lastZombieToHumanTransformation=-999;this.unturnCorpseTill=-99999;this.turnCorpseTill=-99999;this.isFakeCorpse=false;this.lastSpawnTick=-99999;this.lightPillarsTop=[];this.lightPillarsBottom=[];this.hpGlideStart=-999;this.hpGlideEnd=-999;this.hpGlideAmount=0;this.noDraw=false;this.lastShieldActivated=-999999;this.lastShieldHit=-999999;this.lastEmoteStart=-99999;this.lastEmote=null;this.invincibleUntil=-9999;this.weaponCooldowns=[];this.weaponCooldowns2=[];for(var i=0;i<20;i++){this.weaponCooldowns2[i]=weapons[i]&&weapons[i].cooldown2?weapons[i].cooldown2:0;}};Player.prototype.respawn=function(x,y,turnZombie){if(this.isHumanZombie)this.createCorpse();if(turnZombie=="1")this.turnZombie();this.x=parseFloat(x);this.y=parseFloat(y);this.x0=this.x;this.y0=this.y;this.hp=this.maxHP;this.armor=0;this.weapon=this.isHumanZombie?weapons[12]:weapons[0];this.bouncePoints=[];this.init();if(turnZombie=="1")this.lastDeathToZombieTransformation=game.ticksCounter;if(game.playingPlayer==this){game.resetPlayingPlayerStats();game.lastPickUp=Date.now();}if(turnZombie!="1")this.createSpawnEffect(game.playingPlayer==this);if(!this.isHumanZombie)this.invincibleUntil=game.ticksCounter+CONST.SPAWN_INVINCIBILITY;if(game.playingPlayer==this)uiManager.hideDeathScreen();};Player.prototype.turnBoss=function(){this.isBoss=true;this.turnedBossAt=game.ticksCounter;if(this.isHumanZombie){this.weapon=weapons[14];soundManager.playSound(SOUND.ZOMBIE_TRANSFORM,this.x,this.y);}else{soundManager.playSound(SOUND.HUMAN_TRANSFORM,this.x,this.y);}this.hp=this.maxHP;};Player.prototype.getCured=function(){if(this==game.playingPlayer)game.playingPlayerIsZombie=false;this.lastZombieToHumanTransformation=game.ticksCounter;this.isHumanZombie=false;this.weapon=weapons[0];this.team=1;this.armor=0;this.hat=this.originalHat;this.handsOffset=0;if(this.isBoss){this.isBoss=false;}var el=document.getElementById("tr_"+this.id);if(el)document.getElementById("statsTable1").appendChild(el);if(this==game.playingPlayer){game.resetPlayingPlayerStats();game.playingPlayerAbilities=pl_abilities;game.setActiveAbilities();game.playingPlayerEnergy=CONST.START_ENERGY;}};Player.prototype.turnZombie=function(noHpSet){if(this==game.playingPlayer)game.playingPlayerIsZombie=true;this.isHumanZombie=true;if(!noHpSet)this.hp=this.maxHP;this.hpRegeneration=game.type.zombieHpRegeneration;this.energyRegeneration=game.type.zombieEnergyReg;this.weapon=weapons[12];this.armor=0;this.team=2;this.hat={name:"Zombie",offset:23,legs:10};this.handsOffset=256;if(this==game.playingPlayer){game.playingPlayerEnergy=this.soulLvl==1?100:CONST.START_ENERGY;}var el=document.getElementById("tr_"+this.id);if(el)document.getElementById("statsTable2").appendChild(el);if(this==game.playingPlayer){game.playingPlayerAbilities=getDefaultZombieAbilityObj(pl_abilities,abilities);game.setActiveAbilities();}};Player.prototype.turnHuman=function(){if(this==game.playingPlayer)game.playingPlayerIsZombie=false;this.isHumanZombie=false;this.weapon=weapons[0];this.team=1;this.resetCooldowns();this.hat=this.originalHat;this.handsOffset=0;var el=document.getElementById("tr_"+this.id);if(el)document.getElementById("statsTable1").appendChild(el);if(this==game.playingPlayer){game.playingPlayerAbilities=pl_abilities;game.setActiveAbilities();}};Player.prototype.resetCooldowns=function(){if(this.weapon&&this.weaponCooldowns[this.weapon.id]>0&&this.weapon.cooldown)this.weaponCooldowns[this.weapon.id]=this.weapon.cooldown;if(this.weapon&&this.weaponCooldowns2[this.weapon.id]>0&&this.weapon.cooldown2)this.weaponCooldowns2[this.weapon.id]=this.weapon.cooldown2;this.stopReloadSound();};Player.prototype.stopReloadSound=function(){if(this.reloadSound2&&this.reloadSound2.pause){this.reloadSound2.pause();this.reloadSound2.currentTime=0;this.reloadSound2=null;}};Player.prototype.hpUpdate=function(hp,armor,splash){var newHP=parseFloat(hp);var newArmor=parseFloat(armor);var diff=parseInt(this.hp-newHP+(this.armor-newArmor));this.hp=newHP;this.armor=newArmor;if(game.playingPlayer==this)game.redScreen=Math.min(diff,100)*5;if(splash!="true"&&diff>9.9&&diff<10.1&&this.lastShieldActivated<=game.ticksCounter&&this.lastShieldActivated+abilities[16].duration>=game.ticksCounter){this.lastShieldHit=game.ticksCounter;soundManager.playSound(SOUND.SHIELD_HIT,this.x,this.y);this.hitUntil=-999;this.lastHit=-999;}};Player.prototype.performLifesteal=function(amount){amount=Math.min(amount,300);this.hp=Math.min(this.maxHP,this.hp+amount);this.lastLifeSteal=game.ticksCounter;if(this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2&&!game.fastForward)for(var i=0;i<amount;i+=5){new Sprite({x:this.x+Math.random()*0.5-0.25,y:this.y+0.5+Math.random()*0.5,img:imgCoords.healRed,scaleFunction:function scaleFunction(age){return(this.ticksToLive-age)/this.ticksToLive*2;},age:Math.random()*10+35,xR:Math.random()*0.1-0.05,xFunction:function xFunction(age){return Math.pow(age,0.7)*this.xR;},zFunction:function zFunction(age){return 1.4+age*0.02;}});}};Player.prototype.disableAbility=function(ab){if(ab.type=="invis"){this.isInvisible=false;if(this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2){createPoundSmoke(this.x,this.y+0.5,0.5,9,0.4);soundManager.playSound(SOUND.INVIS2,this.x,this.y);}}else if(ab.type=="playdead"){this.unturnCorpseTill=game.ticksCounter+ab.duration2;this.isFakeCorpse=false;}};Player.prototype.die=function(projectile,murderWeaponId,objX,objY,objAOE,killer,obj,startX,startY,vecX,vecY,vecH){this.dieAt=game.ticksCounter;this.finallyRemoveAt=game.ticksCounter+100;this.lastKiller=killer;if(game.redFlag&&game.redFlag.carriedBy==this){game.addToObjectsToDraw(game.redFlag);game.redFlag.carriedBy=null;game.redFlag.isActive=true;if(game.getFieldPath(Math.floor(this.x),Math.floor(this.y))>=10){game.redFlag.currentX=this.x;game.redFlag.currentY=this.y;}else{game.redFlag.currentX=game.redFlag.x;game.redFlag.currentY=game.redFlag.y;if(game.playingPlayer&&game.playingPlayer.team==1)game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.self_resetted"),"#36FF36","textInGreen");else game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.enemy_resetted"),"#FF3232","textInRed");soundManager.playSound(SOUND.FRAG1,undefined,undefined,0.68);}}if(game.blueFlag&&game.blueFlag.carriedBy==this){game.addToObjectsToDraw(game.blueFlag);game.blueFlag.carriedBy=null;game.blueFlag.isActive=true;if(game.getFieldPath(Math.floor(this.x),Math.floor(this.y))>=10){game.blueFlag.currentX=this.x;game.blueFlag.currentY=this.y;}else{game.blueFlag.currentX=game.blueFlag.x;game.blueFlag.currentY=game.blueFlag.y;if(game.playingPlayer&&game.playingPlayer.team==2)game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.self_resetted"),"#36FF36","textInGreen");else game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.enemy_resetted"),"#FF3232","textInRed");soundManager.playSound(SOUND.FRAG1,undefined,undefined,0.68);}}if(game.playingPlayer&&game.redFlag&&game.redFlag.carriedBy==this){if(this==game.playingPlayer){}else if(this.team==game.playingPlayer.team){game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.enemy_dropped",{playerName:this.name}),"#FF3232","textInRed");soundManager.playSound(SOUND.FRAG1,undefined,undefined,0.68);}else{game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.self_dropped",{playerName:this.name}),"#36FF36","textInGreen");soundManager.playSound(SOUND.FRAG1,undefined,undefined,0.68);}}if(game.targetLockedPlayer==this)game.targetLockedPlayer=null;if(game.playingPlayer==this)game.resetPlayingPlayerStats();if(window.debugMode){console.log('murderWeaponId',murderWeaponId);}if(murderWeaponId&&weapons[murderWeaponId]&&weapons[murderWeaponId].flameDeath)this.flameDeath=true;if(startX||startY||vecX||vecY||vecH){this.bouncePoints=createBounce2(startX,startY,vecX,vecY,vecH,game);this.noCorpseBounce=true;}else{var vec=createBounce(this,projectile,objX,objY,objAOE,killer,obj,weapons[murderWeaponId]?weapons[murderWeaponId].flameDeath:null,this.weapon);this.bouncePoints=createBounce2(this.x,this.y,vec.x,vec.y,vec.z,game);}};Player.prototype.isShootable=function(){var wID=this.weapon.id;return this.z<=0.6&&this.weaponCooldowns[wID]<=0&&(this.weaponCooldowns2[wID]<=0||this.weaponCooldowns2[wID]>=this.weapon.cooldown2)&&game.noShootUntil<game.ticksCounter;};Player.prototype.getTeamColor=function(){return teamColors[this.team];};Player.prototype.carriesFlag=function(){return game.redFlag&&game.redFlag.carriedBy==this||game.blueFlag&&game.blueFlag.carriedBy==this;};Player.prototype.update=function(){if(this.removeAt&&this.removeAt<=game.ticksCounter)return false;if(this.dieAt){if(this.dieAt+40==game.ticksCounter&&this.isInvisible)this.disableAbility(abilities[4]);if(this.dieAt+20==game.ticksCounter&&game.playingPlayer==this&&(!game.type.coopZombieMode||game.type.convertTime>game.ticksCounter||this.isHumanZombie))uiManager.showDeathScreen(this.lastKiller?this.lastKiller.name:"");if(this.flameDeath){var timeDead=game.ticksCounter-this.dieAt;var pos=Math.floor(timeDead/5);if(pos>this.path.length-2){this.updateBounce();this.flameDeathAndNowBouncing=true;}else{this.x0=this.x;this.y0=this.y;this.x=this.path[pos].x+(this.path[pos+1].x-this.path[pos].x)*(timeDead/5%1);this.y=this.path[pos].y+(this.path[pos+1].y-this.path[pos].y)*(timeDead/5%1);this.direction=getDirectionFromAgle(this.x0,this.y0,this.x,this.y);this.direction2=this.direction;}if(game.ticksCounter%3==1&&this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2&&!game.fastForward){new Sprite({x:this.x+Math.random()*0.6-0.3,y:this.y+Math.random()*0.6-0.3,img:imgCoords["fire"+(Math.floor(Math.random()*4)+1)],scaleFunction:function scaleFunction(age){return Math.max(0.75-age/20,0)*this.r1;},alphaFunction:function alphaFunction(age){return Math.max(0.75-age/20,0);},r1:3+Math.random()*1,zFunction:function zFunction(age){return age*0.1;}});new Sprite({x:this.x+Math.random()*0.6-0.3,y:this.y+Math.random()*0.6-0.3,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return Math.max(0.75-age/70,0)*this.r1;},alphaFunction:function alphaFunction(age){return Math.max(0.40-age/90,0);},r1:3+Math.random()*1,zFunction:function zFunction(age){return age*0.1;}});new Sprite({x:this.x,y:this.y-0.5,img:imgCoords.light_yellow,scaleFunction:function scaleFunction(age){return Math.max(1-age/30,0)*4;},alphaFunction:function alphaFunction(age){return Math.max(1-age/25,0)*0.16;}});}}else this.updateBounce();if(this.dieAt&&game.playingPlayer==this){var timeTillRespawn=Math.floor((this.dieAt+CONST.PLAYER_RESPAWN_DELAY-game.ticksCounter)/20*10)/10;uiManager.countDownDeath(timeTillRespawn);}}else if(this.bouncePoints.length>0)this.updateBounce();else if(this.weapon&&this.switchWeaponUntil<=game.ticksCounter){this.weaponCooldowns[this.weapon.id]--;if(this.isReloading){this.weaponCooldowns2[this.weapon.id]--;if(this.weaponCooldowns2[this.weapon.id]<0){this.isReloading=false;this.stopReloadSound();}}}if(!this.dieAt){this.z0=this.z;if(this.z>0){this.z=Math.max(this.z+this.vz,0);this.vz-=CONST.GRAVITY;if(this.z<=0){this.zNegative=-0.001;this.zNegative0=0;this.vzNegative=Math.max(this.vz*0.9,-0.38);}}if(this.zNegative<0||this.zNegative0<0){this.zNegative0=this.zNegative;this.zNegative+=this.vzNegative;this.vzNegative+=0.15;if(this.zNegative>0)this.zNegative=0;if(this.zNegative0>0)this.zNegative0=0;}this.spillBloodFromMeleeAttack();if(this.isHumanZombie&&this==game.playingPlayer&&game.ticksCounter%20==13){var bestDist=999999;var bestPlayer=null;for(var i=0;i<game.players.length;i++){var p=game.players[i];if(!p.dieAt&&!p.isHumanZombie){var dist=Math.sqrt(Math.pow(p.x-this.x,2)+Math.pow(p.y-this.y,2));if(dist<bestDist&&dist>10){bestDist=dist;bestPlayer=p;}}}this.nextPlayer=bestPlayer;}}if(this.weapon==weapons[2]&&this.lastTickFire+7>game.ticksCounter){var volume=Math.min((this.lastTickFire+7-game.ticksCounter)/5,1)*0.7;if(this.flameSound){this.flameSound.volume=Math.max(volume*soundManager.getVolumeModifier(this.x,this.y),0)*sound_volume;if(this.lastTimeFlameSoundStarted+5300<Date.now()){this.flameSound=soundManager.playSound(SOUND.FLAMETHROWER,this.x,this.y,volume);this.lastTimeFlameSoundStarted=Date.now();}}else{this.flameSound=soundManager.playSound(SOUND.FLAMETHROWER,this.x,this.y,volume);this.lastTimeFlameSoundStarted=Date.now();}}else if(this.flameSound){this.flameSound.pause();this.flameSound.currentTime=0;this.flameSound=null;}if(!this.dieAt&&this.bouncePoints.length==0&&this.lastPosUpdate<game.ticksCounter){if(Math.sqrt(Math.pow(this.x-this.x0,2)+Math.pow(this.y-this.y0,2))<0.005){this.x0=this.x;this.y0=this.y;}var x0=this.x;var y0=this.y;this.x+=this.x-this.x0;this.y+=this.y-this.y0;this.x0=x0;this.y0=y0;if(this.z<=0&&(this.x!=this.x0||this.y!=this.y0)&&this.stepOffset==game.ticksCounter%5)soundManager.playSound(SOUND.STEP,this.x,this.y,0.65);}if(game.type.coopZombieMode&&this.isInvisible&&1==game.ticksCounter%20){for(var i=0;i<game.players.length;i++){if((game.players[i].team!=this.team||this.team==0)&&game.players[i]!=this&&Math.sqrt(Math.pow(game.players[i].x-this.x,2)+Math.pow(game.players[i].y-this.y,2))<3)this.noInvisUntil=game.ticksCounter+40;}for(var i=0;i<game.zombies.length;i++){if(game.zombies[i].team!=this.team&&Math.sqrt(Math.pow(game.zombies[i].x-this.x,2)+Math.pow(game.zombies[i].y-this.y,2))<3)this.noInvisUntil=game.ticksCounter+40;}}this.hp=Math.min(this.hp+this.hpRegeneration,this.maxHP);return true;};Player.prototype.setElo=function(count,x,y){var oldElo=this.elo;this.elo=parseInt(count);var diff=this.elo-oldElo;if(this==game.playingPlayer&&diff>0&&(x||y))game.floatingTexts.push(new FloatingText("+"+diff,x,y-0.6,1700,1,"#B4B7B8",SCALE_FACTOR*6));return diff;};Player.prototype.setKills=function(count){if(this==game.playingPlayer&&this.isHumanZombie&&count==this.kills+1)game.playingPlayerZombieKillStreak++;this.kills=parseInt(count);};Player.prototype.setDeaths=function(count){this.deaths=parseInt(count);if(this==game.playingPlayer&&this.isHumanZombie)game.playingPlayerZombieKillStreak=0;};Player.prototype.emote=function(emote){this.lastEmoteStart=game.ticksCounter;this.lastEmote=emote;};Player.prototype.setSouls=function(count,x,y){var diff=parseInt(count-this.souls);this.souls=parseInt(count);this.soulLvl=getLvlFromSouls(count);if(this==game.playingPlayer&&diff>0&&(x||y))game.floatingTexts.push(new FloatingText("+"+diff,x,y-1.6,1700,1,"#B4B7B8",SCALE_FACTOR*6,imgCoords.souls));if(this==game.playingPlayer&&diff!=0)game.interface_.refreshSouls(this.souls);};Player.prototype.createAtributeEffect=function(){this.lightPillarsTop=[];this.lightPillarsBottom=[];if(!(this.x+5>=game.cameraX&&this.y+5>=game.cameraY&&this.x-5<=game.cameraX2&&this.y-5<=game.cameraY2)||game.fastForward)return;for(var i=0;i<Math.PI*2;i+=0.4+Math.random()*0.15){(i<=Math.PI?this.lightPillarsBottom:this.lightPillarsTop).push({x:Math.sin(i)*0.45+this.x,y:Math.cos(i)*0.45+this.y,w:0.15+Math.random()*0.3,h:Math.random()*1.5,vh:0.05+Math.random()*0.1,vw:Math.random()*0.01,age_offset:Math.random()*8-4,img:imgCoords.pillar_of_light_yellow});}for(var k=0;k<8;k++){var randomAngle=Math.random()*Math.PI*2;var rand=Math.random()*0.7;new Sprite({x:this.x+Math.cos(randomAngle)*rand,y:this.y-SHOT_HEIGHT+Math.sin(randomAngle)*rand,z:Math.random(),img:imgCoords.particleWhite,scaleFunction:function scaleFunction(age){return this.scale_;},scale_:Math.random()*2+2,z_:Math.random()*0.09,zFunction:function zFunction(age){return age*this.z_;},age:21});}new Sprite({x:this.x,y:this.y,img:imgCoords.light_white,scaleFunction:function scaleFunction(age){return Math.max(0,1-age/this.ticksToLive*0.6)*5;},alphaFunction:function alphaFunction(age){return Math.max((-1*(1/((age*0.9-125)/500+0.31)+age/4)+16.9)*3.7,0)*0.04;},age:40});soundManager.playSound(SOUND.ATT_UP,this.x,this.y,0.85);this.lastSpawnTick=game.ticksCounter-8;};Player.prototype.createLvlUpEffect=function(){this.lightPillarsTop=[];this.lightPillarsBottom=[];if(!(this.x+5>=game.cameraX&&this.y+5>=game.cameraY&&this.x-5<=game.cameraX2&&this.y-5<=game.cameraY2)||game.fastForward)return;if(game.playingPlayer==this)game.floatingTexts.push(new FloatingText("+"+CONST.CRYSTALS_PER_SOULS_LVL,this.x,this.y-1,1700,1,"#5cc3ef",SCALE_FACTOR*6,imgCoords.crystals));for(var i=0;i<Math.PI*2;i+=0.25+Math.random()*0.1){(i<=Math.PI?this.lightPillarsBottom:this.lightPillarsTop).push({x:Math.sin(i)*0.6+this.x,y:Math.cos(i)*0.6+this.y,w:0.15+Math.random()*0.3,h:Math.random()*1.5,vh:0.05+Math.random()*0.1,vw:Math.random()*0.01,age_offset:Math.random()*8-4,img:imgCoords.pillar_of_light_blue});}for(var k=0;k<12;k++){var randomAngle=Math.random()*Math.PI*2;var rand=Math.random()*0.7;new Sprite({x:this.x+Math.cos(randomAngle)*rand,y:this.y-SHOT_HEIGHT+Math.sin(randomAngle)*rand,z:Math.random(),img:imgCoords.particleWhite,scaleFunction:function scaleFunction(age){return this.scale_;},scale_:Math.random()*2+2,z_:Math.random()*0.09,zFunction:function zFunction(age){return age*this.z_;},age:26});}new Sprite({x:this.x,y:this.y,img:imgCoords.light_white,scaleFunction:function scaleFunction(age){return Math.max(0,1-age/this.ticksToLive*0.6)*5;},alphaFunction:function alphaFunction(age){return Math.max((-1*(1/((age*0.9-125)/500+0.31)+age/4)+16.9)*3.7,0)*0.04;},age:44});new Sprite({x:this.x,y:this.y,img:imgCoords.light_white,scaleFunction:function scaleFunction(age){return Math.max(0,1-age/this.ticksToLive*0.7)*5;},alphaFunction:function alphaFunction(age){return Math.max((-1*(1/((age*0.9-125)/500+0.31)+age/4)+16.9)*3.7,0)*0.1;},age:60});this.lastSpawnTick=game.ticksCounter;soundManager.playSound(SOUND.LVL_UP,this.x,this.y,this==game.playingPlayer?1:0.5);};Player.prototype.playFragSound=function(multiKillCount,volume){var fragSoundVolume=0.68*(volume?volume:1);if(multiKills[multiKillCount]){soundManager.playSound(SOUND[multiKills[multiKillCount].sound],undefined,undefined,1.0);fragSoundVolume=0.5;}soundManager.playSound(SOUND["FRAG"+Math.min(parseInt(multiKillCount),5)],undefined,undefined,fragSoundVolume);};Player.prototype.isAlliedWith=function(player){return this==player||this.team==player.team&&this.team>=1;};Player.prototype.draw=function(exactTicks,x1,y1,x2,y2,percentageOfCurrentTickPassed){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2)||this.noDraw)return;if(this.laserHitUntil>=exactTicks||this.hitUntil>=exactTicks){percentageOfCurrentTickPassed=0;exactTicks=this.lastHit;}var scale=SCALE_FACTOR*1.4;var frame=0;if(this.ishumanZombie&&this.soulLvl>1)scale*=Math.pow(1.018,this.soulLvl-1);var x=(this.x0+percentageOfCurrentTickPassed*(this.x-this.x0)-game.cameraX)*FIELD_SIZE;var y=(this.y0+percentageOfCurrentTickPassed*(this.y-this.y0)-game.cameraY)*FIELD_SIZE;var h=(this.z0+percentageOfCurrentTickPassed*(this.z-this.z0))*FIELD_SIZE;var x_=x-32/2*scale;var y_=y-(32-12)*scale;var x_recoiled=0;var y_recoiled=0;var weapon=null;var bounce=false;var blackness=0;var whiteness=0;var invisAlpha=1;var isHumanZombie=this.isHumanZombie;var lastTickFire=this.lastTickFire;var hat=this.hat;var team=this.team;var zHead=!this.dieAt&&this.z<=0?-((this.zNegative0+percentageOfCurrentTickPassed*(this.zNegative-this.zNegative0))*FIELD_SIZE*0.25):0;var isInvisible=this.isInvisible;if(isInvisible){if(this.noInvisUntil>=game.ticksCounter)invisAlpha=0.6;else if(!game.playingPlayer||this.isAlliedWith(game.playingPlayer))invisAlpha=0.3;else if(game.showEnemiesOnMinimapUntil>=game.ticksCounter)invisAlpha=0.185;else if(game.playingPlayer&&game.playingPlayer.zombieSense&&Math.sqrt(Math.pow(this.x-game.playingPlayer.x,2)+Math.pow(this.y-game.playingPlayer.y,2))<10)invisAlpha=0.4;else invisAlpha=0.086;}if(game.playingPlayer&&game.bushArray[Math.floor(this.x)]&&game.bushArray[Math.floor(this.x)][Math.floor(this.y)]){if(!this.isAlliedWith(game.playingPlayer)){invisAlpha=0.076;isInvisible=true;if(game.bushArray[Math.floor(game.playingPlayer.x)]&&game.bushArray[Math.floor(game.playingPlayer.x)][Math.floor(game.playingPlayer.y)]&&Math.sqrt(Math.pow(game.playingPlayer.x-this.x,2)+Math.pow(game.playingPlayer.y-this.y,2))<=CONST.BUSH_VISION_RANGE){invisAlpha=0.55;}}else if(game.playingPlayer==this)invisAlpha=0.56;}var weapon;if(this.flameDeath&&!this.flameDeathAndNowBouncing){var timeDead=exactTicks-this.dieAt;blackness=Math.min(timeDead/50,0.9);h=0;if(timeDead<(this.path.length-1)*10)frame=parseInt(exactTicks*0.6%8);}else if(this.dieAt||this.bouncePoints.length>0){if(this.x!=this.x0)this.direction=this.x>this.x0?0:2;else if(this.direction!=2&&this.direction!=0)this.direction=2;frame=this.z>=this.z0||this.z<0.1?1:0;bounce=true;}else{var shiftX=0;var shiftY=0;if(this.z<=0){var shift=game.shiftArray[Math.floor(this.x)]?game.shiftArray[Math.floor(this.x)][Math.floor(this.y)]:null;if(shift&&shift[0])shiftX=shift[0];if(shift&&shift[1])shiftY=shift[1];}if(Math.abs(this.x0+shiftX-this.x)>0.01||Math.abs(this.y0+shiftY-this.y)>0.01){this.direction=getDirectionFromAgle(this.x0,this.y0,this.x,this.y);var dist=Math.sqrt(Math.pow(this.x-this.x0,2)+Math.pow(this.y-this.y0,2));if(game.ticksCounter>0){if(this.z>0)this.legFrame+=exactTickDiff*0.125;else this.legFrame+=exactTickDiff*0.6*(dist/0.202);}frame=Math.floor(this.legFrame)%8;if(tickDiff>0&&game.ticksCounter>=0&&(game.ticksCounter+this.smokeTimeOffset)%6==1&&!game.fastForward)new Sprite({x:this.x+Math.random()*0.6-0.3,y:this.y+Math.random()*0.6-0.3,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+0.75,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.23;},age:(1.7+Math.random())*20,z_:Math.random()*40+32,zFunction:function zFunction(age){return age/this.z_;}});}else{this.direction=0;frame=3;}if(this==game.playingPlayer&&game.ticksCounter>=0&&!window.leavingGame&&this.lastDeathToZombieTransformation+40<exactTicks&&this.lastHumanToZombieTransformation+40<exactTicks&&!this.isFakeCorpse){var newdirection2=getDirectionFromAgle(x,y,KeyManager.x,KeyManager.y);if(newdirection2!=this.direction2){this.direction2=newdirection2;network.send("dirU$"+this.direction2);}}var switchTimer=(exactTicks+CONST.WPN_SWITCH_TICKS-this.switchWeaponUntil)/CONST.WPN_SWITCH_TICKS;weapon=this.weapon;var wpn_offset=0;if(switchTimer<0.17){weapon=this.lastWeapon;wpn_offset=switchTimer*70;}else if(switchTimer<0.83)weapon=null;else if(switchTimer<1)wpn_offset=-(-1+switchTimer)*70;if(isHumanZombie)weapon=null;if(lastTickFire>=exactTicks-8){x_recoiled=x-KeyManager.x;y_recoiled=y-KeyManager.y;var len=Math.sqrt(x_recoiled*x_recoiled+y_recoiled*y_recoiled);var len2=0.2-Math.min(Math.max(exactTicks-lastTickFire-(weapon&&weapon.recoilTime?weapon.recoilTime:3),0)*0.09,0.2);x_recoiled*=len2*FIELD_SIZE/len;y_recoiled*=len2*FIELD_SIZE/len;if(this.weapon&&this.weapon.recoil){x_recoiled*=this.weapon.recoil;y_recoiled*=this.weapon.recoil;}}}var wpn_nr=weapon&&weapon.frames&&lastTickFire+4>exactTicks?parseInt(exactTicks/weapon.cooldown)%weapon.frames+weapon.frame:weapon?weapon.frame:0;if(this.flameDeathAndNowBouncing)blackness=0.9;if(this.hitUntil>=exactTicks)whiteness=Math.random()<0.5?0.95:0.1;var direction=this.direction;var direction2=this.direction2;if(this.laserHitUntil>=exactTicks){whiteness=0.95;weapon=null;direction=this.lockDirection;direction2=this.lockDirection2;}var vanishingAlpha=this.getVanishingAlpha(exactTicks);var nzOffset=0;var standTime=this.standTime;var requiredStandTime=this.weapon.requiredStandTime;if(standTime&&!this.dieAt){nzOffset=Math.min((standTime+percentageOfCurrentTickPassed)/requiredStandTime,1);frame=Math.floor(nzOffset*2);direction=8;nzOffset*=SCALE_FACTOR*2;}if(this.nextPlayer&&this==game.playingPlayer){var a=getAngle(this.x,this.y,this.nextPlayer.x,this.nextPlayer.y);var dist=1.0+Math.max(game.ticksCounter*0.1,0)%1*0.3;c.fillStyle="rgba(0, 0, 0, "+(0.4+Math.sin(exactTicks*0.3)*0.2)+")";c.beginPath();c.moveTo(x+Math.cos(a)*(dist+0.4)*FIELD_SIZE,y+Math.sin(a)*(dist+0.4)*FIELD_SIZE+0.1*FIELD_SIZE);c.lineTo(x+Math.cos(a-0.15)*dist*FIELD_SIZE,y+Math.sin(a-0.15)*dist*FIELD_SIZE+0.1*FIELD_SIZE);c.lineTo(x+Math.cos(a+0.15)*dist*FIELD_SIZE,y+Math.sin(a+0.15)*dist*FIELD_SIZE+0.1*FIELD_SIZE);c.lineTo(x+Math.cos(a)*(dist+0.4)*FIELD_SIZE,y+Math.sin(a)*(dist+0.4)*FIELD_SIZE+0.1*FIELD_SIZE);c.closePath();c.fill();c.fillStyle="rgba(255, 255, 255, "+(0.4+Math.sin(exactTicks*0.3)*0.2)+")";c.beginPath();c.moveTo(x+Math.cos(a)*(dist+0.4)*FIELD_SIZE,y+Math.sin(a)*(dist+0.4)*FIELD_SIZE);c.lineTo(x+Math.cos(a-0.15)*dist*FIELD_SIZE,y+Math.sin(a-0.15)*dist*FIELD_SIZE);c.lineTo(x+Math.cos(a+0.15)*dist*FIELD_SIZE,y+Math.sin(a+0.15)*dist*FIELD_SIZE);c.lineTo(x+Math.cos(a)*(dist+0.4)*FIELD_SIZE,y+Math.sin(a)*(dist+0.4)*FIELD_SIZE);c.closePath();c.fill();}if(this.weapon==weapons[2]&&lastTickFire+2>=exactTicks)c.globalAlpha=0.4;c.globalAlpha*=vanishingAlpha*invisAlpha;c.drawImage(imgs.shadow,x_,y_,32*scale,32*scale);c.globalAlpha=1.0;var age=exactTicks-this.lastSpawnTick;if((team==1||team==2)&&!this.isFakeCorpse){var img=this.team==1?imgCoords.light_red:imgCoords.light_blue;var lightAlpha=1;if(isHumanZombie){img=imgCoords.light_green;lightAlpha=0.33;}var scale2=SCALE_FACTOR*3.5;c.globalAlpha=0.30*invisAlpha*lightAlpha;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x-scale2*img.w/2,y-h-scale2*12,img.w*scale2,img.h*scale2);c.globalAlpha=1;}if(age<25)for(var i=0;i<this.lightPillarsTop.length;i++){this.updateAndDrawPillar(this.lightPillarsTop[i],age);}var flag=team==1?game.blueFlag:game.redFlag;var obj=team==1?imgCoords.blueFlag:imgCoords.redFlag;if(flag&&flag.carriedBy==this)c.drawImage(imgs.miscSheet,obj.x,obj.y,obj.w,obj.h,x-SCALE_FACTOR*obj.w/2,y-h+nzOffset+zHead-frame%2*SCALE_FACTOR/2-SCALE_FACTOR*38,obj.w*SCALE_FACTOR,obj.h*SCALE_FACTOR);var reloadPerc=0;if(!wpn_offset&&!x_recoiled&&!y_recoiled&&this.weapon&&this.weaponCooldowns2[this.weapon.id]>0&&this.weaponCooldowns2[this.weapon.id]<this.weapon.cooldown2&&this.bouncePoints.length==0)reloadPerc=(this.weaponCooldowns2[this.weapon.id]-percentageOfCurrentTickPassed)/this.weapon.cooldown2;if(this.turnCorpseTill>=exactTicks){var dir=this.direction2%2;frame=7-Math.max(Math.min(Math.floor((this.turnCorpseTill-exactTicks)*7/20),7),0);c.drawImage(imgs.zombieDeath,frame*32,32*dir,32,32,x_,y_-h,32*scale,32*scale);return;}if(this.unturnCorpseTill>=exactTicks){var dir=this.direction2%2;frame=Math.max(Math.min(Math.floor((this.unturnCorpseTill-exactTicks)*7/20),7),0);c.drawImage(imgs.zombieDeath,frame*32,32*dir,32,32,x_,y_-h,32*scale,32*scale);return;}if(this.isFakeCorpse){var dir=this.direction2%2;c.drawImage(imgs.zombieDeath,7*32,32*dir,32,32,x_,y_-h,32*scale,32*scale);return;}var normalDraw=true;if(this.lastDeathToZombieTransformation+40>exactTicks){var turnFrame=Math.max(Math.min(Math.floor((exactTicks-this.lastDeathToZombieTransformation)*10/40),10),0);var dir=this.direction2%2;c.globalAlpha=invisAlpha;c.drawImage(imgs.turnZombie,turnFrame*32,dir*32,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;normalDraw=false;weapon=null;hat=this.originalHat;isHumanZombie=false;if(turnFrame<=5){c.globalAlpha=(5-turnFrame)/5;c.drawImage(imgs.legs,(legFrame+3)*32,32*8+hat.legs*288,32,32,x_,y_-h,32*scale,32*scale);if(hat.hatOnly)c.drawImage(imgs.heads,512+legFrame*32,0,32,32,x_,y_-h,32*scale,32*scale);c.drawImage(imgs.heads,512+legFrame*32,32*hat.offset,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}}else if(this.lastHumanToZombieTransformation+40>exactTicks){var turnFrame=Math.max(Math.min(Math.floor((exactTicks-this.lastHumanToZombieTransformation)*10/40),10),0);var turnDirection=this.x0>this.x?0:1;c.globalAlpha=invisAlpha;c.drawImage(imgs.turnZombie,turnFrame*32,(2+turnDirection)*32,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;normalDraw=turnFrame<=4;weapon=null;team=1;hat=this.originalHat;isHumanZombie=false;}else if(this.lastZombieToHumanTransformation+40>exactTicks){var turnFrame=Math.max(Math.min(Math.floor((exactTicks-this.lastZombieToHumanTransformation)*5/40),5),0);c.globalAlpha=invisAlpha;c.drawImage(imgs.turnZombie,turnFrame*32,4*32,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;normalDraw=turnFrame<=0;weapon=null;team=1;hat=this.originalHat;isHumanZombie=false;}else if(this.turnedBossAt+40>exactTicks){var img_=this.isHumanZombie?imgs.zombieBoss:imgs.humanBoss;var transFrame=Math.max(Math.min(Math.floor((exactTicks-this.turnedBossAt)*7/40),7),0);c.drawImage(img_,45*transFrame,45*9,45,45,x-45/2*scale,y-(50-12)*scale-h+nzOffset-frame%2*scale/2+zHead,45*scale,45*scale);normalDraw=false;}if(normalDraw){if(this.lastThrow+7<exactTicks){if(weapon){c.globalAlpha=invisAlpha;c.drawImage(imgs.weaponsMinus,direction2*32+(reloadPerc?256:0),wpn_nr*32,32,32,x_+x_recoiled+Math.sin(frame*(Math.PI/2))*scale/3,y_-h+zHead+nzOffset+wpn_offset+y_recoiled-frame%2*scale/2,32*scale,32*scale);c.drawImage(imgs.weaponsBodyMinus,direction2*32+(reloadPerc?256:0),wpn_nr*32,32,32,x_,y_-h+zHead-frame%2*scale/2,32*scale,32*scale);if(reloadPerc&&(direction2==3||direction2==4||direction2==5)){var reloadFrame=Math.floor(exactTicks/3)%4;c.drawImage(imgs.hands,reloadFrame*32+256,32*direction2,32,32,x_,y_-h+nzOffset+zHead,32*scale,32*scale);}if(weapon.muzzleFlash&&(direction2==3||direction2==4||direction2==5)&&lastTickFire>=Math.floor(exactTicks)-4){var mfi=imgCoords[weapon.muzzleFlash];var mff=-1;if(lastTickFire>=game.ticksCounter-1&&weapon.muzzleFlashAnimationType!="row")mff=Math.floor(exactTicks*0.5)%2;if(lastTickFire>=game.ticksCounter-4&&weapon.muzzleFlashAnimationType=="row")mff=Math.min(Math.floor((exactTicks-1-lastTickFire)*1.0),3);if(mff>=0)c.drawImage(imgs.miscSheet,mfi.x+direction2*52,mfi.y+mff*52,52,52,x_-10*scale+x_recoiled+Math.sin(frame*(Math.PI/2))*scale/2,y_-10*scale-h+zHead+nzOffset+wpn_offset+y_recoiled-frame%2*scale/1.8,52*scale,52*scale);}c.globalAlpha=1;}if(!weapon&&!bounce&&!isHumanZombie){c.globalAlpha=invisAlpha;c.drawImage(imgs.hands,frame*32,32*direction2+this.handsOffset,32,32,x_,y_-h+nzOffset+zHead,32*scale,32*scale);c.globalAlpha=1;if(this.flameDeath){c.globalAlpha=blackness*invisAlpha;c.drawImage(imgs.handsBlack,frame*32,32*direction2+this.handsOffset,32,32,x_,y_-h+zHead,32*scale,32*scale);c.globalAlpha=1;}if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.handsWhite,frame*32,32*direction2+this.handsOffset,32,32,x_,y_-h+nzOffset+zHead,32*scale,32*scale);c.globalAlpha=1;}}}if(bounce){if(this.isBoss){var img_=this.isHumanZombie?imgs.zombieBoss:imgs.humanBoss;var xFrame=Math.floor(Math.min(Math.max((exactTicks-this.dieAt)*0.25,0),6));c.globalAlpha=vanishingAlpha*invisAlpha;c.drawImage(img_,45*xFrame,45*8,45,45,x-45/2*scale,y-(50-12)*scale-h+nzOffset-frame%2*scale/2+zHead,45*scale,45*scale);c.globalAlpha=1;}else if(isHumanZombie){var yFrame=this.direction;if(yFrame>=1)yFrame=1;var xFrame=Math.floor(Math.min(Math.max((exactTicks-this.dieAt)*0.25,0),7));c.globalAlpha=vanishingAlpha*invisAlpha;c.drawImage(imgs.zombieDeath,xFrame*32,32*yFrame,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;if(this.flameDeath){c.globalAlpha=blackness*vanishingAlpha*invisAlpha;c.drawImage(imgs.zombieDeathBlack,xFrame*32,32*yFrame,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}}else{var legFrame=this.direction+frame;var legs_offset=hat.legs==0&&team==2?4:hat.legs;c.globalAlpha=vanishingAlpha*invisAlpha;c.drawImage(imgs.legs,(legFrame+3)*32,32*8+legs_offset*288,32,32,x_,y_-h,32*scale,32*scale);if(hat.hatOnly)c.drawImage(imgs.heads,512+legFrame*32,0,32,32,x_,y_-h,32*scale,32*scale);c.drawImage(imgs.heads,512+legFrame*32,32*hat.offset,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;if(this.flameDeath){c.globalAlpha=blackness*vanishingAlpha*invisAlpha;c.drawImage(imgs.legsBlack,(legFrame+3)*32,32*8+legs_offset*288,32,32,x_,y_-h,32*scale,32*scale);if(hat.hatOnly)c.drawImage(imgs.headsBlack,512+legFrame*32,0,32,32,x_,y_-h,32*scale,32*scale);c.drawImage(imgs.headsBlack,512+legFrame*32,32*hat.offset,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.legsWhite,(legFrame+3)*32,32*8+legs_offset*288,32,32,x_,y_-h,32*scale,32*scale);if(hat.hatOnly)c.drawImage(imgs.headsWhite,512+legFrame*32,0,32,32,x_,y_-h,32*scale,32*scale);c.drawImage(imgs.headsWhite,512+legFrame*32,32*hat.offset,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}}}else if(isHumanZombie&&lastTickFire+12>game.ticksCounter&&!this.flameDeath){var attackAge=game.ticksCounter-lastTickFire;var frame2=attackAge<4?0:256;c.drawImage(imgs.legs,frame*32,32*direction+hat.legs*288,32,32,x_,y_-h,32*scale,32*scale);if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.legsWhite,frame*32,32*direction+hat.legs*288,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}if(this.isBoss){frame2=Math.min(5+attackAge*1,9);c.drawImage(imgs.zombieBoss,45*frame2,45*direction2,45,45,x-45/2*scale,y-(50-12)*scale-h+nzOffset-frame%2*scale/2+zHead,45*scale,45*scale);}else{c.drawImage(imgs.heads,32*direction2+frame2,(hat.offset+1)*32,32,32,x_,y_-h+nzOffset,32*scale,32*scale);if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.headsWhite,32*direction2+frame2,(hat.offset+1)*32,32,32,x_,y_-h+nzOffset,32*scale,32*scale);c.globalAlpha=1;}}}else{var legs_offset=hat.legs==0&&team==2?4:hat.legs;c.globalAlpha=invisAlpha;c.drawImage(imgs.legs,frame*32,32*direction+legs_offset*288,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;if(this.flameDeath){c.globalAlpha=blackness*invisAlpha;c.drawImage(imgs.legsBlack,frame*32,32*direction+legs_offset*288,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.legsWhite,frame*32,32*direction+legs_offset*288,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}if(this.isBoss){var img_=this.isHumanZombie?imgs.zombieBoss:imgs.humanBoss;c.globalAlpha=invisAlpha;c.drawImage(img_,0,45*direction2,45,45,x-45/2*scale,y-(50-12)*scale-h+nzOffset-frame%2*scale/2+zHead,45*scale,45*scale);c.globalAlpha=1;}else{if(hat.hatOnly){c.globalAlpha=invisAlpha;c.drawImage(imgs.heads,direction2*32+(reloadPerc?256:0),0,32,32,x_,y_-h+nzOffset-frame%2*scale/2+zHead,32*scale,32*scale);c.globalAlpha=1;if(this.flameDeath){c.globalAlpha=blackness*invisAlpha;c.drawImage(imgs.headsBlack,direction2*32+(reloadPerc?256:0),0,32,32,x_,y_-h-frame%2*scale/2+zHead,32*scale,32*scale);c.globalAlpha=1;}if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.headsWhite,direction2*32+(reloadPerc?256:0),0,32,32,x_,y_-h+nzOffset-frame%2*scale/2+zHead,32*scale,32*scale);c.globalAlpha=1;}}c.globalAlpha=invisAlpha;c.drawImage(imgs.heads,direction2*32+(reloadPerc?256:0),32*hat.offset,32,32,x_,y_-h+nzOffset-frame%2*scale/2+zHead,32*scale,32*scale);c.globalAlpha=1;if(this.flameDeath){c.globalAlpha=blackness*invisAlpha;c.drawImage(imgs.headsBlack,direction2*32+(reloadPerc?256:0),32*hat.offset,32,32,x_,y_-h-frame%2*scale/2+zHead,32*scale,32*scale);c.globalAlpha=1;}if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.headsWhite,direction2*32+(reloadPerc?256:0),32*hat.offset,32,32,x_,y_-h+nzOffset-frame%2*scale/2+zHead,32*scale,32*scale);c.globalAlpha=1;}}}if(this.lastThrow+7>=exactTicks){c.globalAlpha=invisAlpha;var throwHandsFrame=Math.max(Math.min(Math.floor((exactTicks-this.lastThrow+1)*0.5),3),0);c.drawImage(imgs.throwHands,throwHandsFrame*32,32*direction2,32,32,x_,y_-h+nzOffset+zHead,32*scale,32*scale);c.globalAlpha=1;}else if(weapon){c.globalAlpha=invisAlpha;if(reloadPerc&&direction2!=3&&direction2!=4&&direction2!=5){var reloadFrame=Math.floor(exactTicks/3)%4;c.drawImage(imgs.hands,reloadFrame*32+256,32*direction2,32,32,x_,y_-h+nzOffset+zHead,32*scale,32*scale);}c.drawImage(imgs.weaponsPlus,direction2*32+(reloadPerc?256:0),wpn_nr*32,32,32,x_+x_recoiled+Math.sin(frame*(Math.PI/2))*scale/2,y_-h+zHead+nzOffset+wpn_offset+y_recoiled-frame%2*scale/1.8,32*scale,32*scale);c.drawImage(imgs.weaponsBodyPlus,direction2*32+(reloadPerc?256:0),wpn_nr*32,32,32,x_,y_-h+zHead+nzOffset-frame%2*scale/2,32*scale,32*scale);if(weapon.muzzleFlash&&direction2!=3&&direction2!=4&&direction2!=5&&lastTickFire>=Math.floor(exactTicks)-4){var mfi=imgCoords[weapon.muzzleFlash];var mff=-1;if(lastTickFire>=game.ticksCounter-1&&weapon.muzzleFlashAnimationType!="row")mff=Math.floor(exactTicks*0.5)%2;if(lastTickFire>=game.ticksCounter-4&&weapon.muzzleFlashAnimationType=="row")mff=Math.min(Math.floor((exactTicks-1-lastTickFire)*1.0),2);if(mff>=0)c.drawImage(imgs.miscSheet,mfi.x+direction2*52,mfi.y+mff*52,52,52,x_-10*scale+x_recoiled+Math.sin(frame*(Math.PI/2))*scale/2,y_-10*scale-h+zHead+nzOffset+wpn_offset+y_recoiled-frame%2*scale/1.8,52*scale,52*scale);}c.globalAlpha=1;}if(!weapon&&!bounce&&isHumanZombie&&!this.isBoss&&lastTickFire+12<=game.ticksCounter){c.globalAlpha=invisAlpha;c.drawImage(imgs.hands,frame*32,32*direction2+this.handsOffset,32,32,x_,y_-h+nzOffset+zHead,32*scale,32*scale);c.globalAlpha=1;if(this.flameDeath){c.globalAlpha=blackness*invisAlpha;c.drawImage(imgs.handsBlack,frame*32,32*direction2+this.handsOffset,32,32,x_,y_-h+zHead,32*scale,32*scale);c.globalAlpha=1;}if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.handsWhite,frame*32,32*direction2+this.handsOffset,32,32,x_,y_-h+nzOffset+zHead,32*scale,32*scale);c.globalAlpha=1;}}}if(this.invincibleUntil>=exactTicks){var img_=imgCoords["bubble"+(Math.floor(exactTicks*0.8)%4+1)];c.globalAlpha=Math.max(Math.min(0.25,(this.invincibleUntil-exactTicks)*0.02),0)*(Math.random()*0.2+0.9);c.drawImage(imgs.miscSheet,img_.x,img_.y,img_.w,img_.h,x-img_.w/2*scale,y-h-(img_.h/2+6)*scale,img_.w*scale,img_.h*scale);c.globalAlpha=1;}if(this.lastLifeSteal+10>=exactTicks){var img_=imgCoords.bubbleRed;c.globalAlpha=Math.max(this.lastLifeSteal+10-exactTicks,0)*0.04;c.drawImage(imgs.miscSheet,img_.x,img_.y,img_.w,img_.h,x-img_.w/2*scale,y-h-(img_.h/2+6)*scale,img_.w*scale,img_.h*scale);c.globalAlpha=1;}if(this.startBlinkingGreen<game.ticksCounter&&this.startBlinkingGreen+20*10>=game.ticksCounter){var img_=imgCoords.bubbleGreen;c.globalAlpha=(0.7+Math.sin(exactTicks)*0.3)*0.25;c.drawImage(imgs.miscSheet,img_.x,img_.y,img_.w,img_.h,x-img_.w/2*scale,y-h-(img_.h/2+6)*scale,img_.w*scale,img_.h*scale);c.globalAlpha=1;}if(this.lastShieldActivated<=exactTicks&&this.lastShieldActivated+abilities[16].duration>=exactTicks){var age=Math.min(Math.max(exactTicks-this.lastShieldActivated,0),20)/20;var alphaMod=1;if(age<0.2)alphaMod=age*5;if(age>0.8)alphaMod=(1-age)*5;if(this.lastShieldHit<=exactTicks&&this.lastShieldHit+10>=exactTicks)alphaMod*=0.6;var img_=imgCoords.shield;var img2_=imgCoords.shield2;c.globalAlpha=(Math.cos(exactTicks/2)+1)*0.5*alphaMod;c.drawImage(imgs.miscSheet,img_.x,img_.y,img_.w,img_.h,x-img_.w/2*scale,y-h-(img_.h/2+6)*scale,img_.w*scale,img_.h*scale);c.globalAlpha=(Math.sin(exactTicks/2)+1)*0.5*alphaMod;c.drawImage(imgs.miscSheet,img2_.x,img2_.y,img2_.w,img2_.h,x-img2_.w/2*scale,y-h-(img2_.h/2+6)*scale,img2_.w*scale,img2_.h*scale);c.globalAlpha=1;if(this.lastShieldHit<=exactTicks&&this.lastShieldHit+10>=exactTicks){age=Math.min(Math.max(exactTicks-this.lastShieldHit,0),10)/10;alphaMod=1;if(age<0.1)alphaMod=age*10;if(age>0.5)alphaMod=(1-age)*0.5;img2_=imgCoords.shield3;c.globalAlpha=alphaMod;c.drawImage(imgs.miscSheet,img2_.x,img2_.y,img2_.w,img2_.h,x-img2_.w/2*scale,y-h-(img2_.h/2+6)*scale,img2_.w*scale,img2_.h*scale);c.globalAlpha=1;}}if(this.zombieSense&&!this.isFakeCorpse&&this.hp>0){var phase=exactTicks%16/15;var imgZ=imgCoords.zombieSenseCircle;var scaleZ=scale*(0.25+phase*1.5);c.globalAlpha=Math.max(0.8-phase,0.01);c.drawImage(imgs.miscSheet,imgZ.x,imgZ.y,imgZ.w,imgZ.h,x-imgZ.w/2*scaleZ,y-h-imgZ.h/2*scaleZ-14*scale,imgZ.w*scaleZ,imgZ.h*scaleZ);c.globalAlpha=1;}if(age<25)for(var i=0;i<this.lightPillarsBottom.length;i++){this.updateAndDrawPillar(this.lightPillarsBottom[i],age);}if(isInvisible&&game.playingPlayer&&!this.isAlliedWith(game.playingPlayer))return;var x=(this.x0+percentageOfCurrentTickPassed*(this.x-this.x0)-game.cameraX)*FIELD_SIZE;var y=(this.y0+percentageOfCurrentTickPassed*(this.y-this.y0)-game.cameraY)*FIELD_SIZE;if(this.dieAt)return;var barScale=SCALE_FACTOR*0.55;var barW=42;var barH=game.playingPlayer==this?13:9;var lvlSqSize=0.45*FIELD_SIZE;var x2=x-(barW*barScale+lvlSqSize)/2;var y2=y-1.85*FIELD_SIZE-h;if(this.isBoss)y2-=(this.isHumanZombie?1.0:0.5)*FIELD_SIZE;if(game.type.souls){c.fillStyle="rgba(22, 22, 22, 0.8)";c.fillRect(x2,y2,lvlSqSize,lvlSqSize);drawText(c,this.soulLvl.toString(),"white",4*SCALE_FACTOR,x2+lvlSqSize/2,y2+lvlSqSize*0.75,FIELD_SIZE,"center");x2+=lvlSqSize;}else{x2+=lvlSqSize*0.5;}y2+=lvlSqSize-barH*barScale;c.fillStyle="black";c.fillRect(x2,y2,barW*barScale,barH*barScale);c.fillStyle="rgba(22, 22, 22, 0.8)";c.fillRect(x2,y2-FIELD_SIZE*0.27,barW*barScale,FIELD_SIZE*0.26);var nameX=x;var nameAlign='center';if(game.type.souls){nameX=x2+FIELD_SIZE*0.1;nameAlign='left';}drawText(c,this.unsafeName,this.nameColorCode,FIELD_SIZE*0.22,nameX,y2-FIELD_SIZE*0.05,null,nameAlign,null,null,null,(barW-4)*barScale);var hp=Math.min(this.hp-(this.hpGlideEnd>=exactTicks?this.hpGlideAmount*(this.hpGlideEnd-exactTicks)/(this.hpGlideEnd-this.hpGlideStart):0),this.maxHP);var img=!game.playingPlayer||this.isAlliedWith(game.playingPlayer)?imgCoords.hpBar1:imgCoords.hpBar3;var w=(barW-2)*barScale*(hp/this.maxHP);c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x2+1*barScale,y2+1*barScale,w,barScale*7);c.strokeStyle="rgba(0, 0, 0, 1)";c.lineWidth=barScale;for(var i=CONST.HP_SEPERATOR_AMOUNT;i<this.maxHP;i+=CONST.HP_SEPERATOR_AMOUNT){c.beginPath();c.moveTo(x2+1*barScale+i/this.maxHP*(barW-2)*barScale,y2+6*barScale);c.lineTo(x2+1*barScale+i/this.maxHP*(barW-2)*barScale,y2+8*barScale);c.stroke();}if(this.armor>0){var w2=(barW-2)*(this.armor/CONST.MAX_ARMOR);c.drawImage(imgs.miscSheet,this.armorBar.x,this.armorBar.y,w2*0.7,this.armorBar.h,x2+1*barScale,y2+1*barScale,w2*barScale,7*barScale);c.strokeStyle="#CFD2E0";c.lineWisth=barScale;c.strokeRect(x2+0.5*barScale,y2+0.5*barScale,(barW-1)*barScale,8*barScale);}if(game.playingPlayer==this){var hoverAb=pl_active_abilities[this.hoverAbility];if(KeyManager.keys[commandKeys[COMMAND.ABILITY1]])hoverAb=pl_active_abilities[0];if(KeyManager.keys[commandKeys[COMMAND.ABILITY2]])hoverAb=pl_active_abilities[1];if(!hoverAb&&KeyManager.activeAbility)hoverAb=KeyManager.activeAbility;if(hoverAb){img=imgCoords.barBlue;w=(barW-2)*(hoverAb.energy/100)*barScale;c.globalAlpha=0.6;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x2+1*barScale,y2+9*barScale,w,barScale*3);c.globalAlpha=1;}img=imgCoords.energyBar;w=(barW-2)*(game.playingPlayerEnergy/100)*barScale;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x2+1*barScale,y2+9*barScale,w,barScale*3);}y2+=FIELD_SIZE*0.05;x2=x-FIELD_SIZE*1.56/2;if(this==game.playingPlayer){if(this.switchWeaponUntil>exactTicks){y2-=FIELD_SIZE*0.75;c.fillStyle="black";c.fillRect(x2-FIELD_SIZE*0.03,y2-FIELD_SIZE*0.03,FIELD_SIZE*1.56,FIELD_SIZE*0.30);w=24*(1+(exactTicks-this.switchWeaponUntil)/CONST.WPN_SWITCH_TICKS);if(w>=0)c.drawImage(imgs.miscSheet,imgCoords.barGrey.x,imgCoords.barGrey.y,w,4,x2,y2,SCALE_FACTOR*w,FIELD_SIZE*0.24);drawText(c,slayOne.widgets.lang.get("game.msg.switching_weapon"),"rgba(255, 255, 255, 0.75)",SCALE_FACTOR*3,x2+FIELD_SIZE*1.56/2,y2+SCALE_FACTOR*3,500,"center");}else if(this.weapon&&this.weaponCooldowns[this.weapon.id]>0&&this.weapon.cooldown>7&&this.bouncePoints.length==0){y2-=FIELD_SIZE*0.75;c.fillStyle="black";c.fillRect(x2-FIELD_SIZE*0.03,y2-FIELD_SIZE*0.03,FIELD_SIZE*1.56,FIELD_SIZE*0.30);w=24*((this.weaponCooldowns[this.weapon.id]-percentageOfCurrentTickPassed)/this.weapon.cooldown);if(w>=0)c.drawImage(imgs.miscSheet,imgCoords.barBlue.x,imgCoords.barBlue.y,w,4,x2,y2,SCALE_FACTOR*w,FIELD_SIZE*0.24);}else if(this.weapon&&this.weaponCooldowns2[this.weapon.id]>0&&this.weaponCooldowns2[this.weapon.id]<this.weapon.cooldown2&&this.bouncePoints.length==0){y2-=FIELD_SIZE*0.75;c.fillStyle="black";c.fillRect(x2-FIELD_SIZE*0.03,y2-FIELD_SIZE*0.03,FIELD_SIZE*1.56,FIELD_SIZE*0.30);w=24*((this.weaponCooldowns2[this.weapon.id]-percentageOfCurrentTickPassed)/this.weapon.cooldown2);if(w>=0)c.drawImage(imgs.miscSheet,imgCoords.barBlue.x,imgCoords.barBlue.y,w,4,x2,y2,SCALE_FACTOR*w,FIELD_SIZE*0.24);drawText(c,slayOne.widgets.lang.get("game.msg.reloading"),"rgba(255, 255, 255, 0.75)",SCALE_FACTOR*3,x2+FIELD_SIZE*1.56/2,y2+SCALE_FACTOR*3,500,"center");}else if(game.noShootUntil>exactTicks){y2-=FIELD_SIZE*0.75;c.fillStyle="white";c.fillRect(x2-FIELD_SIZE*0.03,y2-FIELD_SIZE*0.03,FIELD_SIZE*1.56,FIELD_SIZE*0.30);w=24*((exactTicks-(game.noShootUntil-CONST.NO_SHOOT_AFTER_BLINK_TICKS))/CONST.NO_SHOOT_AFTER_BLINK_TICKS);if(w>=0)c.drawImage(imgs.miscSheet,imgCoords.barGrey.x,imgCoords.barGrey.y,w,4,x2,y2,SCALE_FACTOR*w,FIELD_SIZE*0.24);}}if(this.lastEmoteStart+CONST.EMOTE_DURATION>game.ticksCounter&&this.lastEmote){var age=exactTicks-this.lastEmoteStart;if(age<10)c.globalAlpha=age*0.1;else if(age>CONST.EMOTE_DURATION-10)c.globalAlpha=(CONST.EMOTE_DURATION-age)*0.1;var scale=SCALE_FACTOR;var yE=y-FIELD_SIZE*3.5;var imgE=imgCoords.emotesBubble;c.drawImage(imgs.miscSheet,imgE.x,imgE.y,imgE.w,imgE.h,x-imgE.w*0.5*scale,yE,scale*imgE.w,scale*imgE.h);imgE=imgCoords[this.lastEmote.imgString];var scale2=scale*10/imgE.h;c.drawImage(imgs.miscSheet,imgE.x,imgE.y,imgE.w,imgE.h,x-imgE.w*0.5*scale2,yE+2*scale,scale2*imgE.w,scale2*imgE.h);c.globalAlpha=1;}if(this==game.playingPlayer&&this.weapon&&this.weapon.hasLine&&this.standTime>=this.weapon.requiredStandTime){var startX=this.x;var startY=this.y;var vecX=getMouseGamePlayX(KeyManager.x)-startX;var vecY=getMouseGamePlayY(KeyManager.y)-startY;var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=0.1/len;vecY*=0.1/len;var x=startX;var y=startY;var running=true;var counter=0;while(running){counter++;if(game.getFieldPath(Math.floor(x),Math.floor(y))<=5||counter>250)running=false;else{x+=vecX;y+=vecY;}}if(counter>15){var img=imgCoords.particleWhite;var size=SCALE_FACTOR*1.5;for(var i=15+exactTicks%4;i<counter-3;i+=4){c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(startX+vecX*i-game.cameraX)*FIELD_SIZE-size/2,(startY+vecY*i-SHOT_HEIGHT-game.cameraY)*FIELD_SIZE-size/2,size,size);}}}};Zombie.prototype=new Humanoid();function Zombie(id,x,y,hp,x0,y0,maxHP,hpRegeneration,randomizer,imgScale,masterId,name){this.isZombie=true;this.id=parseInt(id);this.team=-1;this.name=name;this.x=x;this.y=y;this.x0=x0?x0:x;this.y0=y0?y0:y;this.x00=x0;this.y00=y0;this.legFrame=0;this.masterId=masterId;this.hp=parseFloat(hp);this.maxHP=parseFloat(maxHP);this.hpRegeneration=parseFloat(hpRegeneration);randomizer=parseFloat(randomizer);if(randomizer==3){this.head=36;this.hat=null;this.legs=9;this.imgScale=1;this.handsOffset=512;this.isDarkZombie=true;}else if(randomizer==4){this.head=23;this.hat=null;this.legs=10;this.imgScale=1;this.handsOffset=256;this.isRangedZombie=true;this.specialImg=imgs.rangedZombie;this.specialImgWhite=imgs.rangedZombieWhite;this.frameOffset=48;this.frameW=24;this.moveFrames=7;this.specialScale=1;this.specialHight=8;}else if(randomizer==5){this.head=23;this.hat=null;this.legs=10;this.imgScale=1;this.handsOffset=256;this.isCrawler=true;this.frameOffset=0;this.specialImg=imgs.crawler;this.specialImgWhite=imgs.crawlerWhite;this.frameW=30;this.specialHight=11;this.moveFrames=3;this.specialScale=0.85;}else{this.head=23;this.hat=randomizer<0.2?hats[zombieSkins[Math.floor(randomizer*5*zombieSkins.length)]]:null;this.legs=this.hat?this.hat.legs:10;this.imgScale=imgScale;this.handsOffset=256;}this.targetX=0;this.targetY=0;this.bleeds=true;this.z=0;this.vz=0;this.z0=0;this.dieAt=0;this.direction=0;this.lastTickFire=-999;this.lastPosUpdate=-999;this.stepOffset=Math.floor(Math.random()*5);this.smokeTimeOffset=Math.floor(Math.random()*10);this.playSpawnAnimation=masterId>0;this.tickOfSpawn=game.ticksCounter;this.bouncePoints=[];this.flameDeath=false;this.flameDeathAndNowBouncing=false;this.path=[];this.laserHitUntil=-999;this.lastHit=-999;this.lockDirection2=0;this.lockDirection=0;this.finallyRemoveAt=0;this.hitUntil=-999;this.lastSpawnTick=-99999;this.lightPillarsTop=[];this.lightPillarsBottom=[];this.invincibleUntil=-9999;if(this.hp<=0){this.dieAt=game.ticksCounter;this.finallyRemoveAt=game.ticksCounter+50;}game.addToObjectsToDraw(this);};Zombie.prototype.hpUpdate=function(hp){this.hp=parseFloat(hp);if(this.hp<=0&&this.isCrawler)createExplosionGreen(this.x,this.y,2.3);};Zombie.prototype.die=function(projectile,murderWeaponId,objX,objY,objAOE,killer,obj,startX,startY,vecX,vecY,vecH){this.dieAt=game.ticksCounter;this.finallyRemoveAt=game.ticksCounter+100;if(this.isCrawler)this.finallyRemoveAt=game.ticksCounter;soundManager.playSound(SOUND.ZOMBIE_DEATH,this.x,this.y,0.6);if(game.targetLockedPlayer==this)game.targetLockedPlayer=null;if(murderWeaponId&&weapons[murderWeaponId]&&weapons[murderWeaponId].flameDeath)this.flameDeath=true;if(startX||startY||vecX||vecY||vecH){this.bouncePoints=createBounce2(startX,startY,vecX,vecY,vecH,game);this.noCorpseBounce=true;}else{var vec=createBounce(this,projectile,objX,objY,objAOE,killer,obj);this.bouncePoints=createBounce2(this.x,this.y,vec.x,vec.y,vec.z,game);}};Zombie.prototype.update=function(){if(this.finallyRemoveAt&&this.finallyRemoveAt<=game.ticksCounter){if(game.type.coopZombieMode&&!this.isCrawler)this.createCorpse();return false;}if(this.dieAt){if(this.flameDeath){var timeDead=game.ticksCounter-this.dieAt;var pos=Math.floor(timeDead/5);if(pos>this.path.length-2){this.updateBounce();this.flameDeathAndNowBouncing=true;}else{this.x0=this.x;this.y0=this.y;this.x=this.path[pos].x+(this.path[pos+1].x-this.path[pos].x)*(timeDead/5%1);this.y=this.path[pos].y+(this.path[pos+1].y-this.path[pos].y)*(timeDead/5%1);this.direction=getDirectionFromAgle(this.x0,this.y0,this.x,this.y);}if(!game.fastForward&&game.ticksCounter%3==1&&this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2){new Sprite({x:this.x+Math.random()*0.6-0.3,y:this.y+Math.random()*0.6-0.3,img:imgCoords["fire"+(Math.floor(Math.random()*4)+1)],scaleFunction:function scaleFunction(age){return Math.max(0.75-age/20,0)*this.r1;},alphaFunction:function alphaFunction(age){return Math.max(0.75-age/20,0);},r1:3+Math.random()*1,zFunction:function zFunction(age){return age*0.1;}});new Sprite({x:this.x+Math.random()*0.6-0.3,y:this.y+Math.random()*0.6-0.3,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return Math.max(0.75-age/70,0)*this.r1;},alphaFunction:function alphaFunction(age){return Math.max(0.40-age/90,0);},r1:3+Math.random()*1,zFunction:function zFunction(age){return age*0.1;}});new Sprite({x:this.x,y:this.y-0.5,img:imgCoords.light_yellow,scaleFunction:function scaleFunction(age){return Math.max(1-age/30,0)*4;},alphaFunction:function alphaFunction(age){return Math.max(1-age/25,0)*0.16;}});}}else{this.updateBounce();if(this.isRangedZombie&&this.dieAt+5==game.ticksCounter){soundManager.playSound(SOUND.ZOMBIE_BITE,this.x,this.y,0.8);soundManager.playSound(SOUND.ZOMBIE_ATT,this.x,this.y,0.9);}}}else if(this.bouncePoints.length>0)this.updateBounce();if(!this.dieAt){if(this.x!=this.x0||this.y!=this.y0)this.direction=getDirectionFromAgle(this.x0,this.y0,this.x,this.y);this.z0=this.z;if(this.z>0){this.z=Math.max(this.z+this.vz,0);this.vz-=CONST.GRAVITY;}this.spillBloodFromMeleeAttack();}if(!this.dieAt&&this.bouncePoints.length==0&&this.lastPosUpdate<game.ticksCounter){if(Math.sqrt(Math.pow(this.x-this.x0,2)+Math.pow(this.y-this.y0,2))<0.005){this.x0=this.x;this.y0=this.y;}var x0=this.x;var y0=this.y;this.x+=this.x-this.x0;this.y+=this.y-this.y0;this.x0=x0;this.y0=y0;if(this.z<=0&&(this.x!=this.x0||this.y!=this.y0)&&this.stepOffset==game.ticksCounter%5)soundManager.playSound(SOUND.STEP,this.x,this.y,0.65);}this.hp=Math.min(this.hp+this.hpRegeneration,this.maxHP);return true;};Zombie.prototype.isAlliedWith=function(player){return player&&player.isHumanZombie;};Zombie.prototype.performPreHit=function(victim){this.lastTickFire=game.ticksCounter;this.targetX=victim.x;this.targetY=victim.y;this.victim=victim;if(this.isCrawler)this.dieAt=game.ticksCounter;if(this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2)soundManager.playSound(SOUND.ZOMBIE_ATT,victim.x,victim.y);};Zombie.prototype.draw=function(exactTicks,x1,y1,x2,y2,percentageOfCurrentTickPassed){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2))return;if(this.laserHitUntil>=exactTicks||this.hitUntil>=exactTicks){percentageOfCurrentTickPassed=0;exactTicks=this.lastHit;}var scale=SCALE_FACTOR*1.4*this.imgScale;var frame=0;var x=(this.x0+percentageOfCurrentTickPassed*(this.x-this.x0)-game.cameraX)*FIELD_SIZE;var y=(this.y0+percentageOfCurrentTickPassed*(this.y-this.y0)-game.cameraY)*FIELD_SIZE;var h=(this.z0+percentageOfCurrentTickPassed*(this.z-this.z0))*FIELD_SIZE;var x_=x-32/2*scale;var y_=y-(32-12)*scale;var bounce=false;var blackness=0;var whiteness=0;if(this.flameDeath&&!this.flameDeathAndNowBouncing){var timeDead=exactTicks-this.dieAt;blackness=Math.min(timeDead/50,0.9);if(timeDead<(this.path.length-1)*10)frame=parseInt(exactTicks*0.6%8);}else if(this.dieAt||this.bouncePoints.length>0){if(this.x!=this.x0)this.direction=this.x>this.x0?0:2;else if(this.direction!=2&&this.direction!=0)this.direction=2;frame=this.z>=this.z0||this.z<0.1?1:0;bounce=true;}else{var shiftX=0;var shiftY=0;if(this.z<=0){var shift=game.shiftArray[Math.floor(this.x)]?game.shiftArray[Math.floor(this.x)][Math.floor(this.y)]:null;if(shift&&shift[0])shiftX=shift[0];if(shift&&shift[1])shiftY=shift[1];}if(Math.abs(this.x0+shiftX-this.x)>0.01||Math.abs(this.y0+shiftY-this.y)>0.01){var dist=Math.sqrt(Math.pow(this.x-this.x0,2)+Math.pow(this.y-this.y0,2));if(game.ticksCounter>0){if(this.z>0)this.legFrame+=timeDiff*0.0025;else this.legFrame+=timeDiff*0.012*dist/0.202;}frame=Math.floor(this.legFrame)%8;if(tickDiff>0&&game.ticksCounter>=0&&(game.ticksCounter+this.smokeTimeOffset)%6==1&&!game.fastForward)new Sprite({x:this.x+Math.random()*0.6-0.3,y:this.y+Math.random()*0.6-0.3,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+0.75,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.23;},age:(1.7+Math.random())*20,z_:Math.random()*40+32,zFunction:function zFunction(age){return age/this.z_;}});}else frame=3;}if(this.flameDeathAndNowBouncing)blackness=0.9;if(this.hitUntil>=exactTicks)whiteness=Math.random()<0.5?0.95:0.1;var direction=this.direction;if(this.laserHitUntil>=exactTicks){whiteness=0.95;direction=this.lockDirection;}var vanishingAlpha=this.getVanishingAlpha(exactTicks);c.globalAlpha=0.4*vanishingAlpha;c.drawImage(imgs.shadow,x_,y_,32*scale,32*scale);c.globalAlpha=1.0;var age=exactTicks-this.lastSpawnTick;if(age<25)for(var i=0;i<this.lightPillarsTop.length;i++){this.updateAndDrawPillar(this.lightPillarsTop[i],age);}if(bounce){if(this.specialImg){var rFrame=Math.floor(Math.min(Math.max((exactTicks-this.dieAt-2)*0.35,0),8));x_=x-this.frameW/2*scale*this.specialScale;y_=y-(this.frameW-this.specialHight)*scale*this.specialScale;c.drawImage(this.specialImg,rFrame*this.frameW,8*this.frameW,this.frameW,this.frameW,x_,y_,this.frameW*scale*this.specialScale,this.frameW*scale*this.specialScale);}else{var yFrame=this.direction;if(yFrame>=1)yFrame=1;var xFrame=Math.floor(Math.min(Math.max((exactTicks-this.dieAt)*0.25,0),7));c.globalAlpha=vanishingAlpha;c.drawImage(imgs.zombieDeath,xFrame*32,32*yFrame,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;if(this.flameDeath){c.globalAlpha=blackness*vanishingAlpha;c.drawImage(imgs.zombieDeathBlack,xFrame*32,32*yFrame,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}}}else{if(this.playSpawnAnimation&&this.tickOfSpawn+30>=exactTicks){var spawnAge=game.ticksCounter-this.tickOfSpawn;var frame2=Math.floor(Math.min(spawnAge/30*8,7));var imgS=this.isRangedZombie?imgCoords.zombieSpawn2:imgCoords.zombieSpawn1;if(this.isDarkZombie)imgS=imgCoords.zombieSpawn3;if(this.isCrawler)imgS=imgCoords.zombieSpawn4;c.drawImage(imgs.miscSheet,imgS.x+frame2*32,imgS.y,32,imgS.h,x_,y_-h,32*scale*this.specialScale,32*scale*this.specialScale);if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.miscSheetWhite,imgS.x+frame2*32,imgS.y,32,imgS.h,x_,y_-h,32*scale*this.specialScale,32*scale*this.specialScale);c.globalAlpha=1;}}else if(this.lastTickFire+12>game.ticksCounter&&!this.flameDeath){var attackAge=game.ticksCounter-this.lastTickFire;direction=getDirectionFromAgle(this.x,this.y,this.targetX,this.targetY);this.direction=direction;if(this.specialImg){c.globalAlpha=0.4*vanishingAlpha;c.drawImage(imgs.shadow,x_,y_+4*scale,32*scale,32*scale);c.globalAlpha=1.0;var rFrame=attackAge<=4?0:1;x_=x-this.frameW/2*scale*this.specialScale;y_=y-(this.frameW-this.specialHight)*scale*this.specialScale;c.drawImage(this.specialImg,rFrame*this.frameW,direction*this.frameW,this.frameW,this.frameW,x_,y_-h,this.frameW*scale*this.specialScale,this.frameW*scale*this.specialScale);if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(this.specialImgWhite,rFrame*this.frameW,direction*this.frameW,this.frameW,this.frameW,x_,y_-h,this.frameW*scale*this.specialScale,this.frameW*scale*this.specialScale);c.globalAlpha=1;}}else{var frame2=attackAge<4?0:256;frame=2;c.drawImage(imgs.legs,frame*32,32*direction+this.legs*288,32,32,x_,y_-h,32*scale,32*scale);if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.legsWhite,frame*32,32*direction+this.legs*288,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}c.drawImage(imgs.heads,32*direction+frame2,(this.head+1)*32,32,32,x_,y_-h,32*scale,32*scale);if(this.hat)c.drawImage(imgs.heads,32*direction+frame2,32*(1+this.hat.offset),32,32,x_,y_-h-frame%2*scale/2,32*scale,32*scale);if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.headsWhite,32*direction+frame2,(this.head+1)*32,32,32,x_,y_-h,32*scale,32*scale);if(this.hat)c.drawImage(imgs.headsWhite,32*direction+frame2,32*(1+this.hat.offset),32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}}}else{if(this.specialImg){c.globalAlpha=0.4*vanishingAlpha;c.drawImage(imgs.shadow,x_,y_+4*scale,32*scale,32*scale);c.globalAlpha=1.0;var rFrame=frame==3?0:Math.floor(exactTicks*0.6)%this.moveFrames;x_=x-this.frameW/2*scale*this.specialScale;y_=y-(this.frameW-this.specialHight)*scale*this.specialScale;c.drawImage(this.specialImg,rFrame*this.frameW+this.frameOffset,direction*this.frameW,this.frameW,this.frameW,x_,y_-h,this.frameW*scale*this.specialScale,this.frameW*scale*this.specialScale);if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(this.specialImgWhite,rFrame*this.frameW+this.frameOffset,direction*this.frameW,this.frameW,this.frameW,x_,y_-h,this.frameW*scale*this.specialScale,this.frameW*scale*this.specialScale);c.globalAlpha=1;}}else{c.drawImage(imgs.legs,frame*32,32*direction+this.legs*288,32,32,x_,y_-h,32*scale,32*scale);if(this.flameDeath){c.globalAlpha=blackness;c.drawImage(imgs.legsBlack,frame*32,32*direction+this.legs*288,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.legsWhite,frame*32,32*direction+this.legs*288,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}c.drawImage(imgs.heads,direction*32,32*this.head,32,32,x_,y_-h-frame%2*scale/2,32*scale,32*scale);if(this.hat)c.drawImage(imgs.heads,direction*32,32*this.hat.offset,32,32,x_,y_-h-frame%2*scale/2,32*scale,32*scale);if(this.flameDeath){c.globalAlpha=blackness;c.drawImage(imgs.headsBlack,direction*32,32*this.head,32,32,x_,y_-h-frame%2*scale/2,32*scale,32*scale);if(this.hat)c.drawImage(imgs.headsBlack,direction*32,32*this.hat.offset,32,32,x_,y_-h-frame%2*scale/2,32*scale,32*scale);c.globalAlpha=1;}if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.headsWhite,direction*32,32*this.head,32,32,x_,y_-h-frame%2*scale/2,32*scale,32*scale);if(this.hat)c.drawImage(imgs.headsWhite,direction*32,32*this.hat.offset,32,32,x_,y_-h-frame%2*scale/2,32*scale,32*scale);c.globalAlpha=1;}c.drawImage(imgs.hands,frame*32,32*direction+this.handsOffset,32,32,x_,y_-h,32*scale,32*scale);if(this.flameDeath){c.globalAlpha=blackness;c.drawImage(imgs.handsBlack,frame*32,32*direction+this.handsOffset,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.handsWhite,frame*32,32*direction+this.handsOffset,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}}}}if(age<25)for(var i=0;i<this.lightPillarsBottom.length;i++){this.updateAndDrawPillar(this.lightPillarsBottom[i],age);}var x=(this.x0+percentageOfCurrentTickPassed*(this.x-this.x0)-game.cameraX)*FIELD_SIZE;var y=(this.y0+percentageOfCurrentTickPassed*(this.y-this.y0)-game.cameraY)*FIELD_SIZE;if(this.dieAt)return;var barScale=SCALE_FACTOR*0.55;var barW=42;var barH=8;var x2=x-barW*barScale/2;var y2=y-1.85*FIELD_SIZE-h;var nameColor=NAME_COLOR[50].code;if(this.name&&this.name.length>0){var nameX=x;var nameAlign='center';if(game.type.souls){nameX=x2+FIELD_SIZE*0.1;nameAlign='left';}drawText(c,this.name,nameColor,FIELD_SIZE*0.22,nameX,y2-FIELD_SIZE*0.05,null,nameAlign,null,null,null,(barW-4)*barScale);}c.fillStyle="black";c.fillRect(x2,y2,barW*barScale,barH*barScale);var hp=Math.min(this.hp-(this.hpGlideEnd>=exactTicks?this.hpGlideAmount*(this.hpGlideEnd-exactTicks)/(this.hpGlideEnd-this.hpGlideStart):0),this.maxHP);var img=game.playingPlayer&&this.isAlliedWith(game.playingPlayer)?imgCoords.hpBar1:imgCoords.hpBar3;var w=(barW-2)*barScale*(hp/this.maxHP);c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x2+1*barScale,y2+1*barScale,w,barScale*6);c.strokeStyle="rgba(0, 0, 0, 1)";c.lineWidth=barScale;for(var i=CONST.HP_SEPERATOR_AMOUNT;i<this.maxHP;i+=CONST.HP_SEPERATOR_AMOUNT){c.beginPath();c.moveTo(x2+1*barScale+i/this.maxHP*(barW-2)*barScale,y2+5*barScale);c.lineTo(x2+1*barScale+i/this.maxHP*(barW-2)*barScale,y2+7*barScale);c.stroke();}};Corpse.prototype=new Humanoid();function Corpse(id,x,y,z,burned,direction,bouncePoints,scale){this.id=id;this.x=x;this.y=y;this.z=z;this.x0=x;this.y0=y;this.z0=z;this.x00=x;this.y00=y;this.z00=z;this.burned=burned;if(direction>=1)direction=1;this.direction=direction;this.bouncePoints=bouncePoints?bouncePoints:[];this.spillBloodUntil=-99999;this.bloodX=0;this.bloodY=0;this.scale=scale?scale:1;this.isCorpse=true;game.addToObjectsToDraw(this);};Corpse.prototype.update=function(){this.updateBounce();if(this.spillBloodUntil>=game.ticksCounter)this.updateBlood();return true;};Corpse.prototype.hpUpdate=function(hp,armor,splash,attacker){this.spillBlood(attacker);};Corpse.prototype.spillBlood=function(source){this.spillBloodUntil=game.ticksCounter+5;this.bloodX=source.x-this.x;this.bloodY=source.y-this.y;};Corpse.prototype.updateBlood=function(){if(this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2){var vecX=this.bloodX;var vecY=this.bloodY;var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=0.015/len;vecY*=0.015/len;new Blood(this.x+vecX,this.y+vecY,-vecX,-vecY,null,false,function(age){return 0.8+-Math.pow(age*0.05-0.5,2);},true,0.4);new Blood(this.x+vecX,this.y+vecY,-vecX+Math.random()-0.5,-vecY+Math.random()-0.5,null,true,function(age){return 0.5+-Math.pow(age*0.05-0.5);},true,0.4);new Blood(this.x+vecX,this.y+vecY,-vecX,-vecY,imgCoords.particleWhite,true,function(age){return 0.8+-Math.pow(age*0.05-0.5,2);},true,0.4);}};Corpse.prototype.draw=function(exactTicks,x1,y1,x2,y2,percentageOfCurrentTickPassed){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2))return;var scale=SCALE_FACTOR*1.4*this.scale;var x=(this.x0+percentageOfCurrentTickPassed*(this.x-this.x0)-game.cameraX)*FIELD_SIZE;var y=(this.y0+percentageOfCurrentTickPassed*(this.y-this.y0)-game.cameraY)*FIELD_SIZE;var h=(this.z0+percentageOfCurrentTickPassed*(this.z-this.z0))*FIELD_SIZE;var x_=x-32/2*scale;var y_=y-(32-12)*scale;var blackness=this.burned?0.9:0;if(this.bouncePoints.length>0)this.direction=this.x>this.x0?0:1;c.drawImage(imgs.shadow,x_,y_,32*scale,32*scale);var yFrame=this.direction;var xFrame=7;c.drawImage(imgs.zombieDeath,xFrame*32,32*yFrame,32,32,x_,y_-h,32*scale,32*scale);if(blackness){c.globalAlpha=blackness;c.drawImage(imgs.zombieDeathBlack,xFrame*32,32*yFrame,32,32,x_,y_-h,32*scale,32*scale);c.globalAlpha=1;}};function MovableObject(id,x,y,x0,y0,type,hp){this.id=parseInt(id);this.x=x;this.y=y;this.x0=x0?x0:x;this.y0=y0?y0:y;this.x00=x0;this.y00=y0;this.dieAt=0;this.maxHP=type.hp?type.hp:999999;this.hp=hp?hp:this.maxHP;this.dieAt=0;this.finallyRemoveAt=999999;this.noDraw=false;this.isMovableObject=true;this.lastHit=-99999;this.z=0;this.vz=0;this.z0=0;this.lastPosUpdate=-999;this.smokeTimeOffset=Math.floor(Math.random()*10);this.type=type;game.addToObjectsToDraw(this);};MovableObject.prototype.blink=function(x,y){this.x=parseFloat(x);this.y=parseFloat(y);this.x0=this.x;this.y0=this.y;var vecX=this.x-this.x00;var vecY=this.y-this.y00;var dist=Math.sqrt(Math.pow(vecX,2)+Math.pow(vecY,2));var x=this.x00;var y=this.y00;vecX*=1/dist;vecY*=1/dist;if(!game.fastForward){for(var i=0;i<dist;i+=0.75){x+=vecX;y+=vecY;new Sprite({x:x+Math.random()*0.6-0.3,y:y+Math.random()*0.6-0.3-0.5,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.25,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.25;},age:(1.7+Math.random())*20});new Sprite({x:x+Math.random()*0.6-0.3,y:y+Math.random()*0.6-0.3-0.5,img:imgCoords.particleWhite,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.55,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.8;},age:Math.random()*4+10});}soundManager.playSound(SOUND.BLINK,this.x00,this.y00);createBlinkEffect(this.x00,this.y00);createBlinkEffect(this.x,this.y);}};MovableObject.prototype.update=function(){this.z0=this.z;if(this.z>0){this.z=Math.max(this.z+this.vz,0);this.vz-=CONST.GRAVITY;}if(this.lastPosUpdate<game.ticksCounter){if(Math.sqrt(Math.pow(this.x-this.x0,2)+Math.pow(this.y-this.y0,2))<0.005){this.x0=this.x;this.y0=this.y;}var x0=this.x;var y0=this.y;this.x+=this.x-this.x0;this.y+=this.y-this.y0;this.x0=x0;this.y0=y0;}if(this.dieAt&&this.dieAt+1==game.ticksCounter&&this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2){createPoundSmoke(this.x,this.y+0.6,0.45,9);soundManager.playSound(SOUND.WOODCRACK,this.x,this.y,0.8);for(var i=0;i<5;i++){new Sprite({x:this.x+Math.random()*1.2-0.6,y:this.y+Math.random()*1.2-0.6,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.5,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.17;},age:(1.7+Math.random())*20,z_:Math.random()*40+32,zFunction:function zFunction(age){return age/this.z_;}});}}return this.finallyRemoveAt>game.ticksCounter;};MovableObject.prototype.getYDrawingOffset=function(){return this.y;};MovableObject.prototype.hpUpdate=function(hp,armor,splash,attacker){this.hp=parseFloat(hp);this.lastHit=game.ticksCounter;if(attacker&&(attacker.isZombie||attacker.isHumanZombie))soundManager.playSound(SOUND.MECH_IMPACT,this.x,this.y,0.7);if(this.hp<=0){this.finallyRemoveAt=game.ticksCounter+30;if(this.hp==-55){new Splash(this.x,this.y,imgCoords.splash,2.5);this.finallyRemoveAt=game.ticksCounter;}this.dieAt=game.ticksCounter;}};MovableObject.prototype.draw=function(exactTicks,x1,y1,x2,y2,percentageOfCurrentTickPassed){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2)||this.noDraw)return;var scale=SCALE_FACTOR*1.0;var scale_shadow=SCALE_FACTOR*1.6;var x=(this.x0+percentageOfCurrentTickPassed*(this.x-this.x0)-game.cameraX)*FIELD_SIZE;var y=(this.y0+percentageOfCurrentTickPassed*(this.y-this.y0)-game.cameraY)*FIELD_SIZE;var h=(this.z0+percentageOfCurrentTickPassed*(this.z-this.z0))*FIELD_SIZE;var img=this.type.img;if(this.hp<this.maxHP*0.33)img=this.type.img3;else if(this.hp<this.maxHP*0.66)img=this.type.img2;if(this.dieAt&&this.dieAt<=exactTicks){var deathFrame=Math.max(Math.floor((exactTicks-4-this.dieAt)*0.3),0);img=this.type["deathImg"+(deathFrame+1)];if(!img)return;}if(!img)img=this.type.img;var x_=x-img.w/2*scale;var y_=y-(img.h-12)*scale;var shiftX=0;var shiftY=0;if(this.z<=0){var shift=game.shiftArray[Math.floor(this.x)]?game.shiftArray[Math.floor(this.x)][Math.floor(this.y)]:null;if(shift&&shift[0])shiftX=shift[0];if(shift&&shift[1])shiftY=shift[1];}if((Math.abs(this.x0+shiftX-this.x)>0.01||Math.abs(this.y0+shiftY-this.y)>0.01)&&!game.fastForward&&tickDiff>0&&game.ticksCounter>=0&&(game.ticksCounter+this.smokeTimeOffset)%6==1)new Sprite({x:this.x+Math.random()*0.6-0.3,y:this.y+Math.random()*0.6-0.3,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+0.75,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.23;},age:(1.7+Math.random())*20,z_:Math.random()*40+32,zFunction:function zFunction(age){return age/this.z_;}});c.drawImage(imgs.shadow,x-32/2*scale_shadow,y-(32-12)*scale_shadow,32*scale_shadow,32*scale_shadow);var sheet=this.lastHit+1>=game.ticksCounter?imgs.tileSheetWhite:imgs.tileSheet;c.drawImage(imgs.tileSheet,img.x,img.y,img.w,img.h,x_,y_-h,img.w*scale,img.h*scale);if(game.ticksCounter>0&&this.lastHit+1>=game.ticksCounter){c.globalAlpha=0.7+game.ticksCounter%2%10;c.drawImage(imgs.tileSheetWhite,img.x,img.y,img.w,img.h,x_,y_-h,img.w*scale,img.h*scale);c.globalAlpha=1;}};function Ammo(weapon,x,y,id){this.x=x;this.y=y;this.id=id;this.weapon=weapons[weapon];this.itemType=this.weapon?null:itemTypes[weapon-1000];this.isAmmo=true;this.currentX=x;this.currentY=y;this.carriedBy=null;this.isActive=true;this.respawnAt=-9999;this.isFlag=this.itemType&&(this.itemType.special=="redFlag"||this.itemType.special=="blueFlag");this.img=this.weapon?imgCoords[this.weapon.img]:imgCoords[this.itemType.img];this.shine=this.weapon||this.itemType.shine;this.scale=1;if(this.weapon)this.scale*=0.55;if(this.itemType&&this.itemType.scale)this.scale*=this.itemType.scale;this.lastSpawnTick=-99999;this.lightPillarsTop=[];this.lightPillarsBottom=[];var realXInt=Math.floor(this.x);var realYInt=Math.floor(this.y);if(game.pathingArray[realXInt]&&game.pathingArray[realXInt][realYInt])game.pathingArray[realXInt][realYInt]=11;};Ammo.prototype.getYDrawingOffset=function(){return this.currentY-0.7;};Ammo.prototype.pickUp=function(playerID,isRespawn){if(game.playingPlayer&&playerID==game.playingPlayer.id){game.lastPickUp=Date.now();var ammoSize=this.weapon&&this.weapon.ammoSize?game.type.global_ammo_mod?Math.ceil(this.weapon.ammoSize*game.type.global_ammo_mod):this.weapon.ammoSize:null;if(this.weapon&&this.weapon.ammoSize){if(game.playingPlayerClips[this.weapon.id]+game.playingPlayerAmmo[this.weapon.id]<=0){var clip=Math.min(ammoSize,this.weapon.clipSize);game.playingPlayerClips[this.weapon.id]=clip;game.playingPlayerAmmo[this.weapon.id]+=ammoSize-clip;}else game.playingPlayerAmmo[this.weapon.id]+=ammoSize;soundManager.playSound(SOUND.COCK,this.x,this.y,0.6);game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.weapon_pickup",{weapon:this.weapon.name}),"#BEBEBE","textInGrey",false,imgCoords[this.weapon.img]);}if(this.itemType&&this.itemType.pickupMsg){soundManager.playSound(SOUND[this.itemType.pickupSound],this.x,this.y,0.6);game.interface_.setMainKillMsg(this.itemType.pickupMsg,"#BEBEBE","textInGrey",false,this.itemType.img?imgCoords[this.itemType.img]:null);}}else if(this.x>game.cameraX-2&&this.y>game.cameraY-2&&this.x<game.cameraX2+2&&this.y<game.cameraY2+2)soundManager.playSound(this.itemType&&this.itemType.pickupSound?SOUND[this.itemType.pickupSound]:SOUND.COCK,this.x,this.y,0.35);var player=game.getPlayerFromID(playerID);var customRespawnTime=0;if(this.itemType&&player){if(this.itemType.hpRestored)player.hp=Math.min(player.maxHP,player.hp+this.itemType.hpRestored);if(this.itemType.armorRestored)player.armor=Math.min(CONST.MAX_ARMOR,player.armor+this.itemType.armorRestored);if(this.isFlag){var enemyFlag=this.itemType.special=="redFlag"?game.blueFlag:game.redFlag;var myTeam=this.itemType.special=="redFlag"?1:2;var enemyTeam=this.itemType.special=="redFlag"?2:1;if(player.team==enemyTeam){this.carriedBy=player;this.isActive=false;if(game.playingPlayer){if(player==game.playingPlayer){game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.self_pick_enemy"),"#36FF36","textInGreen");soundManager.playSound(SOUND.FRAG2,undefined,undefined,0.68);}else if(player.team==game.playingPlayer.team){game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.others_pick_enemy",{playerName:player.name}),"#36FF36","textInGreen");soundManager.playSound(SOUND.FRAG2,undefined,undefined,0.68);}else{game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.others_pick_self",{playerName:player.name}),"#FF3232","textInRed");soundManager.playSound(SOUND.FRAG2,undefined,undefined,0.68);}}}else if(player.team==myTeam&&(this.currentX!=this.x||this.currentY!=this.y)){this.currentX=this.x;this.currentY=this.y;customRespawnTime=5;if(game.playingPlayer){if(player==game.playingPlayer){game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.self_reset_self"),"#36FF36","textInGreen");soundManager.playSound(SOUND.FRAG1,undefined,undefined,0.68);}else if(player.team==game.playingPlayer.team){game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.others_reset_self",{playerName:player.name}),"#36FF36","textInGreen");soundManager.playSound(SOUND.FRAG1,undefined,undefined,0.68);}else{game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.flag.others_reset_enemy",{playerName:player.name}),"#FF3232","textInRed");soundManager.playSound(SOUND.FRAG1,undefined,undefined,0.68);}}}else if(player.team==myTeam&&this.currentX==this.x&&this.currentY==this.y&&enemyFlag.carriedBy==player){if(game.type.flag){if(this.itemType.special=="redFlag"){game.scoreTeam1++;}else{game.scoreTeam2++;}F$('rankInGame').refreshTeamScore();}if(game.playingPlayer){if(player==game.playingPlayer){var count=0;for(var i=0;i<game.players.length;i++){if(game.players[i].authLevel>=AUTH_LEVEL.GUEST)count++;}var xp=authLevel>=AUTH_LEVEL.PLAYER?getFlagXPFromPlayerCount(count):0;game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.teamdm.score.self_self")+(xp>0?" (+"+xp+" xp)":""),"#36FF36","textInGreen");soundManager.playSound(SOUND.FRAG4,undefined,undefined,0.8);}else if(player.team==game.playingPlayer.team){game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.teamdm.score.others_self",{playerName:player.name}),"#36FF36","textInGreen");soundManager.playSound(SOUND.FRAG4,undefined,undefined,0.78);}else{game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.teamdm.score.others_others",{playerName:player.name}),"#FF3232","textInRed");soundManager.playSound(SOUND.FRAG3,undefined,undefined,0.68);}}game.addCircle(this.x,this.y,imgCoords.whiteCircle);enemyFlag.isActive=true;enemyFlag.createSpawnEffect();enemyFlag.carriedBy=null;enemyFlag.currentX=enemyFlag.x;enemyFlag.currentY=enemyFlag.y;return false;}else return false;}}if(customRespawnTime||!(this.itemType&&this.itemType.respawnPeriod&&this.itemType.respawnPeriod<0)){var respawnPeriod=game.ticksCounter+this.getRespawnPeriod();if(this.weapon&&this.weapon.respawnPeriod)respawnPeriod=game.ticksCounter+this.weapon.respawnPeriod;if(this.itemType&&this.itemType.respawnPeriod)respawnPeriod=game.ticksCounter+this.itemType.respawnPeriod;if(isRespawn){this.respawnAt=respawnPeriod-2;}else{this.respawnAt=9999999999;}this.isActive=false;}return true;};Ammo.prototype.getRespawnPeriod=function(){var respawnPeriod=CONST.ITEM_RESPAWN_TIME;if(this.weapon&&this.weapon.respawnPeriod)respawnPeriod=this.weapon.respawnPeriod;if(this.itemType&&this.itemType.respawnPeriod)respawnPeriod=this.itemType.respawnPeriod;return respawnPeriod;};Ammo.prototype.createSpawnEffect=function(){this.lightPillarsTop=[];this.lightPillarsBottom=[];if(!(this.x+5>=game.cameraX&&this.y+5>=game.cameraY&&this.x-5<=game.cameraX2&&this.y-5<=game.cameraY2))return;for(var i=0;i<Math.PI*2;i+=0.5+Math.random()*0.15){(i<=Math.PI?this.lightPillarsBottom:this.lightPillarsTop).push({x:Math.sin(i)*0.45+this.x,y:Math.cos(i)*0.45+this.y,w:0.15+Math.random()*0.3,h:Math.random()*1.5,vh:0.04+Math.random()*0.08,vw:Math.random()*0.01,age_offset:Math.random()*8-4});}this.lastSpawnTick=game.ticksCounter;soundManager.playSound(SOUND.AMMO_SPAWN,this.x,this.y,0.6);};Ammo.prototype.updateAndDrawPillar=function(p,age){p.h+=p.vh*exactTickDiff;p.w+=p.vw*exactTickDiff;var x=(p.x-p.w/2-game.cameraX)*FIELD_SIZE;var y=(p.y-p.h-game.cameraY)*FIELD_SIZE;var this_age=age+p.age_offset;c.globalAlpha=(this_age<5?Math.max(this_age/5,0):this_age<10?1:Math.max(2.0-this_age/10,0))*0.4;c.drawImage(imgs.miscSheet,imgCoords.pillar_of_light.x,imgCoords.pillar_of_light.y,imgCoords.pillar_of_light.w,imgCoords.pillar_of_light.h,x,y,p.w*FIELD_SIZE,p.h*FIELD_SIZE);};Ammo.prototype.draw=function(exactTicks,x1,y1,x2,y2){if(!(this.currentX+3>=x1&&this.currentY+3>=y1&&this.currentX-3<=x2&&this.currentY-3<=y2)||game.editingMode)return;var age=exactTicks-this.lastSpawnTick;if(!this.isFlag){var img=imgCoords.itemSpawn;var x_offset=0;var timeTillRespawn=this.respawnAt-exactTicks;if(timeTillRespawn<=11){if(timeTillRespawn>=0)x_offset=(1+Math.floor((11-timeTillRespawn)*5/11))*16;else if(timeTillRespawn>=-8)x_offset=(1+Math.floor((8+timeTillRespawn)*5/8))*16;}var x=(this.currentX-game.cameraX-0.5)*FIELD_SIZE;var y=(this.currentY-game.cameraY-0.5)*FIELD_SIZE;c.drawImage(imgs.miscSheet,img.x+x_offset,img.y,16,16,x,y,16*SCALE_FACTOR,16*SCALE_FACTOR);if(!this.isActive&&game.showEnemiesOnMinimapUntil>=exactTicks){var perc=Math.min(Math.max(Math.floor((1-timeTillRespawn/this.getRespawnPeriod())*9),0),8);var img=imgCoords["filler"+perc];var scale=SCALE_FACTOR*0.7;c.globalAlpha=0.75+Math.sin(exactTicks*0.2)*0.25;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x+(FIELD_SIZE+1*SCALE_FACTOR)*0.5-img.w*0.5*scale,y+FIELD_SIZE*0.38-img.h*0.5*scale,img.w*scale,img.h*scale);c.globalAlpha=1;}}if(!this.isActive)return;if(age<25)for(var i=0;i<this.lightPillarsTop.length;i++){this.updateAndDrawPillar(this.lightPillarsTop[i],age);}var scale=this.scale*SCALE_FACTOR;var x=(this.currentX-game.cameraX)*FIELD_SIZE+-this.img.w/2*scale;var y=(this.currentY+(this.itemType&&this.itemType.yOffset?this.itemType.yOffset:0)-0.2-game.cameraY)*FIELD_SIZE+((this.weapon?4:8)-this.img.h)*scale;var shineAlpha=age<15?0:Math.min((age-15)/10,1);if(this.shine){y+=Math.sin(exactTicks*0.35)*FIELD_SIZE*0.15;var shineImg=imgCoords.itemShineFloor;var x2=(this.x-game.cameraX)*FIELD_SIZE+-shineImg.w/2*SCALE_FACTOR;var y2=(this.y-game.cameraY)*FIELD_SIZE+(8-shineImg.h)*SCALE_FACTOR;c.globalAlpha=(0.25+Math.sin(exactTicks*0.45)*0.066)*shineAlpha;c.drawImage(imgs.miscSheet,shineImg.x,shineImg.y,shineImg.w,shineImg.h,x2,y2,shineImg.w*SCALE_FACTOR,shineImg.h*SCALE_FACTOR);}c.globalAlpha=age<8?Math.max(age/8,0):1;c.drawImage(imgs.miscSheet,this.img.x,this.img.y,this.img.w,this.img.h,x,y,this.img.w*scale,this.img.h*scale);if(age<25)for(var i=0;i<this.lightPillarsBottom.length;i++){this.updateAndDrawPillar(this.lightPillarsBottom[i],age);}if(this.shine){var shineImg=imgCoords.itemShine;var x2=(this.x-game.cameraX)*FIELD_SIZE+-shineImg.w/2*SCALE_FACTOR;var y2=(this.y-game.cameraY)*FIELD_SIZE+(8-shineImg.h)*SCALE_FACTOR;c.globalAlpha=(0.6+Math.sin(exactTicks*0.45)*0.25)*shineAlpha;c.drawImage(imgs.miscSheet,shineImg.x,shineImg.y,shineImg.w,shineImg.h,x2,y2,shineImg.w*SCALE_FACTOR,shineImg.h*SCALE_FACTOR);}c.globalAlpha=1;};function Projectile(startX,startY,vecX,vecY,lifetime,id,weapon,isHomingMissile,remainingBullets,isMulti,playerID,aoe){this.x=parseFloat(startX);this.y=parseFloat(startY);this.x0=parseFloat(startX);this.y0=parseFloat(startY);if(!isMulti){if(weapon.soundName)soundManager.playSound(SOUND[weapon.soundName],this.x,this.y,weapon.volume?weapon.volume:1);if(weapon.poundSmokeSize){createPoundSmoke(this.x,this.y,weapon.poundSmokeSize,10);var now=Date.now();game.rumbleUntil=now+500;game.rumblePower=0.05*weapon.poundSmokeSize;game.rumbleStart=now;}}if(remainingBullets==0&&weapon.lastShotSound&&!isMulti)soundManager.playSound(SOUND[weapon.lastShotSound],this.x,this.y);this.vecX=parseFloat(vecX);this.vecY=parseFloat(vecY);this.stepVecX=this.vecX;this.stepVecY=this.vecY;var factor=Math.sqrt(this.vecX*this.vecX+this.vecY*this.vecY)/weapon.projectileSpeed;this.vecX/=factor;this.vecY/=factor;this.dmg=weapon?weapon.dmg:0;this.weapon=weapon;this.aoe=aoe?parseFloat(aoe):weapon.aoe;this.isMulti=isMulti;this.createDrawLens();this.speed=this.weapon&&this.weapon.projectileSpeed?this.weapon.projectileSpeed:0.1;this.tickOfDeath=parseFloat(lifetime)+game.ticksCounter;this.tickOfCreation=game.ticksCounter;this.id=id;this.playerID=playerID;this.rocketSound=null;this.lastTimeRocketSoundStarted=-9999;this.isHomingMissile=isHomingMissile==1;this.prediction=[];this.stepVecX=0;this.stepVecY=0;this.steps=0;this.skipNextUpdate=false;this.dieAt=0;game.addToObjectsToDraw(this);if(!isMulti&&!game.fastForward&&this.x+4>=game.cameraX&&this.y+4>=game.cameraY&&this.x-4<=game.cameraX2&&this.y-4<=game.cameraY2){if(this.weapon.isLaser){new Sprite({x:this.x+this.drawLenX*0.2,y:this.y+this.drawLenY*0.2-SHOT_HEIGHT,img:imgCoords[weapon.light],scaleFunction:function scaleFunction(age){return 1;},alphaFunction:function alphaFunction(){return 0.2;},age:1});}if(this.weapon.spawnBullets&&graphics[graphicSettings].spawnBullets)new Bullet(this.x,this.y);if(this.weapon.isRocket&&this.weapon.noRocketEffects){new Sprite({x:this.x+this.drawLenX*2+Math.random()*0.5-0.25,y:this.y+this.drawLenY*2+Math.random()*0.5-0.25-SHOT_HEIGHT,img:imgCoords[this.weapon.spawnLight?this.weapon.spawnLight:"light_yellow"],scaleFunction:function scaleFunction(age){return 5;},age:8});new Sprite({x:this.x+this.drawLenX*2+Math.random()*0.15-0.075,y:this.y+this.drawLenY*2+Math.random()*0.15-0.075-SHOT_HEIGHT,img:imgCoords[this.weapon.spawnLight?this.weapon.spawnLight:"light_yellow"],scaleFunction:function scaleFunction(age){return 1;},age:8});new Sprite({x:this.x+this.drawLenX*1+Math.random()*0.15-0.075,y:this.y+this.drawLenY*1+Math.random()*0.15-0.075-SHOT_HEIGHT,img:imgCoords[this.weapon.spawnLight?this.weapon.spawnLight:"light_yellow"],scaleFunction:function scaleFunction(age){return 1;},age:8});new Sprite({x:this.x+this.drawLenX*1+Math.random()*0.1-0.05,y:this.y+this.drawLenY*1+Math.random()*0.1-0.05-SHOT_HEIGHT,img:imgCoords.light_white,scaleFunction:function scaleFunction(age){return 0.5;},age:8});new Sprite({x:this.x-this.drawLenX*3+Math.random()*0.1-0.05,y:this.y-this.drawLenY*3+Math.random()*0.1-0.05-SHOT_HEIGHT,img:imgCoords[this.weapon.spawnLight?this.weapon.spawnLight:"light_yellow"],scaleFunction:function scaleFunction(age){return 1;},age:8});}if(this.weapon==weapons[8]){var x=this.x+this.drawLenX*5.5;var y=this.y+this.drawLenY*5.5;for(var i=0;i<5;i++){new Sprite({x:x+Math.random()*0.3-0.15,y:y-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(2.7+Math.random())*20,x_:this.drawLenX*2.25,y_:this.drawLenY*2.25,i_:i/5,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*5*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*5*this.i_*this.y_;}});}for(var i=1;i<3;i++){new Sprite({x:x+Math.random()*0.3-0.15,y:y-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.3;},age:(2.7+Math.random())*20,x_:-this.drawLenY*2.25,y_:this.drawLenX*2.25,i_:i/5,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*3*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*3*this.i_*this.y_;}});}for(var i=1;i<3;i++){new Sprite({x:x+Math.random()*0.3-0.15,y:y-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust2,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.3;},age:(2.7+Math.random())*20,x_:this.drawLenY*2.25,y_:-this.drawLenX*2.25,i_:i/5,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*3*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*3*this.i_*this.y_;}});}new Sprite({x:x,y:y-SHOT_HEIGHT,img:imgCoords.light_yellow,scaleFunction:function scaleFunction(age){return 5;},age:7});}if(this.weapon.isRocket){var x=this.x;var y=this.y;for(var i=0;i<5;i++){new Sprite({x:x+Math.random()*0.3-0.15,y:y-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(2.7+Math.random())*20,x_:this.drawLenX*4.25,y_:this.drawLenY*4.25,i_:i/5,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.y_;}});}if(!this.weapon.noRocketEffects)for(var i=1;i<3;i++){new Sprite({x:x+Math.random()*0.3-0.15,y:y-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(2.7+Math.random())*20,x_:-this.drawLenY*8.25,y_:this.drawLenX*8.25,i_:i/5,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.y_;}});}if(!this.weapon.noRocketEffects)for(var i=1;i<3;i++){new Sprite({x:x+Math.random()*0.3-0.15,y:y-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(2.7+Math.random())*20,x_:this.drawLenY*8.25,y_:-this.drawLenX*8.25,i_:i/5,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.y_;}});}if(!this.weapon.noRocketEffects)for(var i=1;i<6;i++){new Sprite({x:this.x-this.drawLenX*2+Math.random()*0.3-0.15,y:this.y-this.drawLenY*2-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.25,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(2.7+Math.random())*20,x_:-this.drawLenX*8.25,y_:-this.drawLenY*8.25,i_:i/8,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.y_;}});}new Sprite({x:x,y:y-SHOT_HEIGHT,img:imgCoords[this.weapon.spawnLight?this.weapon.spawnLight:"light_yellow"],scaleFunction:function scaleFunction(age){return 5;},age:7});}}};Projectile.prototype.createDrawLens=function(){var len=Math.sqrt(this.vecX*this.vecX+this.vecY*this.vecY)*(this.isMulti?Math.random()*0.2+0.9:1);this.drawLenX=this.vecX*0.2/len;this.drawLenY=this.vecY*0.2/len;this.vecX/=len/this.weapon.projectileSpeed;this.vecY/=len/this.weapon.projectileSpeed;};Projectile.prototype.reflectionUpdate=function(x,y,vecX,vecY){var oldVecX=this.vecX;var oldVecY=this.vecY;this.x0=this.x;this.y0=this.y;this.x=parseFloat(x);this.y=parseFloat(y);this.vecX=parseFloat(vecX);this.vecY=parseFloat(vecY);var len=Math.sqrt(this.vecX*this.vecX+this.vecY*this.vecY);var vecX=this.vecX*0.1/len;var vecY=this.vecY*0.1/len;this.createDrawLens();this.skipNextUpdate=true;var stepX=(this.vecX-oldVecX)/2;var stepY=(this.vecY-oldVecY)/2;if(this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2){if(!(Math.abs(stepX)<0.01&&stepY<0)){new PlasmaShield(this.x,this.y,this.x+stepX,this.y+stepY);for(var i=0;i<5;i++){new Sprite({x:this.x,y:this.y,img:imgCoords[this.weapon.particle],scaleFunction:function scaleFunction(age){return this.r4-age*0.2;},age:5+Math.random()*5,r1:Math.random()*0.6+0.7,r2:stepX*0.3+stepX*0.4*Math.random(),r3:stepY*0.3+stepY*0.4*Math.random(),r4:Math.random()*2+1,zFunction:function zFunction(age){return 0.6*Math.max(0.3,Math.abs(Math.cos(age*this.r1*0.2))/Math.max(1,age*0.2))-0.3;},xFunction:function xFunction(age){return(-5/(age*0.08+1)+5)*this.r2;},yFunction:function yFunction(age){return(-5/(age*0.08+1)+5)*this.r3;}});}for(var k=0;k<2;k++){new Sprite({x:this.x+Math.random()*0.6-0.3,y:this.y+Math.random()*0.6-0.3,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.2;},age:(1.7+Math.random())*20,z_:Math.random()*40+12,zFunction:function zFunction(age){return SHOT_HEIGHT+age/this.z_;}});}}soundManager.playSound(SOUND.REFLECT,this.x,this.y,0.6);soundManager.playSound(SOUND.SIZZLE,this.x,this.y,0.2);new Sprite({x:this.x,y:this.y,img:imgCoords[this.weapon.light],scaleFunction:function scaleFunction(age){return Math.max(0,4-age/this.ticksToLive*4);},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.17;},age:15});}};Projectile.prototype.blink=function(x,y,oldX,oldY){if(this.dmg<10){soundManager.playSound(SOUND.BLINK,this.x,this.y,0.40);createBlinkEffectVerySmall(parseFloat(oldX)-0.2+Math.random()*0.4,parseFloat(oldY)-0.2+Math.random()*0.4);}else{createBlinkEffectSmall(parseFloat(oldX)-0.2+Math.random()*0.4,parseFloat(oldY)-0.2+Math.random()*0.4);soundManager.playSound(SOUND.BLINK,this.x,this.y,0.65);}this.x=parseFloat(x);this.y=parseFloat(y);this.x0=this.x;this.y0=this.y;if(this.dmg<10){createBlinkEffectVerySmall(this.x-0.25+Math.random()*0.5,this.y-0.25+Math.random()*0.5);soundManager.playSound(SOUND.BLINK,this.x,this.y,0.40);}else{createBlinkEffectSmall(this.x-0.25+Math.random()*0.5,this.y-0.25+Math.random()*0.5);soundManager.playSound(SOUND.BLINK,this.x,this.y,0.65);}};Projectile.prototype.normalizeVector=function(){var factor=Math.sqrt(this.vecX*this.vecX+this.vecY*this.vecY)/this.speed;this.stepVecX=this.vecX/factor;this.stepVecY=this.vecY/factor;this.steps=1;var len=Math.sqrt(this.stepVecX*this.stepVecX+this.stepVecY*this.stepVecY);if(len>0.1){this.steps=Math.ceil(len/0.1);this.stepVecX/=this.steps;this.stepVecY/=this.steps;}};Projectile.prototype.makePrediction=function(){this.normalizeVector();var x=this.x;var y=this.y;if(this.prediction.length>0){x=this.prediction[this.prediction.length-1].x;y=this.prediction[this.prediction.length-1].y;}var vecX=this.stepVecX;var vecY=this.stepVecY;while(this.prediction.length<30){for(var k=0;k<this.steps;k++){x+=vecX;y+=vecY;var newXFloor=Math.floor(x);var newYFloor=Math.floor(y);var reflection=false;if(game.getFieldPath(newXFloor,newYFloor)<=5){for(var i=0;i<game.objects.length;i++){if(game.objects[i].blocks&&game.objects[i].intX==newXFloor&&game.objects[i].intY==newYFloor){return;}}reflection=true;x-=vecX*2;vecX*=-1;block=game.getFieldPath(Math.floor(x),Math.floor(y));if(block<=5){x+=vecX*2;y-=vecY*2;vecX*=-1;vecY*=-1;block=game.getFieldPath(Math.floor(x),Math.floor(y));if(block<=5){x-=vecX*2;vecX*=-1;}}}if(k==this.steps-1||reflection)this.prediction.push({x:x,y:y,reflection:reflection,step:k==this.steps-1});}}};Projectile.prototype.update=function(){if(this.dieAt&&this.dieAt+10<=game.ticksCounter)return false;if(this.dieAt)return true;if(this.skipNextUpdate)this.skipNextUpdate=false;else{this.x0=this.x;this.y0=this.y;this.x+=this.vecX;this.y+=this.vecY;}if(this.prediction.length>0){var node=this.prediction.splice(0,1);while(node&&node[0]&&!node[0].step){var node=this.prediction.splice(0,1);}}if(this.weapon.isRocket&&!game.fastForward&&this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2&&Math.random()<0.8&&!this.weapon.noRocketEffects)new Sprite({x:this.x0+Math.random()*0.4-0.2,y:this.y0-SHOT_HEIGHT+Math.random()*0.4-0.2,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+0.75,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(1.7+Math.random())*20,z_:Math.random()*40+32,zFunction:function zFunction(age){return age/this.z_;}});if(this.weapon.isRocket){if(this.rocketSound){var volume=soundManager.getVolumeModifier(this.x,this.y);if(isNaN(volume)||volume<=0)volume=0;this.rocketSound.volume=0.35*volume*sound_volume;if(this.lastTimeRocketSoundStarted+700<Date.now()){this.rocketSound=soundManager.playSound(this.weapon.flySound?SOUND[this.weapon.flySound]:SOUND.ROCKET_FLY,this.x,this.y,0.35);this.lastTimeRocketSoundStarted=Date.now();}}else{this.rocketSound=soundManager.playSound(this.weapon.flySound?SOUND[this.weapon.flySound]:SOUND.ROCKET_FLY,this.x,this.y,0.35);this.lastTimeRocketSoundStarted=Date.now();}}if(this.isHomingMissile&&this.tickOfCreation==game.ticksCounter-1)soundManager.playSound(SOUND.ROCKET_BEEP,this.x,this.y,0.65);return this.tickOfDeath>=game.ticksCounter;};Projectile.prototype.createHitEffect=function(player){if(!game.fastForward&&this.x+5>=game.cameraX&&this.y+5>=game.cameraY&&this.x-5<=game.cameraX2&&this.y-5<=game.cameraY2){if(this.weapon.isLaser){var x=this.x;var y=this.y;if(player){var vecX=this.x-player.x;var vecY=this.y-player.y;var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=CONST.PLAYER_RADIUS/len;vecY*=CONST.PLAYER_RADIUS/len;x=player.x+vecX;y=player.y+vecY;if(player.invincibleUntil<game.ticksCounter){player.laserHitUntil=game.ticksCounter+3;player.lastHit=game.ticksCounter;player.lockDirection=player.direction;player.lockDirection2=player.direction2;soundManager.playSound(SOUND.SIZZLE2,this.x,this.y,0.47);}else soundManager.playSound(SOUND.SIZZLE,this.x,this.y,0.2);}for(var k=0;k<3;k++){new Sprite({x:x+Math.random()*0.6-0.3,y:y+Math.random()*0.6-0.3,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.4;},age:(1.7+Math.random())*20,z_:Math.random()*40+12,zFunction:function zFunction(age){return SHOT_HEIGHT+age/this.z_;}});}for(var k=0;k<9;k++){var randomAngle=Math.random()*Math.PI*2;var rand=Math.random()*0.7;new Sprite({x:x+Math.cos(randomAngle)*rand,y:y-SHOT_HEIGHT+Math.sin(randomAngle)*rand,img:imgCoords[this.weapon.particle],scaleFunction:function scaleFunction(age){return this.scale_;},scale_:Math.random()*3+2,alphaFunction:function alphaFunction(age){return Math.floor(Math.random()*3)*0.44;},age:4});}new Sprite({x:x,y:y,img:imgCoords.light_white,scaleFunction:function scaleFunction(age){return Math.max(0,1-age/this.ticksToLive*0.3)*7;},alphaFunction:function alphaFunction(age){return Math.floor(Math.random()*3)*0.066;},age:4});new Sprite({x:x,y:y,img:imgCoords.light_purple,scaleFunction:function scaleFunction(age){return Math.max(0,1-age/this.ticksToLive*0.3)*5;},alphaFunction:function alphaFunction(age){return Math.floor(Math.random()*3)*0.066;},age:4});}else if(this.weapon.normalProjectile){if(player&&player.bleeds&&player.invincibleUntil<game.ticksCounter){var vecX=this.x-player.x;var vecY=this.y-player.y;var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=CONST.PLAYER_RADIUS/len;vecY*=CONST.PLAYER_RADIUS/len;var x=player.x+vecX;var y=player.y+vecY;for(var k=0;k<2;k++){new Blood(x,y,-vecX,-vecY);}}soundManager.playSound(SOUND.GUN_IMPACT,this.x,this.y,1.0);if(player&&player.invincibleUntil<game.ticksCounter)soundManager.playSound(SOUND.GUN_IMPACT_2,this.x,this.y,1.0);}if(this.weapon.isZombieRangedWeapon)new Splash(this.x+this.vecX,this.y+this.vecY-0.4,imgCoords.rangedZombieImpact,1.15,40,false);}if(!this.dieAt&&this.playerID==game.playingPlayerID&&this.weapon.isHeatSeeking2)game.playingPlayerCountActiveHeatseeking2Missiles--;this.dieAt=game.ticksCounter+10;};Projectile.prototype.createDeathEffect=function(x,y,comboDeath){x=parseFloat(x);y=parseFloat(y);if(this.weapon.isZombieRangedWeapon&&!game.fastForward&&this.x+5>=game.cameraX&&this.y+5>=game.cameraY&&this.x-5<=game.cameraX2&&this.y-5<=game.cameraY2){new Splash(x,y,imgCoords.rangedZombieImpact,1.15,40,false);soundManager.playSound(SOUND.ZOMBIE_BITE,x,y,1.0);}if(this.weapon.isRocket){if(x+10>=game.cameraX&&y+10>=game.cameraY&&x-10<=game.cameraX2&&y-10<=game.cameraY2){var aoe=comboDeath=="1"&&this.weapon.comboAoe?this.weapon.comboAoe:this.aoe;var sound=this.weapon.impactSound?SOUND[this.weapon.impactSound]:SOUND.EXPLODE;if(comboDeath=="1"&&this.weapon.impactSoundCombo)sound=SOUND[this.weapon.impactSoundCombo];createExplosion(x,y,aoe,null,this.weapon.redExplosion);soundManager.playSound(sound,x,y);game.corpseBounce(x,y,this.aoe);}if(this.rocketSound){this.rocketSound.pause();this.rocketSound.currentTime=0;}return;}if(!(this.x+4>=game.cameraX&&this.y+4>=game.cameraY&&this.x-4<=game.cameraX2&&this.y-4<=game.cameraY2)||game.fastForward)return;var x_=this.x;var y_=this.y;var stepX=this.vecX/100;var stepY=this.vecY/100;var i=0;while(game.getFieldPath(Math.floor(x_),Math.floor(y_))<=5){x_-=stepX;y_-=stepY;i++;if(i>200)return;}i=0;while(game.getFieldPath(Math.floor(x_),Math.floor(y_))>5&&i<200){x_+=stepX;y_+=stepY;i++;if(i>200)return;}var p1x=x_-stepX;var p1y=y_+stepY;var p2x=x_+stepX;var p2y=y_-stepY;var p3x=x_-stepX;var p3y=y_-stepY;var px=0;var py=0;if(game.getFieldPath(Math.floor(p1x),Math.floor(p1y))>5){var px=p1x;var py=p1y;}else if(game.getFieldPath(Math.floor(p2x),Math.floor(p2y))>5){var px=p2x;var py=p2y;}else if(game.getFieldPath(Math.floor(p3x),Math.floor(p3y))>5){var px=p3x;var py=p3y;}else return;var stepX1=((px+x_-stepX)/2-x_)*50;var stepY1=((py+y_-stepY)/2-y_)*50;stepX=(px-x_)*50;stepY=(py-y_)*50;if(this.weapon.normalProjectile){var x_circular=stepY1>stepX1?1:0;var y_circular=stepX1>stepY1?1:0;var z_circular=1;for(var i=0;i<9;i++){new Sprite({x:x_,y:y_,img:imgCoords.particle2,scaleFunction:function scaleFunction(age){return this.r4;},age:10+Math.random()*30,r1:Math.random()*0.6+0.7,r2:stepX1*0.6+0.8*Math.random()-0.4,r3:stepY1*0.6+0.8*Math.random()-0.4,r4:Math.random()*1.0+0.5,zFunction:function zFunction(age){return 0.6*Math.max(0.3,Math.abs(Math.cos(age*this.r1*0.2))/Math.max(1,age*0.2));},xFunction:function xFunction(age){return(-5/(Math.min(age,7)*0.28+1.6)+3)*this.r2;},yFunction:function yFunction(age){return(-5/(Math.min(age,7)*0.28+1.6)+3)*this.r3;}});}for(var i=0;i<4;i++){new Sprite({x:x_,y:y_-SHOT_HEIGHT,img:imgCoords.dust2,scaleFunction:function scaleFunction(age){return this.r4+age*0.04;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.2;},age:20+Math.random()*10,r1:Math.random()*0.6+0.7,r2:(stepX1*0.6+0.4*Math.random()-0.2)*((i+1)/3),r3:(stepY1*0.6+0.4*Math.random()-0.2)*((i+1)/3),r4:Math.random()*0.2+0.7,xFunction:function xFunction(age){return(-5/(age*0.9+2.5)+2)*this.r2*0.5;},yFunction:function yFunction(age){return(-5/(age*0.9+2.5)+2)*this.r3*0.5;}});}for(var i=0;i<Math.PI*2;i+=0.7+0.4*Math.random()){new Sprite({x:x_,y:y_-SHOT_HEIGHT,img:imgCoords.dust2,scaleFunction:function scaleFunction(age){return this.r4+age*0.04;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.2;},age:20+Math.random()*10,rX:x_circular*Math.sin(i)*(Math.random()*0.8+0.6),rY:y_circular*Math.sin(i)*(Math.random()*0.8+0.6),rZ:z_circular*Math.cos(i)*(Math.random()*0.8+0.6),r4:Math.random()*0.2+0.5,xFunction:function xFunction(age){return(-5/(age*0.9+2.5)+2)*this.rX*0.2;},yFunction:function yFunction(age){return(-5/(age*0.9+2.5)+2)*this.rY*0.2;},zFunction:function zFunction(age){return(-5/(age*0.9+2.5)+2)*this.rZ*0.2;}});}if(!this.isMulti)soundManager.playSound(SOUND.GUN_IMPACT,x_,y_,1.0);}if(this.weapon.isLaser){for(var k=0;k<3;k++){new Sprite({x:x_+Math.random()*0.6-0.3,y:y_+Math.random()*0.6-0.3,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.4;},age:(1.7+Math.random())*20,z_:Math.random()*40+12,zFunction:function zFunction(age){return SHOT_HEIGHT+age/this.z_;}});}for(var i=0;i<7;i++){new Sprite({x:x_,y:y_,img:imgCoords[this.weapon.particle],scaleFunction:function scaleFunction(age){return this.r4-age*0.2;},age:5+Math.random()*5,r1:Math.random()*0.6+0.7,r2:stepX*0.6+stepX*0.8*Math.random(),r3:stepY*0.6+stepY*0.8*Math.random(),r4:Math.random()*2+1,zFunction:function zFunction(age){return 0.6*Math.max(0.3,Math.abs(Math.cos(age*this.r1*0.2))/Math.max(1,age*0.2));},xFunction:function xFunction(age){return(-5/(age*0.08+1)+5)*this.r2;},yFunction:function yFunction(age){return(-5/(age*0.08+1)+5)*this.r3;}});}soundManager.playSound(SOUND.SIZZLE,x_,y_,0.35);new Sprite({x:x_,y:y_,img:imgCoords[this.weapon.light],scaleFunction:function scaleFunction(age){return Math.max(0,4-age/this.ticksToLive*4);},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.17;},age:15});}};Projectile.prototype.getYDrawingOffset=function(){return this.y;};Projectile.prototype.draw=function(exactTicks,x1,y1,x2,y2,percentageOfCurrentTickPassed){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2)||this.dieAt)return;var x=this.x0+percentageOfCurrentTickPassed*(this.x-this.x0);var y=this.y0+percentageOfCurrentTickPassed*(this.y-this.y0)-SHOT_HEIGHT;var x2=x+this.drawLenX;var y2=y+this.drawLenY;if(this.weapon.isZombieRangedWeapon){var scale=SCALE_FACTOR*(this.weapon.projectileScale?this.weapon.projectileScale:1);scale+=scale*0.18*Math.sin(exactTicks*0.6);c.drawImage(imgs.rangedZombie,24,24*9,24,24,(x-game.cameraX)*FIELD_SIZE-24/2*scale,(y-game.cameraY)*FIELD_SIZE-24/2*scale,24*scale,24*scale);}else if(this.weapon.projectileImg){this.direction=this.weapon.directions==16?getDirectionFromAgle16(this.x0,this.y0,this.x,this.y):getDirectionFromAgle(this.x0,this.y0,this.x,this.y);if(this.weapon.directions==1)this.direction=0;if(this.weapon.isRocket&&!this.weapon.noRocketEffects){var vecY=this.x0-this.x;var vecX=-(this.y0-this.y);var len=Math.sqrt(vecX*vecX+vecY*vecY);var targetLen=0.12*Math.sin(exactTicks/1.5);x+=vecX*targetLen/len;y+=vecY*targetLen/len;var img=imgCoords.fire5;var xF=x-this.drawLenX*0.7;var yF=y-this.drawLenY*0.7;var scale=SCALE_FACTOR*0.9*(Math.random()*0.6+0.6);c.globalAlpha=Math.random()*0.5+0.2;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(xF-game.cameraX)*FIELD_SIZE-img.w/2*scale,(yF-game.cameraY)*FIELD_SIZE-img.h/2*scale,img.w*scale,img.h*scale);c.globalAlpha=1;var img=imgCoords.fire4;var xF=x-this.drawLenX*1.05;var yF=y-this.drawLenY*1.05;var scale=SCALE_FACTOR*0.9*(Math.random()*0.6+0.6);c.globalAlpha=Math.random()*0.5+0.2;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(xF-game.cameraX)*FIELD_SIZE-img.w/2*scale,(yF-game.cameraY)*FIELD_SIZE-img.h/2*scale,img.w*scale,img.h*scale);c.globalAlpha=1;}if(this.weapon.light){var img=imgCoords[this.weapon.light];var size=FIELD_SIZE*(7.5+getGameTickRng2(0,1));c.globalAlpha=0.08+getGameTickRng(0,0.04);c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(x-game.cameraX)*FIELD_SIZE-size/2,(y+0.5-game.cameraY)*FIELD_SIZE-size/2,size,size);c.globalAlpha=1;img=imgCoords.light_white;var size=FIELD_SIZE*(7.5+getGameTickRng(0,1));c.globalAlpha=0.08+getGameTickRng2(0,0.04);c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(x-game.cameraX)*FIELD_SIZE-size/2,(y+0.5-game.cameraY)*FIELD_SIZE-size/2,size,size);c.globalAlpha=1;}if(this.weapon.glowLightImg){var img=imgCoords[this.weapon.glowLightImg];var scale=SCALE_FACTOR*4;c.globalAlpha=0.25;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(x-game.cameraX)*FIELD_SIZE-img.w/2*scale,(y+SHOT_HEIGHT-game.cameraY)*FIELD_SIZE-img.h/2*scale,img.w*scale,img.h*scale);c.globalAlpha=1;}var img=imgCoords[this.weapon.projectileImg];var frameH=img.h/(this.weapon.directions?this.weapon.directions:8);var scale=SCALE_FACTOR*(this.weapon.projectileScale?this.weapon.projectileScale:1);var xMod=0;var yMod=0;if(this.weapon.projectileWiggle){scale*=0.9+Math.floor(game.ticksCounter*0.5)*0.91235%0.2;xMod=(-0.1+Math.floor(game.ticksCounter*0.8)*0.131235%0.2)*0.7;yMod=(-0.1+Math.floor(game.ticksCounter*1.1)*0.1213555635%0.2)*.7;}c.drawImage(imgs.miscSheet,img.x,img.y+frameH*this.direction,img.w,frameH,(x+xMod-game.cameraX)*FIELD_SIZE-img.w/2*scale,(y+yMod-game.cameraY)*FIELD_SIZE-frameH/2*scale,img.w*scale,frameH*scale);}};function Grenade(startX,startY,targetX,targetY,speed,aoe,id,weapon,owner){this.x=parseFloat(startX);this.y=parseFloat(startY);this.x0=this.x;this.y0=this.y;this.vecX=parseFloat(targetX)-this.x;this.vecY=parseFloat(targetY)-this.y;this.dist=Math.sqrt(this.vecX*this.vecX+this.vecY*this.vecY);this.originalDist=this.dist;this.lastBlock=10;soundManager.playSound(SOUND.GRENADE_LAUNCH,this.x,this.y);this.tickOfStart=game.ticksCounter;this.aoe=parseFloat(aoe);this.id=parseInt(id);this.dieAt=0;this.weapon=weapon;this.duration=parseInt(this.dist/this.weapon.projectileSpeed);this.vecX*=this.weapon.projectileSpeed/this.dist;this.vecY*=this.weapon.projectileSpeed/this.dist;this.parabelScheitel=Math.pow(this.dist/2,2)*0.08;game.addToObjectsToDraw(this);var x=this.x;var y=this.y;if(!game.fastForward){for(var i=0;i<4;i++){new Sprite({x:x+Math.random()*0.3-0.15,y:y-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(2.7+Math.random())*20,x_:this.vecX*2.25,y_:this.vecY*2.25,i_:i/5,zFunction:function zFunction(age){return(-1/Math.pow(age/5+1,3)+1)*1.5*this.i_;},xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.y_;}});}for(var i=1;i<3;i++){new Sprite({x:x+Math.random()*0.3-0.15,y:y-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(2.7+Math.random())*20,x_:-this.vecY*2.25,y_:this.vecX*2.25,i_:i/5,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.y_;}});}for(var i=1;i<3;i++){new Sprite({x:x+Math.random()*0.3-0.15,y:y-SHOT_HEIGHT+Math.random()*0.3-0.15,img:imgCoords.dust1,scaleFunction:function scaleFunction(age){return this.scale_-age*0.01;},scale_:Math.random()+1.1,alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.35;},age:(2.7+Math.random())*20,x_:this.vecY*2.25,y_:-this.vecX*2.25,i_:i/5,xFunction:function xFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.x_;},yFunction:function yFunction(age){return(-1/Math.pow(age/5+1,3)+1)*2*this.i_*this.y_;}});}new Sprite({x:x,y:y-SHOT_HEIGHT,img:imgCoords.light_yellow,scaleFunction:function scaleFunction(age){return 5;},age:7});}};Grenade.prototype.update=function(){if(this.dieAt&&this.dieAt+10<=game.ticksCounter)return false;if(this.dieAt)return true;this.x0=this.x;this.y0=this.y;this.x+=this.vecX;this.y+=this.vecY;this.dist-=this.weapon.projectileSpeed;var block=game.getFieldPath(Math.floor(this.x),Math.floor(this.y));var maxAllowedBlock=this.dist<1.2?9:5;if(block<maxAllowedBlock){soundManager.playSound(SOUND.GRENADE_BOUNCE,this.x,this.y,1.0);this.x-=this.vecX*2;block=game.getFieldPath(Math.floor(this.x),Math.floor(this.y));if(block<maxAllowedBlock){this.x+=this.vecX*2;this.y-=this.vecY*2;block=game.getFieldPath(Math.floor(this.x),Math.floor(this.y));if(block<maxAllowedBlock)this.x-=this.vecX*2;}}if(this.lastBlock==5&&block==5&&this.dist<1.2){this.explode();return false;}this.lastBlock=block;this.vecX=this.x-this.x0;this.vecY=this.y-this.y0;if(this.dist<=0){if(game.getFieldPath(Math.floor(this.x),Math.floor(this.y))!=9)this.explode();else if(this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2)new Splash(this.x,this.y,imgCoords.splash);return false;}return true;};Grenade.prototype.blink=function(x,y,oldX,oldY){soundManager.playSound(SOUND.BLINK,this.x,this.y,0.65);createBlinkEffectSmall(parseFloat(oldX)-0.2+Math.random()*0.4,parseFloat(oldY)-0.2+Math.random()*0.4);this.x=parseFloat(x);this.y=parseFloat(y);this.x0=this.x;this.y0=this.y;soundManager.playSound(SOUND.BLINK,this.x,this.y,0.65);createBlinkEffectSmall(this.x-0.25+Math.random()*0.5,this.y-0.25+Math.random()*0.5);};Grenade.prototype.explode=function(){if(this.x+10>=game.cameraX&&this.y+10>=game.cameraY&&this.x-10<=game.cameraX2&&this.y-10<=game.cameraY2){createExplosion(this.x,this.y,this.aoe,this.weapon.sootAlpha);soundManager.playSound(SOUND[this.weapon.impactSound],this.x,this.y,this.weapon.impactSoundVolume);game.corpseBounce(this.x,this.y,this.aoe);}this.dieAt=game.ticksCounter;};Grenade.prototype.getYDrawingOffset=function(){return this.y;};Grenade.prototype.draw=function(exactTicks,x1,y1,x2,y2,percentageOfCurrentTickPassed){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2)||this.dieAt)return;var perc=(exactTicks-this.tickOfStart)/this.duration;var x=this.x0+percentageOfCurrentTickPassed*(this.x-this.x0);var y=this.y0+percentageOfCurrentTickPassed*(this.y-this.y0);var direction=getDirectionFromAgle(this.x0,this.y0,this.x,this.y);var passedDist=perc*this.originalDist;var h=-0.08*Math.pow(passedDist-this.originalDist/2,2)+this.parabelScheitel+(1-passedDist/this.originalDist)*SHOT_HEIGHT*1.5;c.globalAlpha=0.3;c.drawImage(imgs.shadow,(x-game.cameraX)*FIELD_SIZE-16*SCALE_FACTOR/2,(y-game.cameraY)*FIELD_SIZE-16*SCALE_FACTOR/2,32*SCALE_FACTOR/2,32*SCALE_FACTOR/2);c.globalAlpha=1;var xSource=Math.min(Math.floor(perc*3),2)*10;var img=imgCoords[this.weapon.projectileImg];var scale=this.weapon.projectileScale?this.weapon.projectileScale*SCALE_FACTOR:SCALE_FACTOR;c.drawImage(imgs.miscSheet,img.x+xSource,img.y+10*direction,10,10,(x-game.cameraX)*FIELD_SIZE-5*scale,(y-h*0.9-game.cameraY)*FIELD_SIZE-5*scale,10*scale,10*scale);};function Beam(shooter,target,x,y,weapon){if(x||y){this.x=parseFloat(x);this.y=parseFloat(y);}this.shooter=shooter;this.target=target;if(weapon&&shooter&&weapon.isBeam2){this.originX=shooter.x;this.originY=shooter.y;}if(SOUND[weapon.soundName])soundManager.playSound(SOUND[weapon.soundName],this.shooter.x,this.shooter.y,weapon.volume?weapon.volume:1);this.weapon=weapon;this.tickOfCreation=game.ticksCounter;this.dieAt=game.ticksCounter+weapon.lifetime;this.muzzleFlashDisplayTime=weapon.muzzleFlashDisplayTime?game.ticksCounter+weapon.muzzleFlashDisplayTime:game.ticksCounter+99999;this.fadeOutAt=weapon.fadeOutAt?game.ticksCounter+weapon.fadeOutAt:null;this.isBeam2=weapon?weapon.isBeam2:false;game.addToObjectsToDraw(this);};Beam.prototype.getYDrawingOffset=function(){return this.shooter.y;};Beam.prototype.update=function(){return this.dieAt>game.ticksCounter;};Beam.prototype.draw=function(exactTicks,x1,y1,x2,y2,percentageOfCurrentTickPassed){var x=this.shooter.x0+percentageOfCurrentTickPassed*(this.shooter.x-this.shooter.x0);var y=this.shooter.y0+percentageOfCurrentTickPassed*(this.shooter.y-this.shooter.y0)-SHOT_HEIGHT;if(this.originX){x=this.originX;y=this.originY-SHOT_HEIGHT;}var xT=0;var yT=0;if(this.target){xT=this.target.x0+percentageOfCurrentTickPassed*(this.target.x-this.target.x0);yT=this.target.y0+percentageOfCurrentTickPassed*(this.target.y-this.target.y0)-SHOT_HEIGHT;var vecX=x-xT;var vecY=y-yT;var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=0.4/len;vecY*=0.4/len;xT+=vecX;yT+=vecY;}else{xT=this.x;yT=this.y-SHOT_HEIGHT;}var vecX=xT-x;var vecY=yT-y;var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=this.weapon.beamRenderStartOffset/len;vecY*=this.weapon.beamRenderStartOffset/len;x+=vecX;y+=vecY;if(this.fadeOutAt&&this.fadeOutAt<=exactTicks)c.globalAlpha=Math.max(this.dieAt-exactTicks,0)/(this.dieAt-this.fadeOutAt);for(var i=3;i>=1;i--){if(this.weapon["beamColor"+[i]]){c.strokeStyle=this.weapon["beamColor"+[i]];c.lineWidth=this.weapon["beamWidth"+[i]]*FIELD_SIZE*(0.8+game.ticksCounter%1.2*0.2);c.beginPath();c.moveTo((x-game.cameraX)*FIELD_SIZE,(y-game.cameraY)*FIELD_SIZE);c.lineTo((xT-game.cameraX)*FIELD_SIZE,(yT-game.cameraY)*FIELD_SIZE);c.lineCap='round';c.stroke();}}c.globalAlpha=1;if(this.muzzleFlashDisplayTime>exactTicks){var img=imgCoords[this.weapon.muzzleFlashParticle];for(var i=0;i<15;i++){c.globalAlpha=0.8-(exactTicks+i)*1.7%10*0.08;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(x+Math.cos(Math.PI*2*(i/20))*((exactTicks+i)*1.7%10)*0.066-game.cameraX)*FIELD_SIZE,(y+Math.sin(Math.PI*2*(i/20))*((exactTicks+i)*3.9654%10)*0.066-game.cameraY)*FIELD_SIZE,img.w*SCALE_FACTOR*(2.2-(exactTicks+i)*1.7%10*0.1),img.h*SCALE_FACTOR*(2.2-(exactTicks+i)*1.7%10*0.1));}if(this.weapon.muzzleFlashParticle2){var img=imgCoords[this.weapon.muzzleFlashParticle2];for(var i=0;i<15;i++){c.globalAlpha=0.8-(exactTicks+i)*1.7%10*0.08;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(x+Math.cos(Math.PI*2*(i/20))*((exactTicks+i)*2.18%10)*0.066-game.cameraX)*FIELD_SIZE,(y+Math.sin(Math.PI*2*(i/20))*((exactTicks+i)*1.74675%10)*0.066-game.cameraY)*FIELD_SIZE,img.w*SCALE_FACTOR*(2.2-(exactTicks+i)*1.7%10*0.1),img.h*SCALE_FACTOR*(2.2-(exactTicks+i)*1.7%10*0.1));}}}if(this.weapon.muzzleFlashLight&&!this.muzzleFlashLightHasBeenCreated){this.muzzleFlashLightHasBeenCreated=true;if(this.weapon.muzzleFlashLight&&this.weapon.muzzleFlashLight2)for(var i=0;i<5;i++){var randomAngle=Math.random()*Math.PI*2;var randomSpeed=Math.random()*0.09;var randomAngle2=Math.random()*Math.PI*2;var randomDistance=Math.random()*0.34;new Sprite({x:x+Math.cos(randomAngle2)*randomDistance,y:y+Math.sin(randomAngle2)*randomDistance,img:imgCoords[this.weapon.muzzleFlashLight],scaleFunction:function scaleFunction(age){return Math.max(0,2-age*0.1);},alphaFunction:function alphaFunction(age){return Math.max(0,0.5-age*0.025);},age:(1.7+Math.random())*20,angleX:Math.cos(randomAngle),angleY:Math.sin(randomAngle),speed:randomSpeed,xFunction:function xFunction(age){return age*this.angleX*this.speed;},yFunction:function yFunction(age){return age*this.angleY*this.speed;}});new Sprite({x:x+Math.cos(randomAngle2)*randomDistance,y:y+Math.sin(randomAngle2)*randomDistance,img:imgCoords[this.weapon.muzzleFlashLight2],scaleFunction:function scaleFunction(age){return Math.max(0,(2-age*0.1)*0.7);},alphaFunction:function alphaFunction(age){return Math.max(0,0.5-age*0.025);},age:(1.7+Math.random())*20,angleX:Math.cos(randomAngle),angleY:Math.sin(randomAngle),speed:randomSpeed,xFunction:function xFunction(age){return age*this.angleX*this.speed;},yFunction:function yFunction(age){return age*this.angleY*this.speed;}});}if(this.weapon.hitLight1&&this.weapon.hitLight2){for(var i=0;i<5;i++){var randomAngle=Math.random()*Math.PI*2;var randomSpeed=Math.random()*0.09;var randomAngle2=Math.random()*Math.PI*2;var randomDistance=Math.random()*0.34;new Sprite({x:xT+Math.cos(randomAngle2)*randomDistance,y:yT+Math.sin(randomAngle2)*randomDistance,img:imgCoords[this.weapon.hitLight1],scaleFunction:function scaleFunction(age){return Math.max(0,2-age*0.1);},alphaFunction:function alphaFunction(age){return Math.max(0,0.5-age*0.025);},age:(1.7+Math.random())*20,angleX:Math.cos(randomAngle),angleY:Math.sin(randomAngle),speed:randomSpeed,xFunction:function xFunction(age){return age*this.angleX*this.speed;},yFunction:function yFunction(age){return age*this.angleY*this.speed;}});new Sprite({x:xT+Math.cos(randomAngle2)*randomDistance,y:yT+Math.sin(randomAngle2)*randomDistance,img:imgCoords[this.weapon.hitLight2],scaleFunction:function scaleFunction(age){return Math.max(0,(2-age*0.1)*0.7);},alphaFunction:function alphaFunction(age){return Math.max(0,0.5-age*0.025);},age:(1.7+Math.random())*20,angleX:Math.cos(randomAngle),angleY:Math.sin(randomAngle),speed:randomSpeed,xFunction:function xFunction(age){return age*this.angleX*this.speed;},yFunction:function yFunction(age){return age*this.angleY*this.speed;}});}}}c.globalAlpha=1;};function Object_(id,owner,ability,x,y,hp,maxHP,ticks2live,aoe,tickOfDeath,targetX,targetY){this.id=id;this.x=parseInt(x)+0.5;this.y=parseInt(y)+0.5;this.z=0;this.x0=this.x;this.y0=this.y;this.z0=this.z;this.maxHP=parseFloat(maxHP);this.hp=hp?parseFloat(hp):this.maxHP;this.aoe=aoe?parseFloat(aoe):0;this.owner=owner;this.isObject=true;this.ability=ability;this.object=objects[ability.object];this.barYOffset=this.object&&this.object.barYOffset?this.object.barYOffset:1.55;this.hpPerTick=this.object?this.object.hpPerTick:0;this.dmg=this.object?this.object.dmg:0;this.animation=animationData[this.object.animation];this.weapon=this.object?this.object.weapon:null;this.lifetime=ticks2live?parseFloat(ticks2live):this.object.lifetime;this.tickOfDeath=tickOfDeath?parseInt(tickOfDeath)+game.ticksCounter:game.ticksCounter+this.lifetime;this.tickOfBirth=this.tickOfDeath-this.lifetime;this.particles=[];this.lightPillarsTop=[];this.lightPillarsBottom=[];this.imgScale=this.object&&this.object.imgScale?this.object.imgScale:1;this.healthBarW=this.object&&this.object.healthBarW?this.object.healthBarW:24;this.showLifeTimeBar=this.object&&this.object.showLifeTimeBar;this.invincibleUntil=-9999;this.laserHitUntil=-999;if(this.ability.type=="place")this.createSpawnEffect();if(this.ability.type=="throw"&&this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2)soundManager.playSound(SOUND.THROW,this.x,this.y,0.8);this.countParticles=Math.floor(this.aoe*Math.pow(Math.PI,2)*0.25);this.hitUntil=-999;this.bleeds=false;this.lastTickFire=-9999;this.direction=1;this.lastShootX=0;this.lastShootY=0;this.yOffset=this.object&&this.object.yOffset?this.object.yOffset:0;this.emitsSmoke=this.object&&this.object.emitsSmoke;this.flash=this.object&&this.object.flash;this.rotation=1.0;if(ability.type=="throw"){this.x=parseFloat(x);this.y=parseFloat(y);this.vecX=parseFloat(targetX)-this.x;this.vecY=parseFloat(targetY)-this.y;var len=Math.sqrt(this.vecX*this.vecX+this.vecY*this.vecY);if(len==0)len=0.01;this.z=0.6;this.vecH=Math.pow(len,0.25)*0.12;var speed=len*0.065;this.vecX*=speed/len;this.vecY*=speed/len;this.groundBounceCounter=0;this.lastBlockHeight=0;this.tickOfDeath=game.ticksCounter+999999;this.hasLanded=false;}game.addToObjectsToDraw(this);if(ability.type=="place"&&this.object&&game.pathingArray[x]&&game.pathingArray[x][y])game.pathingArray[x][y]=this.object.pathing;};Object_.prototype.blink=function(x,y,oldX,oldY){soundManager.playSound(SOUND.BLINK,this.x,this.y,0.6);createBlinkEffectSmall(parseFloat(oldX)-0.2+Math.random()*0.4,parseFloat(oldY)-0.2+Math.random()*0.4);this.x=parseFloat(x);this.y=parseFloat(y);this.x0=this.x;this.y0=this.y;soundManager.playSound(SOUND.BLINK,this.x,this.y,0.6);createBlinkEffectSmall(this.x-0.25+Math.random()*0.5,this.y-0.25+Math.random()*0.5);};Object_.prototype.groundBounce=function(){if(this.hasLanded)return;this.groundBounceCounter++;var power=Math.min(1,this.vecH*10);soundManager.playSound(SOUND.GRENADE_BOUNCE,this.x,this.y,0.45*power);createPoundSmoke(this.x,this.y+0.9,0.35*power,7,0.4);this.rotation=Math.random()*2.0-1.0;if(this.groundBounceCounter==3&&this.flash&&this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2)soundManager.playSound(SOUND.FLASH_START,this.x,this.y,1);if(this.groundBounceCounter==5){if(this.emitsSmoke&&this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2){soundManager.playSound(SOUND.SMOKE_START,this.x,this.x,0.15);createPoundSmoke(this.x,this.y+0.5,0.7,9,0.4);}this.tickOfDeath=game.ticksCounter+this.lifetime+5;this.tickOfBirth=game.ticksCounter+5;}};Object_.prototype.wallBounceEffect=function(oldVX,oldVY,newVX,newVY){if(game.fastForward)return;if(oldVX!=newVX&&this.tickOfBirth+1<game.ticksCounter){soundManager.playSound(SOUND.GRENADE_BOUNCE,this.x,this.y,0.45);this.rotation=Math.random()*3.0-1.5;var x_circular=0;var y_circular=1;var z_circular=1;for(var i=0;i<Math.PI*2;i+=0.7+0.4*Math.random()){new Sprite({x:this.x,y:this.y-this.z,img:imgCoords.dust2,scaleFunction:function scaleFunction(age){return this.r4+age*0.04;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.2;},age:20+Math.random()*10,rX:x_circular*Math.sin(i)*(Math.random()*0.8+0.6),rY:y_circular*Math.sin(i)*(Math.random()*0.8+0.6),rZ:z_circular*Math.cos(i)*(Math.random()*0.8+0.6),r4:Math.random()*0.2+0.5,xFunction:function xFunction(age){return(-5/(age*0.9+2.5)+2)*this.rX*0.2;},yFunction:function yFunction(age){return(-5/(age*0.9+2.5)+2)*this.rY*0.2;},zFunction:function zFunction(age){return(-5/(age*0.9+2.5)+2)*this.rZ*0.2;}});}}if(oldVY!=newVY&&this.tickOfBirth+1<game.ticksCounter){soundManager.playSound(SOUND.GRENADE_BOUNCE,this.x,this.y,0.45);this.rotation=Math.random()*3.0-1.5;var x_circular=1;var y_circular=0;var z_circular=1;for(var i=0;i<Math.PI*2;i+=0.7+0.4*Math.random()){new Sprite({x:this.x,y:this.y-this.z,img:imgCoords.dust2,scaleFunction:function scaleFunction(age){return this.r4+age*0.04;},alphaFunction:function alphaFunction(age){return Math.max(0,1-age/this.ticksToLive)*0.2;},age:20+Math.random()*10,rX:x_circular*Math.sin(i)*(Math.random()*0.8+0.6),rY:y_circular*Math.sin(i)*(Math.random()*0.8+0.6),rZ:z_circular*Math.cos(i)*(Math.random()*0.8+0.6),r4:Math.random()*0.2+0.5,xFunction:function xFunction(age){return(-5/(age*0.9+2.5)+2)*this.rX*0.2;},yFunction:function yFunction(age){return(-5/(age*0.9+2.5)+2)*this.rY*0.2;},zFunction:function zFunction(age){return(-5/(age*0.9+2.5)+2)*this.rZ*0.2;}});}}};Object_.prototype.update=function(){if(this.ability.type=="throw"){this.x0=this.x;this.y0=this.y;this.z0=this.z;this.x+=this.vecX;this.y+=this.vecY;var blockHeight=game.getHeight2(Math.floor(this.x),Math.floor(this.y));var hitWall=false;if(this.z<blockHeight){if(blockHeight==this.lastBlockHeight){if(game.getFieldPath(Math.floor(this.x),Math.floor(this.y))==9){if(this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2)new Splash(this.x,this.y,imgCoords.splash);return false;}this.vecH*=-0.5;this.vecX*=0.9;this.vecY*=0.9;this.z=blockHeight;this.groundBounce();if(this.vecH<0.002||this.groundBounceCounter>6&&!this.hasLanded){this.tickOfDeath=game.ticksCounter+this.lifetime;this.hasLanded=true;return true;}}else{hitWall=true;this.x-=this.vecX*2;blockHeight=game.getHeight2(Math.floor(this.x),Math.floor(this.y));if(this.z<blockHeight){this.x+=this.vecX*2;this.y-=this.vecY*2;blockHeight=game.getHeight2(Math.floor(this.x),Math.floor(this.y));if(this.z<blockHeight)this.x-=this.vecX*2;}}}this.vecX=this.x-this.x0;this.vecY=this.y-this.y0;if(hitWall){var oldVX=Math.sign(this.x-this.x0);var oldVY=Math.sign(this.y-this.y0);this.vecX*=0.9;this.vecY*=0.9;this.x=this.x0;this.y=this.y0;var newVX=Math.sign(this.x-this.x0);var newVY=Math.sign(this.y-this.y0);this.wallBounceEffect(oldVX,oldVY,newVX,newVY);}this.z+=this.vecH;if(this.z<0){if(game.getFieldPath(Math.floor(this.x),Math.floor(this.y))==9){if(this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2)new Splash(this.x,this.y,imgCoords.splash);return false;}this.z=0;this.vecH*=-0.5;this.vecX*=0.75;this.vecY*=0.75;this.groundBounce();if(this.vecH<0.005||this.groundBounceCounter>6&&!this.hasLanded){this.tickOfDeath=game.ticksCounter+this.lifetime;this.hasLanded=true;return true;}}this.vecH-=0.045;this.vecX*=0.97;this.vecY*=0.97;this.lastBlockHeight=blockHeight;if(!this.hasLanded&&this.groundBounceCounter>=4&&game.ticksCounter%5==2&&this.emitsSmoke&&this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2)createPoundSmoke(this.x,this.y+0.5,0.7,9,0.4);if(!this.hasLanded)return true;}if(this.hpPerTick&&game.ticksCounter%7==0&&this.x+5>=game.cameraX&&this.y+5>=game.cameraY&&this.x-5<=game.cameraX2&&this.y-5<=game.cameraY2)soundManager.playSound(SOUND.HEAL_AURA,this.x,this.y,0.4);if(this.emitsSmoke&&(game.ticksCounter-this.tickOfBirth)%20==0&&!game.fastForward){new Sprite({x:this.x+Math.random()*9-4.5,y:this.y+6.0+Math.random()*9-4.5,x_:Math.random()*0.05-0.025,y_:Math.random()*0.05-0.025,img:imgCoords.hpBar4,scale_:Math.random()*0.2+0.9,scaleFunction:function scaleFunction(age){return(3.5+age*0.002)*this.scale_;},alphaFunction:function alphaFunction(age){return Math.min(this.ticksLeft*0.03,age*0.05,1);},xFunction:function xFunction(age){return age*this.x_;},yFunction:function yFunction(age){return age*this.y_;},zFunction:function zFunction(age){return 7;},offsetDrawing:12,age:240});new Sprite({x:this.x+Math.random()*0.5-0.25,y:this.y+4.0+Math.random()*0.5-0.25,x_:Math.random()*0.01-0.005,y_:Math.random()*0.01-0.005,img:imgCoords.hpBar4,scale_:Math.random()*0.2+0.9,scaleFunction:function scaleFunction(age){return(0.4+age*0.011)*this.scale_;},alphaFunction:function alphaFunction(age){return Math.min(this.ticksLeft*0.1,age*0.1,1);},xFunction:function xFunction(age){return age*this.x_;},yFunction:function yFunction(age){return age*this.y_;},zFunction:function zFunction(age){return 4;},age:40});}if((this.emitsSmoke||this.object&&this.object.emitsPoison)&&(game.ticksCounter-this.tickOfBirth)%14==9&&this.x+3>=game.cameraX&&this.y+3>=game.cameraY&&this.x-3<=game.cameraX2&&this.y-3<=game.cameraY2)soundManager.playSound(SOUND.SMOKE_LOOP,this.x,this.y,0.5);if(this.ability.type=="throw"&&this.aoe&&this.dmg&&this.tickOfDeath==game.ticksCounter&&this.x+10>=game.cameraX&&this.y+10>=game.cameraY&&this.x-10<=game.cameraX2&&this.y-10<=game.cameraY2){createExplosion(this.x,this.y,this.aoe,1);soundManager.playSound(SOUND.EXPLODE,this.x,this.y,0.8);game.corpseBounce(this.x,this.y,this.aoe);}if(this.object&&this.object.emitsPoison&&this.tickOfBirth==game.ticksCounter){createPoundSmoke(this.x,this.y,0.5,8,0.3);soundManager.playSound(SOUND.SMOKE_START,this.x,this.y,0.15);}return game.ticksCounter<this.tickOfDeath;};Object_.prototype.die=function(){game.objectsToDraw.erease(this);if(this.ability.type=="place"){if(game.pathingArray[Math.floor(this.x)]&&game.pathingArray[Math.floor(this.x)][Math.floor(this.y)]>=0)game.pathingArray[Math.floor(this.x)][Math.floor(this.y)]=10;createExplosion(this.x,this.y,1,0.25);soundManager.playSound(SOUND.EXPLODE,this.x,this.y,0.5);}if(this.ability.type=="throw"&&this.object&&this.object.countLasers){createExplosion(this.x,this.y,0.3,0.25);soundManager.playSound(SOUND.EXPLODE,this.x,this.y,0.6);soundManager.playSound(SOUND.LASER,this.x,this.y,1.0);}};Object_.prototype.getYDrawingOffset=function(){return this.y;};Object_.prototype.createSpawnEffect=function(){this.lightPillarsTop=[];this.lightPillarsBottom=[];if(!(this.x+5>=game.cameraX&&this.y+5>=game.cameraY&&this.x-5<=game.cameraX2&&this.y-5<=game.cameraY2))return;for(var i=0;i<Math.PI*2;i+=0.3+Math.random()*0.15){(i<=Math.PI?this.lightPillarsBottom:this.lightPillarsTop).push({x:Math.sin(i)*0.45+this.x,y:Math.cos(i)*0.45+this.y,w:0.15+Math.random()*0.3,h:Math.random()*1.5,vh:0.04+Math.random()*0.08,vw:Math.random()*0.01,age_offset:Math.random()*8-4});}soundManager.playSound(this.object&&this.object.spawnSound?SOUND[this.object.spawnSound]:SOUND.AMMO_SPAWN,this.x,this.y,this.object&&this.object.volume?this.ability.volume:0.7);};Object_.prototype.updateAndDrawPillar=function(p,age){p.h+=p.vh*exactTickDiff;p.w+=p.vw*exactTickDiff;var x=(p.x-p.w/2-game.cameraX)*FIELD_SIZE;var y=(p.y-p.h-game.cameraY)*FIELD_SIZE;var this_age=age+p.age_offset;c.globalAlpha=(this_age<5?Math.max(this_age/5,0):this_age<10?1:Math.max(2.0-this_age/10,0))*0.4;c.drawImage(imgs.miscSheet,imgCoords.pillar_of_light.x,imgCoords.pillar_of_light.y,imgCoords.pillar_of_light.w,imgCoords.pillar_of_light.h,x,y,p.w*FIELD_SIZE,p.h*FIELD_SIZE);};Object_.prototype.shoot=function(x1,y1,x2,y2){this.lastTickFire=game.ticksCounter;this.direction=getDirectionFromAgle(x1,y1,x2,y2);this.lastShootX=x2;this.lastShootY=y2;};Object_.prototype.draw=function(exactTicks,x1,y1,x2,y2,percentageOfCurrentTickPassed){if(!(this.x+5>=x1&&this.y+5>=y1&&this.x-5<=x2&&this.y-5<=y2))return;if(this.ability.type=="throw"){if(!this.hasLanded){var x=(this.x0+percentageOfCurrentTickPassed*(this.x-this.x0)-game.cameraX)*FIELD_SIZE;var y=(this.y0+percentageOfCurrentTickPassed*(this.y-this.y0)-game.cameraY)*FIELD_SIZE;var h=(this.z0+percentageOfCurrentTickPassed*(this.z-this.z0))*FIELD_SIZE;var img=imgCoords[this.object.img[Math.floor(exactTicks*this.rotation+99999999)%this.object.img.length]];c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x-img.w*SCALE_FACTOR/2,y-img.h*SCALE_FACTOR/2-h,img.w*SCALE_FACTOR,img.h*SCALE_FACTOR);return;}var x=(this.x-game.cameraX)*FIELD_SIZE;var y=(this.y-game.cameraY)*FIELD_SIZE;var h=0;var img=imgCoords[this.object.img[0]];if(this.object&&this.object.emitsPoison)c.globalAlpha=Math.min(Math.max((this.tickOfDeath-exactTicks)*0.03,0),1);c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x-img.w*SCALE_FACTOR/2,y-img.h*SCALE_FACTOR/2-h,img.w*SCALE_FACTOR,img.h*SCALE_FACTOR);c.globalAlpha=1;return;}var age=exactTicks-this.tickOfBirth;if(age<25)for(var i=0;i<this.lightPillarsTop.length;i++){this.updateAndDrawPillar(this.lightPillarsTop[i],age);}c.globalAlpha=1;var scale=SCALE_FACTOR*this.imgScale;var img=imgCoords[this.object.img[0]];if(this.object&&this.object.animationType=="dmg"){img=imgCoords[this.object.img[Math.floor(this.object.img.length*(1-this.hp/this.maxHP))]];if(!img)img=imgCoords[this.object.img[0]];}if(this.object&&this.object.animationType=="auto"){img=imgCoords[this.object.img[Math.floor(game.ticksCounter*0.2+999999)%this.object.img.length]];if(!img)img=imgCoords[this.object.img[0]];}var x=(this.x-game.cameraX)*FIELD_SIZE+-img.w/2*scale;var y=(this.y+this.yOffset/16-0.2-game.cameraY)*FIELD_SIZE+(8-img.h)*scale;c.globalAlpha=age<8?Math.max(age/8,0):1;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x,y,img.w*scale,img.h*scale);c.globalAlpha=1;var whiteness=0;if(this.hitUntil>=exactTicks)whiteness=Math.random()<0.5?0.95:0.1;if(this.laserHitUntil>=exactTicks)whiteness=0.95;if(whiteness>0){c.globalAlpha=whiteness;c.drawImage(imgs.miscSheetWhite,img.x,img.y,img.w,img.h,x,y,img.w*scale,img.h*scale);c.globalAlpha=1;}if(this.weapon){var x_recoiled=0;var y_recoiled=0;if(this.lastTickFire>=exactTicks-8){x_recoiled=-this.lastShootX;y_recoiled=-this.lastShootY;var len=Math.sqrt(x_recoiled*x_recoiled+y_recoiled*y_recoiled);var len2=0.2-Math.min(Math.max(exactTicks-this.lastTickFire-(this.weapon&&this.weapon.recoilTime?this.weapon.recoilTime:3),0)*0.09,0.2);x_recoiled*=len2*FIELD_SIZE/len;y_recoiled*=len2*FIELD_SIZE/len;if(this.weapon.recoil){x_recoiled*=this.weapon.recoil;y_recoiled*=this.weapon.recoil;}}var wpn_nr=0;if(this.animation.countFrames)wpn_nr=this.lastTickFire+4>exactTicks?parseInt(exactTicks/this.weapon.cooldown)%this.animation.countFrames:0;var img=this.animation["imgTurret"+wpn_nr+this.direction];var x2=(this.x-game.cameraX)*FIELD_SIZE+-img.w/2*scale;var y2=(this.y-0.2-game.cameraY)*FIELD_SIZE+(8-img.h)*scale;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x2+x_recoiled,y2+y_recoiled,img.w*scale,img.h*scale);if(this.animation.muzzleFlash&&this.lastTickFire>=exactTicks-2){var mfi=this.animation.muzzleFlash;var mff=Math.floor(exactTicks*0.5)%2;x2=(this.x-game.cameraX)*FIELD_SIZE-44/2*scale;y2=(this.y-0.2-game.cameraY)*FIELD_SIZE-44/2*scale;c.drawImage(imgs.miscSheet,mfi.x+this.direction*44,mfi.y+mff*44,44,44,x2-0*scale+x_recoiled,y2-0*scale+y_recoiled,44*scale,44*scale);}}if(age<25)for(var i=0;i<this.lightPillarsBottom.length;i++){this.updateAndDrawPillar(this.lightPillarsBottom[i],age);}c.globalAlpha=1;if(this.ability==abilities[0]){drawCircle((this.x-game.cameraX)*FIELD_SIZE,(this.y-game.cameraY)*FIELD_SIZE,this.aoe*FIELD_SIZE,null,"rgba(30, 255, 30, 0.05)",0.85);drawCircle((this.x-game.cameraX)*FIELD_SIZE,(this.y-game.cameraY)*FIELD_SIZE,this.aoe*FIELD_SIZE,"rgba(200, 200, 255, 0.1)",null,0.85,0.7);while(this.particles.length<this.countParticles){var rng=Math.random()*Math.PI*2;this.particles.push({x:Math.sin(rng)*this.aoe*Math.random()+this.x,y:Math.cos(rng)*this.aoe*Math.random()+this.y,tickOfCreation:exactTicks,tickOfDeath:exactTicks+Math.random()*40+20,speed:(Math.random()*0.5+0.35)/1000});}c.lineWidth=SCALE_FACTOR;for(var i=0;i<this.particles.length;i++){var particle=this.particles[i];if(particle.tickOfDeath<=exactTicks){this.particles.splice(i,1);i--;}else{var age2=(exactTicks-particle.tickOfCreation)*50;var drawX=(particle.x-game.cameraX)*FIELD_SIZE;var drawX2=drawX;var drawY=(particle.y-1-game.cameraY)*FIELD_SIZE;var drawY1=drawY-particle.speed*age2*FIELD_SIZE;var drawY2=drawY-(particle.speed*age2*1.5-1.2)*FIELD_SIZE;if(age2<500)c.globalAlpha=age2/500;if(particle.tickOfDeath-exactTicks<10)c.globalAlpha=(particle.tickOfDeath-exactTicks)/10;var grad=c.createLinearGradient(drawX2,drawY2,drawX,drawY1);grad.addColorStop(0,"rgba(180, 255, 170, 0.0)");grad.addColorStop(0.5,"rgba(180, 255, 170, 0.3)");grad.addColorStop(1,"rgba(180, 255, 170, 0.0)");c.strokeStyle=grad;c.beginPath();c.moveTo(drawX,drawY1);c.lineTo(drawX2,drawY2);c.stroke();c.globalAlpha=1;}}c.globalAlpha=1;}if(this.object&&this.object.noBars&&!KeyManager.keys[KEY.ALT])return;var x=(this.x-game.cameraX)*FIELD_SIZE;var y=(this.y-game.cameraY)*FIELD_SIZE;var barScale=SCALE_FACTOR*0.55;var barW=this.healthBarW*1.8;var barH=8;var x2=x-barW*barScale/2;var y2=y-1.85*FIELD_SIZE;c.fillStyle="black";c.fillRect(x2,y2,barW*barScale,barH*barScale);var hp=Math.min(this.hp-(this.hpGlideEnd>=exactTicks?this.hpGlideAmount*(this.hpGlideEnd-exactTicks)/(this.hpGlideEnd-this.hpGlideStart):0),this.maxHP);img=!game.playingPlayer||this.owner&&this.owner.isAlliedWith(game.playingPlayer)?imgCoords.hpBar1:imgCoords.hpBar3;var w=(barW-2)*barScale*(hp/this.maxHP);c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x2+1*barScale,y2+1*barScale,w,barScale*6);c.strokeStyle="rgba(0, 0, 0, 1)";c.lineWidth=barScale;for(var i=CONST.HP_SEPERATOR_AMOUNT;i<this.maxHP;i+=CONST.HP_SEPERATOR_AMOUNT){c.beginPath();c.moveTo(x2+1*barScale+i/this.maxHP*(barW-2)*barScale,y2+5*barScale);c.lineTo(x2+1*barScale+i/this.maxHP*(barW-2)*barScale,y2+7*barScale);c.stroke();}if(this.ability.noBars)return;if(this.showLifeTimeBar){y2-=FIELD_SIZE*0.375;c.fillStyle="black";c.fillRect(x2-FIELD_SIZE*0.03,y2-FIELD_SIZE*0.03,FIELD_SIZE*1.56,FIELD_SIZE*0.30);w=24*((this.tickOfDeath-exactTicks)/this.lifetime);c.drawImage(imgs.miscSheet,imgCoords.barBlue.x,imgCoords.barBlue.y,w,4,x2,y2,SCALE_FACTOR*w,FIELD_SIZE*0.24);}if(this.ability.initTicks&&this.tickOfBirth+this.ability.initTicks>exactTicks){y2-=FIELD_SIZE*0.375;c.fillStyle="black";c.fillRect(x2-FIELD_SIZE*0.03,y2-FIELD_SIZE*0.03,FIELD_SIZE*1.56,FIELD_SIZE*0.30);w=24*((exactTicks-this.tickOfBirth)/this.ability.initTicks);c.drawImage(imgs.miscSheet,imgCoords.barBlue.x,imgCoords.barBlue.y,w,4,x2,y2,SCALE_FACTOR*w,FIELD_SIZE*0.24);}};function Sprite(data){this.offsetDrawing=5;extend(this,data);this.tickOfBirth=game.ticksCounter;this.ticksToLive=this.age?this.age:30;this.ticksLeft=this.ticksToLive;this.tickOfDeath=this.tickOfBirth+this.ticksToLive;this.alphaFunction=this.alphaFunction?this.alphaFunction:function(age){return this.ticksToLive-age<20?Math.max((this.ticksToLive-age)/20,0):1;};this.height=this.height?this.height:0;this.drawY=this.y;game.effects.push(this);game.addToObjectsToDraw(this);};Sprite.prototype.update=function(){if(this.dieOnCollision){var age=game.ticksCounter+1-this.tickOfBirth;var x=this.x;if(this.xFunction)x+=this.xFunction(age);var y=this.y;if(this.yFunction)y+=this.yFunction(age);return game.getFieldPath(Math.floor(x),Math.floor(y))>5&&this.tickOfDeath>game.ticksCounter;}return this.tickOfDeath>game.ticksCounter;};Sprite.prototype.getYDrawingOffset=function(){if(!(this.drawY>-999999)){return-1;}return this.drawY;};Sprite.prototype.draw=function(exactTicks,x1,y1,x2,y2){if(!(this.x+this.offsetDrawing>=x1&&this.y+this.offsetDrawing>=y1&&this.x-this.offsetDrawing<=x2&&this.y-this.offsetDrawing*2<=y2)||!this.img)return;var age=exactTicks-this.tickOfBirth;this.ticksLeft=Math.max(this.ticksToLive-age,0);var alpha=this.alphaFunction?this.alphaFunction(age):1;var scale=Math.max(this.scaleFunction(age),0)*SCALE_FACTOR;var z=this.zFunction?this.zFunction(age):0;var x=this.x;if(this.xFunction)x+=this.xFunction(age);var y=this.y;if(this.yFunction)y+=this.yFunction(age)*0.75;this.drawY=y;if(!(y>-999999)&&!(y<-999999)){this.drawY=-10;this.ticksLeft=0;}var drawX=g2rx(x)-this.img.w/2*scale;var drawY=g2ry(y-z)-this.img.h/2*scale;c.globalAlpha=alpha;c.drawImage(imgs.miscSheet,this.img.x,this.img.y,this.img.w,this.img.h,drawX,drawY,this.img.w*scale,this.img.h*scale);c.globalAlpha=1;};function Bullet(x,y){this.x=x;this.y=y;this.z=1;this.vx=(Math.random()*1-0.5)*0.05;this.vy=(Math.random()*1-0.5)*0.05;this.vx2=(Math.random()*1-0.5)*0.15;this.vy2=(Math.random()*1-0.5)*0.15;this.spread=0.15;this.tickOfBirth=game.ticksCounter;this.tickOfDeath=this.tickOfBirth+67;this.lastPhase=1;this.rand=Math.floor(Math.random()*100);game.effects.push(this);game.addToObjectsToDraw(this);};Bullet.prototype.update=function(ticksCounter){return this.tickOfDeath>ticksCounter;};Bullet.prototype.getYDrawingOffset=function(){return this.y;};Bullet.prototype.draw=function(exactTicks,x1,y1,x2,y2){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2))return;var age=exactTicks-this.tickOfBirth-7;var z=0;var x=0;var y=0;var img=imgCoords["bullet"+((99999999+this.rand+Math.floor(exactTicks))%4+1)];if(age>Math.sqrt(1.2)/this.spread+2*Math.sqrt(0.3)/this.spread){z=0;img=imgCoords["bullet"+(this.rand%4+1)];if(img==imgCoords.bullet3)img=imgCoords.bullet1;x=Math.sqrt(1.2)/this.spread*this.vx+this.x+this.vx2*(2*Math.sqrt(0.3)/this.spread);y=Math.sqrt(1.2)/this.spread*this.vy+this.y+this.vy2*(2*Math.sqrt(0.3)/this.spread);if(this.lastPhase==2){this.lastPhase=3;soundManager.playSound(SOUND.CARTRIDGE2,x,y,0.3);}}else if(age>Math.sqrt(1.2)/this.spread){img=imgCoords["bullet"+((99999999+this.rand-Math.floor(exactTicks))%4+1)];z=-Math.pow(this.spread*(age-Math.sqrt(1.2)/this.spread-Math.sqrt(0.3)/this.spread),2)+0.3;x=Math.sqrt(1.2)/this.spread*this.vx+this.x+this.vx2*(age-Math.sqrt(1.2)/this.spread);y=Math.sqrt(1.2)/this.spread*this.vy+this.y+this.vy2*(age-Math.sqrt(1.2)/this.spread);if(this.lastPhase==1){this.lastPhase=2;soundManager.playSound(SOUND.CARTRIDGE1,x,y,0.1);}}else{z=-Math.pow(this.spread*age,2)+1.2;x=this.x+this.vx*age;y=this.y+this.vy*age;}var scale=SCALE_FACTOR;var drawX=g2rx(x)-img.w/2*scale;var drawY=g2ry(y-z)-img.h/2*scale;c.globalAlpha=age>35?Math.max((55-age)/20,0):1;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,drawX,drawY,img.w*scale,img.h*scale);c.globalAlpha=1;};function Blood(x,y,vecX,vecY,img,noStain,zFunc,noStain2,additionalDrawingOffset){this.x=x;this.y=y;this.additionalDrawingOffset=additionalDrawingOffset?additionalDrawingOffset:0;this.z=1;var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=0.2/len;vecY*=0.2/len;this.vx=(Math.random()*1-0.5)*0.2-vecX*0.6;this.vy=(Math.random()*1-0.5)*0.2-vecY*0.6;this.scale=1+Math.random()*1.5;this.spread=0.25;this.tickOfBirth=game.ticksCounter;this.tickOfDeath=this.tickOfBirth+67;this.hasBeenDrawn=noStain?true:false;this.img=img?img:imgCoords.particleRed;this.zFunc=zFunc;var len=Math.sqrt(vecX*vecX+vecY*vecY);vecX*=0.2/len;vecY*=0.2/len;var totalLen=1.5+Math.random()*2;var running=true;while(running&&!noStain2){totalLen-=0.2;x+=vecX;y+=vecY;var path=game.getFieldPath(Math.floor(x),Math.floor(y));if(path<=5){if(vecY<0&&Math.floor(y)!=Math.floor(y-=vecY)&&Math.floor(x)==Math.floor(x-=vecX)){var img=imgCoords.particleRed;var w=2+Math.floor(Math.random()*2);var h=1;var x_=(x+12)*16-1;var y_=game.tilesCashes[Math.floor(y-1)].height-10+Math.random()*3;if(game.tilesCashes[Math.floor(y-1)]&&game.tilesCashes[Math.floor(y-1)].getContext){game.tilesCashes[Math.floor(y-1)].getContext("2d").globalAlpha=0.2;game.tilesCashes[Math.floor(y-1)].getContext("2d").drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,Math.round(x_),Math.round(y_),w,h);game.tilesCashes[Math.floor(y-1)].getContext("2d").globalAlpha=1;}}running=false;}if(totalLen<0){if(path==10){var img=imgCoords.particleRed;for(var j=0;j<game.groundCanvas.length;j++){game.groundCanvas[j].getContext("2d").globalAlpha=0.2;game.groundCanvas[j].getContext("2d").drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(x-game.groundMinX)*16,(y-game.groundMinY)*16,2,2);game.groundCanvas[j].getContext("2d").globalAlpha=1;}}running=false;}}game.effects.push(this);game.addToObjectsToDraw(this);};Blood.prototype.update=function(ticksCounter){return this.tickOfDeath>ticksCounter&&!this.hasBeenDrawn;};Blood.prototype.getYDrawingOffset=function(){return this.y+this.additionalDrawingOffset;};Blood.prototype.draw=function(exactTicks,x1,y1,x2,y2){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2))return;var age=exactTicks-this.tickOfBirth-3;var z=0;var x=0;var y=0;if(age>Math.sqrt(1.2)/this.spread){if(this.hasBeenDrawn)return;x=Math.sqrt(1.2)/this.spread*this.vx+this.x;y=Math.sqrt(1.2)/this.spread*this.vy+this.y;for(var j=0;j<game.groundCanvas.length;j++){game.groundCanvas[j].getContext("2d").globalAlpha=0.2;game.groundCanvas[j].getContext("2d").drawImage(imgs.miscSheet,this.img.x,this.img.y,this.img.w,this.img.h,(x-game.groundMinX)*16,(y-game.groundMinY)*16,2,2);game.groundCanvas[j].getContext("2d").globalAlpha=1;}this.hasBeenDrawn=true;}else{z=this.zFunc?this.zFunc(age):-Math.pow(0.25*age,2)+1.2;x=this.x+this.vx*age;y=this.y+this.vy*age;c.globalAlpha=0.8;}var scale=SCALE_FACTOR*this.scale;var drawX=g2rx(x)-this.img.w/2*scale;var drawY=g2ry(y-z*0.5)-this.img.h/2*scale;c.drawImage(imgs.miscSheet,this.img.x,this.img.y,this.img.w,this.img.h,drawX,drawY,this.img.w*scale,this.img.h*scale);c.globalAlpha=1;};function Splash(x,y,img,scale,age,loop,yOffsetMod,animSpeed){this.x=x;this.y=y;this.yOffset=y+(yOffsetMod?yOffsetMod:0);this.scale=scale?scale:1;this.img=img;this.frameW=img.frameW?img.frameW:img.w;this.countFrames=img.w/this.frameW;this.tickOfBirth=game.ticksCounter;this.tickOfDeath=this.tickOfBirth+(typeof age==="undefined"?40:age===0?999999999:age);this.loop=loop?true:false;this.frameOffset=this.loop?Math.floor(Math.random()*999):0;this.animSpeed=animSpeed?animSpeed:0.5;soundManager.playSound(SOUND.SPLASH,this.x,this.y);game.effects.push(this);game.addToObjectsToDraw(this);};Splash.prototype.update=function(ticksCounter){return this.tickOfDeath>ticksCounter;};Splash.prototype.getYDrawingOffset=function(){return this.yOffset;};Splash.prototype.draw=function(exactTicks,x1,y1,x2,y2){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2))return;var age=exactTicks-this.tickOfBirth;var scale=SCALE_FACTOR*this.scale;var x_offset=Math.floor((age+this.frameOffset)*this.animSpeed);if(this.loop)x_offset=x_offset%this.countFrames;if(x_offset>this.countFrames-1)return;var drawX=g2rx(this.x)-this.frameW/2*scale;var drawY=g2ry(this.y)-this.img.h/2*scale;c.globalAlpha=0.9;c.drawImage(imgs.miscSheet,this.img.x+x_offset*this.frameW,this.img.y,this.frameW,this.img.h,drawX,drawY,this.frameW*scale,this.img.h*scale);c.globalAlpha=1;};function Tile(x,y,type,game_){this.x=x;this.y=y;this.img=type.img;this.type=type;this.isTile=true;(game_?game_:game).addToObjectsToDraw(this);(game_?game_:game).noGridTiles.push(this);};Tile.prototype.getYDrawingOffset=function(){return this.y;};Tile.prototype.draw=function(exactTicks,x1,y1,x2,y2){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2))return;var scale=SCALE_FACTOR;var drawX=g2rx(this.x)-this.img.w/2*scale;var drawY=g2ry(this.y)-this.img.h/2*scale;c.globalAlpha=1;c.drawImage(imgs.tileSheet,this.img.x,this.img.y,this.img.w,this.img.h,drawX,drawY,this.img.w*scale,this.img.h*scale);};function Flare(x,y,z){this.x=x;this.y=y;this.z=z;this.vx=0;this.vz=0.015;this.tickOfBirth=game.ticksCounter;this.tickOfDeath=this.tickOfBirth+40+Math.random()*40;game.effects.push(this);game.addToObjectsToDraw(this);};Flare.prototype.update=function(ticksCounter){this.vx+=Math.random()*0.004-0.002;this.vz+=Math.random()*0.004-0.002;return this.tickOfDeath>ticksCounter;};Flare.prototype.getYDrawingOffset=function(){return this.y;};Flare.prototype.draw=function(exactTicks,x1,y1,x2,y2){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2))return;if(game.ticksCounter>=0){this.x+=this.vx;this.z+=this.vz;}var time2Live=Math.max(this.tickOfDeath-exactTicks,0);var globalAlpha=Math.min(time2Live/20,1);var img=imgCoords.particleYellow;var drawX=g2rx(this.x)-img.w/2*SCALE_FACTOR;var drawY=g2ry(this.y-this.z*0.8)-img.h/2*SCALE_FACTOR;c.globalAlpha=(Math.random()*0.2+0.8)*globalAlpha;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,drawX,drawY,img.w*SCALE_FACTOR,img.h*SCALE_FACTOR);var scale=SCALE_FACTOR*(Math.random()*0.2+0.9);img=imgCoords.light_yellow;drawX=g2rx(this.x)-img.w/2*scale;drawY=g2ry(this.y-this.z*0.8)-img.h/2*scale;c.globalAlpha=(Math.random()*0.1+0.25)*globalAlpha;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,drawX,drawY,img.w*scale,img.h*scale);c.globalAlpha=1;};function Fairy(x,y){this.x=x;this.y=y;this.x0=x;this.y0=y;this.z=0.2+Math.random()*0.6;this.vx=Math.random()*0.005-0.0025;this.vy=Math.random()*0.005-0.0025;this.tickOfDeath=game.ticksCounter+450+Math.floor(Math.random()*120);};Fairy.prototype.update=function(ticksCounter){this.vx+=Math.random()*0.0005-0.00025;this.vy+=Math.random()*0.0005-0.00025;return this.tickOfDeath>ticksCounter;};Fairy.prototype.draw=function(exactTicks,x1,y1){if(game.ticksCounter>=0){this.x+=this.vx;this.y+=this.vy;}var fac=1/(1-this.z);var x=x1+(this.x-x1)*fac;var y=y1+(this.y-y1)*fac;if(!(x+3>=game.cameraX&&y+3>=game.cameraY&&x-3<=game.cameraX2&&y-3<=game.cameraY2))return;var time2Live=Math.max(this.tickOfDeath-exactTicks,0);var globalAlpha=Math.min(time2Live/20,1);var scale=SCALE_FACTOR*this.z*3;var img=imgCoords.particleWhite;var drawX=g2rx(x)-img.w/2*scale;var drawY=g2ry(y-this.z*0)-img.h/2*scale;c.globalAlpha=0.2*globalAlpha;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,drawX,drawY,img.w*scale,img.h*scale);scale=SCALE_FACTOR*this.z*3;img=imgCoords.light_light_yellow;drawX=g2rx(x)-img.w/2*scale;drawY=g2ry(y-this.z*0)-img.h/2*scale;c.globalAlpha=(Math.random()*0.05+0.1)*globalAlpha;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,drawX,drawY,img.w*scale,img.h*scale);c.globalAlpha=1;};function PlasmaShield(x,y,toX,toY){this.x=x;this.y=y;this.radius=0.5;var vecX=toX-x;var vecY=toY-y;this.angle=getAngle(x,y,toX,toY)+Math.random()*0.2-0.1;var len=Math.sqrt(vecX*vecX+vecY*vecY);this.x-=vecX*(this.radius-0.1)/len;this.y-=vecY*(this.radius-0.1)/len;this.tickOfBirth=game.ticksCounter;this.tickOfDeath=game.ticksCounter+10;game.effects.push(this);game.addToObjectsToDraw(this);};PlasmaShield.prototype.update=function(){return this.tickOfDeath>game.ticksCounter;};PlasmaShield.prototype.getYDrawingOffset=function(){return this.y;};PlasmaShield.prototype.draw=function(exactTicks,x1,y1,x2,y2){if(!(this.x+3>=x1&&this.y+3>=y1&&this.x-3<=x2&&this.y-3<=y2))return;var age=(exactTicks-this.tickOfBirth)*50;var randomYOffsetPixels=(age*0.05%4-2)*SCALE_FACTOR*0.5;c.scale(1,0.8);c.strokeStyle="rgba(200, 200, 255, "+(1-age/400)*0.6+")";c.lineWidth=1.5*SCALE_FACTOR;c.beginPath();c.arc((this.x-game.cameraX)*FIELD_SIZE,((this.y-0.2-game.cameraY)*FIELD_SIZE+randomYOffsetPixels)/0.8,this.radius*FIELD_SIZE,this.angle-0.5,this.angle+0.5,false);c.arc((this.x-game.cameraX)*FIELD_SIZE,((this.y-0.3-game.cameraY)*FIELD_SIZE+randomYOffsetPixels)/0.8,this.radius*FIELD_SIZE,this.angle-0.5,this.angle+0.5,false);c.arc((this.x-game.cameraX)*FIELD_SIZE,((this.y-0.4-game.cameraY)*FIELD_SIZE+randomYOffsetPixels)/0.8,this.radius*FIELD_SIZE,this.angle-0.5,this.angle+0.5,false);c.stroke();c.scale(1,1/0.8);};function Interface(map){this.messages=[];document.getElementById('chatloginner').innerHTML="";this.hoverWeapon=-1;this.hoverAbility=-1;this.buttons=[];this.top3=[];this.chatlog=[];this.currentUpgChoices=[];this.oldUpgChoices=[];this.showOldUpgChoicesUntil=-9999;this.currentUpgChoicesStart=-9999;this.currentUpgChoicesEnd=-9999;this.selectedChoiceUntil=-9999;this.upgNotificationStart=-9999;this.upgNotificationHovered=false;this.cureButtonHovered=false;this.abilityPoints=0;this.soulLvl=1;this.soulsGot=0;this.soulsNeeded=0;this.hoverChoice=null;this.buttonIsHovered=false;this.lastChoiceIndex=-1;this.skipButtonHover=false;this.unskipButtonHover=false;this.upgradeChoicesAvailable=false;this.tutorialMessagesActive=[];this.lastTutorialMessagesStateChange=[];if(map&&map.tutorialMessages)for(var i=0;i<map.tutorialMessages.length;i++){this.tutorialMessagesActive.push(false);this.lastTutorialMessagesStateChange.push(-99999);}if(isMobile){this.buttons.push(new Button(1,-1.8,1.5,1.5,KEY.LEFT));this.buttons.push(new Button(2.6,-1.8,1.5,1.5,KEY.DOWN));this.buttons.push(new Button(4.2,-1.8,1.5,1.5,KEY.RIGHT));this.buttons.push(new Button(2.6,-3.4,1.5,1.5,KEY.UP));}this.replayLength=0;this.replayLengthStr="";this.replayTimer=0;this.provisionalReplayPos=-1;this.fastForwardTo=-1;this.replayPlusHover=false;this.replayMinusHover=false;this.recordGIF=false;this.gifButtonIsHovered=false;this.gifProcessing=false;};Interface.prototype.analyzeReplay=function(r){var counter=0;for(var i=0;i<r.length;i++){var splitMsg=r[i].split("$");if(splitMsg[0]=="upd")counter++;}this.replayLength=counter;this.replayLengthStr=ticks2TimeStr(this.replayLength);};Interface.prototype.setMainKillMsg=function(msg,color,cssAnimName,two,img){if(game.fastForward)return;var el=document.getElementById("mainKillMsg"+(two?"2":""));var str="";for(var i=0;i<msg.length;i++){str+="<span class='noSelect' oncontextmenu='return false;'>"+msg.substr(i,1)+"</span>";}el.innerHTML=str;el.style.color=color;if(img){el.innerHTML="<span> &nbsp;</span>"+el.innerHTML;var scale=SCALE_FACTOR*0.7;var canvas=document.createElement("canvas");canvas.className="noSelect";canvas.width=Math.floor(scale*img.w);canvas.height=Math.floor(scale*img.h);canvas.getContext("2d").mozImageSmoothingEnabled=false;canvas.getContext("2d").msImageSmoothingEnabled=false;canvas.getContext("2d").imageSmoothingEnabled=false;canvas.getContext("2d").drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,0,0,canvas.width,canvas.height);el.insertBefore(canvas,el.firstChild);}var els=el.childNodes;for(var i=0;i<els.length;i++){els[i].style.animationName=cssAnimName;els[i].style.animationDelay=i*0.015+"s";els[i].style.animationDuration="5s";}};Interface.prototype.getFormattedPlayerName=function(player){if(!player){return null;}var clan_tag="";if(player.clan_tag&&player.clan_tag.length>0){clan_tag="[<span style='color: "+player.nameColorCode+";'>"+player.clan_tag+"</span>] ";}var player_name=clan_tag+"<span style='color: "+player.nameColorCode+";'>"+player.fullName+"</span>";return"<span style='background: "+player.getTeamColor()+";'>"+player_name+"</span>";};Interface.prototype.addKillMsg=function(p1,p2,projectile,murderWeaponID,obj,splash){if(game.fastForward)return;var el=document.getElementById('killsDisplayDiv');var now=Date.now();var div=document.createElement("div");p1=this.getFormattedPlayerName(p1);p2=this.getFormattedPlayerName(p2);var canvas=document.createElement("canvas");var img=projectile&&projectile.weapon?imgCoords[projectile.weapon.img]:imgCoords.grenade1;var wpn=typeof murderWeaponID!=="undefined"?weapons[murderWeaponID]:null;if(wpn)img=imgCoords[wpn.img];if(obj)img=imgCoords[obj.ability.icon];if(splash=="true")img=imgCoords.splashSingle;var scale=projectile&&projectile.weapon||wpn?SCALE_FACTOR_BASE*0.3:SCALE_FACTOR_BASE*0.6;canvas.width=Math.floor(scale*img.w);canvas.height=Math.floor(scale*img.h);canvas.getContext("2d").mozImageSmoothingEnabled=false;canvas.getContext("2d").msImageSmoothingEnabled=false;canvas.getContext("2d").imageSmoothingEnabled=false;canvas.getContext("2d").drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,0,0,canvas.width,canvas.height);if(p1==p2)div.innerHTML=slayOne.widgets.lang.get("game.msg.killed_self_broadcast",{playerName:p1});else div.innerHTML=p1+" <img src='"+canvas.toDataURL()+"' /> "+p2;div.className="chatMsg noSelect killMsg";div.setAttribute("data-time",now);el.appendChild(div);};Interface.prototype.chatMsg=function(msg,color){if(game.fastForward)return;var el=document.getElementById('chatDisplayDiv');var el2=document.getElementById('chatloginner');var now=Date.now();var playerID=msg.split("$")[0];var formattedPlayerName=null;if(playerID==-1){formattedPlayerName="<span style='text-decoration: underline; color: red;'>Server</span>";}else{var pl=game.getPlayerFromID(playerID);if(pl&&pl.name&&playerIsBeeingIgnored(pl.name)){return;}formattedPlayerName=this.getFormattedPlayerName(pl);}if(formattedPlayerName){msg=formattedPlayerName+": "+escapeHtml(msg.split("$").slice(1).join("$"));var div=document.createElement("div");var div2=document.createElement("div");div.innerHTML=msg;div2.innerHTML=msg;div.className="chatMsg noSelect";div2.className="noSelect";div.setAttribute("data-time",now);el.appendChild(div);el2.appendChild(div2);soundManager.playSound(SOUND.CHAT1,undefined,undefined,0.5);}};Interface.prototype.addMsg=function(msg,color){if(game.fastForward)return;var el=document.getElementById('chatDisplayDiv');var now=Date.now();var div=document.createElement("div");div.innerHTML="<span style='color: "+color+";'>"+msg+"</span>";div.className="chatMsg noSelect";div.setAttribute("data-time",now);el.appendChild(div);};Interface.prototype.click=function(){var now=Date.now();if(this.hoverWeapon>=0&&game&&!weaponsUnclickable){game.switchWeapon(this.hoverWeapon);return true;}if(this.cureButtonHovered){game.cureTick=0;network.send("cure");return true;}if(this.hoverAbility>=0&&game&&!weaponsUnclickable){this.initAbility(pl_active_abilities[this.hoverAbility],this.hoverAbility);return true;}if(this.hoverChoice&&game&&game.playingPlayer){if(this.showOldUpgChoicesUntil<now){this.currentUpgChoicesEnd=now+200;network.send("upg$"+this.hoverChoice.index+"$"+this.hoverChoice.sub);this.lastChoiceIndex=this.hoverChoice.i;this.selectedChoiceUntil=now+500;this.upgradeChoicesAvailable=false;this.abilityPoints-=this.hoverChoice.cost;soundManager.playSound(SOUND.BEEBEEP);game.playingPlayer.createAtributeEffect();}return true;}if(this.upgNotificationStart>0&&this.upgNotificationHovered){this.shopUpgrades();return true;}if(this.skipButtonHover){this.hideUpgrades();return true;}if(this.unskipButtonHover){this.shopUpgrades();return true;}if(this.provisionalReplayPos>=0){soundManager.playSound(SOUND.CLICK);this.replayJumpTo();return true;}if(this.gifButtonIsHovered){soundManager.playSound(SOUND.CLICK);if(this.recordGIF)this.endGIF();else this.startGIF();return true;}if(this.replayPlusHover){window.soundManager.playSound(SOUND.CLICK);changeReplaySpeed(1);return true;}if(this.replayMinusHover){window.soundManager.playSound(SOUND.CLICK);changeReplaySpeed(-1);return true;}};Interface.prototype.shopUpgrades=function(){this.currentUpgChoicesStart=Date.now();this.currentUpgChoicesEnd=this.currentUpgChoicesStart+9999999;this.upgNotificationStart=-9999;soundManager.playSound(SOUND.BEEBEEP);};Interface.prototype.hideUpgrades=function(){this.currentUpgChoicesEnd=Date.now()+200;soundManager.playSound(SOUND.BEEBEEP);this.hoverChoice=null;};Interface.prototype.initAbility=function(ab,i){if(KeyManager.activeAbility==ab){KeyManager.activeAbility=null;soundManager.playSound(SOUND.SWITCH);}else{var error=false;if(ab.energy>game.playingPlayerEnergy){error=true;this.addMsg(slayOne.widgets.lang.get("game.msg.no_energy"),"red");soundManager.playSound(SOUND.NEGATIVE,0.8);}else if(game.lastAbilityUses[i]+ab.cooldown>game.ticksCounter){error=true;this.addMsg(slayOne.widgets.lang.get("game.msg.no_cooldown"),"red");soundManager.playSound(SOUND.NEGATIVE,0.8);}else if(ab.type=="blink"&&game.playingPlayer.carriesFlag()){error=true;this.addMsg(slayOne.widgets.lang.get("game.skills.teleport.disabled_in_ctf"),"red");soundManager.playSound(SOUND.NEGATIVE,0.8);}if(ab.isInstant){if(!error){network.send("ab$"+ab.id);KeyManager.activeAbility=null;}}else{if(!error)soundManager.playSound(SOUND.SWITCH);KeyManager.activeAbility=ab;}}};Interface.prototype.killAllMsgs=function(){var el=document.getElementById('chatDisplayDiv');while(el.childNodes.length>0){el.removeChild(el.childNodes[0]);}el=document.getElementById('killsDisplayDiv');while(el.childNodes.length>0){el.removeChild(el.childNodes[0]);}};Interface.prototype.refreshTop3=function(){var sort=game.type.winningCondition;if(!sort){return;}var playersByScore=game.players.sort(game.playerSortHandler);this.top3=[];this.playingPlayerStats=null;var playingPlayerIsInTop3=false;var myRank=0;for(var i=0;i<Math.min(3,playersByScore.length);i++){this.top3[i]={rank:i+1,id:playersByScore[i].id,team:playersByScore[i].team,name:playersByScore[i].name,clan:playersByScore[i].clan_tag,souls:playersByScore[i][sort]};if(game.playingPlayer==playersByScore[i]){playingPlayerIsInTop3=true;myRank=i+1;}}if(game&&game.playingPlayer&&!playingPlayerIsInTop3)for(i=0;i<playersByScore.length;i++){if(playersByScore[i]==game.playingPlayer){myRank=i+1;this.top3.push({rank:myRank,id:game.playingPlayer.id,team:game.playingPlayer.team,clan:game.playingPlayer.clan_tag,name:game.playingPlayer.name,souls:game.playingPlayer[sort]});break;}}return myRank;};Interface.prototype.presentUpgChoice=function(splitMsg){var now=Date.now();if(this.currentUpgChoicesEnd+500>now){this.oldUpgChoices=this.currentUpgChoices;this.showOldUpgChoicesUntil=now+500;this.currentUpgChoicesStart=now-1000;this.currentUpgChoicesEnd=now+9999999;this.upgNotificationStart=-9999;}else this.upgNotificationStart=now;this.currentUpgChoices=[];this.abilityPoints=splitMsg[1];this.refreshSouls(parseInt(splitMsg[2]));if(game.playingPlayer){game.playingPlayer.souls=parseInt(parseInt(splitMsg[2]));game.playingPlayer.soulLvl=getLvlFromSouls(parseInt(splitMsg[2]));}var k=0;for(var i=3;i<splitMsg.length;i+=3){var upg=abilities[splitMsg[i]];var maxLvl=splitMsg[i+1]!="-1"?5:10;if(splitMsg[i+1]=="-1"&&upg.maxLvl)maxLvl=upg.maxLvl;else if(splitMsg[i+1]!="-1"&&upg.levelUpMaxUpgLvl&&upg.levelUpMaxUpgLvl[splitMsg[i+1]])maxLvl=upg.levelUpMaxUpgLvl[splitMsg[i+1]];this.currentUpgChoices.push({img:imgCoords[upg.icon],text:upg.name+(splitMsg[i+1]!="-1"?" - "+upg.levelUpFieldsName[splitMsg[i+1]]:""),cost:splitMsg[i+1]!="-1"?upg.levelUpCost[splitMsg[i+1]]:upg.cost,index:splitMsg[i],sub:splitMsg[i+1],lvl:parseInt(splitMsg[i+2]),maxLvl:maxLvl,i:k});k++;}if(this.currentUpgChoices.length==0)this.upgNotificationStart=-9999;this.upgradeChoicesAvailable=this.currentUpgChoices.length>0;};Interface.prototype.refreshSouls=function(souls){this.soulLvl=getLvlFromSouls(souls);var lowBorder=getCrystalsRequiredForLvl(this.soulLvl);var highBorder=getCrystalsRequiredForLvl(this.soulLvl+1);this.soulsGot=souls-lowBorder;this.soulsNeeded=highBorder-lowBorder;};Interface.prototype.draw=function(exactTicks){var now=Date.now();var el=document.getElementById('chatDisplayDiv');var els=el.childNodes;for(var i=0;i<els.length;i++){if(els[i].getAttribute("data-time")<now-10000||i<els.length-10)el.removeChild(els[i]);}el=document.getElementById('killsDisplayDiv');var els=el.childNodes;for(var i=0;i<els.length;i++){if(els[i].getAttribute("data-time")<now-10000||i<els.length-10)el.removeChild(els[i]);}var scale=SCALE_FACTOR_BASE*0.8;var scaleA=scale*0.5;var scaleM=scale*0.40;if(game.map.tutorialMessages&&game.playingPlayer)for(var i=0;i<game.map.tutorialMessages.length;i++){var msg=game.map.tutorialMessages[i];if(tickDiff>0){var inRange=Math.sqrt(Math.pow(game.playingPlayer.x-msg.x,2)+Math.pow(game.playingPlayer.y-msg.y,2))<=3.5;if(this.tutorialMessagesActive[i]!=inRange)this.lastTutorialMessagesStateChange[i]=game.ticksCounter;this.tutorialMessagesActive[i]=inRange;}if(this.tutorialMessagesActive[i]||this.lastTutorialMessagesStateChange[i]+10>=game.ticksCounter){var msg_alpha=1;if(this.lastTutorialMessagesStateChange[i]+20>=game.ticksCounter){msg_alpha=Math.min(Math.max((game.ticksCounter-this.lastTutorialMessagesStateChange[i])/10,0.05),0.95);if(!this.tutorialMessagesActive[i])msg_alpha=1-msg_alpha;}var x=g2rx(msg.x);var y=g2ry(msg.y-3);var textW=SCALE_FACTOR_BASE*78;c.globalAlpha=msg_alpha;var img=imgCoords.speech;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x-90*SCALE_FACTOR_BASE*0.5,y-10*SCALE_FACTOR_BASE,90*SCALE_FACTOR_BASE,img.h*SCALE_FACTOR_BASE);if(msg.img&&imgCoords[msg.img]){img=imgCoords[msg.img];var scaleImg=Math.min(16/img.w,16/img.h)*SCALE_FACTOR_BASE;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x-76*SCALE_FACTOR_BASE*0.5,y+SCALE_FACTOR_BASE*6-img.h*0.5*scaleImg,img.w*scaleImg,img.h*scaleImg);textW-=img.w*scaleImg+SCALE_FACTOR_BASE*4;x=x+(-textW+SCALE_FACTOR_BASE*78)*0.5;}c.globalAlpha=1;drawText(c,F_(msg.msg),"white",SCALE_FACTOR_BASE*3.5,x,y,textW,"center",msg_alpha,"rgba(0, 0, 0, 0.0)",SCALE_FACTOR_BASE*5,null,null,null,"Verdana, Geneva, Arial, Helvetica, sans-serif");gaEventOnce('tutorial-step-'+msg.msg);}}var buttonAlpha=weaponsUnclickable?0.7:1.0;var wpns=game&&game.playingPlayerIsZombie?[weapons[12]]:weapons;if(game&&game.playingPlayer&&(game.playingPlayer.weapon||game.playingPlayerIsZombie)&&!game.playingPlayer.dieAt){var button_img=imgCoords.weaponFrame2;var x1=WIDTH-(button_img.w+1)*scaleM;var y1=HEIGHT-(button_img.h+1)*scaleM;this.hoverWeapon=-1;var img2=imgCoords.weaponFrameCurrent;for(var i=0;i<wpns.length;i++){var wpn=wpns[wpns.length-i-1];var totalAmmo=game.playingPlayerClips[wpn.id]+game.playingPlayerAmmo[wpn.id];if((totalAmmo>0||game.playingPlayer.weapon==wpn)&&!wpn.noWeapon||wpn==weapons[12]&&game.playingPlayerIsZombie){button_img=totalAmmo>0||wpn==weapons[12]?imgCoords.weaponFrame2Green:imgCoords.weaponFrame2;var sheet=totalAmmo>0||wpn==weapons[12]?imgs.miscSheet:imgs.miscSheetGrey;c.globalAlpha=buttonAlpha;c.drawImage(sheet,button_img.x,button_img.y,button_img.w,button_img.h,x1,y1,button_img.w*scaleM,button_img.h*scaleM);if(game.playingPlayer.weapon==wpn||wpn==weapons[12])c.drawImage(imgs.miscSheet,img2.x,img2.y,img2.w,img2.h,x1-3*scaleM,y1-3*scaleM,img2.w*scaleM,img2.h*scaleM);var wpn_img=imgCoords[wpn.img];c.drawImage(sheet,wpn_img.x,wpn_img.y,wpn_img.w,wpn_img.h,x1+button_img.w*scaleM*0.4-wpn_img.w*0.5*scaleM*1.3,y1+(button_img.h-3)*scaleM-wpn_img.h*scaleM*1.3,wpn_img.w*scaleM*1.3,wpn_img.h*scaleM*1.3);var ammo_img=imgCoords[wpn.ammoImgSmall];c.drawImage(sheet,ammo_img.x,ammo_img.y,ammo_img.w,ammo_img.h,x1+button_img.w*scaleM*0.25-ammo_img.w*scaleM*1.2,y1+button_img.h*scaleM*0.2-ammo_img.h*0.5*scaleM*1.2,ammo_img.w*scaleM*1.2,ammo_img.h*scaleM*1.2);var ammo=wpn.ammoSize?game.playingPlayerClips[wpn.id]+" ("+game.playingPlayerAmmo[wpn.id]+")":"INF";drawText(c,ammo,totalAmmo>0?"#4FAC43":"rgba(255, 255, 255, "+buttonAlpha*0.7+")",scaleM*7.5,x1+button_img.w*scaleM*0.35,y1+button_img.h*0.55);if(wpn.id<=9){var key=commandKeys[COMMAND["WPN"+(wpn.id+1)]];var color=KeyManager.keys[key]?"rgba(100, 170, 110, "+buttonAlpha*0.8+")":"rgba(255, 255, 255, "+buttonAlpha*0.8+")";drawText(c,"["+keyNames[key]+"]",color,scaleM*6,x1+button_img.w*scaleM*0.8,y1+button_img.h*scaleM*0.8,"right");}c.globalAlpha=1;if(!weaponsUnclickable&&KeyManager.x>=x1&&KeyManager.y>=y1&&KeyManager.y<=y1+button_img.h*scaleM){this.hoverWeapon=wpn.id;c.fillStyle="rgba(0, 0, 0, 0.8)";c.fillRect(WIDTH-100*scale,HEIGHT-80*scale,60*scale,50*scale);drawText(c,wpn.name,"white",scale*4,WIDTH-95*scale,HEIGHT-74*scale,scale*200,"left",1,null,null,scale*50);drawText(c,wpn.description,"#D4D4D4",scale*3,WIDTH-95*scale,HEIGHT-64*scale,scale*50,"left",1,null,scale*3.5);c.globalAlpha=0.5;c.drawImage(imgs.miscSheet,img2.x,img2.y,img2.w,img2.h,x1-3*scaleM,y1-3*scaleM,img2.w*scaleM,img2.h*scaleM);c.globalAlpha=1;}y1-=(button_img.h+2)*scaleM;}}}var now=Date.now();if(window.lastReplaySpeedChange+2000>now){var alpha_=Math.min((window.lastReplaySpeedChange+2000-now)/750,1);drawText(c,"Speed x"+window.replayOption.display,"#FFD155",FIELD_SIZE_BASE*0.35,WIDTH-SCALE_FACTOR_BASE*7,HEIGHT-SCALE_FACTOR_BASE*10,500,"right",alpha_);}if(game.playingPlayer&&KeyManager.activeAbility&&KeyManager.activeAbility.activeMsg)drawText(c,KeyManager.activeAbility.activeMsg,"#C0EDBA",FIELD_SIZE_BASE*0.4,WIDTH*0.5,HEIGHT*0.1,WIDTH-20,"center",0.8,"rgba(255, 255, 255, 0.3)",FIELD_SIZE_BASE*0.45);this.hoverAbility=-1;if(game&&game.playingPlayer&&!game.playingPlayer.dieAt)for(var i=0;i<pl_active_abilities.length;i++){if(pl_active_abilities[i]){c.globalAlpha=buttonAlpha;var a=pl_active_abilities[i];var button_img=game.playingPlayerEnergy>=a.energy?imgCoords.abilityFrameGreen:imgCoords.abilityFrame;var x1=WIDTH-scaleA*(button_img.w+1)*(pl_active_abilities.length-i)-(imgCoords.weaponFrame.w+6)*scaleM;var y1=HEIGHT-(button_img.h+1)*scaleA;var sheet=a.energy<=game.playingPlayerEnergy&&game.lastAbilityUses[i]+a.cooldown<=game.ticksCounter?imgs.miscSheet:imgs.miscSheetGrey;c.drawImage(sheet,button_img.x,button_img.y,button_img.w,button_img.h,x1,y1,button_img.w*scaleA,button_img.h*scaleA);var img=imgCoords[a.icon];var imgScale=(button_img.w-6)*scaleA/Math.max(img.w,img.h);var x=x1+(button_img.w*scaleA-img.w*imgScale)/2;var y=y1+(button_img.h*scaleA-img.h*imgScale)*0.2;c.drawImage(sheet,img.x,img.y,img.w,img.h,x,y,img.w*imgScale,img.h*imgScale);var key=commandKeys[COMMAND["ABILITY"+(i+1)]];var color=KeyManager.keys[key]?"rgba(100, 170, 110, "+buttonAlpha*0.8+")":"rgba(255, 255, 255, "+buttonAlpha*0.7+")";drawText(c,getKeyName(key),color,scale*3.5,x1+button_img.w*scaleA*0.5,y1+scaleA*38,button_img.w,"center");if(!weaponsUnclickable&&KeyManager.x>x1&&KeyManager.x<x1+button_img.w*scaleA&&KeyManager.y>HEIGHT-(button_img.h+1)*scaleA){this.hoverAbility=i;c.globalAlpha=0.3;c.drawImage(imgs.miscSheetWhite,button_img.x,button_img.y,button_img.w,button_img.h,x1,y1,button_img.w*scaleA,button_img.h*scaleA);c.globalAlpha=1;c.fillStyle="rgba(0, 0, 0, 0.8)";c.fillRect(WIDTH-100*scale,HEIGHT-65*scale,scale*65,scale*35);drawText(c,a.name,"white",scale*4,WIDTH-scale*96,HEIGHT-58*scale);drawText(c,slayOne.widgets.lang.get("game.skills.misc.energy_cost",{energy:a.energy}),"#DD52CE",scale*3,WIDTH-scale*96,HEIGHT-52*scale,scale*90,"left");drawText(c,a.description,"#D4D4D4",scale*3,WIDTH-scale*96,HEIGHT-45*scale,scale*55,"left",1,null,scale*3.5);}var cd=game.lastAbilityUses[pl_active_abilities[0]==a?0:1]+a.cooldown-game.ticksCounter;if(cd>0)drawText(c,Math.floor(cd/20).toString(),"red",scale*9,x1+button_img.w*scaleA*0.5,y1+scaleA*25,button_img.w,"center",1,"rgba(0, 0, 0, 0.65)",button_img.h);}}if(game.playingPlayer&&game.playingPlayer.invincibleUntil>game.ticksCounter&&game.ticksCounter>0)drawText(c,slayOne.widgets.lang.get("game.msg.invincible",{seconds:Math.ceil((game.playingPlayer.invincibleUntil-game.ticksCounter)/20)}),"#dbe0be",FIELD_SIZE_BASE*0.2,WIDTH*0.5,HEIGHT*0.85,WIDTH-20,"center",0.8,"rgba(255, 255, 255, 0.2)",FIELD_SIZE_BASE*0.3);var yText=7.5*scale;if(game&&game.type.team&&game.type.souls){var scaleTS=scale*0.9;var soulsImg=imgCoords.souls;c.drawImage(imgs.miscSheet,soulsImg.x,soulsImg.y,soulsImg.w,soulsImg.h,WIDTH*0.5-soulsImg.w*0.5*scaleTS,1*scaleTS,soulsImg.w*scaleTS,soulsImg.h*scaleTS);drawText(c,game.scoreTeam1,"#A13232",scale*6,WIDTH*0.5-(soulsImg.w*0.5+3)*scaleTS,yText+2*scale,scale*70,"right",1,"rgba(0, 0, 0, 0.3)",scale*7);drawText(c,game.scoreTeam2,"#1B698E",scale*6,WIDTH*0.5+(soulsImg.w*0.5+3)*scaleTS,yText+2*scale,scale*70,"left",1,"rgba(0, 0, 0, 0.3)",scale*7);yText+=11*scale;}if(game.roundTime>0&&(game.map.special!="tutorial1"||game.ticksCounter>=game.roundTime-20*60)){var str="";var ongoing;if(game.ticksCounter<0){str=Math.floor(-game.ticksCounter/20);ongoing=false;}else{str=ticks2TimeStr(game.roundTime-game.ticksCounter);ongoing=true;}F$('rankInGame').refreshTime(ongoing,str);drawText(c,str,"rgba(255, 255, 255, 0.7)",scale*5.5,WIDTH/2,yText,WIDTH*0.9,"center");yText+=6*scale;}if(game.fps){var fpsFontSize=scale*4.5;drawText(c,'FPS: '+game.fps,fpsColor(game.fps),fpsFontSize,10,100,WIDTH*2,'left');if(game.fpsAvg){drawText(c,' ('+game.fpsAvg+')',fpsColor(game.fpsAvg),fpsFontSize,10+fpsFontSize*4.5,100,WIDTH*2,'left');}if(game.pingShow&&game.isGaming()){drawText(c,'Ping: '+(game.ping>700?'LAG':game.ping),pingColor(game.ping),fpsFontSize,10+fpsFontSize*8.5,100,WIDTH*2,'left');}}if(game.type.coopZombieMode){var alive=0;var _iteratorNormalCompletion20=true;var _didIteratorError20=false;var _iteratorError20=undefined;try{for(var _iterator20=game.players[Symbol.iterator](),_step20;!(_iteratorNormalCompletion20=(_step20=_iterator20.next()).done);_iteratorNormalCompletion20=true){var p=_step20.value;if(p&&!p.isHumanZombie){alive++;}}}catch(err){_didIteratorError20=true;_iteratorError20=err;}finally{try{if(!_iteratorNormalCompletion20&&_iterator20.return){_iterator20.return();}}finally{if(_didIteratorError20){throw _iteratorError20;}}}drawText(c,'Alive: '+alive+' / '+game.players.length,pingColor(alive>3?1:999),fpsFontSize,10,130,WIDTH*2,'left');}var scanMsg=function scanMsg(text,color){drawText(c,text,color,FIELD_SIZE_BASE*0.3,WIDTH*0.5,yText+2*scale,WIDTH-20,"center");};if(game.playingPlayer&&!game.playingPlayer.dieAt&&game.showEnemiesOnMinimapUntil>=game.ticksCounter){scanMsg(slayOne.widgets.lang.get("game.skills.scan.countdown",{seconds:Math.floor((game.showEnemiesOnMinimapUntil-game.ticksCounter)/20)}),"rgba(0, 255, 6, 0.7)");}else if(game&&game.type.flag){scanMsg(slayOne.widgets.lang.get(game.getFlagText()),"rgba(255, 246, 173, "+(0.55+Math.sin(exactTicks*0.4)*0.15)+")");}else if(game&&game.type.coopZombieMode){scanMsg(game.getZombieCoopText(),"rgba(255, 246, 173, "+(0.55+Math.sin(exactTicks*0.4)*0.15)+")");}if(game.ticksCounter<0)drawText(c,game.victoryMsg,"rgba(255, 255, 255, 0.7)",scale*7.0,WIDTH/2,17*SCALE_FACTOR_BASE,WIDTH*0.9,"center");if(game.ticksCounter<0){F$('rankInGame').setVictoryMessage(game.victoryMsg);}else{F$('rankInGame').setVictoryMessage("");}scale*=0.7;this.hoverChoice=null;this.upgNotificationHovered=false;this.skipButtonHover=false;this.unskipButtonHover=false;var upgChoices=this.showOldUpgChoicesUntil>=now?this.oldUpgChoices:this.currentUpgChoices;if(game&&game.playingPlayer&&game.type.souls&&game.ticksCounter>0){var img=imgCoords.newStatsFrame;var img2=imgCoords.soulsBar;var img3=imgCoords.hpBar1;var img4=imgCoords.energyBar;y=HEIGHT-(img.h+1)*scale;x=1*scale;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x,y,img.w*scale,img.h*scale);drawText(c,this.soulLvl,"#e1f063",scale*8,x+16*scale,y+14*scale,24*scale,"right",1,null,null,10*scale);drawText(c,game.playingPlayer.unsafeName,"#b9cc8d",scale*8,x+20*scale,y+14*scale,100*scale,"left",1,null,null,scale*42);drawText(c,game.playingPlayer.souls,"#b4b7b8",scale*7,x+18*scale,y+29*scale,100*scale,"left",1,null,null,16*scale);drawText(c,this.abilityPoints,"#5cc3ef",scale*7,x+46*scale,y+29*scale,100*scale,"left",1,null,null,16*scale);c.drawImage(imgs.miscSheet,img2.x,img2.y,img2.w,img2.h,x+69*scale,y+5*scale,73*scale*(this.soulsGot/this.soulsNeeded),10*scale);drawText(c,this.soulsGot+" / "+this.soulsNeeded,"#d0e661",scale*8,x+106*scale,y+14*scale,84*scale,"center");c.drawImage(imgs.miscSheet,img3.x,img3.y,img3.w,img3.h,x+69*scale,y+20*scale,73*scale*(game.playingPlayer.hp/game.playingPlayer.maxHP),5*scale);drawText(c,Math.ceil(game.playingPlayer.hp)+" / "+Math.ceil(game.playingPlayer.maxHP),"white",scale*6,x+106*scale,y+25*scale,84*scale,"center",1,null,null,null,"black");c.drawImage(imgs.miscSheet,img4.x,img4.y,img4.w,img4.h,x+69*scale,y+28*scale,73*scale*(game.playingPlayerEnergy/100),2*scale);img=imgCoords.newUpgFrame;img2=imgCoords.newUpgFrameWhite;img3=imgCoords.newUpgFrameYellow;y-=(img.h+1)*scale;if(game.playingPlayer.dieAt)return;if(this.upgNotificationStart>0){var nr=game.ticksCounter/3%3+1;img=imgCoords["newUps"+Math.floor(nr)];var age=now-this.upgNotificationStart;var h=Math.min(img.h,age/400*img.h);c.globalAlpha=1-nr%1;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,h,x,y,img.w*scale,h*scale);img=imgCoords["newUps"+(Math.floor(nr)%3+1)];c.globalAlpha=nr%1;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,h,x,y,img.w*scale,h*scale);c.globalAlpha=1;drawText(c,F_("game.msg.choose_upgrade"),"#4BA6FA",scale*8,x+5*scale,y+10*scale,200*scale,"left",1,null,null,scale*100);drawText(c,F_("game.msg.upgrade_shortcut",{key:keyNames[commandKeys[COMMAND.PICK_UPGRADE]]}),"#4BA6FA",scale*6,x+6*scale,y+21*scale,200*scale,"left",1,null,null,scale*100);if(KeyManager.x<=img.w*scale&&KeyManager.y>=y){this.upgNotificationHovered=true;nr=game.ticksCounter/5%4+1;img=imgCoords["newUpsFrame"+Math.floor(nr)];c.globalAlpha=1-nr%1;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x-1*scale,y-2*scale,img.w*scale,img.h*scale);img=imgCoords["newUpsFrame"+(Math.floor(nr)%4+1)];c.globalAlpha=nr%1;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x-1*scale,y-2*scale,img.w*scale,img.h*scale);c.globalAlpha=1;}}else if(upgChoices.length>0){if(this.currentUpgChoicesStart+350>now)x-=scale*img.w*(this.currentUpgChoicesStart+350-now)/350;if(this.currentUpgChoicesEnd<now)x-=scale*img.w*(now-this.currentUpgChoicesEnd)/350;for(var i=0;upgChoices&&i<upgChoices.length;i++){var choice=upgChoices[i];var img5=choice.img;var abImgScale=scale*16/Math.max(img5.w,img5.h);c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x,y,img.w*scale,img.h*scale);c.drawImage(imgs.miscSheet,img5.x,img5.y,img5.w,img5.h,x+img.h*scale/2-img5.w*abImgScale/2-scale*1,y+img.h*scale/2-img5.h*abImgScale/2,img5.w*abImgScale,img5.h*abImgScale);drawText(c,choice.cost,"#5cc3ef",scale*7.5,x+108*scale,y+18*scale);drawText(c,choice.text,"#FFFDC0",scale*6.5,x+24*scale,y+22*scale,150*scale,"left",1,null,null,scale*70);for(var k=0;k<choice.maxLvl;k++){c.fillStyle=k<choice.lvl?"#65E054":"rgba(0, 0, 0, 0.8)";c.fillRect(x+24*scale+k*11*scale,y+4*scale,10*scale,2*scale);}if(this.lastChoiceIndex==i&&this.selectedChoiceUntil>now){if(game.ticksCounter%2==1){c.globalAlpha=0.75;c.drawImage(imgs.miscSheet,img3.x,img3.y,img3.w,img3.h,x,y,img3.w*scale,img3.h*scale);c.globalAlpha=1;}}else if(KeyManager.x<=x+img.w*scale&&KeyManager.y>=y&&KeyManager.y<=y+img.h*scale){this.hoverChoice=choice;c.globalAlpha=0.4;c.drawImage(imgs.miscSheetWhite,img.x,img.y,img.w,img.h,x,y,img.w*scale,img.h*scale);c.globalAlpha=1;}y-=(img.h+1)*scale;}img2=imgCoords.upgSkip;x+=5*scale;y+=(img.h+1)*scale-img2.h*scale;c.drawImage(imgs.miscSheet,img2.x,img2.y,img2.w,img2.h,x,y,img2.w*scale,img2.h*scale);drawText(c,F_("game.msg.hideskip_shortcut",{key:keyNames[commandKeys[COMMAND.PICK_UPGRADE]]}),"#304420",scale*6.5,x+17*scale,y+12*scale,scale*100,"left",1,null,null,scale*62,"#688551");if(KeyManager.x<=x+img2.w*scale&&KeyManager.y>=y&&KeyManager.y<=y+img2.h*scale||KeyManager.keys[commandKeys[COMMAND.PICK_UPGRADE]]){c.globalAlpha=0.3;c.drawImage(imgs.miscSheetWhite,img2.x,img2.y,img2.w,img2.h,x,y,img2.w*scale,img2.h*scale);c.globalAlpha=1;this.skipButtonHover=true;}if(this.currentUpgChoicesEnd+200<now&&this.upgradeChoicesAvailable){img2=imgCoords.upgUnskip;x=5*scale;y=HEIGHT-(imgCoords.newStatsFrame.h+1)*scale-img2.h*scale;c.drawImage(imgs.miscSheet,img2.x,img2.y,img2.w,img2.h,x,y,img2.w*scale,img2.h*scale);drawText(c,F_("game.msg.show_upgrades_shortcut",{key:keyNames[commandKeys[COMMAND.PICK_UPGRADE]]}),"#304420",scale*6.5,x+17*scale,y+12*scale,scale*200,"left",1,null,null,scale*64,"#688551");if(KeyManager.x<=x+img2.w*scale&&KeyManager.y>=y&&KeyManager.y<=y+img2.h*scale||KeyManager.keys[commandKeys[COMMAND.PICK_UPGRADE]]){c.globalAlpha=0.3;c.drawImage(imgs.miscSheetWhite,img2.x,img2.y,img2.w,img2.h,x,y,img2.w*scale,img2.h*scale);c.globalAlpha=1;this.unskipButtonHover=true;}}}}if(window.tickDiff>0&&this.recordGIF){canvasGIF.width=canvasGIF.width;canvasGIF.getContext("2d").drawImage(canvas,0,0,canvas.width,canvas.height,0,0,canvasGIF.width,canvasGIF.height);var img=imgCoords.main_logo;canvasGIF.getContext("2d").drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,2,canvasGIF.height-2-img.h,img.w,img.h);this.gif.addFrame(canvasGIF.getContext("2d"),{delay:50,copy:true});}this.cureButtonHovered=false;if(game.cureTick){if(!game.playingPlayer.isHumanZombie||game.cureTick<game.ticksCounter){game.cureTick=0;}}if(game.cureTick){var img=imgCoords.cureButton;var scaleC=3.2*0.65;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,scaleC*100,3*scaleC,img.w*scaleC,img.h*scaleC);var text=slayOne.widgets.lang.get("game.buttons.cure");text+=' ( '+Math.floor((game.cureTick-game.ticksCounter)/20)+' )';drawText(c,text,"white",scale*8,scaleC*(100+0.5*img.w),24*scaleC,scale*200,"center");if(KeyManager.x>=scaleC*100&&KeyManager.x<=(img.w+100)*scaleC&&KeyManager.y<=img.h*scaleC){this.cureButtonHovered=true;c.globalAlpha=0.5;c.drawImage(imgs.miscSheetWhite,img.x,img.y,img.w,img.h,scaleC*100,3*scaleC,img.w*scaleC,img.h*scaleC);c.globalAlpha=1.0;}}this.replayPlusHover=false;this.replayMinusHover=false;if(game.replayMode&&this.replayLength){scale=SCALE_FACTOR_BASE*0.8;var img=imgCoords.replayBar;var img2=imgCoords.replayPos;var percDone=this.replayTimer/this.replayLength;var str=" "+ticks2TimeStr(this.replayTimer)+" / "+this.replayLengthStr;if(game.fastForward&&this.fastForwardTo>0)str+=" ("+ticks2TimeStr(this.fastForwardTo)+")";else{this.provisionalReplayPos=-1;var provisionalReplayPerc=-1;if(KeyManager.x<=90*scale&&KeyManager.y>=HEIGHT-(img.h+2)*scale){provisionalReplayPerc=Math.min(Math.max((KeyManager.x/scale-5)/78,0),1);this.provisionalReplayPos=Math.floor(provisionalReplayPerc*this.replayLength);str+=" ("+ticks2TimeStr(this.provisionalReplayPos)+")";}}drawText(c,str,"white",scale*6.0,4*scale,HEIGHT-(img.h+6)*scale,scale*200,"left",1,"rgba(0, 0, 0, 0.5)",scale*10);c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,scale*2,HEIGHT-(img.h+2)*scale,img.w*scale,img.h*scale);c.drawImage(imgs.miscSheet,img2.x,img2.y,img2.w,img2.h,scale*(5+percDone*78),HEIGHT-(img2.h+2)*scale,img2.w*scale,img2.h*scale);if(game.fastForward&&this.fastForwardTo>0){c.globalAlpha=0.5;c.drawImage(imgs.miscSheet,img2.x,img2.y,img2.w,img2.h,scale*(5+this.fastForwardTo/this.replayLength*78),HEIGHT-(img2.h+2)*scale,img2.w*scale,img2.h*scale);c.globalAlpha=1;}else if(provisionalReplayPerc>=0){c.globalAlpha=0.5;c.drawImage(imgs.miscSheet,img2.x,img2.y,img2.w,img2.h,scale*(5+provisionalReplayPerc*78),HEIGHT-(img2.h+2)*scale,img2.w*scale,img2.h*scale);c.globalAlpha=1;}img=imgCoords.replayPlusMinus;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,scale*90,HEIGHT-(img.h+2)*scale,img.w*scale,img.h*scale);if(KeyManager.x>=scale*90&&KeyManager.x<=(90+img.w)*scale&&KeyManager.y>=HEIGHT-(img.h+2)*scale&&KeyManager.y<=HEIGHT-(img.h+2-9)*scale){this.replayPlusHover=true;img2=imgCoords.replayWhite;c.globalAlpha=0.2;c.drawImage(imgs.miscSheet,img2.x,img2.y,img2.w,img2.h,scale*90,HEIGHT-(img.h+2)*scale,img2.w*scale,img2.h*scale);c.globalAlpha=1;}if(KeyManager.x>=scale*90&&KeyManager.x<=(90+img.w)*scale&&KeyManager.y>=HEIGHT-(img.h+2-9)*scale){this.replayMinusHover=true;img2=imgCoords.replayWhite;c.globalAlpha=0.2;c.drawImage(imgs.miscSheet,img2.x,img2.y,img2.w,img2.h,scale*90,HEIGHT-(img.h+2-9)*scale,img2.w*scale,img2.h*scale);c.globalAlpha=1;}this.gifButtonIsHovered=false;if(!game.fastForward){if(this.gifProcessing)drawText(c," gif is beeing processed ...","white",scale*6.0,4*scale,HEIGHT-38*scale,scale*200,"left",1,"rgba(0, 0, 0, 0.5)",scale*10);else{img=this.recordGIF?imgCoords.stopGif:imgCoords.startGif;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,scale*2,HEIGHT-(34+img.h)*scale,img.w*scale,img.h*scale);if(KeyManager.x<=(img.w+2)*scale&&KeyManager.y>=HEIGHT-(img.h+34)*scale&&KeyManager.y<=HEIGHT-34*scale){this.gifButtonIsHovered=true;img=imgCoords.whiteGif;c.globalAlpha=0.2;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,scale*2,HEIGHT-(34+img.h)*scale,img.w*scale,img.h*scale);c.globalAlpha=1;}if(this.recordGIF)drawText(c," recording ...","white",scale*6.0,(4+img.w)*scale,HEIGHT-38*scale,scale*200,"left",1,"rgba(0, 0, 0, 0.5)",scale*10);}}}if(isMobile)for(var i=0;i<this.buttons.length;i++){this.buttons[i].draw();}};Interface.prototype.startGIF=function(){var relation=700/WIDTH;canvasGIF.width=WIDTH*relation;canvasGIF.height=HEIGHT*relation;canvasGIF.getContext("2d").mozImageSmoothingEnabled=false;canvasGIF.getContext("2d").msImageSmoothingEnabled=false;canvasGIF.getContext("2d").imageSmoothingEnabled=false;this.gif=new GIF({workers:3,quality:10,width:canvasGIF.width,height:canvasGIF.height,debug:true});this.recordGIF=true;};Interface.prototype.endGIF=function(){this.recordGIF=false;this.gifProcessing=true;this.gif.on('finished',function(blob){var d=new Date();saveAs(blob,"slay-one-gif-"+d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+".gif");game.interface_.gif=null;game.interface_.gifProcessing=false;});this.gif.render();};Interface.prototype.replayJumpTo=function(){if(this.provisionalReplayPos==this.replayTimer)return;if(this.provisionalReplayPos<this.replayTimer)startReplay();game.interface_.fastForwardTo=this.provisionalReplayPos;game.fastForward=true;window.oldReplayOptionsIndex=window.replayOptionsIndex;window.replayOptionsIndex=window.replayOptions.length-1;window.replayOption=window.replayOptions[window.replayOptionsIndex];};"use strict";var Skin=function(){function Skin(){_classCallCheck(this,Skin);}_createClass(Skin,null,[{key:"show",value:function show(){if(!loginData){return;}if(!this.heroSelect){this.heroSelect=parseInt(loginData?loginData.hat:0)|0;}if(!this.heroClick){this.heroClick=this.heroSelect;}this.filterAb=null;this.card=null;this.isRefreshBuyTime=false;if(!this.stair){this.stair=0;}this.currentUpgradeHero=false;if(!this.refreshBuyTime){network.send('buyHero$price');}var o=this.get();this.tplHeroFilter();this.tplHeroList();o.style.display='block';}},{key:"get",value:function get(){var o=document.getElementById('skin');if(!o){o=this._create();}return o;}},{key:"_createUpgrade",value:function _createUpgrade(){var _this5=this;var box=document.createElement('div');box.id='upgradeHero';box.className='F-Window';var h2=document.createElement('div');h2.className='title';h2.innerText='UPGRADE SLAYER';box.appendChild(h2);var inBox=document.createElement('div');inBox.className='content';box.appendChild(inBox);var close=document.createElement('div');close.className='F-Button close';close.onclick=this.closeUpgrade;box.appendChild(close);document.body.appendChild(box);F$(box.id);window.setInterval(function(){if(!_this5.isRefreshBuyTime){return;}_this5.doRefreshBuyTime();},1000);return box;}},{key:"closeUpgrade",value:function closeUpgrade(){var o=document.getElementById('upgradeHero');if(o){o.style.display='none';Skin.isRefreshBuyTime=false;}}},{key:"doRefreshBuyTime",value:function doRefreshBuyTime(){if(!this.refreshBuyTime){return;}var o=document.getElementById('upgradeHero').querySelector('span.time');if(!o){return;}var time=(this.refreshBuyTime-Date.now())/1000|0;if(time<0){time+=86400;this.refreshBuyTime+=86400*1000;this.stair=0;}o.innerText=this._formatTime(time);}},{key:"_formatTime",value:function _formatTime(time){var s='';var _arr=[1,0,0];for(var _i=0;_i<_arr.length;_i++){var end=_arr[_i];var i=time%60;if(i<10){i='0'+i;}s=i+(end?'':':')+s;time=time/60|0;}return s;}},{key:"_create",value:function _create(){var _this6=this;var box=document.createElement('div');box.id='skin';box.className='F-Window';var h2=document.createElement('div');h2.className='title';h2.innerText=F_('hero.list.title');box.appendChild(h2);var inBox=document.createElement('div');inBox.className='content';var filterBox=document.createElement('div');filterBox.className='filter';inBox.appendChild(filterBox);var viewBox=document.createElement('div');viewBox.className='view';inBox.appendChild(viewBox);var heroBox=document.createElement('div');heroBox.className='hero';inBox.appendChild(heroBox);box.appendChild(inBox);var close=document.createElement('div');close.className='F-Button close';close.onclick=function(){_this6.close();};box.appendChild(close);document.body.appendChild(box);F$(box.id);this.heroClick=parseInt(loginData?loginData.hat:0)|0;return box;}},{key:"tplHeroFilter",value:function tplHeroFilter(){var _this7=this;var o=document.getElementById('skin');if(!o){return;}var filter=o.querySelector('div.filter');filter.innerHTML='';var text=document.createElement('div');text.className='text';text.innerText=F_('hero.list.filter');filter.appendChild(text);var abBox=document.createElement('div');abBox.className='ab-list';var _loop=function _loop(ab){if(ab['zombieOnly']){return"continue";}var abDiv=document.createElement('div');abDiv.title=ab.name;abDiv.appendChild(_this7.tplCanvasAb(ab.id,32));var isSelected=_this7.filterAb===ab.id;if(isSelected){abDiv.className='selected';}abDiv.onclick=function(){_this7.filterAb=isSelected?null:ab.id;_this7.tplHeroList();_this7.tplHeroFilter();o.querySelector('div.hero').scrollTop=0;};abBox.appendChild(abDiv);};var _iteratorNormalCompletion21=true;var _didIteratorError21=false;var _iteratorError21=undefined;try{for(var _iterator21=abilities[Symbol.iterator](),_step21;!(_iteratorNormalCompletion21=(_step21=_iterator21.next()).done);_iteratorNormalCompletion21=true){var ab=_step21.value;var _ret=_loop(ab);if(_ret==="continue")continue;}}catch(err){_didIteratorError21=true;_iteratorError21=err;}finally{try{if(!_iteratorNormalCompletion21&&_iterator21.return){_iterator21.return();}}finally{if(_didIteratorError21){throw _iteratorError21;}}}filter.appendChild(abBox);}},{key:"isHaveAb",value:function isHaveAb(hatId){if(!Number.isInteger(this.filterAb)){return false;}var ab=this.getAbList(hatId);return ab[this.filterAb|0].lvl>0;}},{key:"upgradeHero",value:function upgradeHero(heroId){var o=document.getElementById('upgradeHero');if(!o){o=this._createUpgrade();}this.currentUpgradeHero=heroId;this.refreshUpgrade();o.style.display='block';}},{key:"refreshUpgrade",value:function refreshUpgrade(){var _this8=this;var heroId=this.currentUpgradeHero;var o=document.getElementById('upgradeHero');if(!o){return;}var box=o.querySelector('.content');box.innerHTML='';var canvas=document.createElement('canvas');canvas.className='hat';canvas.width=100;canvas.height=100;var ctx=canvas.getContext('2d');ctx.mozImageSmoothingEnabled=false;ctx.msImageSmoothingEnabled=false;ctx.imageSmoothingEnabled=false;drawHat(ctx,hats[heroId],3.5,2,100,100);var heroCard=this.getCard()[heroId];var info=document.createElement('div');info.className='info';var s='';if(heroCard.level){s+='<span class="lvl">Level: '+heroCard.level+'</span>';if(heroCard.level<10){s+='<br><span class="card">Card: '+heroCard.count+'/'+heroCard.level*5+'</span>';}}else{s+='<span class="locked">Locked</span>';}info.innerHTML=s;var leftBox=document.createElement('div');leftBox.className='left-box';leftBox.appendChild(canvas);leftBox.appendChild(info);box.appendChild(leftBox);this._appendText(box,'title',F_('hero.buy.card.title'));this._appendText(box,'desp',F_('hero.buy.card.desp1'));this._appendText(box,'desp',F_('hero.buy.card.desp2'));var cardFull=heroCard.count>=Math.max(heroCard.level,1)*5;var levelFull=heroCard.level>=10;if(levelFull){this.tplHeroView(hats[heroId]);}var price=10+this.stair*5;var span=document.createElement('span');var isEnable;isEnable=!levelFull&&!cardFull&&pl_gold>price;span.className='time';this._appendButton(box,'card','Cost Gold x '+price,isEnable,function(){_this8._actionBuy('card',heroId);},span);this._appendText(box,'title',F_('hero.buy.upgrade.title'));this._appendText(box,'desp',F_('hero.buy.upgrade.desp'));isEnable=!levelFull&&cardFull&&pl_gold>100;this._appendButton(box,'upgrade','Cost Gold x 100',isEnable,function(){_this8._actionBuy('upgrade',heroId);});this._appendText(box,'title',F_('hero.buy.full.title'));this._appendText(box,'desp',F_('hero.buy.full.desp'));isEnable=!levelFull&&pl_gold>10000;var p=this._appendButton(box,'full','Cost Gold x 10000',isEnable,function(){_this8._actionBuy('full',heroId);});var span=document.createElement('span');span.innerHTML='or';p.appendChild(span);isEnable=!levelFull&&pl_gem>0;var btn=this._createButton('gem','Cost Gem x 1',isEnable,function(){_this8._actionBuy('gemFull',heroId);});p.appendChild(btn);this.tplHeroList();this.tplHeroView(hats[heroId]);this.doRefreshBuyTime();this.isRefreshBuyTime=true;}},{key:"_actionBuy",value:function _actionBuy(action,heroId){var o=document.getElementById('upgradeHero');if(!o){return;}var _iteratorNormalCompletion22=true;var _didIteratorError22=false;var _iteratorError22=undefined;try{for(var _iterator22=o.querySelectorAll('button')[Symbol.iterator](),_step22;!(_iteratorNormalCompletion22=(_step22=_iterator22.next()).done);_iteratorNormalCompletion22=true){var btn=_step22.value;btn.className=btn.className.replace(' disabled','')+' disabled';}}catch(err){_didIteratorError22=true;_iteratorError22=err;}finally{try{if(!_iteratorNormalCompletion22&&_iterator22.return){_iterator22.return();}}finally{if(_didIteratorError22){throw _iteratorError22;}}}network.send('buyHero$'+action+'$'+heroId);}},{key:"_appendText",value:function _appendText(box,className,text){var p=document.createElement('p');p.className=className;p.innerText=text;box.appendChild(p);}},{key:"_appendButton",value:function _appendButton(box,className,text,isEnable,onClick,ext){var button=this._createButton(className,text,isEnable,onClick);var p=document.createElement('p');p.className=className;p.appendChild(button);if(ext){p.appendChild(ext);}box.appendChild(p);return p;}},{key:"_createButton",value:function _createButton(className,text,isEnable,onClick){text=text.replace(/Gold/,'<i class="gold"></i>');text=text.replace(/Gem/,'<i class="gem"></i>');var button=document.createElement('button');button.className=className+(isEnable?'':' disabled');button.innerHTML=text;if(isEnable){button.onclick=onClick;}else{button.disabled=true;}return button;}},{key:"tplHeroList",value:function tplHeroList(){var _this9=this;var o=document.getElementById('skin');if(!o){return;}var list=o.querySelector('div.hero');list.innerHTML='';var _arr2=[false,true];for(var _i2=0;_i2<_arr2.length;_i2++){var isCommon=_arr2[_i2];var _arr3=[true,false];for(var _i3=0;_i3<_arr3.length;_i3++){var isFilter=_arr3[_i3];var isFilterWork=false;var _arr4=[true,false];for(var _i4=0;_i4<_arr4.length;_i4++){var isHave=_arr4[_i4];var _loop2=function _loop2(hat){if(hat.id in hero==isCommon){return"continue";}if(_this9.isHaveAb(hat.id)!=isFilter){return"continue";}var heroCard=_this9.getCard()[hat.id];var lv=heroCard.level;if(!lv==isHave){return"continue";}if(!isCommon&&isFilter){isFilterWork=true;}var o=document.createElement('div');var className='one-hero';if(!lv){className+=' nohave';}else if(lv>=10){className+=' max';}o.className=className;if(hat.id===_this9.heroSelect){o.className=o.className.replace(' selected','')+' selected';}o.appendChild(_this9.tplCanvasHero(hat));abDiv=document.createElement('div');abDiv.className='ab';abList=_this9.getAbList(hat.id);if(isFilter&&Number.isInteger(_this9.filterAb)){abDiv.appendChild(_this9.tplCanvasAb(_this9.filterAb));}var _iteratorNormalCompletion24=true;var _didIteratorError24=false;var _iteratorError24=undefined;try{for(var _iterator24=abilities[Symbol.iterator](),_step24;!(_iteratorNormalCompletion24=(_step24=_iterator24.next()).done);_iteratorNormalCompletion24=true){ab=_step24.value;if(ab.id===_this9.filterAb){continue;}if(!abList[ab.id].lvl||ab.type=='passive'){continue;}abDiv.appendChild(_this9.tplCanvasAb(ab.id));}}catch(err){_didIteratorError24=true;_iteratorError24=err;}finally{try{if(!_iteratorNormalCompletion24&&_iterator24.return){_iterator24.return();}}finally{if(_didIteratorError24){throw _iteratorError24;}}}o.appendChild(abDiv);var name=document.createElement('div');name.className='info';name.innerHTML='<span class="id">#'+hat.id+'</span><br>'+'<span class="name">'+hat.name+'</span><br>'+'<span class="lvl">'+(lv?'Level: '+lv:F_('hero.buy.locked'))+'</span>';o.appendChild(name);o.onclick=function(){_this9.clickHeroSelect(_this9,hat,o);};list.appendChild(o);if(_this9.heroClick===hat.id){o.click();}};var _iteratorNormalCompletion23=true;var _didIteratorError23=false;var _iteratorError23=undefined;try{for(var _iterator23=hats[Symbol.iterator](),_step23;!(_iteratorNormalCompletion23=(_step23=_iterator23.next()).done);_iteratorNormalCompletion23=true){var hat=_step23.value;var abDiv;var abList;var ab;var _ret2=_loop2(hat);if(_ret2==="continue")continue;}}catch(err){_didIteratorError23=true;_iteratorError23=err;}finally{try{if(!_iteratorNormalCompletion23&&_iterator23.return){_iterator23.return();}}finally{if(_didIteratorError23){throw _iteratorError23;}}}}if(isFilter&&isFilterWork){list.appendChild(document.createElement('p'));}}if(!isCommon){list.appendChild(document.createElement('p'));}}}},{key:"tplHeroView",value:function tplHeroView(hat){var _this10=this;var o=document.getElementById('skin');if(!o){return;}var view=o.querySelector('div.view');view.innerHTML='';view.appendChild(this.tplCanvasHero(hat));var heroCard=this.getCard()[hat.id];var name=document.createElement('div');name.className='info';var s='<span class="id">#'+hat.id+'</span><br>'+'<span class="name">'+hat.name+'</span>';if(heroCard.level){s+='<br><span class="lvl">Level: '+heroCard.level+'</span>';if(heroCard.level<10){s+='<br><span class="card">Card: '+heroCard.count+'/'+heroCard.level*5+'</span>';}}else{s+='<br><span class="locked">'+F_('hero.buy.locked')+'</span>';}name.innerHTML=s;view.appendChild(name);var bSelect=this.heroSelect===hat.id;if(hat.id in SKIN_AUTHOR){var pAuthor=document.createElement('p');pAuthor.className='skin-author';pAuthor.innerText=F_('skin.author').replace(/\[\[name\]\]/,SKIN_AUTHOR[hat.id]);view.appendChild(pAuthor);}var p=document.createElement('p');p.className='btn';if(['en-US','zh-CN','zh-TW'].indexOf(slayOne.widgets.lang.locale)==-1){p.className='btn btn-small';}p.appendChild(this._tplHeroViewButton(view,'setHat',heroCard.level,bSelect?F_('hero.list.currentBtn'):F_('hero.list.selectBtn'),function(){bSelect?_this10.close():_this10.setHero(hat.id);}));var heroCard=this.getCard()[hat.id];if(heroCard.level<10){p.appendChild(this._tplHeroViewButton(view,'upgrade',true,F_(heroCard.level?'hero.list.upgradeBtn':'hero.list.buyBtn'),function(){_this10.upgradeHero(hat.id);}));}view.appendChild(p);if(!(hat.id in hero)){var warn=document.createElement('p');warn.className='warn';warn.innerText='Warning: The abilities of this slayer have not yet been finalized';view.appendChild(warn);}view.appendChild(this.tplAbList(hat.id));}},{key:"_tplHeroViewButton",value:function _tplHeroViewButton(view,key,isEnable,name,click){var button=document.createElement('button');button.innerText=name;if(isEnable){button.onclick=click;button.className=key;}else{button.disabled=true;button.className=key+' disabled';}return button;}},{key:"setHero",value:function setHero(id){loginData.hat=id;pl_hat=hats[id];this.heroSelect=id;network.send('setHat$'+id);this.tplHeroList();pl_abilities=Skin.getAbList(id);this.refreshAbilitiesButton();}},{key:"getCard",value:function getCard(){if(this.card){return this.card;}var tmp={};if(loginData){var _iteratorNormalCompletion25=true;var _didIteratorError25=false;var _iteratorError25=undefined;try{for(var _iterator25=loginData.new_items.split(';')[Symbol.iterator](),_step25;!(_iteratorNormalCompletion25=(_step25=_iterator25.next()).done);_iteratorNormalCompletion25=true){var s=_step25.value;if(!s.length){continue;}var row=s.split(',').map(function(i){return i|0;});tmp[row[0]]={level:row[1],count:row[2]};}}catch(err){_didIteratorError25=true;_iteratorError25=err;}finally{try{if(!_iteratorNormalCompletion25&&_iterator25.return){_iterator25.return();}}finally{if(_didIteratorError25){throw _iteratorError25;}}}}var list={};var _iteratorNormalCompletion26=true;var _didIteratorError26=false;var _iteratorError26=undefined;try{for(var _iterator26=hats[Symbol.iterator](),_step26;!(_iteratorNormalCompletion26=(_step26=_iterator26.next()).done);_iteratorNormalCompletion26=true){var hat=_step26.value;if(!tmp[hat.id]){list[hat.id]={level:0,count:0};continue;}list[hat.id]=tmp[hat.id];}}catch(err){_didIteratorError26=true;_iteratorError26=err;}finally{try{if(!_iteratorNormalCompletion26&&_iterator26.return){_iterator26.return();}}finally{if(_didIteratorError26){throw _iteratorError26;}}}this.card=list;return list;}},{key:"resetCard",value:function resetCard(s){this.card=null;loginData.new_items=s;}},{key:"tplCanvasHero",value:function tplCanvasHero(hat){var canvas=document.createElement('canvas');canvas.className='hat';canvas.width=100;canvas.height=100;var ctx=canvas.getContext('2d');ctx.mozImageSmoothingEnabled=false;ctx.msImageSmoothingEnabled=false;ctx.imageSmoothingEnabled=false;drawHat(ctx,hat,3.5,2,100,100);return canvas;}},{key:"tplCanvasAb",value:function tplCanvasAb(i,size){size=size|0;if(!size){size=32;}var canvas=document.createElement('canvas');canvas.width=size;canvas.height=size;var ctx=canvas.getContext("2d");ctx.mozImageSmoothingEnabled=false;ctx.msImageSmoothingEnabled=false;ctx.imageSmoothingEnabled=false;var a=abilities[i];var img=imgCoords[a.icon];var fac=size/Math.max(img.w,img.h);var w=img.w*fac;var h=img.h*fac;ctx.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,0,0,w,h);return canvas;}},{key:"getAbList",value:function getAbList(hatId){var ab=hero[hatId];if(!ab){ab=hero[0];}ab=ab.split(';');ab.shift();for(var id=0,len=ab.length;id<len;id++){var row=ab[id];var main=parseInt(row)|0;var sub=[];if(main&&row.indexOf(',')>0){sub=row.split(',').map(function(a){return a|0;});sub.shift();}ab[id]={id:id,lvl:main,attributes:sub};}return ab;}},{key:"tplAbList",value:function tplAbList(heroId){var abList=document.createElement('div');abList.className='ab-list';var _iteratorNormalCompletion27=true;var _didIteratorError27=false;var _iteratorError27=undefined;try{for(var _iterator27=this.getAbList(heroId)[Symbol.iterator](),_step27;!(_iteratorNormalCompletion27=(_step27=_iterator27.next()).done);_iteratorNormalCompletion27=true){var ab=_step27.value;if(!ab.lvl){continue;}var cfg=abilities[ab.id];var p=document.createElement('p');p.className='name';p.innerHTML=cfg.name+'&#160;'+this._lvlTag(ab.lvl,heroId,false)+'<br><span>'+cfg.description+'</span>';p.insertBefore(this.tplCanvasAb(ab.id),p.firstChild);abList.appendChild(p);if(cfg.levelUpFields){var pList=[];for(var j=0;j<cfg.levelUpFieldsName.length;j++){if(!ab.attributes[j]){continue;}var _p=document.createElement('p');var val=cfg.levelUpValues[j];var precision=val.toString().indexOf('.')==-1?0:val.toString().replace(/.*\./,'').length;val=(val*ab.attributes[j]).toFixed(precision);if(cfg.id==10){val=val/20|0;}_p.innerHTML=cfg.levelUpFieldsName[j]+' +'+val+' '+this._lvlTag(ab.attributes[j],heroId,true);pList.push(_p);}if(pList.length){var subDiv=document.createElement('div');subDiv.className='sub';var _iteratorNormalCompletion28=true;var _didIteratorError28=false;var _iteratorError28=undefined;try{for(var _iterator28=pList[Symbol.iterator](),_step28;!(_iteratorNormalCompletion28=(_step28=_iterator28.next()).done);_iteratorNormalCompletion28=true){var _p2=_step28.value;subDiv.appendChild(_p2);}}catch(err){_didIteratorError28=true;_iteratorError28=err;}finally{try{if(!_iteratorNormalCompletion28&&_iterator28.return){_iterator28.return();}}finally{if(_didIteratorError28){throw _iteratorError28;}}}abList.appendChild(subDiv);}}}}catch(err){_didIteratorError27=true;_iteratorError27=err;}finally{try{if(!_iteratorNormalCompletion27&&_iterator27.return){_iterator27.return();}}finally{if(_didIteratorError27){throw _iteratorError27;}}}return abList;}},{key:"_lvlTag",value:function _lvlTag(i,heroId,isSub){var lv=this.getCard()[heroId].level;var base=Math.floor(i*lv/10)|0;if(!base&&!isSub){base=1;}var s='';for(var j=0;j<i;j++){if(j>=base){s+='<i class="no"></i>';}else{s+='<i></i>';}}return s;}},{key:"close",value:function close(){var o=document.getElementById('skin');if(o){o.style.display='none';}Skin.closeUpgrade();}},{key:"refreshAbilitiesButton",value:function refreshAbilitiesButton(button){if(!button){button=document.getElementById('ability_button_main');if(!button){return;}}Skin.abilitiesThumbnail(button,pl_abilities);slayOne.widgets.hoverLight(button,{width:'180px',height:'118px',left:'-6px',top:'-6px'});slayOne.widgets.tooltip(button,{tip:slayOne.widgets.lang.get('home.buttons.abilities.tooltip'),align:"center"});slayOne.widgets.clickable(button);}},{key:"clickHeroSelect",value:function clickHeroSelect(obj,hat,o){soundManager.playSound(SOUND.CLICK);obj.heroClick=hat.id;if(obj.prevSelect){obj.prevSelect.className=obj.prevSelect.className.replace(' click','');}o.className=o.className.replace(' click','')+' click';obj.prevSelect=o;obj.tplHeroView(hat);}},{key:"abilitiesThumbnail",value:function abilitiesThumbnail(box,pl,size){if(!size){size=32;}box.innerHTML='';var _arr5=[false,true];for(var _i5=0;_i5<_arr5.length;_i5++){var isPassive=_arr5[_i5];for(var i=0;i<abilities.length;i++){var playerAbility=pl[i];if(!playerAbility||playerAbility.lvl===0){continue;}var ab=abilities[i];if(ab.type=='passive'!=isPassive){continue;}var c_=document.createElement('canvas');c_.width=size;if(!isPassive){c_.width*=1.5;}c_.height=c_.width;var ctx_=c_.getContext("2d");ctx_.mozImageSmoothingEnabled=false;ctx_.msImageSmoothingEnabled=false;ctx_.imageSmoothingEnabled=false;var img=imgCoords.button;ctx_.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,0,0,c_.width,c_.height);img=imgCoords[ab.icon];var fac=c_.width*0.75/Math.max(img.w,img.h);var w=img.w*fac;var h=img.h*fac;ctx_.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(c_.width-w)/2,(c_.height-h)/2,w,h);box.appendChild(c_);}if(!isPassive){box.appendChild(document.createElement('br'));}}}}]);return Skin;}();document.addEventListener('DOMContentLoaded',function(){window.setTimeout(function(){},1000);},false);"use strict";var pl_custombuild;var CustomBuild=function(){function CustomBuild(){_classCallCheck(this,CustomBuild);}_createClass(CustomBuild,null,[{key:"show",value:function show(){if(!loginData){return;}pl_custombuild=this._copy(loginData.custom_build);for(var i in pl_custombuild){pl_custombuild[i].id=i;}var o=this.get();this.refresh();this.refreshCount();o.style.display='block';}},{key:"get",value:function get(checkOnly){var o=document.getElementById('customBuild');if(!o){if(checkOnly){return;}abilities.map(function(a){a.isPassive=a.type=='passive';return a;});o=this._create();}return o;}},{key:"refresh",value:function refresh(){var _iteratorNormalCompletion29=true;var _didIteratorError29=false;var _iteratorError29=undefined;try{for(var _iterator29=pl_custombuild[Symbol.iterator](),_step29;!(_iteratorNormalCompletion29=(_step29=_iterator29.next()).done);_iteratorNormalCompletion29=true){var ab=_step29.value;if(ab.lvl){this.selectAb(ab.id,true);}}}catch(err){_didIteratorError29=true;_iteratorError29=err;}finally{try{if(!_iteratorNormalCompletion29&&_iterator29.return){_iterator29.return();}}finally{if(_didIteratorError29){throw _iteratorError29;}}}}},{key:"_drawOperate",value:function _drawOperate(box){var _this11=this;var preview=document.createElement('div');preview.className='preview';var previewTitle=document.createElement('p');previewTitle.className='title';previewTitle.innerText='abilities summary';preview.appendChild(previewTitle);var previewAb=document.createElement('div');previewAb.className='ab';preview.appendChild(previewAb);var reset=document.createElement('div');reset.className='F-Button large reset';reset.innerText=F_('game.btn.reset');reset.onclick=this.reset;preview.appendChild(reset);box.appendChild(preview);var o=document.createElement('div');o.className='enter';var save=document.createElement('div');save.className='F-Button large';save.innerText=F_('profile.btn_desc_save.label');save.onclick=this.save;var play=document.createElement('div');play.className='F-Button large';play.innerText=F_('home.buttons.play.label');play.onclick=function(){_this11.save();network.send('joinRandomGame$abc$6');};o.appendChild(save);o.appendChild(play);box.appendChild(o);}},{key:"save",value:function save(){var pre=CustomBuild._copy(pl_custombuild);pre.map(function(a){delete a.id;return a;});var json=JSON.stringify(pre);if(json!=JSON.stringify(loginData.custom_build)){loginData.custom_build=JSON.parse(json);network.send("abUpd$"+json);}}},{key:"_copy",value:function _copy(a){return JSON.parse(JSON.stringify(a));}},{key:"_create",value:function _create(){var _this12=this;var box=document.createElement('div');box.id='customBuild';box.className='F-Window';var h2=document.createElement('div');h2.className='title';h2.innerText='CUSTOM BUILD';box.appendChild(h2);var inBox=document.createElement('div');inBox.className='content';var oCount=document.createElement('div');oCount.className='count';inBox.appendChild(oCount);var oAlert=document.createElement('div');oAlert.className='alert';inBox.appendChild(oAlert);this._drawOperate(inBox);this._drawAbAll(inBox);box.appendChild(inBox);var close=document.createElement('div');close.className='F-Button close';close.onclick=function(){_this12.close();};box.appendChild(close);document.body.appendChild(box);F$(box.id);return box;}},{key:"_drawAb",value:function _drawAb(ab){var _this13=this;if(ab.zombieOnly){return;}var btn=document.createElement('div');btn.className='checkbox';btn.onclick=function(){_this13.selectAb(ab.id);};var name=document.createElement('p');name.className='name';name.innerText=ab.name;var description=document.createElement('p');description.className='description';description.innerText=ab.description;var icon=Skin.tplCanvasAb(ab.id,48);var row=document.createElement('div');row.className='ab-main ab_'+ab.id;row.appendChild(icon);row.appendChild(btn);row.appendChild(name);row.appendChild(description);var sub=this._drawAbSub(ab.id);if(sub){row.appendChild(sub);}return row;}},{key:"_drawAbAll",value:function _drawAbAll(box){var abList=document.createElement('div');abList.className='ab-list';var _arr6=[false,true];for(var _i6=0;_i6<_arr6.length;_i6++){var isPassive=_arr6[_i6];if(isPassive){var row=document.createElement('div');row.className='passive-text';row.innerText='Passive skill';abList.appendChild(row);}var _iteratorNormalCompletion30=true;var _didIteratorError30=false;var _iteratorError30=undefined;try{for(var _iterator30=abilities[Symbol.iterator](),_step30;!(_iteratorNormalCompletion30=(_step30=_iterator30.next()).done);_iteratorNormalCompletion30=true){var ab=_step30.value;if(ab.isPassive!=isPassive){continue;}var row=this._drawAb(ab);if(row){abList.appendChild(row);}}}catch(err){_didIteratorError30=true;_iteratorError30=err;}finally{try{if(!_iteratorNormalCompletion30&&_iterator30.return){_iterator30.return();}}finally{if(_didIteratorError30){throw _iteratorError30;}}}}box.appendChild(abList);}},{key:"_drawAbSub",value:function _drawAbSub(id){var ab=abilities[id];if(!ab.isPassive&&!ab.levelUpFields){return;}var row=document.createElement('div');row.className='sub-tree';if(ab.isPassive){var p=document.createElement('p');p.className='have-'+pl_custombuild[id].lvl;this._appendModBtn(p,id);this._appendMod(p,10);row.appendChild(p);}else{for(var i=0,j=ab.levelUpFields.length;i<j;i++){var p=document.createElement('p');var lvl=0;if(pl_custombuild[id].attributes.length>0){lvl=pl_custombuild[id].attributes[i];}p.className='have-'+lvl;p.innerText=ab.levelUpFieldsName[i];this._appendModBtn(p,id,i);this._appendMod(p,ab.levelUpMaxLvl[i]);row.appendChild(p);}}return row;}},{key:"_setSubTreeClass",value:function _setSubTreeClass(id,sub,o){var ab=abilities[id];if(!o){var box=this.get();if(!box){return;}if(ab.isPassive){sub=0;}o=box.querySelector('.ab_'+id+' .sub-tree p:nth-of-type('+(sub+1)+')');}var lvl=0;var max=10;var pl=pl_custombuild[id];if(ab.isPassive){lvl=pl.lvl;}else{lvl=pl.attributes.length?pl.attributes[sub]:0;max=ab.levelUpMaxLvl[sub];}var className='have-'+lvl;if(lvl==0){className+=' min';}else if(lvl==max){className+=' max';}o.className=className;}},{key:"_appendMod",value:function _appendMod(box,j){var div=document.createElement('div');for(var i=0;i<j;i++){var o=document.createElement('i');div.appendChild(o);}box.appendChild(div);return box;}},{key:"_appendModBtn",value:function _appendModBtn(box,ab,sub){var _this14=this;var subBtn=document.createElement('div');subBtn.className='sub';subBtn.onclick=function(){_this14.click(ab,sub,false);};box.appendChild(subBtn);var addBtn=document.createElement('div');addBtn.className='add';addBtn.onclick=function(){_this14.click(ab,sub,true);};box.appendChild(addBtn);return box;}},{key:"click",value:function click(id,sub,isAdd){soundManager.playSound(SOUND.CLICK);if(isAdd&&this.isMaxAb()){this.alert();return;}var o=this.get();var add=isAdd?1:-1;var isChange=false;var ab=abilities[id];var pl=pl_custombuild[id];if(ab.isPassive){if(isAdd&&pl.lvl<10||!isAdd&&pl.lvl>0){pl.lvl+=add;o.querySelector('.ab_'+id+' .sub-tree p').className='have-'+pl.lvl;if(pl.lvl<1){pl.lvl=1;this.selectAb(id);}}}else if(ab.levelUpFieldsName.length){var att=pl.attributes;if(!att.length){att=ab.levelUpFields.map(function(){return 0;});pl.attributes=att;}var lvl=att[sub];if(isAdd&&lvl<ab.levelUpMaxLvl[sub]||!isAdd&&lvl>0){lvl+=add;}att[sub]=lvl;o.querySelector('.ab_'+id+' .sub-tree p:nth-of-type('+(sub+1)+')').className='have-'+lvl;}this.refreshCount();}},{key:"calcAb",value:function calcAb(){var i=0;pl_custombuild.map(function(a){i+=a.lvl;if(a.attributes&&a.attributes.length){i+=a.attributes.reduce(function(m,n){return m+n;});}});return i;}},{key:"calcActiveAb",value:function calcActiveAb(){var i=0;pl_custombuild.map(function(a){var ab=abilities[a.id];if(ab.isPassive){return;}if(a.lvl){i++;}});return i;}},{key:"refreshCount",value:function refreshCount(){var main=document.getElementById('customBuild');var o;o=main.querySelector('.count');if(!o){return;}o.innerText='Abilities points: '+this.calcAb()+' / 12';o=main.querySelector('.preview .ab');Skin.abilitiesThumbnail(o,pl_custombuild,42);}},{key:"isMaxAb",value:function isMaxAb(){return this.calcAb()>=12;}},{key:"reset",value:function reset(){pl_custombuild.map(function(a){a.lvl=0;a.attributes=[];return a;});var o=CustomBuild.get(true);if(!o){return;}var list=o.querySelectorAll('.ab-main');var _iteratorNormalCompletion31=true;var _didIteratorError31=false;var _iteratorError31=undefined;try{for(var _iterator31=list[Symbol.iterator](),_step31;!(_iteratorNormalCompletion31=(_step31=_iterator31.next()).done);_iteratorNormalCompletion31=true){var btn=_step31.value;btn.className=btn.className.replace(/ select/,'');}}catch(err){_didIteratorError31=true;_iteratorError31=err;}finally{try{if(!_iteratorNormalCompletion31&&_iterator31.return){_iterator31.return();}}finally{if(_didIteratorError31){throw _iteratorError31;}}}CustomBuild.refreshCount();}},{key:"selectAb",value:function selectAb(i,showOnly){var o=this.get(true);if(!o){return;}if(!showOnly){soundManager.playSound(SOUND.CLICK);}var pl=pl_custombuild[i];var isSelect=pl.lvl>0;var ab=abilities[i];if(!showOnly){isSelect=!isSelect;if(isSelect){if(this.isMaxAb()){this.alert();return;}if(!ab.isPassive&&this.calcActiveAb()>=2){this.alert('2active');return;}}pl.attributes=[];pl.lvl=isSelect?1:0;}var div=o.querySelector('div.ab_'+i);var className=div.className;if(isSelect){className+=' select';}else{className=className.replace(/ select/,'');}div.className=className;if(isSelect&&!showOnly){className='have-0';if(isSelect&&ab.isPassive){className='have-1';}var list=div.querySelectorAll('.sub-tree p');var _iteratorNormalCompletion32=true;var _didIteratorError32=false;var _iteratorError32=undefined;try{for(var _iterator32=list[Symbol.iterator](),_step32;!(_iteratorNormalCompletion32=(_step32=_iterator32.next()).done);_iteratorNormalCompletion32=true){var p=_step32.value;p.className=className;}}catch(err){_didIteratorError32=true;_iteratorError32=err;}finally{try{if(!_iteratorNormalCompletion32&&_iterator32.return){_iterator32.return();}}finally{if(_didIteratorError32){throw _iteratorError32;}}}}this.refreshCount();}},{key:"alert",value:function alert(t){var _this15=this;var o=document.body.querySelector('#customBuild .alert');if(!o){return;}if(!this.maxAlertVer){this.maxAlertVer=0;}this.maxAlertVer++;var ver=this.maxAlertVer;o.className='alert alertActive';if(t=='2active'){o.innerText=F_('abilities.warn.exceed');}else{o.innerText='You can spend a maximum of 12 skill points';}window.setTimeout(function(){if(ver!=_this15.maxAlertVer){return;}o.className='alert';window.setTimeout(function(){if(ver!=_this15.maxAlertVer){return;}o.innerText='';},3000);},500);}},{key:"close",value:function close(){var o=this.get(true);if(o){o.style.display='none';}}}]);return CustomBuild;}();"use strict";var NameColor=function(){function NameColor(){_classCallCheck(this,NameColor);}_createClass(NameColor,null,[{key:"show",value:function show(){var o=this.get();this.refresh();o.style.display='block';}},{key:"get",value:function get(){var o=document.getElementById('nameColor');if(!o){o=this._create();}return o;}},{key:"getColor",value:function getColor(){var color=NAME_COLOR[loginData.name_color_select];if(!color){if(loginData.name_color[0]){return NAME_COLOR[loginData.name_color[0]].code;}return'#fff';}return color.code;}},{key:"refreshPanel",value:function refreshPanel(){var color=this.getColor();var profile=document.body.querySelector('.playerProfileView > .playerMeta .playerNick');if(profile){profile.style.color=color;}var welcome=document.body.querySelector('.homeWelcomeMsgWrapper > .msgBody');if(welcome){var span=welcome.querySelectorAll('span');var _iteratorNormalCompletion33=true;var _didIteratorError33=false;var _iteratorError33=undefined;try{for(var _iterator33=span[Symbol.iterator](),_step33;!(_iteratorNormalCompletion33=(_step33=_iterator33.next()).done);_iteratorNormalCompletion33=true){var a=_step33.value;a.style.color=color;}}catch(err){_didIteratorError33=true;_iteratorError33=err;}finally{try{if(!_iteratorNormalCompletion33&&_iterator33.return){_iterator33.return();}}finally{if(_didIteratorError33){throw _iteratorError33;}}}}}},{key:"refresh",value:function refresh(){var _this16=this;this.get();var content=document.getElementById('nameColorContent');content.innerHTML='';var _loop3=function _loop3(_id2){_id2=_id2|0;if(_id2<200){return"continue";}a=NAME_COLOR[_id2];row=document.createElement('div');row.innerText=a.name;row.style.color=a.code;select=loginData.name_color_select;if(!select){select=loginData.name_color[0];}if(_id2==select){row.className='selected';row.onclick=function(){_this16.hide();};}else if(loginData.name_color.includes(_id2)){row.className='can-select';row.onclick=function(){loginData.name_color_select=_id2;network.send('chooseNameColor$'+_id2);_this16.refreshPanel();_this16.hide();};}else{row.className='invalid';}content.appendChild(row);_id=_id2;};for(var _id in NAME_COLOR){var a;var row;var select;var _ret3=_loop3(_id);if(_ret3==="continue")continue;}}},{key:"_create",value:function _create(){var _this17=this;var box=document.createElement('div');box.id='nameColor';box.className='F-Window light';var close=document.createElement('div');close.className='F-Button close';close.onclick=function(){_this17.hide();};box.appendChild(close);var content=document.createElement('div');content.className='content';content.id='nameColorContent';box.appendChild(content);document.body.appendChild(box);F$(box.id);console.log(box);return box;}},{key:"hide",value:function hide(){var o=document.getElementById('nameColor');if(o){o.style.display='none';}}}]);return NameColor;}();"use strict";var loginData;var NetworkRespondMsgJson={plInfo:function plInfo(data){uiManager.showPlayerInfoWithData(data);},steamTrans:function steamTrans(data){if(data){SteamTransData=data;}F$('steamBindStart').show();},lvlUp:function lvlUp(data){console.log('lvlUp',data);uiManager.lvlUp(data);},'logged-in':function loggedIn(data,self){steamInitWaitHide();if(data.name.indexOf('郑大猫')!==-1){debugMode=1;}console.log('debug mode',!!debugMode);var ts_diff=data.ts_now-data.ts_create;data.new_player=ts_diff<86400000;console.log(data);if(data.name_color){loginData=data;}if('gem'in data){pl_gem=data.gem|0;}if(isSteam&&data.steam){localStorage.setItem('steam_prev_pid',data.steam.prev_pid|0);}if(self.redirectMsg){network.send("join-game$"+self.redirectMsg.roomId+'$'+self.redirectMsg.name);self.redirectMsg=null;}else{uiManager.loginSuccess(data);tutor(2);}self.triggerMessage(NetworkMessages.LoginSuccess,data);},initPreload:function initPreload(data){tmpPreload=data;},buyHero:function buyHero(data){if(data.err){console.log('buyHero err '+data.msg);return;}if('countdown'in data){Skin.refreshBuyTime=Date.now()+data.countdown*1000;}if('stair'in data){Skin.stair=data.stair;}if(data.hero){var s='';for(var _i7 in data.hero){var row=data.hero[_i7];s+=[_i7,row.level,row.count].join(',')+';';}loginData.new_items=s;Skin.card=false;}if('gold'in data){pl_gold=data.gold|0;F$('resourceBar').refresh();}if('gem'in data){pl_gem=data.gem|0;F$('resourceBar').refresh();}if(Skin.isRefreshBuyTime){Skin.refreshUpgrade();}}};var NetworkRespondMsg={upg:function upg(splitMsg){game.interface_.presentUpgChoice(splitMsg);},'map-vote':function mapVote(splitMsg){if(splitMsg.length>=3){game.voteNextMap(splitMsg[1],splitMsg[2]);}else{F$('rankInGame_mapList').voted=true;}},pong:function pong(splitMsg){game.calcPong(splitMsg[1]);},guest:function guest(splitMsg,self,msg){if(self.ignoreGuestMsg){self.ignoreGuestMsg=false;return;}if(self.redirectMsg){network.send("join-game$"+self.redirectMsg.roomId+'$'+self.redirectMsg.name);self.redirectMsg=null;return;}if(isSteam){Steam.login();return;}if(FacebookUtils.embeddedInCanvas){return;}F$('bottomBar').show();F$('bottomBar').hideForFb();if(!network.autojoin(msg)){var showHint=!localStorage.getItem('showedTutorialHint');if(showHint){gaEventOnce('show-welcome');F$('welcome').open();}else{uiManager.showMainScene();}}},logState:function logState(splitMsg,self){slayOne.viewHelpers.showFloatTip({tipType:'error',content:F_(splitMsg[1])||splitMsg[1]});self.triggerMessage(NetworkMessages.LoginFail,splitMsg);},cure:function cure(splitMsg){game.cureTick=splitMsg[1];},init:function init(splitMsg,self,msg){var mapId=splitMsg[2];var mapVersion=splitMsg[3];if(isTutorialMap(mapId)){gaEventOnce('tutorial-start-to-initialize');}else{gaEventOnce('game-start-to-initialize');}gameCommandBuffer.waitMap(mapId,mapVersion);mapService.loadMap(mapId,mapVersion,function(map){if(isTutorialMap(mapId)){gaEventOnce('tutorial-map-loaded');}else{gaEventOnce('game-map-loaded');}BIUtils.endEvent('flow','home.buttons.play','init');enterGame(map);window.replayFile=[];window.isPlayingGame=true;game=new Game(map);if(isTutorialMap(mapId)){gaEventOnce('tutorial-scene-created');}else{gaEventOnce('game-scene-created');}game.init(splitMsg,msg);uiManager.refreshMenuButtons();slayOne.viewHelpers.hideFullScreenLoading();if(isTutorialMap(mapId)){gaEventOnce('tutorial-scene-initialized');}else{gaEventOnce('game-scene-initialized');}window.replayFile.push('initPreload$'+JSON.stringify(tmpPreload));window.replayFile.push(msg);BIUtils.endEvent('flow','home.buttons.play','game');if(window.joinGamePurpose=='play'){network.send('joinTeam$1');}gameCommandBuffer.flush();});},maplist:function maplist(splitMsg){showLoadMapWindow2(splitMsg);},maplist4Cr:function maplist4Cr(splitMsg,self){self.triggerMessage(NetworkMessages.MapListResponse,splitMsg);},unlock:function unlock(splitMsg){uiManager.unlock(splitMsg);},unlockA:function unlockA(splitMsg){uiManager.unlockAbility(splitMsg);},stats:function stats(splitMsg){var result={xpGained:parseInt(splitMsg[1]),eloGained:parseInt(splitMsg[2]),goldGained:parseInt(splitMsg[3]),kills:parseInt(splitMsg[4]),deaths:parseInt(splitMsg[5]),xp:parseInt(splitMsg[6]),elo:parseInt(splitMsg[7]),gold:parseInt(splitMsg[8]),souls:parseInt(splitMsg[9]),show:parseInt(splitMsg[10]),exit:typeof splitMsg[11]=='undefined'?true:parseInt(splitMsg[11]),chestId:parseInt(splitMsg[12])};if(result.exit&&game){game.isBattle=false;}if(result.xp){uiManager.setXP(result.xp);}if(result.goldGained){pl_gold=result.gold;F$('resourceBar').refresh();}if(result.exit){preExitGame();}if(result.show){uiManager.showResults(result);}else{if(result.exit){exitGame();F$('result').hide();}else if(game.isTutorial()){F$alert(F_('tutorial.alert.exit.content'),attemptExitGame,F_('tutorial.alert.exit.title'));}}},steamBind:function steamBind(splitMsg){var o=document.getElementById('steamBindEndFeedback');if(!o){return;}var result=splitMsg[1];console.log('steamBind',result=='success',result==='success',result);if(result==='success'){o.style.color='#fff';o.innerText=F_('steam.binding.result.success');return;}var box=document.getElementById('steamBindEnd');if(box){var btn=box.querySelector('.content > .F-Button');if(btn){isSteamBindSend=false;btn.className=btn.className.replace(/ disabled/,'');}}if(result==='steam-id-error'||result==='code-timeout'||result==='steam-not-found'){o.innerText=F_('steam.binding.result.void');return;}if(result==='steam-been-bound'){o.innerText=F_('steam.binding.result.bound');return;}o.innerText=F_('steam.binding.result.server');},updateClan:function updateClan(splitMsg,self){pl_clan_tag=splitMsg[1];pl_clan_role=parseInt(splitMsg[2]);uiManager.refreshClanDiv();uiManager.refreshWelcomeDiv();self.triggerMessage(NetworkMessages.UpdateClan,splitMsg);},dailyQuests:function dailyQuests(splitMsg){pl_daily_quests=JSON.parse(splitMsg[2]);pl_daily_quests.refreshCountdown=parseInt(splitMsg[3]);pl_daily_quests.refreshCountdownStart=Date.now();if(pl_daily_quests_refesh_timeout_id){clearTimeout(pl_daily_quests_refesh_timeout_id);}pl_daily_quests_refesh_timeout_id=setTimeout(function(){network.send('getDailyQuests');pl_daily_quests_refesh_timeout_id=null;},parseInt(splitMsg[3])*1000+5000);var lastShowDailyQuestTime=localStorage.getItem('lastShowDailyQuestTime-'+db_id)||1;var date1=new Date(parseInt(lastShowDailyQuestTime));date1.setHours(0,0,0,0);var date2=new Date();date2.setHours(0,0,0,0);if(date1.getTime()!=date2.getTime()){localStorage.setItem('lastShowDailyQuestTime-'+db_id,Date.now());if(!loginData.new_player){F$("dailyQuest").open();}}F$("dailyQuest").tryCompleteQuests();F$("dailyQuest").refresh();F$("resourceBar_dailyQuestSidebar").refresh();},awardChest:function awardChest(splitMsg){pl_chests=parseChests(splitMsg[1]);F$('resourceBar').refresh();},addMultiChests:function addMultiChests(splitMsg){pl_chests=parseChests(splitMsg[1]);F$('resourceBar').refresh();},openTreasureChestDone:function openTreasureChestDone(splitMsg){pl_chests=parseChests(splitMsg[1]);var gold=parseInt(splitMsg[2]);var skinId=splitMsg[3];var chestId=splitMsg[4];pl_gold+=parseInt(gold);obtainHat(skinId);F$('resourceBar').refresh();slayOne.viewHelpers.hideFullScreenLoading();F$("openChest").show(chestId,gold,skinId);soundManager.playSound(SOUND.OPEN_CHEST);},upgradeNewItemFailed:function upgradeNewItemFailed(){slayOne.viewHelpers.hideFullScreenLoading();},upgradeNewItemDone:function upgradeNewItemDone(splitMsg){var id=splitMsg[1];pl_gold=splitMsg[2];pl_items[id]={id:id,count:parseInt(splitMsg[3]),level:parseInt(splitMsg[4])};F$('resourceBar').refresh();slayOne.viewHelpers.hideFullScreenLoading();F$('items').refresh();soundManager.playSound(SOUND.UPGRADE_ITEM);},'register-success':function registerSuccess(splitMsg,self){self.triggerMessage(NetworkMessages.RegisterSuccess,splitMsg);},'map-upload-init':function mapUploadInit(){game.editor.uploadMap2();},path:function path(splitMsg){var path=[];for(var i=2;i<splitMsg.length;i+=2){path.push({x:splitMsg[i],y:splitMsg[i+1]});}game.getPlayerFromID(splitMsg[1]).path=path;},kick:function kick(){F$alert(F_('game.kicked'));},ping:function ping(splitMsg,self){self.lastPing=Date.now()-self.lastTimePingSent;self.lastTimePingSent=0;},'server-info':function serverInfo(splitMsg,self,msg){slayOne.viewHelpers.showFloatTip({tipType:'error',content:msg.substr(12)});self.triggerMessage(NetworkMessages.ServerInfo,splitMsg);},csv:function csv(splitMsg,self,msg){var xx=splitMsg[0]+'$'+splitMsg[1]+'$';var blob=new Blob([msg.substr(xx.length)],{type:"text/plain;charset=utf-8"});saveAs(blob,splitMsg[1]);soundManager.playSound(SOUND.CLICK);},orderTimeout:function orderTimeout(splitMsg,self){slayOne.viewHelpers.showFloatTip({tipType:'error',content:F_("payment.timeout")});self.triggerMessage(NetworkMessages.OrderTimeout,splitMsg);},leftRoom:function leftRoom(){window.isPlayingGame=false;},debugInfo:function debugInfo(splitMsg,self,msg){},refresh:function refresh(splitMsg,self){if(splitMsg[1]=='gold'){pl_gold=parseInt(splitMsg[2]);F$('resourceBar').refresh();}self.triggerMessage(NetworkMessages.Refresh,splitMsg);},allGames:function allGames(splitMsg){console.log(splitMsg[1]);},ClanAppsOfPlayer:function ClanAppsOfPlayer(splitMsg,self){self.triggerMessage(NetworkMessages.ClanAppsOfPlayer,splitMsg);},banned:function banned(splitMsg){var t1=parseInt(splitMsg[1]);var t2=new Date(t1+60*1000).toLocaleString();var bannedMsg=slayOne.widgets.lang.get('game.msg.bannedUntil').replace('[[time]]',t2);slayOne.viewHelpers.showFullScreenLoading();slayOne.viewHelpers.showFloatTip({tipType:'error',content:bannedMsg,duration:-1});},'session-expired':function sessionExpired(splitMsg){slayOne.viewHelpers.showFullScreenLoading();slayOne.viewHelpers.showFloatTip({tipType:'error',content:splitMsg[1],duration:-1});},memberList:function memberList(splitMsg){uiManager.memberList(splitMsg);},applicationList:function applicationList(splitMsg){uiManager.memberList(splitMsg);},'agb-accept-ok':function agbAcceptOk(){document.getElementById("optionsWindow").style.display="none";F$('resourceBar').show();uiManager.showMainScene();},'register-state':function registerState(splitMsg,self){slayOne.viewHelpers.showFloatTip({tipType:'error',content:F_(splitMsg[1])||splitMsg[1]});self.triggerMessage(NetworkMessages.RegisterResponse,splitMsg);uiManager.registerState(splitMsg[1]);},gL:function gL(splitMsg,self){self.triggerMessage(NetworkMessages.GameListResponse,splitMsg);},playerList:function playerList(splitMsg){uiManager.showPlayerList(splitMsg);},clanList:function clanList(splitMsg,self){self.triggerMessage(NetworkMessages.ClanList,splitMsg);},clInfo:function clInfo(splitMsg,self){self.triggerMessage(NetworkMessages.ClanInfo,splitMsg);},myClInfo:function myClInfo(splitMsg,self){self.triggerMessage(NetworkMessages.MyClanInfo,splitMsg);},clanApplyInfo:function clanApplyInfo(splitMsg,self){self.triggerMessage(NetworkMessages.ClanApply,splitMsg);},completeDailyQuestDone:function completeDailyQuestDone(){}};var NetworkGameMsg={upd:function upd(splitMsg){if(0&&window.debugMode){var t=Date.now();game.receiveUpdate(splitMsg);t=Date.now()-t;if(t>3){console.log('game.receiveUpdate',t);}}else{game.receiveUpdate(splitMsg);}},nP:function nP(splitMsg){if(game.map==map1){preStore.newPlayers.push({value:splitMsg,time:Date.now()});return;}game.newPlayer(splitMsg);if(game.playingPlayerID&&game.playingPlayerID>0&&splitMsg[1]==game.playingPlayerID){if(game.mapId){if(isTutorialMap(game.mapId)){gaEventOnce('tutorial-play-now');watchGameplayTime([15,30,55,115,175,295],game.ctime,'tutorial');}else{gaEventOnce('game-play-now');watchGameplayTime([15,30,55,115,175,295,595,895],game.ctime,'game');}}}},nZ:function nZ(splitMsg){if(game.map==map1){preStore.newZombies.push({value:splitMsg,time:Date.now()});}else{game.newZombie(splitMsg);}},pid:function pid(splitMsg){if(game.map==map1){preStore.pid={value:splitMsg[1],time:Date.now()};}else{game.setPlayingPlayerID(splitMsg[1]);}},pL:function pL(splitMsg){game.playerLeaves(splitMsg);},proD:function proD(splitMsg){game.projectileDies(splitMsg);},hp:function hp(splitMsg){game.hpUpdate(splitMsg);},hpO:function hpO(splitMsg){game.hpUpdateObject(splitMsg);},pro:function pro(splitMsg){game.newProjectile(splitMsg);},beam1:function beam1(splitMsg){game.newBeam1(splitMsg);},beam2:function beam2(splitMsg){game.newBeam2(splitMsg);},proM:function proM(splitMsg){game.newProjectileMulti(splitMsg);},grn:function grn(splitMsg){game.newGrenade(splitMsg);},rl2:function rl2(splitMsg){game.reload2(splitMsg);},rsp:function rsp(splitMsg){game.playerRespawns(splitMsg);},emote:function emote(splitMsg){game.emote(splitMsg);},'next-maps':function nextMaps(splitMsg){var mapVotes={};var total=0;var loaded=0;for(var i=1;i<splitMsg.length;i+=3){var id=splitMsg[i];var version=splitMsg[i+1];mapVotes[id]={id:id,version:version,votes:parseInt(splitMsg[i+2])};total++;mapService.loadMap(id,version,function(id,data){mapVotes[id].name=data.name;mapVotes[id].type=data.type;mapVotes[id].w=data.x;mapVotes[id].h=data.y;if(++loaded==total){game.setNextMaps(mapVotes);}}.bind(null,id));}},nO:function nO(splitMsg){game.newObject(splitMsg);if(splitMsg[4]==1){if(game.playingPlayerID&&game.playingPlayerID>0&&splitMsg[5]==game.playingPlayerID){gaEventOnce('laser-turret-placed');}}}};var pomelo=window.pomelo;var jscd=null;var NetworkMessages={GameListResponse:'GameListResponse',GameEntered:'GameEntered',GameExit:'GameExit',MapListResponse:'MapListResponse',LoginSuccess:'LoginSuccess',LoginFail:'LoginFail',RegisterSuccess:'RegisterSuccess',RegisterResponse:'RegisterResponse',ClanList:'ClanList',ClanInfo:'ClanInfo',UpdateClan:'UpdateClan',ServerInfo:'ServerInfo',ClanApply:'ClanApply',ClanAppsOfPlayer:'ClanAppsOfPlayer',MyClanInfo:"MyClanInfo",Refresh:"Refresh",OrderTimeout:"OrderTimeout"};if(!window.debugMode){window.debugMode=getSearchQuery()['debug']||0;}var getUdid=function getUdid(){if(SteamInfo.user){if(localStorage.getItem('udid_steam')!==SteamInfo.user.steamId){return;}}return localStorage.getItem('udid');};var NetworkMessageParser={GameListResponse:function GameListResponse(raw){var result=[];var termsCount=raw.length;if(termsCount<=2){return result;}for(var i=1;i<termsCount;i+=13){result.push({roomId:raw[i+2],mapName:raw[i],numPlayers:raw[i+1],mode:raw[i+3],numPlayersMax:raw[i+4],creator:'SlayOne',mapW:raw[i+5]||0,mapH:raw[i+6]||0,mapThumbnail:getMapThumbnail(raw[i+7],raw[i+8]),mapDesc:raw[i+9]||"",source:raw[i+10],createTime:raw[i+11],tag:raw[i+12]});}return result;},GameEntered:function GameEntered(raw){return raw;},MapListResponse:function MapListResponse(raw){var result=[];var termsCount=raw.length;for(var i=1;i<termsCount;i+=7){result.push({mapId:raw[i],mapName:raw[i+1],mapW:raw[i+2],mapH:raw[i+3],thumbnail:getMapThumbnail(raw[i],raw[i+5]),mode:'',maxPlayers:raw[i+4],version:raw[i+5],mapDesc:raw[i+6]});}return result;},LoginFail:function LoginFail(raw){return raw[1];},LoginSuccess:function LoginSuccess(data){return{displayName:data.name,authLevel:data.lvl|0,exp:data.xp|0,gold:data.gold|0,dbId:data.db_id,items:data.new_items,hatIndex:data.hat|0,abilitiesUnlocked:data.abilities_unlocked,abilities:data.abilities,shownAGB:data.agb_accepted,clanTag:data.clan_tag,sessionId:data.session_id,autojoin:data.autologin,tutorials:data.tutorials};},RegisterResponse:function RegisterResponse(raw){return raw[1];},RegisterSuccess:function RegisterSuccess(raw){return raw[1];},ClanList:function ClanList(raw){var data=[];for(var i=3,length=raw.length;i<length;i+=4){data.push({tag:raw[i],name:raw[i+1],countMembers:parseInt(raw[i+2]),elo:parseInt(raw[i+3])});}data.total=parseInt(raw[1]);data.page=parseInt(raw[2]);return data;},ClanInfo:function ClanInfo(raw){return raw[1]?{tag:raw[1],name:raw[2],countMembers:raw[3],crystals:raw[4],id:raw[5],description:raw[6],elo:parseInt(raw[7])}:null;},MyClanInfo:function MyClanInfo(data){var clan=null;if(data[1]){clan={tag:data[1],name:data[2],countMembers:data[3],crystals:data[4],clan_role:data[5],description:data[6],elo:parseInt(data[7]),id:data[8],appsCount:parseInt(data[9])};};return clan;}};function Network(){var self=this;this.lastPing=50;this.lastTimePingSent=0;this.connectedServerIndex="";this.redirectMsg=null;this.blockInputMessages=true;this.blockCustomBI=true;this.eventHooks={};var search=getSearchQuery();var forcedServerName=search["server"];var cachedServerName=window.localStorage.getItem("chooseServerOnStart");if(cachedServerName&&cachedServerName.length>0){window.localStorage.setItem("chooseServerOnStart","");forcedServerName=cachedServerName;}this.addMessageListener(NetworkMessages.GameEntered,function(){self.blockInputMessages=false;});this.addMessageListener(NetworkMessages.GameExit,function(){self.blockInputMessages=true;});new ServerChooser().choose(SERVER_INFOS,forcedServerName,function(s){self.onServerChosen(s);});};Network.prototype.checkAll=function(){new ServerChooser().checkAll();};Network.prototype.addMessageListener=function(eventName,callback){if(!(eventName in this.eventHooks)){this.eventHooks[eventName]=[];}this.eventHooks[eventName].push(callback);};Network.prototype.once=function(eventName,callback){var that=this;var newCallback=function newCallback(data){that.removeMessageListener(eventName,newCallback);callback(data);};this.addMessageListener(eventName,newCallback);};Network.prototype.removeMessageListener=function(eventName,callback){if(!(eventName in this.eventHooks)){return;}var callbackArr=this.eventHooks[eventName];var idx=callbackArr.indexOf(callback);if(idx>=0){callbackArr.splice(idx,1);}};Network.prototype.triggerMessage=function(eventName,raw){if(!(eventName in this.eventHooks)){return;}var immutable=raw;if(NetworkMessageParser[eventName]){immutable=NetworkMessageParser[eventName](raw);}var callbacks=this.eventHooks[eventName].concat();callbacks.forEach(function(cb){cb(immutable);});return immutable;};Network.prototype.onServerChosen=function(s){var self=this;this.socket=s;authLevel=AUTH_LEVEL.GUEST;var delayedMessages=[];var delayedTimeout=0;function processDelayedMessages(fished){if(!delayedMessages.length){return;}if(fished&&window.debugMode==4){console.warn("fish delayed messages: "+delayedMessages.length);}while(delayedMessages.length){respondPackedMsg(delayedMessages.shift());}clearTimeout(delayedTimeout);delayedTimeout=0;}function onmessage(data){processDelayedMessages(true);if(!data.z){var msg=data.data;var splitMsg=msg.split("$");respondMsg(msg,splitMsg);return;}var rawMsg=data.z;if(typeof rawMsg[0]!=="number"){respondPackedMsg(rawMsg);return;}if(window.debugMode==4){console.log("packed:"+rawMsg.length/2);}for(var i=0;i<rawMsg.length;i+=2){if(rawMsg[i]==2){var delayedMsg=rawMsg[i+1];if(!delayedMessages.length){delayedTimeout=setTimeout(processDelayedMessages,48);}delayedMessages.push(delayedMsg);}else{respondPackedMsg(rawMsg[i+1]);}}};function respondPackedMsg(rawMsg){for(var i=0;i<rawMsg.length;i++){if(typeof rawMsg[i]==='boolean'){rawMsg[i]=rawMsg[i]?'true':'false';}}var msg=rawMsg.join("$");respondMsg(msg,rawMsg);}function respondMsg(msg,splitMsg){var cmd=splitMsg[0];if(window.debugMode==3){if(cmd!='upd'){console.log(Date.now()+' - jbs recv:',msg);}}if(cmd=='reload-game'){window.slayOne.views.homeScreen.hideWindow(true);slayOne.viewHelpers.hideFullScreenLoading();F$alert(F_('game.msg.reload.game'),function(){location.reload();});}if(!gameCommandBuffer.tryBuffer(splitMsg,msg)&&game&&game.map!=map1){self.handleGameMsg(splitMsg,msg);}if(cmd=='upd'){return;}if(NetworkRespondMsgJson[cmd]){var slice=msg.split('$');slice.shift();var data=JSON.parse(slice.join('$'));if(!data||(typeof data==="undefined"?"undefined":_typeof(data))!=='object'){return;}NetworkRespondMsgJson[cmd](data,self);return;}if(NetworkRespondMsg[cmd]){NetworkRespondMsg[cmd](splitMsg,self,msg);return;}if(NetworkRespondMsg[msg]){NetworkRespondMsg[msg](splitMsg,self,msg);return;}if(msg.substr(0,10)=="map4Editor"){map4Editor(msg);return;}}pomelo.on('jbs',onmessage);pomelo.on('redirect',function(msg){if(window.debugMode){console.log(Date.now()+' - redirect:',msg);}pomeloRedirect=true;pomelo.disconnect();setTimeout(function(){self.socket=null;self.redirectMsg=msg;pomeloRedirect=false;self.ignoreGuestMsg=!!localStorage.getItem("fId");pomeloInit(msg.host,msg.port,network.connectedServerIndex,function(socket){self.socket=socket;});},0);});};Network.prototype.onBeforeServerSwitch=function(){if(this.socket==null){return;}this.socket.disconnect();};Network.prototype.autojoin=function(msgName){if(msgName=='guest'){if(network.autoJoinHintShowed){return false;}var search=getSearchQuery();if(search["game"]){network.autoJoinHintShowed=true;slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get('hint.inviteURL.login')});}return false;}if(network.autoJoinedEver){return false;}var search=getSearchQuery();if(search["game"]){network.send("join-game$"+search["game"]);window.joinGamePurpose=search['mode']&&search['mode']==3?'spectate':null;network.autoJoinedEver=true;return true;}return false;};var lastUpdTime=0;Network.prototype.handleGameMsg=function(splitMsg,msg){var cmd=splitMsg[0];if(!Game.isIngameCommand(cmd)){return;}if(NetworkGameMsg[cmd]){NetworkGameMsg[cmd](splitMsg);}else if(msg.substr(0,4)=="chat"&&game){game.interface_.chatMsg(msg.substr(4),"#8CD882");}if(!game.replayMode&&cmd!="next-maps"){window.replayFile.push(msg);}};Network.prototype.send=function(data){if(window.debugMode==4){console.log('send:',data);}var action=data.split('$')[0];if(this.blockInputMessages&&(action=='kdn'||action=='kup'||action=='mu'||action=='md')){return;}if(['register','waitOrder','login','i-accept-agb','logout','req-games-list','loginSteam','joinRandomGame','changeNick','changeSteamNick','create-game','join-game','buyHero','session_id','update-profile-text','reqAllGames','steamTrans','steamBind','playerList','myClanInfo','acceptClanMember','rejectClanMember','apply4Clan','leaveClan','createClan','clanList','getMemberList','plInfo','clInfo','update-clan','kickMember','makeAdmin','makeMod','makeMember','getClanAppsOfPlayer','abUpd','setHat','upgradeNewItem','chooseNameColor','buyItem','buyAbility','setTutorials','openTreasureChest','getDailyQuests','completeDailyQuest','req-map-list','map-upl-1','map-upl-2<<','req-map-4-e','req-map-list-4-create'].indexOf(action)>=0){pomelo.notify('lobby.lobbyHandler.jbs',{'data':data});}else{pomelo.notify('room.roomHandler.jbs',{'data':data});}};function ServerChooser(){}function getProperties(){(function(window){{var unknown='-';var screenSize='';var width='';var height='';if(screen.width){width=screen.width?screen.width:'';height=screen.height?screen.height:'';screenSize+=''+width+" x "+height;}var nVer=navigator.appVersion;var nAgt=navigator.userAgent;var browser=navigator.appName;var version=''+parseFloat(navigator.appVersion);var majorVersion=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;if((verOffset=nAgt.indexOf('Opera'))!=-1){browser='Opera';version=nAgt.substring(verOffset+6);if((verOffset=nAgt.indexOf('Version'))!=-1){version=nAgt.substring(verOffset+8);}}if((verOffset=nAgt.indexOf('OPR'))!=-1){browser='Opera';version=nAgt.substring(verOffset+4);}else if((verOffset=nAgt.indexOf('Edge'))!=-1){browser='Microsoft Edge';version=nAgt.substring(verOffset+5);}else if((verOffset=nAgt.indexOf('MSIE'))!=-1){browser='Microsoft Internet Explorer';version=nAgt.substring(verOffset+5);}else if((verOffset=nAgt.indexOf('Chrome'))!=-1){browser='Chrome';version=nAgt.substring(verOffset+7);}else if((verOffset=nAgt.indexOf('Safari'))!=-1){browser='Safari';version=nAgt.substring(verOffset+7);if((verOffset=nAgt.indexOf('Version'))!=-1){version=nAgt.substring(verOffset+8);}}else if((verOffset=nAgt.indexOf('Firefox'))!=-1){browser='Firefox';version=nAgt.substring(verOffset+8);}else if(nAgt.indexOf('Trident/')!=-1){browser='Microsoft Internet Explorer';version=nAgt.substring(nAgt.indexOf('rv:')+3);}else if((nameOffset=nAgt.lastIndexOf(' ')+1)<(verOffset=nAgt.lastIndexOf('/'))){browser=nAgt.substring(nameOffset,verOffset);version=nAgt.substring(verOffset+1);if(browser.toLowerCase()==browser.toUpperCase()){browser=navigator.appName;}}if((ix=version.indexOf(';'))!=-1){version=version.substring(0,ix);}if((ix=version.indexOf(' '))!=-1){version=version.substring(0,ix);}if((ix=version.indexOf(')'))!=-1){version=version.substring(0,ix);}majorVersion=parseInt(''+version,10);if(isNaN(majorVersion)){version=''+parseFloat(navigator.appVersion);majorVersion=parseInt(navigator.appVersion,10);}var mobile=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(nVer);var cookieEnabled=navigator.cookieEnabled?true:false;if(typeof navigator.cookieEnabled=='undefined'&&!cookieEnabled){document.cookie='testcookie';cookieEnabled=document.cookie.indexOf('testcookie')!=-1?true:false;}var os=unknown;var clientStrings=[{s:'Windows 10',r:/(Windows 10.0|Windows NT 10.0)/},{s:'Windows 8.1',r:/(Windows 8.1|Windows NT 6.3)/},{s:'Windows 8',r:/(Windows 8|Windows NT 6.2)/},{s:'Windows 7',r:/(Windows 7|Windows NT 6.1)/},{s:'Windows Vista',r:/Windows NT 6.0/},{s:'Windows Server 2003',r:/Windows NT 5.2/},{s:'Windows XP',r:/(Windows NT 5.1|Windows XP)/},{s:'Windows 2000',r:/(Windows NT 5.0|Windows 2000)/},{s:'Windows ME',r:/(Win 9x 4.90|Windows ME)/},{s:'Windows 98',r:/(Windows 98|Win98)/},{s:'Windows 95',r:/(Windows 95|Win95|Windows_95)/},{s:'Windows NT 4.0',r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:'Windows CE',r:/Windows CE/},{s:'Windows 3.11',r:/Win16/},{s:'Android',r:/Android/},{s:'Open BSD',r:/OpenBSD/},{s:'Sun OS',r:/SunOS/},{s:'Linux',r:/(Linux|X11)/},{s:'iOS',r:/(iPhone|iPad|iPod)/},{s:'Mac OS X',r:/Mac OS X/},{s:'Mac OS',r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:'QNX',r:/QNX/},{s:'UNIX',r:/UNIX/},{s:'BeOS',r:/BeOS/},{s:'OS/2',r:/OS\/2/},{s:'Search Bot',r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var id in clientStrings){var cs=clientStrings[id];if(cs.r&&cs.r.test(nAgt)){os=cs.s;break;}}var osVersion=unknown;if(/Windows/.test(os)){osVersion=/Windows (.*)/.exec(os)[1];os='Windows';}switch(os){case'Mac OS X':osVersion=/Mac OS X (10[\.\_\d]+)/.exec(nAgt)[1];break;case'Android':osVersion=/Android ([\.\_\d]+)/.exec(nAgt)[1];break;case'iOS':osVersion=/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer);osVersion=osVersion[1]+'.'+osVersion[2]+'.'+(osVersion[3]|0);break;}var flashVersion='no check';if(typeof swfobject!='undefined'){var fv=swfobject.getFlashPlayerVersion();if(fv.major>0){flashVersion=fv.major+'.'+fv.minor+' r'+fv.release;}else{flashVersion=unknown;}}}jscd={screen:screenSize,browser:browser,browserVersion:version,browserMajorVersion:majorVersion,mobile:mobile,os:os,osVersion:osVersion,cookies:cookieEnabled,flashVersion:flashVersion};})(this);var properties={};properties.app_version="1.0.0";properties.os=jscd.os;properties.os_version=jscd.osVersion;properties.browser=jscd.browser;properties.browser_version=jscd.browserVersion;properties.lang=navigator.language;properties.install_source=''+document.referrer||'empty_referrer';properties.scene=+!window.blockAdBlock;properties.udid=getUdid();return properties;}var pomeloRedirect=false;var pomeloEnter=function pomeloEnter(callback,cbxx){if(FacebookUtils.embeddedInCanvas){clearLocal();}console.log("=> Start request connector.entryHandler.enter ...");var udid=getUdid();gaEventOnce('start-to-create-session-at-connector');pomelo.request('connector.entryHandler.enter',{'udid':udid||''},function(msg){if(msg.result!=0){slayOne.viewHelpers.showFloatTip({tipType:'error',content:'We are currently maintaining the servers. Please try again later.'+' ['+msg.result+']',duration:-1});if(cbxx){cbxx(new Error(JSON.stringify(msg,null,0)));}return;}if(cbxx){cbxx(null);return;}console.log(msg.lobby||'lobby-null');gaEventOnce('session-at-connector-created');network.blockCustomBI=false;localStorage.setItem('udid',msg.udid||'');localStorage.setItem('udid_steam',SteamInfo.user?SteamInfo.user.steamId:'');var redirectId='';if(network.redirectMsg&&network.redirectMsg.redirectId){redirectId=network.redirectMsg.redirectId;}window.serverTimeDiff=msg.ts-Date.now();var properties=getProperties();console.log("=> Start request lobby.lobbyHandler.enter ...");gaEventOnce('start-to-prepare-player-data-at-lobby');pomelo.request('lobby.lobbyHandler.enter',{session_id:getSessionId(),redirectId:redirectId,properties:properties},function(msg){gaEventOnce('player-data-at-lobby-prepared');pomelo.request('lobby.lobbyHandler.getMapIds',{},function(ret){var preloadStart=Date.now();mapService.loadMaps(ret.idVersions,function(){console.log("finish preloading maps: ",Date.now()-preloadStart+"ms");});});if(msg!='ok1'&&msg!='ok2'){slayOne.viewHelpers.showFloatTip({tipType:'error',content:msg,duration:-1});return;}if(msg!='ok2'){var fid=localStorage.getItem("fId");if(FacebookUtils.embeddedInCanvas||!!fid&&fid!=''){if(!!window.FB&&FacebookUtils.authInfo){gaEventOnce('start-to-login-with-facebook-account');FacebookUtils.loginGame(function(res){if(res.result==0){gaEventOnce('login-with-facebook-account-succeeded');callback(pomelo);}});return;}}slayOne.viewHelpers.hideFullScreenLoading();steamInitWait();}console.log('pomelo init success');callback(pomelo);});});};var pomeloInit=function pomeloInit(host,port,index,callback,cbxx){try{var onClose=function onClose(){if(pomeloRedirect||network.redirectMsg!=null){return;}F$alert(F_("network.close"),function(){window.location.reload();});};var initializing=true;pomelo.removeAllListeners('io-error');pomelo.on('io-error',function(err){if(initializing){initializing=false;if(cbxx){cbxx(err);}}});pomelo.once('heartbeat timeout',onClose);pomelo.once('close',onClose);gaEventOnce('start-to-connect');pomelo.init({host:host,port:port,user:{},handshakeCallback:function handshakeCallback(){console.log('handshakeCallback success');}},function(){initializing=false;network.connectedServerIndex=index;gaEventOnce('connected');if(!!window.FB&&(FacebookUtils.embeddedInCanvas||localStorage.getItem("fId"))){gaEventOnce('start-to-check-facebook-status');FacebookUtils.onFbReady(function(){gaEventOnce('check-facebook-status-succeeded');pomeloEnter(callback,cbxx);});}else{pomeloEnter(callback,cbxx);}});}catch(err){if(cbxx){cbxx(err);}else{alert(err);alert("Your browser seems to not support Websockets. Websockets, however, are required to run this game.");throw new Error("No Websockets supported.");}}};ServerChooser.prototype.choose=function(addresses,forceServerName,callback){var result=null;var serverNames=Object.keys(SERVER_INFOS);var fastFound=false;var setOpen=function setOpen(s,host,port,index){s.onopen=function(event){s.close();if(fastFound){return;}fastFound=true;console.log('connected to',host,port,index);pomeloInit(host,port,index,callback);};};var foreachServer=function foreachServer(serverNames){console.log('server foreach',serverNames);serverNames.forEach(function(serverName){var server=SERVER_INFOS[serverName];var rnd=Math.floor(Math.random()*server.list.length);var connector=server.list[rnd];var host=connector.host;var port=connector.port;var url='wss://'+host;if(port){url+=':'+port;}var s=new WebSocket(url);setOpen(s,host,port,serverName);});};if(forceServerName&&forceServerName.length>0){if(serverNames.indexOf(forceServerName)>=0){foreachServer([forceServerName]);return;}}if(!serverNames||serverNames.length<=0){slayOne.viewHelpers.showFloatTip({tipType:'error',content:'We are currently maintaining the servers. Please try again later.',duration:-1});return;}F$ajax.get('https://slayone.soulogic.com/server-choose.json',function(res){(function(){if(res.status!=200){return;}var data=JSON.parse(res.response);if(!data||!data['server']){return;}var server=data.server;console.log('server peferer',server);if(SERVER_INFOS[server]){serverNames=[server];}})();foreachServer(serverNames);});};ServerChooser.prototype.checkAllImpl=function(connectors,index){if(index>=connectors.length){console.log('=============================*');console.log('============================**');console.log('===========================***');var n=0;for(var i=0;i<connectors.length;i++){console.log(connectors[i].result);if(connectors[i].result.substr(-4)=='- ok'){n++;}}console.log('ok: '+n);console.log('failed: '+(connectors.length-n));console.log('checkAll: done');return;}var self=this;var region=connectors[index].region;var host=connectors[index].host;var port=connectors[index].port;var func=function func(err){var msg=err?err.message:'ok';connectors[index].result=index+1+') '+region+' - '+host+':'+port+' - '+msg;setTimeout(function(){self.checkAllImpl(connectors,index+1);},0);};try{console.log(index+1+'...');pomeloInit(host,port,index,function(){},function(err){func(err);});}catch(err){func(err);}};ServerChooser.prototype.checkAll=function(){var regionNames=Object.keys(SERVER_INFOS);if(regionNames==null||regionNames.length<=0){console.error('SERVER_INFOS is empty');return;}var total=0;for(var region in SERVER_INFOS){if(!SERVER_INFOS[region].list||SERVER_INFOS[region].list.length<=0){console.error('SERVER_INFOS['+region+'] is empty');return;}total+=SERVER_INFOS[region].list.length;}console.log('total: '+total);var connectors=[];for(var region in SERVER_INFOS){for(var i=0;i<SERVER_INFOS[region].list.length;i++){SERVER_INFOS[region].list[i].region=region;connectors.push(SERVER_INFOS[region].list[i]);}}this.checkAllImpl(connectors,0);};function KeyManager(){this.x=0;this.y=0;this.leftMouse=false;this.keys=[];this.activeAbility=null;};if(!isMobile){var MouseWheelHandler=function MouseWheelHandler(e){if(document.getElementById("chatInputDiv").style.display=="inline")return;var e=window.event||e;e=e.wheelDelta||-e.detail;if(game&&game.editingMode){zoom(e>0?1.2:1/1.2);return;}if(game&&game.iAmSpec){zoom(e>0?1.1:1/1.1,0.035);game.specX=game.cameraX;game.specY=game.cameraY;return;}if(game&&game.playingPlayer&&game.playingPlayer.weapon&&!game.playingPlayer.dieAt){var step=Math.sign(-e);var currentNr=(game.playingPlayer.weapon.id+weapons.length)%weapons.length;var nr=(currentNr+weapons.length+step)%weapons.length;while(weapons[nr].noWeapon||game.playingPlayerClips[nr]+game.playingPlayerAmmo[nr]<=0&&nr!=0){nr=(nr+step)%weapons.length;}game.switchWeapon(nr);}};var zoom=function zoom(direction,minZoom){var x=game.cameraX+WIDTH/2/FIELD_SIZE;var y=game.cameraY+HEIGHT/2/FIELD_SIZE;SCALE_CONST*=direction;SCALE_CONST=Math.min(Math.max(SCALE_CONST,minZoom?minZoom:0.009),0.30);resize();game.cameraX=x-WIDTH/2/FIELD_SIZE;game.cameraY=y-HEIGHT/2/FIELD_SIZE;};document.addEventListener('contextmenu',function(e){e.preventDefault();});document.documentElement.onkeyup=function(e){var key=KeyManager.getKeyCode(e);var keyCode=keyCodes[key];KeyManager.keys[key]=false;if(key==KEY.T||key==KEY.TAB){F$('rankInGame').hide();}else if(key==commandKeys[COMMAND.FIRE_2])game.fire2Up();else if(keyCode){if(commandKeys[COMMAND.STAND]==key)network.send("kup$"+COMMAND.STAND);else network.send("kup$"+keyCode);}return false;};document.documentElement.onkeydown=function(e){return KeyManager.handleInput(KeyManager.getKeyCode(e),e);};KeyManager.prototype.getKeyCode=function(e){return e.which||e.keyCode;};;window.ondragover=function(e){e.preventDefault();};document.addEventListener("mousewheel",MouseWheelHandler,false);document.addEventListener("DOMMouseScroll",MouseWheelHandler,false);document.documentElement.onmousedown=function(e){window.focus();if(e.currentTarget==canvas)return;var key=KeyManager.getKeyCode(e);if(key==1&&KeyManager.leftMouse)return;if(key==1)KeyManager.leftMouse=true;else if(key==3){e.preventDefault();return KeyManager.handleInput(KEY.RIGHTMOUSE,e);}if(!game||game.map==map1)return;if(game.editingMode)game.editor.noClick=true;if(e.target&&(e.target.getAttribute("data-noclick")=="yes"||e.target.parentNode&&e.target.parentNode.getAttribute("data-noclick")=="yes"||e.target.parentNode.parentNode&&e.target.parentNode.parentNode.getAttribute("data-noclick")=="yes"))return;if(game.editingMode){game.editor.noClick=false;game.editor.click();return;}if(game&&game.map!=map1&&!(e.target&&(e.target.id=="gameLink"||e.target.className.indexOf("clickableDuringGame")>=0)))return false;};KeyManager.prototype.handleInput=function(key,e){var now=Date.now();var keyCode=keyCodes[key];var oldState=KeyManager.keys[key];KeyManager.keys[key]=true;if(document.getElementById("chatInputDiv").style.display=="inline"&&key!=KEY.ENTER){return;}if(key==KEY.F6){specFocusBestLoop();return;}if(key==KEY.F7){cameraReset();return;}if(key==KEY.ESC){if(isSteam&&win.isFullscreen){Desktop.toggleFullscreen();}return;}if(key==KEY.F8){window.soundManager.playSound(SOUND.CLICK);toggleFullscreen(document.documentElement);return;}if(key==KEY.F10){window.soundManager.playSound(SOUND.CLICK);toggleOptionsMenu();return;}if(key==KEY.PLUS&&game&&game.replayMode){window.soundManager.playSound(SOUND.CLICK);changeReplaySpeed(1);return;}if(key==KEY.MINUS&&game&&game.replayMode){window.soundManager.playSound(SOUND.CLICK);changeReplaySpeed(-1);return;}if(document.getElementById("hotkeyScreen")&&document.getElementById("hotkeyScreen").style.display!="none"){var active_hotkey_buttons=document.getElementsByClassName("hotkey_button_active");if(active_hotkey_buttons&&active_hotkey_buttons.length>0){var active_hotkey_button=active_hotkey_buttons[0];active_hotkey_button.style.color="";active_hotkey_button.className="hotkey_button";active_hotkey_button.innerHTML=getKeyName(key);commandKeys[active_hotkey_button.getAttribute("data-key")]=key;soundManager.playSound(SOUND.CLICK);refreshKeyCodes();var hotkeyStr="";for(var attribute in commandNames){if(commandNames.hasOwnProperty(attribute))hotkeyStr+=attribute+":"+commandKeys[attribute]+"_";}localStorage.setItem("hotkeys",hotkeyStr);return false;}}else if(game&&game.editingMode){game.editor.scroll=false;if(e.target&&(e.target.getAttribute("data-noclick")=="yes"||e.target.parentNode&&e.target.parentNode.getAttribute("data-noclick")=="yes"||e.target.parentNode.parentNode&&e.target.parentNode.parentNode.getAttribute&&e.target.parentNode.parentNode.getAttribute("data-noclick")=="yes"))return;game.editor.key(key);return;}else if(game&&game.map!=map1){if(key==commandKeys[COMMAND.JUMP]){network.send("m2");if(KeyManager.activeAbility){soundManager.playSound(SOUND.SWITCH);KeyManager.activeAbility=null;}}else if(key==commandKeys[COMMAND.FIRE_2]){game.fire2Down();}else if(key==KEY.T||key==KEY.TAB){F$('rankInGame').show();e.preventDefault();return false;}else if(key==commandKeys[COMMAND.PICK_UPGRADE]&&game.interface_.upgradeChoicesAvailable&&(game.interface_.upgNotificationStart>0||game.interface_.currentUpgChoicesEnd<now))game.interface_.shopUpgrades();else if(key==commandKeys[COMMAND.PICK_UPGRADE]&&game.interface_.upgNotificationStart<0&&game.interface_.currentUpgChoices.length>0&&game.interface_.currentUpgChoicesEnd>now)game.interface_.hideUpgrades();else if(key==KEY.ENTER){var el=document.getElementById("chatInputDiv");var el2=document.getElementById("chatInput");var el3=document.getElementById("chatlog");var el4=document.getElementById("chatloginner");if(el.style.display!="inline"){el.style.display="inline";el3.style.display="inline";el4.scrollTop=el4.scrollHeight;el2.focus();}else{var msg=el2.value;if(msg&&msg.length>0)network.send("chat"+msg);el2.value="";el.style.display="none";el3.style.display="none";}}else if(commandKeys[COMMAND.ABILITY1]==key)game.interface_.initAbility(pl_active_abilities[0],0);else if(commandKeys[COMMAND.ABILITY2]==key)game.interface_.initAbility(pl_active_abilities[1],1);else if(commandKeys[COMMAND.UP]==key||commandKeys[COMMAND.DOWN]==key||commandKeys[COMMAND.LEFT]==key||commandKeys[COMMAND.RIGHT]==key||commandKeys[COMMAND.RELOAD]==key||commandKeys[COMMAND.STAND]==key&&game.playingPlayer&&game.playingPlayer.weapon&&game.playingPlayer.weapon.requiredStandTime){if(oldState!=KeyManager.keys[key]){if(commandKeys[COMMAND.STAND]==key)network.send("kdn$"+COMMAND.STAND);else network.send("kdn$"+keyCode);}}else if(game.playingPlayer&&!game.playingPlayer.isHumanZombie)for(var i=0;i<weapons.length;i++){if(!weapons[i].noWeapon&&key==commandKeys[COMMAND["WPN"+(i+1)]]){var totalAmmo=game.playingPlayerClips[i]+game.playingPlayerAmmo[i];if(game.playingPlayerClips[i]+game.playingPlayerAmmo[i]>0||game.playingPlayer.weapon==weapons[i])game.switchWeapon(i);else{game.interface_.setMainKillMsg("you don't have this weapon","grey","textInGrey");soundManager.playSound(SOUND.EMPTY_CLIP,game.playingPlayer.x,game.playingPlayer.y,0.75);}i=weapons.length;}}}};document.documentElement.onmouseup=function(e){var key=KeyManager.getKeyCode(e);if(key==1)KeyManager.leftMouse=false;if(game&&game.playingPlayer&&key==1){game.mouseUp();}};document.documentElement.onclick=function(e){var b=KeyManager.getKeyCode(e);if(b==2||b==3){e.preventDefault();e.stopPropagation();return false;}};canvas.onclick=function(e){e.preventDefault();e.stopPropagation();return false;};canvas.addEventListener("mousedown",function(e){var x=getMouseGamePlayX();var y=getMouseGamePlayY();var key=KeyManager.getKeyCode(e);if(key==1){if(game.interface_.click())return;if(game.iAmSpec){switchSpec(1);return;}if(game.playingPlayer&&KeyManager.activeAbility){var target=null;if(KeyManager.activeAbility.energy>game.playingPlayerEnergy){game.interface_.addMsg(slayOne.widgets.lang.get("game.msg.no_energy"),"red");soundManager.playSound(SOUND.NEGATIVE,0.8);}else if(game.lastAbilityUses[pl_active_abilities[0]==KeyManager.activeAbility?0:1]+KeyManager.activeAbility.cooldown>game.ticksCounter){game.interface_.addMsg(slayOne.widgets.lang.get("game.msg.no_cooldown"),"red");soundManager.playSound(SOUND.NEGATIVE,0.8);}else if(KeyManager.activeAbility.type=="blink"&&game.playingPlayer.carriesFlag()){game.interface_.addMsg(slayOne.widgets.lang.get("game.skills.teleport.disabled_in_ctf"),"red");soundManager.playSound(SOUND.NEGATIVE,0.8);}else{if(KeyManager.activeAbility.type=="place")target=game.getPotentialPlaceTarget(KeyManager.activeAbility);else target={x:x,y:y};network.send("ab$"+KeyManager.activeAbility.id+"$"+target.x+"$"+target.y);}KeyManager.activeAbility=null;}else if(game.playingPlayer&&game.playingPlayer.weapon){if(game.playingPlayer.weapon.requiredStandTime&&game.playingPlayer.standTime<=0){if(game.playingPlayerClips[game.playingPlayer.weapon.id]){game.interface_.setMainKillMsg(slayOne.widgets.lang.get("game.msg.stand_required",{keyName:getKeyName(commandKeys[COMMAND.STAND])}),"grey","textInGrey");soundManager.playSound(SOUND.NEGATIVE,0.8);}}else{game.mouseDown();}}}else if(key==3){if(game.iAmSpec){switchSpec(-1);return;}}});document.documentElement.onmousemove=function(e){if(e.pageX==null&&e.clientX!=null){var doc=document.documentElement;var body=document.body;e.pageX=e.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);e.pageY=e.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}if(typeof KeyManager!=='undefined'){KeyManager.x=e.pageX;KeyManager.y=e.pageY;if(KeyManager.leftMouse&&game&&game.editingMode)game.editor.mouseMove();}};}function KeyManagerMobile(){this.x=0;this.y=0;this.leftMouse=false;this.ongoingTouches=[];this.keys=[];};if(isMobile){KeyManagerMobile.prototype.keyUp=function(key){var keyCodes=keyCodes[key];if(keyCodes)network.send("kup$"+keyCodes);};KeyManagerMobile.prototype.keyDown=function(key){var keyCode=keyCodes[key];if((key==KEY.NUM1||key==KEY.NUM2||key==KEY.NUM3||key==KEY.NUM4||key==KEY.NUM5||key==KEY.NUM6||key==KEY.NUM7)&&game&&game.playingPlayer&&game.ticksCounter>=0&&game.playingPlayerIsNotStunned()){var nr=key-KEY.NUM1;if(weapons[nr]&&weapons[nr]!=game.playingPlayer.weapon){network.send("sW$"+nr);soundManager.playSound(SOUND.SWITCH_WEAPON,undefined,undefined,0.7);game.resetPlayingPlayerCooldowns();game.playingPlayer.switchWeaponUntil=game.ticksCounter+CONST.WPN_SWITCH_TICKS;game.playingPlayer.lastWeapon=game.playingPlayer.weapon;game.playingPlayer.weapon=weapons[nr];game.playingPlayer.isReloading=false;game.resetPlayingPlayerCooldowns();}}else if(keyCode)network.send("kdn$"+keyCode);};document.ontouchstart=function(e){for(var i=0;i<e.touches.length;i++){KeyManager.ongoingTouches.push(e.touches[i]);}KeyManager.leftMouse=true;if(game.iAmSpec){switchSpec(1);return;}var x=e.touches[0].pageX/FIELD_SIZE+game.cameraX;var y=e.touches[0].pageY/FIELD_SIZE+game.cameraY;for(var i=0;i<game.interface_.buttons.length;i++){if(game.interface_.buttons[i].contains(e.touches[0].pageX,e.touches[0].pageY)){return;}}KeyManager.x=e.touches[0].pageX;KeyManager.y=e.touches[0].pageY;network.send("md$"+x+"$"+(y+(game.playingPlayer&&game.playingPlayer.weapon&&game.playingPlayer.weapon.addHeight?SHOT_HEIGHT:0)));};document.ontouchend=function(e){for(var i=0;i<e.changedTouches.length;i++){for(var k=0;k<KeyManager.ongoingTouches.length;k++){if(KeyManager.ongoingTouches[k].identifier==e.changedTouches[i].identifier){KeyManager.ongoingTouches.splice(k,1);k=KeyManager.ongoingTouches.length;}}}network.send("mu");KeyManager.leftMouse=false;};document.ontouchmove=function(e){KeyManager.x=e.touches[0].pageX;KeyManager.y=e.touches[0].pageY;};}function FloatingText(text,x,y,lifetime,speed,color,size,img){this.text=text;this.color=color?color:"red";this.size=size?size:FIELD_SIZE*0.3;this.img=img;this.x=x;this.y=y;this.timeOfBirth=Date.now();this.lifetime=lifetime?lifetime:2000;this.speed=speed?speed:2;};FloatingText.prototype.update=function(){return this.timeOfBirth+this.lifetime>=Date.now();};FloatingText.prototype.draw=function(){var now=Date.now();var x=(this.x-game.cameraX)*FIELD_SIZE;var y=(this.y-game.cameraY-(now-this.timeOfBirth)*this.speed/1000)*FIELD_SIZE;if(this.img)x+=this.img.w/2;var time2Live=Math.max(this.timeOfBirth+this.lifetime-now,0.001);var alpha=time2Live>500?1:time2Live/500;if(this.timeOfBirth+200>now)alpha=(now-this.timeOfBirth)/200;drawText(c,this.text,this.color,this.size,x,y,250,"center",alpha);if(this.img){var scale=SCALE_FACTOR*0.9;c.globalAlpha=alpha;c.drawImage(imgs.miscSheet,this.img.x,this.img.y,this.img.w,this.img.h,x-c.measureText(this.text).width/2-(this.img.w+2)*scale,y-this.img.h*scale*0.8,this.img.w*scale,this.img.h*scale);c.globalAlpha=1;}};function SoundManager(){this.sounds=[];this.sounds[SOUND.GRENADE_LAUNCH]=[window.ResourcePath+"sounds/grenade_launch_1.ogg",window.ResourcePath+"sounds/grenade_launch_2.ogg",window.ResourcePath+"sounds/grenade_launch_3.ogg"];this.sounds[SOUND.EXPLODE]=[window.ResourcePath+"sounds/explo1.ogg",window.ResourcePath+"sounds/explo2.ogg"];this.sounds[SOUND.LASER]=[window.ResourcePath+"sounds/laser1.ogg",window.ResourcePath+"sounds/laser1.ogg",window.ResourcePath+"sounds/laser2.ogg",window.ResourcePath+"sounds/laser2.ogg"];this.sounds[SOUND.SWITCH_WEAPON]=[window.ResourcePath+"sounds/switch_weapon.ogg",window.ResourcePath+"sounds/switch_weapon.ogg"];this.sounds[SOUND.COCK]=[window.ResourcePath+"sounds/cock1.ogg",window.ResourcePath+"sounds/cock1.ogg"];this.sounds[SOUND.EMPTY_CLIP]=[window.ResourcePath+"sounds/empty-clip.ogg",window.ResourcePath+"sounds/empty-clip.ogg"];this.sounds[SOUND.SIZZLE]=[window.ResourcePath+"sounds/sizzle1.ogg",window.ResourcePath+"sounds/sizzle2.ogg",window.ResourcePath+"sounds/sizzle2.ogg"];this.sounds[SOUND.SIZZLE2]=[window.ResourcePath+"sounds/sizzle3.ogg",window.ResourcePath+"sounds/sizzle3.ogg",window.ResourcePath+"sounds/sizzle3.ogg"];this.sounds[SOUND.GUN_IMPACT]=[window.ResourcePath+"sounds/gun_hit_wall.ogg",window.ResourcePath+"sounds/gun_hit_wall.ogg",window.ResourcePath+"sounds/gun_hit_wall.ogg",window.ResourcePath+"sounds/gun_hit_wall.ogg"];this.sounds[SOUND.GUN_IMPACT_2]=[window.ResourcePath+"sounds/gun_impact_x.ogg",window.ResourcePath+"sounds/gun_impact_x.ogg",window.ResourcePath+"sounds/gun_impact_x.ogg",window.ResourcePath+"sounds/gun_impact_x.ogg"];this.sounds[SOUND.PUNCH]=[window.ResourcePath+"sounds/punch1.ogg",window.ResourcePath+"sounds/punch2.ogg",window.ResourcePath+"sounds/punch1.ogg",window.ResourcePath+"sounds/punch2.ogg",window.ResourcePath+"sounds/punch1.ogg",window.ResourcePath+"sounds/punch2.ogg"];this.sounds[SOUND.KICK]=[window.ResourcePath+"sounds/kick1.ogg",window.ResourcePath+"sounds/kick2.ogg",window.ResourcePath+"sounds/kick3.ogg",window.ResourcePath+"sounds/kick4.ogg"];this.sounds[SOUND.CLICK]=[window.ResourcePath+"sounds/click1.ogg",window.ResourcePath+"sounds/click1.ogg"];this.sounds[SOUND.ROCKET_LAUNCH]=[window.ResourcePath+"sounds/rocket-launch.ogg",window.ResourcePath+"sounds/rocket-launch.ogg",window.ResourcePath+"sounds/rocket-launch.ogg"];this.sounds[SOUND.ROCKET_FLY]=[window.ResourcePath+"sounds/rocket-fly.ogg",window.ResourcePath+"sounds/rocket-fly.ogg",window.ResourcePath+"sounds/rocket-fly.ogg"];this.sounds[SOUND.FRAG1]=[window.ResourcePath+"sounds/kill1.ogg"];this.sounds[SOUND.FRAG2]=[window.ResourcePath+"sounds/kill2.ogg"];this.sounds[SOUND.FRAG3]=[window.ResourcePath+"sounds/kill3.ogg"];this.sounds[SOUND.FRAG4]=[window.ResourcePath+"sounds/kill4.ogg"];this.sounds[SOUND.FRAG5]=[window.ResourcePath+"sounds/kill5.ogg"];this.sounds[SOUND.RELOAD_MG]=[window.ResourcePath+"sounds/reload_mg.ogg"];this.sounds[SOUND.RELOAD_GL]=[window.ResourcePath+"sounds/reload_gl.ogg"];this.sounds[SOUND.RELOAD_RL]=[window.ResourcePath+"sounds/reload_rl.ogg"];this.sounds[SOUND.RELOAD_RL_2]=[window.ResourcePath+"sounds/reload_rl_2.ogg"];this.sounds[SOUND.LASER_RECHARGE]=[window.ResourcePath+"sounds/laser-recharge.ogg"];this.sounds[SOUND.RELOAD_FLAME]=[window.ResourcePath+"sounds/reload_flame.ogg"];this.sounds[SOUND.HEAL_WPN]=[window.ResourcePath+"sounds/heal_wpn.ogg",window.ResourcePath+"sounds/heal_wpn.ogg",window.ResourcePath+"sounds/heal_wpn.ogg"];this.sounds[SOUND.SHOTGUN]=[window.ResourcePath+"sounds/shotgun.ogg",window.ResourcePath+"sounds/shotgun2.ogg"];this.sounds[SOUND.SHOTGUN_RELOAD]=[window.ResourcePath+"sounds/shotgun_reload_2.ogg"];this.sounds[SOUND.SHOTGUN_RELOAD_LONG]=[window.ResourcePath+"sounds/shotgun_reload_long.ogg"];this.sounds[SOUND.ZIP]=[window.ResourcePath+"sounds/zip.ogg"];this.sounds[SOUND.LVLUP]=[window.ResourcePath+"sounds/archivement3.ogg"];this.sounds[SOUND.UPGRADE_ITEM]=[window.ResourcePath+"sounds/archivement2.ogg"];this.sounds[SOUND.OPEN_CHEST]=[window.ResourcePath+"sounds/archivement3.ogg"];this.sounds[SOUND.UNLOCK]=[window.ResourcePath+"sounds/archivement2.ogg"];this.sounds[SOUND.ZOOM]=[window.ResourcePath+"sounds/zoom.ogg"];this.sounds[SOUND.BING]=[window.ResourcePath+"sounds/bing.ogg",window.ResourcePath+"sounds/bing.ogg"];this.sounds[SOUND.FLAME_BURN]=[window.ResourcePath+"sounds/flame.ogg",window.ResourcePath+"sounds/flame.ogg",window.ResourcePath+"sounds/flame.ogg",window.ResourcePath+"sounds/flame.ogg"];this.sounds[SOUND.FLAME_EXPLODE]=[window.ResourcePath+"sounds/flame_explo.ogg",window.ResourcePath+"sounds/flame_explo.ogg"];this.sounds[SOUND.SNIPER]=[window.ResourcePath+"sounds/sniper3.ogg",window.ResourcePath+"sounds/sniper4.ogg"];this.sounds[SOUND.ROCKET_BEEP]=[window.ResourcePath+"sounds/rocket-beep.ogg",window.ResourcePath+"sounds/rocket-beep.ogg"];this.sounds[SOUND.HEAL]=[window.ResourcePath+"sounds/heal.ogg",window.ResourcePath+"sounds/heal.ogg"];this.sounds[SOUND.ARMOR]=[window.ResourcePath+"sounds/armor.ogg",window.ResourcePath+"sounds/armor.ogg"];this.sounds[SOUND.AMMO_SPAWN]=[window.ResourcePath+"sounds/ammo-spawn.ogg",window.ResourcePath+"sounds/ammo-spawn.ogg",window.ResourcePath+"sounds/ammo-spawn.ogg"];this.sounds[SOUND.PLAYER_SPAWN]=[window.ResourcePath+"sounds/warp-in.ogg",window.ResourcePath+"sounds/warp-in.ogg",window.ResourcePath+"sounds/warp-in.ogg"];this.sounds[SOUND.REFLECT]=[window.ResourcePath+"sounds/plasma-shield.ogg",window.ResourcePath+"sounds/plasma-shield2.ogg",window.ResourcePath+"sounds/plasma-shield3.ogg",window.ResourcePath+"sounds/plasma-shield.ogg",window.ResourcePath+"sounds/plasma-shield2.ogg",window.ResourcePath+"sounds/plasma-shield3.ogg"];this.sounds[SOUND.FLAMETHROWER]=[window.ResourcePath+"sounds/flamethrower.ogg",window.ResourcePath+"sounds/flamethrower.ogg"];this.sounds[SOUND.GRENADE_BOUNCE]=[window.ResourcePath+"sounds/grenade-bounce.ogg",window.ResourcePath+"sounds/grenade-bounce.ogg",window.ResourcePath+"sounds/grenade-bounce.ogg"];this.sounds[SOUND.PLACE]=[window.ResourcePath+"sounds/clic02.ogg",window.ResourcePath+"sounds/clic02.ogg"];this.sounds[SOUND.SWITCH]=[window.ResourcePath+"sounds/switch.ogg",window.ResourcePath+"sounds/switch.ogg",window.ResourcePath+"sounds/switch.ogg",window.ResourcePath+"sounds/switch.ogg"];this.sounds[SOUND.CHAT1]=[window.ResourcePath+"sounds/chat-1.ogg",window.ResourcePath+"sounds/chat-1.ogg",window.ResourcePath+"sounds/chat-1.ogg",window.ResourcePath+"sounds/chat-1.ogg"];this.sounds[SOUND.INVIS1]=[window.ResourcePath+"sounds/invis1.ogg",window.ResourcePath+"sounds/invis1.ogg"];this.sounds[SOUND.STEP]=[window.ResourcePath+"sounds/step1.ogg",window.ResourcePath+"sounds/step2.ogg",window.ResourcePath+"sounds/step3.ogg",window.ResourcePath+"sounds/step4.ogg",window.ResourcePath+"sounds/step1.ogg",window.ResourcePath+"sounds/step2.ogg",window.ResourcePath+"sounds/step3.ogg",window.ResourcePath+"sounds/step4.ogg"];this.sounds[SOUND.THROW]=[window.ResourcePath+"sounds/throw-1.ogg",window.ResourcePath+"sounds/throw-2.ogg"];this.sounds[SOUND.FLASH]=[window.ResourcePath+"sounds/flash.ogg",window.ResourcePath+"sounds/flash.ogg"];this.sounds[SOUND.FLASH_START]=[window.ResourcePath+"sounds/flash_start.ogg",window.ResourcePath+"sounds/flash_start.ogg"];this.sounds[SOUND.SMOKE_START]=[window.ResourcePath+"sounds/smoke_start.ogg",window.ResourcePath+"sounds/smoke_start.ogg"];this.sounds[SOUND.SMOKE_LOOP]=[window.ResourcePath+"sounds/smoke_loop.ogg",window.ResourcePath+"sounds/smoke_loop.ogg",window.ResourcePath+"sounds/smoke_loop.ogg",window.ResourcePath+"sounds/smoke_loop.ogg"];this.sounds[SOUND.SPELL]=[window.ResourcePath+"sounds/spell.ogg",window.ResourcePath+"sounds/spell.ogg"];this.sounds[SOUND.INVIS2]=[window.ResourcePath+"sounds/invis2.ogg",window.ResourcePath+"sounds/invis2.ogg"];this.sounds[SOUND.NEGATIVE]=[window.ResourcePath+"sounds/negative.ogg",window.ResourcePath+"sounds/negative.ogg",window.ResourcePath+"sounds/negative.ogg",window.ResourcePath+"sounds/negative.ogg"];this.sounds[SOUND.BLINK]=[window.ResourcePath+"sounds/blink.ogg",window.ResourcePath+"sounds/blink.ogg"];this.sounds[SOUND.TURRET_INIT]=[window.ResourcePath+"sounds/turret-init.ogg",window.ResourcePath+"sounds/turret-init.ogg"];this.sounds[SOUND.HEAL_AURA]=[window.ResourcePath+"sounds/heal-aura.ogg",window.ResourcePath+"sounds/heal-aura.ogg",window.ResourcePath+"sounds/heal-aura.ogg",window.ResourcePath+"sounds/heal-aura.ogg"];this.sounds[SOUND.CLICK]=[window.ResourcePath+"sounds/click1.ogg"];this.sounds[SOUND.MG]=[window.ResourcePath+"sounds/mg4.ogg",window.ResourcePath+"sounds/mg4.ogg",window.ResourcePath+"sounds/mg4.ogg",window.ResourcePath+"sounds/mg4.ogg",window.ResourcePath+"sounds/mg5.ogg",window.ResourcePath+"sounds/mg5.ogg",window.ResourcePath+"sounds/mg5.ogg",window.ResourcePath+"sounds/mg5.ogg",window.ResourcePath+"sounds/mg4.ogg",window.ResourcePath+"sounds/mg4.ogg",window.ResourcePath+"sounds/mg4.ogg",window.ResourcePath+"sounds/mg5.ogg",window.ResourcePath+"sounds/mg5.ogg",window.ResourcePath+"sounds/mg5.ogg",window.ResourcePath+"sounds/mg5.ogg"];this.sounds[SOUND.CARTRIDGE1]=[window.ResourcePath+"sounds/cartridge1.ogg",window.ResourcePath+"sounds/cartridge2.ogg",window.ResourcePath+"sounds/cartridge4.ogg",window.ResourcePath+"sounds/cartridge1.ogg",window.ResourcePath+"sounds/cartridge2.ogg",window.ResourcePath+"sounds/cartridge4.ogg",window.ResourcePath+"sounds/cartridge1.ogg",window.ResourcePath+"sounds/cartridge2.ogg"];this.sounds[SOUND.CARTRIDGE2]=[window.ResourcePath+"sounds/cartridge3.ogg",window.ResourcePath+"sounds/cartridge5.ogg",window.ResourcePath+"sounds/cartridge3.ogg",window.ResourcePath+"sounds/cartridge5.ogg",window.ResourcePath+"sounds/cartridge3.ogg",window.ResourcePath+"sounds/cartridge5.ogg",window.ResourcePath+"sounds/cartridge3.ogg",window.ResourcePath+"sounds/cartridge5.ogg"];this.sounds[SOUND.DOUBLE_KILL]=[window.ResourcePath+"sounds/kills/doublekill.ogg"];this.sounds[SOUND.MULTI_KILL]=[window.ResourcePath+"sounds/kills/multikill.ogg"];this.sounds[SOUND.ULTRA_KILL]=[window.ResourcePath+"sounds/kills/ultrakill.ogg"];this.sounds[SOUND.MONSTER_KILL]=[window.ResourcePath+"sounds/kills/monsterkill.ogg"];this.sounds[SOUND.KILLING_SPREE]=[window.ResourcePath+"sounds/kills/killingspree.ogg"];this.sounds[SOUND.RAMPAGE]=[window.ResourcePath+"sounds/kills/rampage.ogg"];this.sounds[SOUND.DOMINATING]=[window.ResourcePath+"sounds/kills/dominating.ogg"];this.sounds[SOUND.UNSTOPPABLE]=[window.ResourcePath+"sounds/kills/unstoppable.ogg"];this.sounds[SOUND.GODLIKE]=[window.ResourcePath+"sounds/kills/godlike.ogg"];this.sounds[SOUND.SCAN]=[window.ResourcePath+"sounds/scan.ogg"];this.sounds[SOUND.START]=[window.ResourcePath+"sounds/game_start.ogg"];this.sounds[SOUND.END]=[window.ResourcePath+"sounds/end.ogg",window.ResourcePath+"sounds/end2.ogg"];this.sounds[SOUND.WIN]=[window.ResourcePath+"sounds/win.ogg"];this.sounds[SOUND.LOSE]=[window.ResourcePath+"sounds/lose.ogg"];this.sounds[SOUND.TEAMKILL]=[window.ResourcePath+"sounds/teamkill.ogg"];this.sounds[SOUND.ZOMBIE_BITE]=[window.ResourcePath+"sounds/zombie_bite.ogg",window.ResourcePath+"sounds/zombie_bite.ogg",window.ResourcePath+"sounds/zombie_bite_3.ogg",window.ResourcePath+"sounds/zombie_bite_3.ogg"];this.sounds[SOUND.ZOMBIE_DEATH]=[window.ResourcePath+"sounds/zombie-21.ogg",window.ResourcePath+"sounds/zombie-8.ogg"];this.sounds[SOUND.ZOMBIE_ATT]=[window.ResourcePath+"sounds/zombie-1.ogg",window.ResourcePath+"sounds/zombie-11.ogg",window.ResourcePath+"sounds/zombie-9.ogg"];this.sounds[SOUND.LVL_UP]=[window.ResourcePath+"sounds/lvlUp.ogg",window.ResourcePath+"sounds/lvlUp.ogg"];this.sounds[SOUND.ATT_UP]=[window.ResourcePath+"sounds/att_up.ogg"];this.sounds[SOUND.BEEBEEP]=[window.ResourcePath+"sounds/beebeep.ogg"];this.sounds[SOUND.SPLASH]=[window.ResourcePath+"sounds/splash.ogg"];this.sounds[SOUND.SHIELD]=[window.ResourcePath+"sounds/shield.ogg",window.ResourcePath+"sounds/shield.ogg"];this.sounds[SOUND.SHIELD_HIT]=[window.ResourcePath+"sounds/shield_hit.ogg",window.ResourcePath+"sounds/shield_hit.ogg"];this.sounds[SOUND.WOODCRACK]=[window.ResourcePath+"sounds/woodcrack1.ogg",window.ResourcePath+"sounds/woodcrack2.ogg",window.ResourcePath+"sounds/woodcrack3.ogg"];this.sounds[SOUND.MECH_IMPACT]=[window.ResourcePath+"sounds/mech-impact-1.ogg",window.ResourcePath+"sounds/mech-impact-2.ogg"];this.sounds[SOUND.CRAWLER_IMPACT]=[window.ResourcePath+"sounds/crawler-impact.ogg",window.ResourcePath+"sounds/crawler-impact.ogg"];this.sounds[SOUND.ZOMBIE_BOSS_HIT]=[window.ResourcePath+"sounds/zombie_boss_hit.ogg",window.ResourcePath+"sounds/zombie_boss_hit.ogg"];this.sounds[SOUND.ZOMBIE_TRANSFORM]=[window.ResourcePath+"sounds/zombietransform.ogg",window.ResourcePath+"sounds/zombietransform.ogg"];this.sounds[SOUND.HUMAN_TRANSFORM]=[window.ResourcePath+"sounds/humantransform.ogg",window.ResourcePath+"sounds/humantransform.ogg"];this.sounds[SOUND.ASMD1]=[window.ResourcePath+"sounds/asmd1.ogg",window.ResourcePath+"sounds/asmd2.ogg",window.ResourcePath+"sounds/asmd1.ogg",window.ResourcePath+"sounds/asmd2.ogg"];this.sounds[SOUND.ASMD2]=[window.ResourcePath+"sounds/humantransform.ogg",window.ResourcePath+"sounds/humantransform.ogg"];this.sounds[SOUND.ASMD_RELOAD]=[window.ResourcePath+"sounds/asmd_reload.ogg"];this.sounds[SOUND.ASMD_FLY]=[window.ResourcePath+"sounds/asmd_fly.ogg",window.ResourcePath+"sounds/asmd_fly.ogg",window.ResourcePath+"sounds/asmd_fly.ogg",window.ResourcePath+"sounds/asmd_fly.ogg"];this.sounds[SOUND.ASMD_BALL_LAUNCH]=[window.ResourcePath+"sounds/asmd_2.ogg",window.ResourcePath+"sounds/asmd_2.ogg"];this.sounds[SOUND.ASMD_EXPLO_1]=[window.ResourcePath+"sounds/asmd_explo_1.ogg",window.ResourcePath+"sounds/asmd_explo_1.ogg"];this.sounds[SOUND.ASMD_EXPLO_2]=[window.ResourcePath+"sounds/asmd_explo_2.ogg",window.ResourcePath+"sounds/asmd_explo_2.ogg"];}SoundManager.prototype.loadSound=function(files){var target=[];for(var i=0;i<files.length;i++){target.push(new Audio(files[i]));}return target;};SoundManager.prototype.getVolumeModifier=function(x,y){var volume=1;var left=game.cameraX;var top=game.cameraY;var right=game.cameraX+WIDTH/FIELD_SIZE;var bottom=game.cameraY+HEIGHT/FIELD_SIZE;var distX=0;if(x<left||x>right)distX=Math.min(Math.abs(x-left),Math.abs(x-right));var distY=0;if(y<top||y>bottom)distY=Math.min(Math.abs(y-top),Math.abs(y-bottom));var dist=Math.sqrt(distX*distX+distY*distY);if(dist>0)volume=1-dist/5;volume*=Math.min(SCALE_FACTOR/15+0.6,1);return volume;};SoundManager.prototype.playSound=function(sound,x,y,volumeModifier){if(!(sound_volume>0)||!this.sounds[sound]||game.fastForward)return;var volume=typeof x!='undefined'?this.getVolumeModifier(x,y):1;volume=volumeModifier?volume*volumeModifier:volume;if(volume<=0)return;var s=this.sounds[sound];if(typeof s[0]=="string"){s=this.loadSound(s);this.sounds[sound]=s;}var readySounds=[];for(var i=0;i<s.length;i++){if(s[i].currentTime>=s[i].duration||s[i].currentTime==0||!s[i].currentTime)readySounds.push(s[i]);}if(readySounds.length==0)return;var soundToPlay=readySounds[Math.floor(Math.random()*readySounds.length)];soundToPlay.loop=false;soundToPlay.play();volume=volume*sound_volume*0.70;if(volume>1){volume=1;}else if(!volume>0){volume=0;}soundToPlay.volume=volume;return soundToPlay;};function Editor(){this.currentObj=null;this.selectedUnits=[];this.ammo=[];this.scroll=false;this.currentAddedFields=[];this.noClick=false;this.brushSize=1;if(game.map.ammo)for(var i=0;i<game.map.ammo.length;i++){this.ammo.push({weapon:game.map.ammo[i].weapon,x:game.map.ammo[i].x,y:game.map.ammo[i].y});}if(!document.getElementById("editorElementsDiv")){var div=document.createElement("div");div.id="editorElementsDiv";document.body.appendChild(div);div.setAttribute("data-noclick",'yes');div.innerHTML="<div data-noclick='yes'>Ground Textures</div><div data-noclick='yes' id='editorElementsDivGround'></div>";div.innerHTML+="<div data-noclick='yes'>Map Objects</div><div data-noclick='yes' id='editorElementsDivTiles'></div>";div.innerHTML+="<div data-noclick='yes'>Ammo</div><div data-noclick='yes' id='editorElementsDivAmmo'></div>";div.innerHTML+="<div data-noclick='yes'>Items</div><div data-noclick='yes' id='editorElementsDivItems'></div>";var editorElementsDivGround=document.getElementById("editorElementsDivGround");var editorElementsDivTiles=document.getElementById("editorElementsDivTiles");var editorElementsDivAmmo=document.getElementById("editorElementsDivAmmo");var editorElementsDivItems=document.getElementById("editorElementsDivItems");for(var i=0;i<tileTypes.length;i++){if(!tileTypes[i].noShow){var cv=getCanvasFromImgObj(tileTypes[i].img,imgs.tileSheet,58);uiManager.createButton("<img class='pixelated' src='"+cv.toDataURL()+"' />","editorButton",function(){game.editor.currentObj=tileTypes[this.name.split("_")[1]];document.getElementById('editorElementsDiv').style.display="none";},null,tileTypes[i].ground?editorElementsDivGround:editorElementsDivTiles,null,function(){uiManager.showEditorInfo(this.getAttribute('data-att1'));},uiManager.hideEditorInfo,"obj_"+i,tileTypes[i].name);}}for(var i=0;i<weapons.length;i++){if(weapons[i].clipSize){var cv=getCanvasFromImgObj(imgCoords[weapons[i].img],imgs.miscSheet,58);uiManager.createButton("<img class='pixelated' src='"+cv.toDataURL()+"' />","editorButton",function(){game.editor.currentObj=this.name;document.getElementById('editorElementsDiv').style.display="none";},null,editorElementsDivAmmo,null,function(){uiManager.showEditorInfo(this.getAttribute('data-att1'));},uiManager.hideEditorInfo,"ammo_"+i,weapons[i].name);}}for(var i=0;i<itemTypes.length;i++){var cv=getCanvasFromImgObj(itemTypes[i].img,imgs.miscSheet,58);uiManager.createButton("<img class='pixelated' src='"+cv.toDataURL()+"' />","editorButton",function(){game.editor.currentObj=this.name;document.getElementById('editorElementsDiv').style.display="none";},null,editorElementsDivItems,null,function(){uiManager.showEditorInfo(this.getAttribute('data-att1'));},uiManager.hideEditorInfo,"ammo_"+(i+1000),itemTypes[i].name);}var cv=getCanvasFromImgObj(imgCoords.spawningPoint,imgs.tileSheet,58);uiManager.createButton("<img class='pixelated' src='"+cv.toDataURL()+"' />","editorButton",function(){game.editor.currentObj="spawningPoint";document.getElementById('editorElementsDiv').style.display="none";},null,editorElementsDivItems,null,function(){uiManager.showEditorInfo(this.getAttribute('data-att1'));},uiManager.hideEditorInfo,null,"Spawning Point");cv=getCanvasFromImgObj(imgCoords.spawningPointRed,imgs.tileSheet,58);uiManager.createButton("<img class='pixelated' src='"+cv.toDataURL()+"' />","editorButton",function(){game.editor.currentObj="spawningPointRed";document.getElementById('editorElementsDiv').style.display="none";},null,editorElementsDivItems,null,function(){uiManager.showEditorInfo(this.getAttribute('data-att1'));},uiManager.hideEditorInfo,null,"Spawning Point Red");cv=getCanvasFromImgObj(imgCoords.spawningPointBlue,imgs.tileSheet,58);uiManager.createButton("<img class='pixelated' src='"+cv.toDataURL()+"' />","editorButton",function(){game.editor.currentObj="spawningPointBlue";document.getElementById('editorElementsDiv').style.display="none";},null,editorElementsDivItems,null,function(){uiManager.showEditorInfo(this.getAttribute('data-att1'));},uiManager.hideEditorInfo,null,"Spawning Point Blue");cv=getCanvasFromImgObj(imgCoords.waypoint,imgs.tileSheet,58);uiManager.createButton("<img class='pixelated' src='"+cv.toDataURL()+"' />","editorButton",function(){game.editor.currentObj="waypoint";document.getElementById('editorElementsDiv').style.display="none";},null,editorElementsDivItems,null,function(){uiManager.showEditorInfo(this.getAttribute('data-att1'));},uiManager.hideEditorInfo,null,"Waypoint (for bots)");var div2=document.createElement("div");div2.id="editorDiv2";document.body.appendChild(div2);uiManager.createButton("Select [<span class='red'>R</span>]","editorButton2",function(){game.editor.currentObj=null;soundManager.playSound(SOUND.CLICK);},null,div2);uiManager.createButton("New map","editorButton2",function(){game.editor.showNewMapWindow();},null,div2);uiManager.createButton("Map Settings","editorButton2",function(){game.editor.showMapSettingsWindow();},null,div2);uiManager.createButton("Upload map","editorButton2",function(){game.editor.uploadMap();},null,div2);uiManager.createButton("Load map","editorButton2",function(){showLoadMapWindow();},null,div2);uiManager.createButton("Objects [<span class='red'>Q</span>]","editorButton2",function(){document.getElementById("editorElementsDiv").style.display=document.getElementById("editorElementsDiv").style.display!="block"?"block":"none";},null,div2);uiManager.createButton("Save to file","editorButton2",function(){game.editor.save();},null,div2);}else{document.getElementById("editorDiv2").style.display="block";}};Editor.prototype.showNewMapWindow=function(){this.fillMapSettingsWindow(true);uiManager.createButton("create",null,game.editor.createMap,null,mapSettingsWindow,"mapSettingsCloseButton");document.getElementById("mapSettingsWindow").style.display="inline";};Editor.prototype.showMapSettingsWindow=function(){this.fillMapSettingsWindow();uiManager.createButton("save",null,game.editor.saveMapSettings,null,mapSettingsWindow,"mapSettingsCloseButton");document.getElementById("mapSettingsWindow").style.display="inline";};Editor.prototype.fillMapSettingsWindow=function(newMap){var noBorderChecked=!newMap&&game.map.noBorder?" checked='checked' ":"";var invisChecked=!newMap&&game.map.invisible?" checked='checked' ":"";var closedChecked=!newMap&&game.map.closed?" checked='checked' ":"";var str="Name <input type='text' id='mapNameInput' value='"+(newMap?"unnamed":game.map.name)+"' /><br /><textarea style='width: 350px; height: 150px;' id='mapDescriptionInput'>";str+=(newMap?"":game.map.description)+"</textarea><br />X: <input id='mapX' class='mapSizeInput' type='text' value='"+(newMap?48:game.map.x)+"' /> Y: ";str+="<input id='mapY' class='mapSizeInput' type='text' value='"+(newMap?48:game.map.y)+"' /><br /><label title='If this is checked, the map will have no wall border by default.'>";str+="No border: <input type='checkbox' "+noBorderChecked+" id='mapNoBorder' /></label><br />";str+="<label title='Invisible maps can not be seen by anyone but you. You can use this for \"work in progress\" maps for exmaple.'>Invisible: <input type='checkbox' "+invisChecked+" id='mapInvisible' /></label><br />";str+="<label title='Closed maps can not be loaded in the map editor by other players.'>Closed: <input type='checkbox' "+closedChecked+" id='mapClosed' /></label><br />";str+="Max players: <input id='mapMaxPlayers' class='mapSizeInput' type='text' value='"+(newMap||!game.map.maxPlayers?10:game.map.maxPlayers)+"' /><br />";mapSettingsWindow.innerHTML=str;var dd=document.createElement("select");dd.id="mapTypeDD";for(var i=0;i<MAP_TYPE_SETTINGS.length;i++){dd.innerHTML+="<option "+(!newMap&&game.map.type==i?" selected='selected' ":"")+">"+MAP_TYPE_SETTINGS[i].name+"</option>";}mapSettingsWindow.appendChild(dd);mapSettingsWindow.appendChild(uiManager.createCloseButton());};Editor.prototype.saveMapSettings=function(){var oldBorderState=game.map.noBorder;document.getElementById("mapSettingsWindow").style.display="none";game.map.name=document.getElementById("mapNameInput").value;game.map.description=document.getElementById("mapDescriptionInput").value;game.map.x=Math.min(Math.max(parseInt(document.getElementById("mapX").value),CONST.MIN_MAP_SIZE),CONST.MAX_MAP_SIZE);game.map.y=Math.min(Math.max(parseInt(document.getElementById("mapY").value),CONST.MIN_MAP_SIZE),CONST.MAX_MAP_SIZE);game.map.maxPlayers=Math.min(Math.max(parseInt(document.getElementById("mapMaxPlayers").value),1),24);game.map.closed=document.getElementById("mapClosed").checked;game.map.invisible=document.getElementById("mapInvisible").checked;game.map.noBorder=document.getElementById("mapNoBorder").checked;game.map.type=document.getElementById("mapTypeDD").selectedIndex;game.createGroundCanvas();game.createBlockArray();soundManager.playSound(SOUND.CLICK);if(game.map.noBorder&&!oldBorderState){for(var k=0;k<game.tiles.length;k++){if(tileIsBorder(game.tiles[k])){game.tiles.splice(k,1);k--;}}game.generateTilesCanvasses();}if(!game.map.noBorder&&oldBorderState){game.createDefaultBorder();game.generateTilesCanvasses();}};Editor.prototype.createMap=function(){document.getElementById("mapSettingsWindow").style.display="none";soundManager.playSound(SOUND.CLICK);var map={x:Math.max(parseInt(document.getElementById("mapX").value),8),y:Math.max(parseInt(document.getElementById("mapY").value),8),maxPlayers:Math.min(Math.max(parseInt(document.getElementById("mapMaxPlayers").value),1),16),closed:document.getElementById("mapClosed").checked,invisible:document.getElementById("mapInvisible").checked,name:document.getElementById("mapNameInput").value,description:document.getElementById("mapDescriptionInput").value,noBorder:document.getElementById("mapNoBorder").checked,tiles:[],defaultTiles:0,groundTiles:[],type:document.getElementById("mapTypeDD").selectedIndex};game=new Game(map,true);game.editor=new Editor();game.startEditingMode();uiManager.refreshMenuButtons();};Editor.prototype.uploadMap=function(){slayOne.viewHelpers.showFloatTip({tipType:'success',content:"Request uploading map"});var that=this;F$ajax.options("/map/"+game.map.name,function(res){if(res.status>=200&&res.status<300&&res.getResponseHeader("Allow").split(/\s*,\s*/).indexOf("PUT")>=0){slayOne.viewHelpers.showFullScreenLoading();that.uploadMap2(res.getResponseHeader("ETag"));}else{slayOne.viewHelpers.showFloatTip({tipType:'error',content:res.responseText});}});soundManager.playSound(SOUND.CLICK);};Editor.prototype.uploadMap2=function(lastVersion){slayOne.viewHelpers.showFloatTip({tipType:'success',content:"Uploading map, it will take about 10 - 20 seconds."});var headers={"Content-type":'application/json'};if(lastVersion){headers["If-Match"]=lastVersion;}F$ajax.put("/map/"+game.map.name,function(res){slayOne.viewHelpers.hideFullScreenLoading();if(res.status==204){slayOne.viewHelpers.showFloatTip({tipType:'success',content:"No change"});}else if(res.status==201){slayOne.viewHelpers.showFloatTip({tipType:'success',content:"Map uploaded"});}else{slayOne.viewHelpers.showFloatTip({tipType:'error',content:res.responseText});}},game.editor.export_(),headers);};function showLoadMapWindow(){soundManager.playSound(SOUND.CLICK);F$ajax.get("/map/",function(res){if(res.status==200){showLoadMapWindow2(JSON.parse(res.responseText));}else{slayOne.viewHelpers.showFloatTip({tipType:'error',content:res.responseText});}});};function showLoadMapWindow2(data){var div=document.getElementById("logindiv");var str="<div id='maps_inner'><table class='basicTable' style='margin-top: 20px;'>";for(var i=0;i<data.length;i++){str+="<tr><td>"+data[i].name+"</td><td><button class='withClickSound' onclick='requestMap4Editor("+data[i].id+");'>load</button></td></tr>";}div.innerHTML=str+"</div></table>";if(game&&game.editingMode)div.appendChild(uiManager.createCloseButton());else uiManager.createButton("back","backButton",function(){uiManager.showMainScene();},null,div);uiManager.createButton("Load external",null,function(){var fileInput=document.createElement("input");fileInput.type="file";fileInput.click();fileInput.onchange=function(){var file=fileInput.files[0];if(file){var reader=new FileReader();reader.readAsBinaryString(file);reader.onload=function(e){setTimeout(function(){var map=JSON.parse(e.target.result);game=new Game(map,true);game.editor=new Editor();game.startEditingMode();game.map.description=map.description;game.map.name=map.name;uiManager.refreshMenuButtons();document.getElementById("logindiv").style.display="none";},50);};}};},null,div,"loadExternalButton");div.className="basicWindow logindiv1";div.style.display="inline";};function requestMap4Editor(mapID){F$ajax.get("/map/"+mapID,function(res){if(res.status==200){map4Editor(res.responseText);}else{slayOne.viewHelpers.showFloatTip({tipType:'error',content:res.responseText});}});};function map4Editor(data){enterGame();var map=null;try{map=JSON.parse(data);}catch(e){console.log(e);return;}game=new Game(map,true);game.editor=new Editor();game.startEditingMode();uiManager.refreshMenuButtons();};function enterGame(msg){network.triggerMessage(NetworkMessages.GameEntered,msg);window.slayOne.views.homeScreen.hideWindow();F$('resourceBar').hide();document.getElementById("optionsWindow").style.display="none";uiManager.hideDeathScreen();slayOne.viewHelpers.hideAd();window.focus();};Editor.prototype.export_=function(){var map_={name:game.map.name,description:game.map.description,x:game.map.x,y:game.map.y,maxPlayers:game.map.maxPlayers,closed:game.map.closed,invisible:game.map.invisible,defaultTiles:0,tiles:[],groundTiles:[],noGridTiles:[],spawningPoints:game.spawningPoints,spawningPointsRed:game.spawningPointsRed,spawningPointsBlue:game.spawningPointsBlue,waypoints:game.waypoints,tutorialMessages:game.map.tutorialMessages,special:game.map.special,type:game.map.type,ammo:this.ammo,noBorder:game.map.noBorder};for(var i=0;i<game.groundTiles.length;i++){map_.groundTiles.push(createTileForExport(game.groundTiles[i]));}for(var i=0;i<game.tiles.length;i++){if(!tileIsBorder(game.tiles[i]))map_.tiles.push(createTileForExport(game.tiles[i]));}if(game.noGridTiles)for(var i=0;i<game.noGridTiles.length;i++){map_.noGridTiles.push(createTileForExport(game.noGridTiles[i]));}var minimap=new Minimap(game);map_.thumbnail=minimap.canvas.toDataURL('image/jpeg',0.9);return JSON.stringify(map_);};function tileIsBorder(tile){return((tile.x==-1||tile.x==game.map.x)&&tile.y>=-1&&tile.y<=game.map.y||(tile.y==-1||tile.y==game.map.y)&&tile.x>=-1&&tile.x<=game.map.x)&&tile.type.isBorder;};function createTileForExport(o){var tile={x:o.x,y:o.y,id:o.type.id};if(o.type.editable)for(var i=0;i<o.type.editable.length;i++){tile[o.type.editable[i]]=parseFloat(typeof o[o.type.editable[i]]!=="undefined"?o[o.type.editable[i]]:o.type[o.type.editable[i]]);}return tile;};Editor.prototype.save=function(){var blob=new Blob([this.export_()],{type:"text/plain;charset=utf-8"});saveAs(blob,"map.js");soundManager.playSound(SOUND.CLICK);};Editor.prototype.key=function(key,el){if(key==commandKeys[COMMAND.UP]||key==commandKeys[COMMAND.DOWN]||key==commandKeys[COMMAND.LEFT]||key==commandKeys[COMMAND.RIGHT])this.scroll=true;if(key==KEY.Q){document.getElementById("editorElementsDiv").style.display=document.getElementById("editorElementsDiv").style.display!="block"?"block":"none";soundManager.playSound(SOUND.CLICK);}if(key==KEY.R){this.currentObj=null;soundManager.playSound(SOUND.CLICK);}if(key==KEY.NUM1){this.brushSize=1;soundManager.playSound(SOUND.SWITCH,undefined,undefined,0.7);}else if(key==KEY.NUM2){this.brushSize=2;soundManager.playSound(SOUND.SWITCH,undefined,undefined,0.7);}else if(key==KEY.NUM3){this.brushSize=3;soundManager.playSound(SOUND.SWITCH,undefined,undefined,0.7);}else if(key==KEY.NUM4){this.brushSize=4;soundManager.playSound(SOUND.SWITCH,undefined,undefined,0.7);}else if(key==KEY.NUM5){this.brushSize=5;soundManager.playSound(SOUND.SWITCH,undefined,undefined,0.7);}else if(key==KEY.E){if(this.selectedUnits.length>0)soundManager.playSound(SOUND.PLACE);for(var i=0;i<this.selectedUnits.length;i++){var found=false;for(var k=0;k<game.tiles.length;k++){if(game.tiles[k]==this.selectedUnits[i]){game.tiles.splice(k,1);if(this.selectedUnits[i].type.blockVision){for(var j=0;j<game.objectsToDraw.length;j++){if(this.selectedUnits[i]==game.objectsToDraw[j].tile){game.objectsToDraw.splice(j,1);j=game.objectsToDraw.length;}}}else game.refreshBlockingTilesCanvas(this.selectedUnits[i].y+this.selectedUnits[i].type.h-1);this.selectedUnits.splice(i,1);k=game.tiles.length;i--;found=true;game.createBlockArray();}}if(!found)for(var k=0;k<game.groundTiles.length;k++){if(game.groundTiles[k]==this.selectedUnits[i]){game.groundTiles.splice(k,1);this.selectedUnits.splice(i,1);k=game.groundTiles.length;i--;game.createGroundCanvas();found=true;game.createBlockArray();}}if(!found)for(var k=0;k<game.objectsToDraw.length;k++){if(game.objectsToDraw[k]==this.selectedUnits[i]){game.noGridTiles.erease(game.objectsToDraw[k]);game.objectsToDraw.splice(k,1);this.selectedUnits.splice(i,1);k=game.objectsToDraw.length;i--;found=true;}}if(!found)for(var k=0;k<game.spawningPoints.length;k++){if(game.spawningPoints[k]==this.selectedUnits[i]){game.spawningPoints.splice(k,1);this.selectedUnits.splice(i,1);k=game.spawningPoints.length;i--;found=true;}}if(!found)for(var k=0;k<game.spawningPointsRed.length;k++){if(game.spawningPointsRed[k]==this.selectedUnits[i]){game.spawningPointsRed.splice(k,1);this.selectedUnits.splice(i,1);k=game.spawningPointsRed.length;i--;found=true;}}if(!found)for(var k=0;k<game.spawningPointsBlue.length;k++){if(game.spawningPointsBlue[k]==this.selectedUnits[i]){game.spawningPointsBlue.splice(k,1);this.selectedUnits.splice(i,1);k=game.spawningPointsBlue.length;i--;found=true;}}if(!found)for(var k=0;k<game.waypoints.length;k++){if(game.waypoints[k]==this.selectedUnits[i]){game.waypoints.splice(k,1);this.selectedUnits.splice(i,1);k=game.waypoints.length;i--;}}if(!found)for(var k=0;k<this.ammo.length;k++){if(this.ammo[k]==this.selectedUnits[i]){this.ammo.splice(k,1);this.selectedUnits.splice(i,1);k=this.ammo.length;i--;}}}}this.refreshItemInfo();};Editor.prototype.addTile=function(pos){this.currentAddedFields.push({x:pos.x,y:pos.y});if(typeof this.currentObj==='string'){if(this.currentObj=="waypoint")game.waypoints.push({x:pos.x,y:pos.y});else if(this.currentObj=="spawningPoint")game.spawningPoints.push({x:pos.x,y:pos.y});else if(this.currentObj=="spawningPointRed")game.spawningPointsRed.push({x:pos.x,y:pos.y});else if(this.currentObj=="spawningPointBlue")game.spawningPointsBlue.push({x:pos.x,y:pos.y});else if(this.currentObj.substr(0,4)=="ammo")this.ammo.push({x:pos.x,y:pos.y,weapon:parseInt(this.currentObj.split("_")[1])});}else if(this.currentObj.noGrid){var x=game.cameraX+KeyManager.x/FIELD_SIZE;var y=game.cameraY+KeyManager.y/FIELD_SIZE;new Tile(x,y,this.currentObj);}else if(this.currentObj.ground){for(var x=-this.brushSize+1;x<this.brushSize;x++){for(var y=-this.brushSize+1;y<this.brushSize;y++){if(true){var obj=this.currentObj.collection?tileTypes[this.currentObj.id+this.currentObj.collection[Math.floor(Math.random()*this.currentObj.collection.length)]]:this.currentObj;if(!obj.isNotFull)for(var i=0;i<game.groundTiles.length;i++){if(game.groundTiles[i].x==pos.x+x&&game.groundTiles[i].y==pos.y+y){game.groundTiles.splice(i,1);i--;}}game.groundTiles.push(createTile({x:pos.x+x,y:pos.y+y,id:obj.id}));}}}game.createGroundCanvas();game.createBlockArray();}else{var obj=this.currentObj.collection?tileTypes[this.currentObj.id+this.currentObj.collection[Math.floor(Math.random()*this.currentObj.collection.length)]]:this.currentObj;game.tiles.push(createTile({x:pos.x,y:pos.y,id:obj.id}));if(obj.blockVision)game.createVisionTile(game.tiles[game.tiles.length-1]);else game.refreshBlockingTilesCanvas(pos.y+obj.h-1);game.createBlockArray();}soundManager.playSound(SOUND.PLACE);};Editor.prototype.mouseMove=function(){if(this.noClick)return;if(this.currentObj){var pos=this.getObjPosFromMousePos();for(var i=0;i<this.currentAddedFields.length;i++){if(Math.floor(pos.x)==this.currentAddedFields[i].x&&Math.floor(pos.y)==this.currentAddedFields[i].y)return;}this.addTile(pos);}};Editor.prototype.click=function(){this.currentAddedFields=[];var pos=this.getObjPosFromMousePos();if(this.currentObj)this.addTile(pos);else{var selectedUnits=[];for(var i=0;i<game.noGridTiles.length;i++){var t=game.noGridTiles[i];var x=game.cameraX+KeyManager.x/FIELD_SIZE;var y=game.cameraY+KeyManager.y/FIELD_SIZE;if(t.isTile&&t.x-0.5*t.img.w/16<=x&&t.x+0.5*t.img.w/16>=x&&t.y-0.5*t.img.h/16<=y&&t.y+0.5*t.img.h/16>=y){selectedUnits.push(t);i=game.noGridTiles.length;}}for(var i=0;i<game.tiles.length;i++){if(game.tiles[i].x==pos.x&&game.tiles[i].y==pos.y)selectedUnits.push(game.tiles[i]);}if(selectedUnits.length==0)for(var i=0;i<this.ammo.length;i++){if(this.ammo[i].x==pos.x&&this.ammo[i].y==pos.y)selectedUnits.push(this.ammo[i]);}if(selectedUnits.length==0)for(var i=0;i<game.waypoints.length;i++){if(game.waypoints[i].x==pos.x&&game.waypoints[i].y==pos.y)selectedUnits.push(game.waypoints[i]);}if(selectedUnits.length==0)for(var i=0;i<game.spawningPoints.length;i++){if(game.spawningPoints[i].x==pos.x&&game.spawningPoints[i].y==pos.y)selectedUnits.push(game.spawningPoints[i]);}if(selectedUnits.length==0)for(var i=0;i<game.spawningPointsRed.length;i++){if(game.spawningPointsRed[i].x==pos.x&&game.spawningPointsRed[i].y==pos.y)selectedUnits.push(game.spawningPointsRed[i]);}if(selectedUnits.length==0)for(var i=0;i<game.spawningPointsBlue.length;i++){if(game.spawningPointsBlue[i].x==pos.x&&game.spawningPointsBlue[i].y==pos.y)selectedUnits.push(game.spawningPointsBlue[i]);}if(selectedUnits.length==0)for(var i=0;i<game.groundTiles.length;i++){if(game.groundTiles[i].x==pos.x&&game.groundTiles[i].y==pos.y)selectedUnits.push(game.groundTiles[i]);}if(selectedUnits.length>0)this.selectedUnits=selectedUnits;}this.refreshItemInfo();};Editor.prototype.refreshItemInfo=function(){if(this.selectedUnits.length<=0){document.getElementById("editorItemInfo").style.display="none";return;}var o=this.selectedUnits[0];var t=o.type;var str="<div>"+t.name+"</div>";str+="<div>X: "+o.x+", Y: "+o.y+"</div>";if(t.editable)for(var i=0;i<t.editable.length;i++){str+="<div>"+t.editableCaption[i]+": <input id='editorInput"+i+"' name='"+t.editable[i]+"' oninput='game.editor.setAttribute();' class='mapSizeInput' type='text' value='"+o[t.editable[i]]+"' /></div>";}document.getElementById("editorItemInfo").style.display="block";document.getElementById("editorItemInfo").innerHTML=str;};Editor.prototype.setAttribute=function(){var i=0;while(document.getElementById("editorInput"+i)){var el=document.getElementById("editorInput"+i);this.selectedUnits[0][el.name]=el.value;i++;}};Editor.prototype.getObjPosFromMousePos=function(){if(this.currentObj&&this.currentObj.noGrid)return{x:game.cameraX+KeyManager.x/FIELD_SIZE,y:game.cameraY+KeyManager.y/FIELD_SIZE};return{x:Math.floor(game.cameraX+KeyManager.x/FIELD_SIZE),y:Math.floor(game.cameraY+KeyManager.y/FIELD_SIZE)};};Editor.prototype.draw=function(){if(this.scroll){if(KeyManager.keys[commandKeys[COMMAND.UP]])game.cameraY-=timeDiff*0.019;if(KeyManager.keys[commandKeys[COMMAND.DOWN]])game.cameraY+=timeDiff*0.019;if(KeyManager.keys[commandKeys[COMMAND.LEFT]])game.cameraX-=timeDiff*0.019;if(KeyManager.keys[commandKeys[COMMAND.RIGHT]])game.cameraX+=timeDiff*0.019;}if(this.currentObj){if(typeof this.currentObj!=='string'){var obj=this.currentObj;var size=obj.ground?this.brushSize:1;var img=imgCoords[obj.img]?imgCoords[obj.img]:obj.img;var coords=this.getObjPosFromMousePos();for(var x=-size+1;x<size;x++){for(var y=-size+1;y<size;y++){var x_=0;var y_=0;if(obj.noGrid){x_=(coords.x+x-game.cameraX)*FIELD_SIZE-obj.img.w*0.5*SCALE_FACTOR;y_=(coords.y+y-game.cameraY)*FIELD_SIZE-obj.img.h*0.5*SCALE_FACTOR;}else{x_=(Math.floor(coords.x)+x-game.cameraX)*FIELD_SIZE+(obj.w*8-img.w/2)*SCALE_FACTOR;y_=(Math.floor(coords.y)+y-game.cameraY)*FIELD_SIZE+(obj.h*16+(this.currentObj.ground?0:4)-img.h)*SCALE_FACTOR;}c.globalAlpha=0.5;c.drawImage(imgs.tileSheet,img.x,img.y,img.w,img.h,x_,y_,img.w*SCALE_FACTOR,img.h*SCALE_FACTOR);c.globalAlpha=1;}}}}else{for(var i=0;i<this.selectedUnits.length;i++){var u=this.selectedUnits[i];var ut=u.type;var x=ut&&ut.noGrid?u.x-ut.img.w/16/2:u.x;var y=ut&&ut.noGrid?u.y-ut.img.h/16/2:u.y;var w=ut&&ut.noGrid?ut.img.w/16:ut?ut.w:1;var h=ut&&ut.noGrid?ut.img.h/16:ut?ut.h:1;c.strokeStyle="rgba(190, 190, 230, 0.75)";c.lineWidth=SCALE_FACTOR;c.strokeRect((x-game.cameraX)*FIELD_SIZE,(y-game.cameraY)*FIELD_SIZE,FIELD_SIZE*w,FIELD_SIZE*h);}}if(!KeyManager.keys[KEY.ALT]){c.fillStyle="rgba(130, 100, 100, 0.45)";for(var x=Math.floor(game.cameraX);x<=game.cameraX2;x++){for(var y=Math.floor(game.cameraY);y<=game.cameraY2;y++){if(game.getFieldPath(x,y)<10)c.fillRect((x-game.cameraX)*FIELD_SIZE,(y-game.cameraY)*FIELD_SIZE,FIELD_SIZE,FIELD_SIZE);}}for(var i=0;i<game.spawningPoints.length;i++){var obj=imgCoords.spawningPoint;var x=(game.spawningPoints[i].x-game.cameraX)*FIELD_SIZE+(8-obj.w/2)*SCALE_FACTOR;var y=(game.spawningPoints[i].y-game.cameraY)*FIELD_SIZE+(16-obj.h)*SCALE_FACTOR;c.drawImage(imgs.tileSheet,obj.x,obj.y,obj.w,obj.h,x,y,obj.w*SCALE_FACTOR,obj.h*SCALE_FACTOR);}for(var i=0;i<game.spawningPointsRed.length;i++){var obj=imgCoords.spawningPointRed;var x=(game.spawningPointsRed[i].x-game.cameraX)*FIELD_SIZE+(8-obj.w/2)*SCALE_FACTOR;var y=(game.spawningPointsRed[i].y-game.cameraY)*FIELD_SIZE+(16-obj.h)*SCALE_FACTOR;c.drawImage(imgs.tileSheet,obj.x,obj.y,obj.w,obj.h,x,y,obj.w*SCALE_FACTOR,obj.h*SCALE_FACTOR);}for(var i=0;i<game.spawningPointsBlue.length;i++){var obj=imgCoords.spawningPointBlue;var x=(game.spawningPointsBlue[i].x-game.cameraX)*FIELD_SIZE+(8-obj.w/2)*SCALE_FACTOR;var y=(game.spawningPointsBlue[i].y-game.cameraY)*FIELD_SIZE+(16-obj.h)*SCALE_FACTOR;c.drawImage(imgs.tileSheet,obj.x,obj.y,obj.w,obj.h,x,y,obj.w*SCALE_FACTOR,obj.h*SCALE_FACTOR);}for(var i=0;i<game.waypoints.length;i++){var p=game.waypoints[i];var obj=imgCoords.waypoint;var x=(p.x-game.cameraX)*FIELD_SIZE+(8-obj.w/2)*SCALE_FACTOR;var y=(p.y-game.cameraY)*FIELD_SIZE+(16-obj.h)*SCALE_FACTOR;c.drawImage(imgs.tileSheet,obj.x,obj.y,obj.w,obj.h,x,y,obj.w*SCALE_FACTOR,obj.h*SCALE_FACTOR);}}for(var i=0;i<this.ammo.length;i++){var a=this.ammo[i];var img=weapons[a.weapon]?imgCoords[weapons[a.weapon].img]:imgCoords[itemTypes[a.weapon-1000].img];var scale=weapons[a.weapon]?SCALE_FACTOR*0.6:SCALE_FACTOR;var x=(a.x-game.cameraX)*FIELD_SIZE+(8-img.w/2)*scale;var y=(a.y-game.cameraY)*FIELD_SIZE+(16-img.h)*scale;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x,y,img.w*scale,img.h*scale);}};(function(window,slayOne,document){var viewKey="optionsScreen";function renderVolumeSelector_(parentNode,viewModel){var domWrapper=document.createElement('div');viewModel.rsVolume=slayOne.widgets.rangeSelection(domWrapper,{min:0,max:1,step:0.01,value:window.sound_volume,customClassName:"clickableDuringGame",onChange:function onChange(val){window.sound_volume=parseFloat(val);window.localStorage.setItem("sound_volume",window.sound_volume);}});parentNode.appendChild(slayOne.widgets.topLabelled({customClassName:"optionsRangeField",label:slayOne.widgets.lang.get("options.volume.label"),content:domWrapper}));}function renderMinimapSizeSelector_(parentNode,viewModel){var domWrapper=document.createElement('div');viewModel.rsMinimapSize=slayOne.widgets.rangeSelection(domWrapper,{min:0.5,max:2,step:0.01,value:window.minimapSizeFactor,customClassName:"clickableDuringGame",onChange:function onChange(val){window.minimapSizeFactor=parseFloat(val);window.localStorage.setItem("minimapSizeFactor",window.minimapSizeFactor);}});parentNode.appendChild(slayOne.widgets.topLabelled({customClassName:"optionsRangeField",label:slayOne.widgets.lang.get("options.minimap_size.label"),content:domWrapper}));}function renderGraphicsEffectCheckbox_(parentNode,viewModel){viewModel.cbFX=slayOne.widgets.checkbox(parentNode,{selected:window.graphicSettings==0,label:slayOne.widgets.lang.get("options.graphic.label"),labelClassName:"",tipAlign:"center",tipMultiline:true,tipWidth:"350px",customClassName:"optionsCheckbox",onChange:function onChange(selected){window.graphicSettings=selected?0:10;window.localStorage.setItem("graphicSettings",window.graphicSettings);if(game){game.isLowGraphicEffect=selected;}}});}function renderWeaponsUnclickableCheckbox_(parentNode,viewModel){viewModel.cbFX=slayOne.widgets.checkbox(parentNode,{selected:window.weaponsUnclickable,label:slayOne.widgets.lang.get("options.weaponsUnclickable.label"),labelClassName:"",tipAlign:"center",tipMultiline:true,tipWidth:"350px",customClassName:"optionsCheckbox",onChange:function onChange(selected){window.weaponsUnclickable=selected;window.localStorage.setItem("weaponsUnclickable",selected|0);}});}function renderForcePlayerNameColor_(parentNode,viewModel){viewModel.cbFX=slayOne.widgets.checkbox(parentNode,{selected:window.forcePlayerNameColor,label:slayOne.widgets.lang.get("options.forcePlayerNameColor.label"),labelClassName:"",tipAlign:"left",tipMultiline:true,tipWidth:"350px",customClassName:"optionsCheckboxExt",onChange:function onChange(selected){window.forcePlayerNameColor=selected;window.localStorage.setItem("forcePlayerNameColor",selected|0);}});}function renderInGameChatCheckbox_(parentNode,viewModel){viewModel.cbHideChats=slayOne.widgets.checkbox(parentNode,{selected:window.localStorage.getItem("hideChat")=="true",label:slayOne.widgets.lang.get("options.hide_chat.label"),labelClassName:"",customClassName:"optionsCheckbox",onChange:function onChange(selected){window.localStorage.setItem("hideChat",selected);document.getElementById("chatDisplayDiv").style.display=selected?"none":"block";}});}function renderDropLists_(parentNode,viewModel){renderLanguageSwitch_(parentNode,viewModel);renderServerSwitch_(parentNode,viewModel);}function renderLanguageSwitch_(parentNode,viewModel){var domWrapper=document.createElement('div');domWrapper.className="optionsDDLContainer";var initIndex=0;var languageOptions=[];for(var languageKey in slayOne.widgets.lang.supportedLocales){if(slayOne.widgets.lang.locale==languageKey){initIndex=languageOptions.length;}languageOptions.push({label:slayOne.widgets.lang.supportedLocales[languageKey],value:languageKey});}viewModel.ddlLanguage=slayOne.widgets.dropdownMenu(domWrapper,{customClassName:"optionsDdl",customButtonClassName:"optionsDdlBtn",customButtonWidth:"242px",selectOptions:languageOptions,initIndex:initIndex,onSwitch:function onSwitch(languageOption){if(isInGame()){slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("options.msg.operation_forbidden")});viewModel.ddlLanguage.selectOption(initIndex);return;}var promptWnd=slayOne.viewHelpers.showPrompt({title:slayOne.widgets.lang.get("options.language.prompt.title"),content:slayOne.widgets.lang.get("options.language.prompt.content"),buttons:['cancel','ok'],onClick:function onClick(btnName){if(btnName=='ok'){slayOne.widgets.lang.setPreferredLocale(languageOption.value);slayOne.viewHelpers.showFullScreenLoading();setTimeout(function(){window.location.reload();},250);}else if(btnName=='cancel'){viewModel.ddlLanguage.selectOption(initIndex);}promptWnd.close();}});}});parentNode.appendChild(slayOne.widgets.topLabelled({label:slayOne.widgets.lang.get("options.language.label"),content:domWrapper}));}function renderEmptyCell_(parentNode){parentNode.style.width="283px";}function renderServerSwitch_(parentNode,viewModel){var domWrapper=document.createElement('div');domWrapper.className="optionsDDLContainer";var serverOptions=[];var initIndex=0;for(var index in SERVER_INFOS){var sInfo=SERVER_INFOS[index];serverOptions.push({label:sInfo.name,value:index});if(network.connectedServerIndex==index){initIndex=serverOptions.length-1;}}viewModel.ddlServer=slayOne.widgets.dropdownMenu(domWrapper,{customClassName:"optionsDdl",customButtonClassName:"optionsDdlBtn",customButtonWidth:"242px",selectOptions:serverOptions,initIndex:initIndex,onSwitch:function onSwitch(serverOption){if(isInGame()){slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("options.msg.operation_forbidden")});viewModel.ddlServer.selectOption(initIndex);return;}var promptWnd=slayOne.viewHelpers.showPrompt({title:slayOne.widgets.lang.get("options.server.prompt.title"),content:slayOne.widgets.lang.get("options.server.prompt.content"),buttons:['cancel','ok'],onClick:function onClick(btnName){if(btnName=='ok'){window.localStorage.setItem("chooseServerOnStart",serverOption.value);slayOne.viewHelpers.showFullScreenLoading();setTimeout(function(){window.location.reload();},250);}else if(btnName=='cancel'){viewModel.ddlServer.selectOption(initIndex);}promptWnd.close();}});}});parentNode.appendChild(slayOne.widgets.topLabelled({label:slayOne.widgets.lang.get("options.server.label"),content:domWrapper}));}function renderButtons_(parentNode,viewModel){viewModel.btnCtrls=slayOne.widgets.labelButton(parentNode,{label:slayOne.widgets.lang.get("options.btn_ctrl.label"),tipAlign:"left",theme:"HugeNormal",customClassName:"",onClick:function onClick(){slayOne.views.hotkeyScreen.showWindow({});}});viewModel.btnLoadReplay=slayOne.widgets.labelButton(parentNode,{label:slayOne.widgets.lang.get("options.btn_replay.label"),tipAlign:"left",theme:"HugeNormal",customClassName:"",onClick:function onClick(){if(isInGame()){slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("options.msg.operation_forbidden")});return;}loadReplay();}});viewModel.btnFullScreen=slayOne.widgets.labelButton(parentNode,{label:slayOne.widgets.lang.get("options.btn_fullscreen.label")+"[F8]",tipAlign:"left",theme:"HugeNormal",customClassName:"",onClick:function onClick(){toggleFullscreen(document.documentElement);}});if(loginData&&!loginData.steam_bind){viewModel.btnSteamBind=slayOne.widgets.labelButton(parentNode,{label:slayOne.widgets.lang.get('options.btn_binding.label'),tipAlign:"left",theme:"HugeNormal",customClassName:"",onClick:function onClick(){if(isSteam){steamTrans();}else{F$('steamBindEnd').show();}}});}}function showWindow(options){Skin.close();var domContent=document.createElement('div');domContent.className="optionsView";var viewModel={rsVolume:null,rsMinimapSize:null,cbFX:null,cbHideChats:null,btnCtrls:null,btnLoadReplay:null,btnFullScreen:null,btnSteamBind:null,ddlLanguage:null,ddlServer:null};var aRows=[[{renderMethod:renderVolumeSelector_},{renderMethod:renderMinimapSizeSelector_}],[{renderMethod:renderGraphicsEffectCheckbox_},{renderMethod:renderInGameChatCheckbox_}],[{renderMethod:renderWeaponsUnclickableCheckbox_},{renderMethod:renderEmptyCell_}],[{renderMethod:renderForcePlayerNameColor_}],[{renderMethod:renderDropLists_},{renderMethod:renderButtons_}]];for(var i=0;i<aRows.length;i++){var aCells=aRows[i];var domTable=document.createElement("div");var domRow=document.createElement("div");domTable.className="mainLayoutTable";domRow.style.display="table-row";domTable.style.marginBottom="10px";for(var j=0;j<aCells.length;j++){var layoutCell=aCells[j];var domCell=document.createElement("div");var renderMethod=layoutCell.renderMethod?layoutCell.renderMethod.bind(this):null;domCell.className="mainLayoutCell";domRow.appendChild(domCell);renderMethod(domCell,viewModel);}domTable.appendChild(domRow);domContent.appendChild(domTable);}slayOne.viewHelpers.showPopup(viewKey,{theme:'standard',title:slayOne.widgets.lang.get("options.title"),content:domContent,onClose:options.onClose});}function hideWindow(){slayOne.viewHelpers.hidePopup(viewKey);}slayOne.views[viewKey]={showWindow:showWindow,hideWindow:hideWindow};})(window,window.slayOne,window.document);(function(window,slayOne,document){var viewKey="homeScreen";var domMain=document.getElementById("homeUI");var domMainContent=document.getElementById("homeUIContent");var domAbilities=null;function renderButtonChangeSkins_(parentNode,viewModel){var uiManager=window.uiManager;var button=document.createElement("button");button.onclick=function(){Skin.show();};button.id="button_change_skins";button.className="hatButton standardWell pixelated";button.style.position="relative";var canvas=document.createElement("canvas");canvas.style.width='100%';canvas.style.height='100%';button.appendChild(canvas);parentNode.appendChild(button);slayOne.widgets.hoverLight(button,{width:'120px',height:'118px',left:'-6px',top:'-6px'});slayOne.widgets.tooltip(button,{tip:F_('home.buttons.slayer.tooltip'),align:"center"});slayOne.widgets.clickable(button);window.uiManager.canvasChangeSkinsButton=canvas;return button;}function renderButtonAbilities_(parentNode,viewModel){var imgs=window.imgs;var imgCoords=window.imgCoords;var pl_abilities=window.pl_abilities;var abilities=window.abilities;var button=document.createElement("button");domAbilities=button;button.onclick=function(){Skin.show();};button.id="ability_button_main";button.className="standardWell pixelated";button.style.position="relative";if(!pl_abilities){return;}button.refreshView=Skin.refreshAbilitiesButton;button.refreshView(button);parentNode.appendChild(button);}var cachedSocialButtons=null;function collectSocialButtons(){cachedSocialButtons.container.removeChild(cachedSocialButtons.yt);cachedSocialButtons.container.removeChild(cachedSocialButtons.fb);cachedSocialButtons.container.removeChild(cachedSocialButtons.twttr);cachedSocialButtons.container.removeChild(cachedSocialButtons.rd);cachedSocialButtons.container.removeChild(cachedSocialButtons.fbw);cachedSocialButtons.container=null;}function renderSocialButton_(buttonClassName,openURL,tipLabel){var domButton=document.createElement("div");domButton.className="socialMediaBtn "+buttonClassName;domButton.onclick=function(){window.open(openURL,"_blank");};slayOne.widgets.hoverLight(domButton,{width:"46px",height:"50px"});if(tipLabel&&tipLabel.length>0){slayOne.widgets.tooltip(domButton,{tip:slayOne.widgets.lang.get(tipLabel),align:"center"});}slayOne.widgets.clickable(domButton);return domButton;}function renderSocialMedia_(parentNode,viewModel){var domContainer=document.createElement("div");domContainer.className="socialMediaContainer";var domYouTube;var domFacebookPage;var domTwitter;var domReddit;var domFacebookWidget;if(cachedSocialButtons){domYouTube=cachedSocialButtons.yt;domFacebookPage=cachedSocialButtons.fb;domTwitter=cachedSocialButtons.twttr;domReddit=cachedSocialButtons.rd;domFacebookWidget=cachedSocialButtons.fbw;}else{cachedSocialButtons={};cachedSocialButtons.yt=domYouTube=renderSocialButton_("socialMediaYt","https://www.youtube.com/channel/UCvfm6BNJ8tLJy2lZkaZTAFg?sub_confirmation=1",'home.buttons.social.youtube.tooltip');cachedSocialButtons.fb=domFacebookPage=renderSocialButton_("socialMediaFb","https://www.facebook.com/slay.one.game/","home.buttons.social.facebook.tooltip");cachedSocialButtons.twttr=domTwitter=renderSocialButton_("socialMediaTw","https://twitter.com/slayoneofficial","home.buttons.social.twitter.tooltip");cachedSocialButtons.rd=domReddit=renderSocialButton_("socialMediaRd","https://www.reddit.com/r/slayone","home.buttons.social.reddit.tooltip");domFacebookWidget=document.createElement("div");domFacebookWidget.innerHTML='<div class="fb-like" data-href="https://www.facebook.com/slay.one.game/" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="true"></div>';cachedSocialButtons.fbw=domFacebookWidget;}cachedSocialButtons.container=domContainer;domContainer.appendChild(domFacebookPage);domContainer.appendChild(domYouTube);domContainer.appendChild(domReddit);domContainer.appendChild(domTwitter);domContainer.appendChild(domFacebookWidget);if(!domFacebookWidget.widgetInited&&window.FB){domFacebookWidget.widgetInited=true;try{window.FB.XFBML.parse(domFacebookWidget);}catch(e){}}parentNode.appendChild(domContainer);}function toggleAbilitiesMenu(viewModel){if(viewModel.authLevel>=AUTH_LEVEL.PLAYER){var el=document.getElementById("optionsWindow");el.className="optionsWindow2 basicWindow";el.style.display=el.style.display!="inline"||el.getAttribute("data-windowtype")!="abilities"?"inline":"none";window.uiManager.showAbilities();}else{showNeedsLoginWindow(viewModel);}};function toggleHatsMenu(viewModel){if(viewModel.authLevel>=AUTH_LEVEL.PLAYER){uiManager.showHatsMenu();}else{showNeedsLoginWindow(viewModel);}};function showNeedsLoginWindow(viewModel){slayOne.views.needsLoginScreen.render(viewModel);}var levelBar;function renderLevelInfo_(parentNode,viewModel){levelBar=document.createElement("div");levelBar.className="levelInfo";parentNode.appendChild(levelBar);refreshExp();}function refreshExp(){pl_lvl=getLvlFromXp(pl_xp);var xp1=pl_xp-getTotalXPRequiredForLvl(pl_lvl);var xp2=getXPRequiredForLvl(pl_lvl+1);var perc=Math.floor(xp1*100/xp2);levelBar.innerHTML='<div class="levelHeader">Level '+pl_lvl+'</div>'+'<div class="levelProgressBar"><div class="progressIndicator" style="width: '+perc+'%;"></div></div>'+'<div class="standardTooltip">EXP: '+xp1+' / '+xp2+'<br /><br />'+F_('home.tooltip.exp')+'</div>';}function renderWelcomeMessage_(parentNode,viewModel){var domWelcomeMsg=document.createElement('div');domWelcomeMsg.className="homeWelcomeMsgWrapper";var str="";str+='<div class="msgHead">'+slayOne.widgets.lang.get("home.welcome.prefix")+'</div>';domWelcomeMsg.innerHTML=str;parentNode.appendChild(domWelcomeMsg);var domWelcomeBody=document.createElement('div');domWelcomeBody.className="msgBody";domWelcomeMsg.appendChild(domWelcomeBody);refreshWelcomeMessage(domWelcomeBody);}function refreshWelcomeMessage(parentNode){var domMsgBody=parentNode?parentNode:document.querySelector(".homeWelcomeMsgWrapper .msgBody");if(!domMsgBody){return;}domMsgBody.innerHTML="";generatePlayerProfileBody(domMsgBody);}function generatePlayerProfileBody(parentNode){var domPlayerContent=document.createElement('div');var str="";if(pl_clan_tag&&pl_clan_tag.length>0){str+="[<span class='pseudoLink withClickSound' onclick='uiManager.requestMyClanInfo();' style='color: "+NameColor.getColor()+"'>"+pl_clan_tag+"</span>] ";}str+="<span class='nick pseudoLink withClickSound' onclick='uiManager.showPlayerInfoById(\""+db_id+"\");' style='color: "+NameColor.getColor()+"'>"+escapeHtml(networkPlayerName)+"</span>";domPlayerContent.innerHTML=str;parentNode.appendChild(domPlayerContent);}function renderNickNameTextInput_(parentNode,viewModel){slayOne.widgets.standardTextInput(parentNode,{size:10,placeholder:slayOne.widgets.lang.get("home.input.nickname.placeholder"),cssId:"inputNickname",skin:"shadowed"});}function renderBottomButtons_(parentNode,viewModel){var prevNode=parentNode.querySelector("#homeBottomButtons");if(prevNode!=null){parentNode.removeChild(prevNode);}var domContainer=document.createElement("div");domContainer.id="homeBottomButtons";var divPlay=document.createElement("div");divPlay.className="homeBottomButton";var buttonPlay=slayOne.widgets.labelButton(divPlay,{label:slayOne.widgets.lang.get("home.buttons.play.label"),theme:"StandardYellow",tip:slayOne.widgets.lang.get('home.buttons.play.tooltip'),onClick:function onClick(){gaEventOnce('player-click-play-button');var inputNickname=document.getElementById("inputNickname");var nickname="";if(inputNickname){nickname=trim(inputNickname.value).replace(/ /g,'_');inputNickname.value=nickname;}F$('newGame').show(nickname);}});domContainer.appendChild(divPlay);if(viewModel.authLevel>=AUTH_LEVEL.PLAYER){domContainer.addClass("loggedIn");var divListRooms=document.createElement("div");divListRooms.className="homeBottomButton buttonLobby";var buttonListRooms=slayOne.widgets.labelButton(divListRooms,{label:slayOne.widgets.lang.get('home.buttons.lobby.label'),theme:"StandardGreen",tip:slayOne.widgets.lang.get('home.buttons.lobby.tooltip'),tipAlign:"center",onClick:function onClick(){uiManager.showLobby();}});domContainer.appendChild(divListRooms);var divLogOut=document.createElement("div");divLogOut.className="homeBottomButton";if(FacebookUtils.embeddedInCanvas){slayOne.widgets.labelButton(divLogOut,{label:slayOne.widgets.lang.get('home.buttons.guide.label'),tip:slayOne.widgets.lang.get('top.buttons.faq_small.tooltip'),tipAlign:"right",theme:"StandardGreen",onClick:showTutorialWindow_});}else{slayOne.widgets.labelButton(divLogOut,{label:slayOne.widgets.lang.get('home.buttons.logout.label'),tip:slayOne.widgets.lang.get('home.buttons.logout.tooltip'),tipAlign:"right",theme:"StandardGreen",onClick:logout});}domContainer.appendChild(divLogOut);}else{domContainer.removeClass("loggedIn");var divLogin=document.createElement("div");divLogin.className="homeBottomButton";var buttonLogin=slayOne.widgets.labelButton(divLogin,{label:slayOne.widgets.lang.get('home.buttons.login.label'),tip:slayOne.widgets.lang.get('home.buttons.login.tooltip'),tipAlign:"center",theme:"StandardGreen",onClick:function onClick(){hideWindow();window.uiManager.showLogin();}});domContainer.appendChild(divLogin);var divSignup=document.createElement("div");divSignup.className="homeBottomButton";var buttonSignup=slayOne.widgets.labelButton(divSignup,{label:slayOne.widgets.lang.get('home.buttons.signup.label'),tip:slayOne.widgets.lang.get('home.buttons.signup.tooltip'),tipAlign:"right",theme:"StandardGreen",onClick:function onClick(){hideWindow();window.uiManager.showRegister();}});domContainer.appendChild(divSignup);}parentNode.appendChild(domContainer);}function hideWindow(forever){window.hideHomeWindowForever=!!forever;window.showHomeWindow=false;domMain.style.display="none";}function showWindow(){window.showHomeWindow=!window.hideHomeWindowForever;}function refreshAbilitiesPanel(){domAbilities.refreshView();}function render(viewModel){if(domMainContent.innerHTML&&domMainContent.innerHTML.length>0){collectSocialButtons();}domMainContent.innerHTML="";var homeModel={authLevel:viewModel.authLevel};var aRows=[[{renderMethod:renderButtonChangeSkins_},{renderMethod:renderButtonAbilities_},{renderMethod:renderSocialMedia_}],[{renderMethod:homeModel.authLevel>=AUTH_LEVEL.PLAYER?renderWelcomeMessage_:renderNickNameTextInput_},{renderMethod:renderLevelInfo_}]];for(var i=0;i<aRows.length;i++){var aCells=aRows[i],domTable=document.createElement("div"),domRow=document.createElement("div");if(i==0){domTable.className="mainLayoutTable";}else{domTable.className="profile";}domRow.style.display="table-row";for(var j=0;j<aCells.length;j++){var layoutCell=aCells[j],domCell=document.createElement("div"),renderMethod=layoutCell.renderMethod?layoutCell.renderMethod.bind(this):null;domCell.className="mainLayoutCell";renderMethod(domCell,homeModel);domRow.appendChild(domCell);}domTable.appendChild(domRow);domMainContent.appendChild(domTable);}renderBottomButtons_(domMain,homeModel);showWindow();}setInterval(function(){if(window.showHomeWindow&&!window.isPlayingGame){if(domMain.style.display=="none"||!domMain.style.display){domMain.style.display="block";}}else{if(domMain.style.display=="block"){domMain.style.display="none";}}},50);slayOne.views[viewKey]={render:render,showWindow:showWindow,hideWindow:hideWindow,refreshAbilitiesPanel:refreshAbilitiesPanel,refreshWelcomeMessage:refreshWelcomeMessage,refreshExp:refreshExp};})(window,window.slayOne,window.document);(function(slayOne,document){var domMain=document.getElementById("mainUI"),cellTypeToClass={label:"labelCell"},cellTypeToMethod={activeButton:renderButton_};function renderLayoutGrid_(parentNode,options){var domGrid=document.createElement("div"),layoutRows=options.layoutRows,beforeAddCell=options.beforeAddCell;domGrid.className="mainLayoutTable";for(var i=0;i<layoutRows.length;i++){var layoutCells=layoutRows[i],domRow=document.createElement("div");domRow.className="layoutRow";for(var j=0;j<layoutCells.length;j++){var cellSettings=layoutCells[j],domCell=document.createElement("div"),cellContent=cellSettings.cellContent,cellType=cellSettings.cellType;domCell.className="mainLayoutCell";if(cellTypeToClass[cellType]){domCell.className+=" "+cellTypeToClass[cellType];}if(cellTypeToMethod[cellType]){cellTypeToMethod[cellType](domCell,cellSettings);}if(beforeAddCell){beforeAddCell(cellSettings,domCell);}if(cellContent){if(typeof cellContent==="string"){domCell.innerHTML=cellContent;}else{domCell.appendChild(cellContent);}}domRow.appendChild(domCell);}domGrid.appendChild(domRow);}parentNode.appendChild(domGrid);}function renderButton_(parentNode,cellSettings){var button=document.createElement("div"),cellType=cellSettings.cellType;button.innerHTML=cellSettings.buttonLabel;if(cellType==="activeButton"){button.className="buttonActive";}parentNode.appendChild(button);}function renderHeaderLabel_(parentNode,viewSettings){var domContainer=document.createElement("div"),imgLabel=document.createElement("img"),imgName=viewSettings.labelImage,layoutCells=[{cellKey:"borderLeft",cssClass:"regularHeaderLabelLeft"},{cellKey:"label",cssClass:"regularHeaderLabelLeftCenter"},{cellKey:"borderRight",cssClass:"regularHeaderLabelRight"}],oCellByKey={};domContainer.className="regularHeaderLabelContainer";for(var i=0;i<layoutCells.length;i++){var layoutCell=layoutCells[i],domCell=document.createElement("div");domCell.className=layoutCell.cssClass;domContainer.appendChild(domCell);oCellByKey[layoutCell.cellKey]=domCell;}if(imgName){imgLabel.src=ResourcePath+"imgs/main_ui/"+imgName+".png";imgLabel.className="headerLabelImage";}if(viewSettings.headerLabel){oCellByKey.label.innerHTML=viewSettings.headerLabel;}else{oCellByKey.label.appendChild(imgLabel);}parentNode.appendChild(domContainer);}function renderHeader_(parentNode,viewSettings){var domHeader=document.createElement("div"),buttonClose=document.createElement("button"),layoutCells=[{cellKey:"topLeft",cssClass:"regularViewTopLeft"},{cellKey:"topMiddle",cssClass:"regularViewTopCenter"},{cellKey:"topRight",cssClass:"regularViewTopRight"}],oCellByKey={};for(var i=0;i<layoutCells.length;i++){var layoutCell=layoutCells[i],domCell=document.createElement("div");domCell.className=layoutCell.cssClass;domHeader.appendChild(domCell);oCellByKey[layoutCell.cellKey]=domCell;}renderHeaderLabel_(parentNode,viewSettings);buttonClose.className="regularViewCloseWindow";buttonClose.onclick=function(){viewSettings.onClose();};domHeader.appendChild(buttonClose);parentNode.appendChild(domHeader);}function renderFooter_(parentNode,viewSettings){var domContainer=document.createElement("div"),layoutCells=[{cellKey:"topLeft",cssClass:"regularViewBottomLeft"},{cellKey:"topMiddle",cssClass:"regularViewBottomCenter"},{cellKey:"topRight",cssClass:"regularViewBottomRight"}],oCellByKey={};for(var i=0;i<layoutCells.length;i++){var layoutCell=layoutCells[i],domCell=document.createElement("div");domCell.className=layoutCell.cssClass;domContainer.appendChild(domCell);oCellByKey[layoutCell.cellKey]=domCell;}parentNode.appendChild(domContainer);}function renderContent_(parentNode,viewSettings){var domContainer=document.createElement("div");domContainer.className="regularViewContent";if(viewSettings.layoutGrids){for(var i=0;i<viewSettings.layoutGrids.length;i++){renderLayoutGrid_(domContainer,viewSettings.layoutGrids[i]);}}if(viewSettings.domContent){domContainer.appendChild(viewSettings.domContent);}parentNode.appendChild(domContainer);}function hideWindow(){FunUI.managers.PopUpManager.removePopUp(domMain);}var domPopUps=null;function showPopup(windowName,options){hidePopup(windowName);if(!domPopUps){domPopUps=document.createElement("div");domPopUps.id="popupWndContainer";}var themeOption=options&&options.theme?options.theme:'light';BIUtils.startEvent('window',windowName);var sendWindowEvent=function sendWindowEvent(){if(windowName!='infoScreen'){BIUtils.endEvent('window',windowName);}};switch(themeOption){case'light':{var wnd=slayOne.widgets.popupWindow(domPopUps,{windowName:windowName,theme:themeOption,content:options.content,onClose:function onClose(){sendWindowEvent();domPopUps.removeChild(wnd);if(domPopUps.children.length<=0){FunUI.managers.PopUpManager.removePopUp(domPopUps);}options.onClose&&options.onClose();}});break;}case'standard':{var wnd=slayOne.widgets.popupWindow(domPopUps,{windowName:windowName,theme:themeOption,title:options.title,content:options.content,onClose:function onClose(){sendWindowEvent();domPopUps.removeChild(wnd);if(domPopUps.children.length<=0){FunUI.managers.PopUpManager.removePopUp(domPopUps);}options.onClose&&options.onClose();}});break;}case'tabbed':{var wnd=slayOne.widgets.popupWindow(domPopUps,{windowName:windowName,theme:themeOption,title:options.title,tabs:options.tabs,initTabIndex:options.initTabIndex,onClose:function onClose(){sendWindowEvent();domPopUps.removeChild(wnd);if(domPopUps.children.length<=0){FunUI.managers.PopUpManager.removePopUp(domPopUps);}options.onClose&&options.onClose();}});break;}case'prompt':{var wnd=slayOne.widgets.popupWindow(domPopUps,{windowName:windowName,theme:themeOption,content:options.content,hideCloseBtn:true,onClose:function onClose(){sendWindowEvent();domPopUps.removeChild(wnd);if(domPopUps.children.length<=0){FunUI.managers.PopUpManager.removePopUp(domPopUps);}options.onClose&&options.onClose();}});break;}}FunUI.managers.PopUpManager.addPopUp(domPopUps);}function getPopup(windowName){var domPopup=document.getElementById(windowName);return domPopup;}function hidePopup(windowName){var domPopup=document.getElementById(windowName);if(domPopup){domPopup.closePopUp();}}function showWindow(viewSettings){Skin.close();domMain.innerHTML="";domMain.className="regularView";renderHeader_(domMain,viewSettings);renderContent_(domMain,viewSettings);renderFooter_(domMain,viewSettings);FunUI.managers.PopUpManager.addPopUp(domMain);}var fsLoading=null;function showFullScreenLoading(){if(!fsLoading){fsLoading={};fsLoading.dom=document.getElementById('fsLoading');fsLoading.handle=slayOne.widgets.loadingIndicator(fsLoading.dom,{width:'100%',height:'100%'});}fsLoading.handle.startAnimation();fsLoading.dom.style.display="block";}function hideFullScreenLoading(){if(!fsLoading){return;}fsLoading.dom.style.display="none";fsLoading.handle.stopAnimation();}var floatTipZIndex=1000000;var floatTipsCache={};function showFloatTip(options){var floatTipId=floatTipZIndex++;var domTip=slayOne.widgets.floatTip(options);domTip.style.zIndex=floatTipId;floatTipsCache[floatTipId]=domTip;var domContainer=document.getElementById("floatTipsLayer");domContainer.appendChild(domTip);domTip.startShowAnimation(function(){removeFloatTip(domTip);});return floatTipId;}function getFloatTip(floatTipId){return floatTipsCache[floatTipId];}function hideFloatTip(floatTipId){var domTip=floatTipsCache[floatTipId];if(!domTip){return;}floatTipsCache[floatTipId]=null;domTip.startHideAnimation();}function removeFloatTip(domTip){var domContainer=document.getElementById("floatTipsLayer");domContainer.removeChild(domTip);}var promptId=0;function showPrompt(promptOptions){promptId+=1;var promptWndName="promptWnd"+promptId.toString();slayOne.viewHelpers.showPopup(promptWndName,{theme:'prompt',content:slayOne.widgets.prompt(promptOptions)});return{close:function close(){slayOne.viewHelpers.hidePopup(promptWndName);}};}function showAd(){if(isDesktop||debugMode){return;}document.getElementById('adContainer').style.display='block';if(game&&game.playingPlayer){return;}var itch=document.getElementById('itchBanner');if(itch){itch.style.display='block';}var greenlight=document.getElementById('greenlight-button');if(greenlight){greenlight.style.display='block';}var steam=document.getElementById('steam-addon');if(steam){steam.style.display='block';}}function hideAd(){document.getElementById('adContainer').style.display='none';var itch=document.getElementById('itchBanner');if(itch){itch.style.display='none';}var greenlight=document.getElementById('greenlight-button');if(greenlight){greenlight.style.display='none';}var steam=document.getElementById('steam-addon');if(steam){steam.style.display='none';}}function showInfoScreen(options){slayOne.views.infoScreen.render(options.title,options.content);}slayOne.viewHelpers={showWindow:showWindow,hideWindow:hideWindow,showPopup:showPopup,getPopup:getPopup,hidePopup:hidePopup,showFullScreenLoading:showFullScreenLoading,hideFullScreenLoading:hideFullScreenLoading,showFloatTip:showFloatTip,getFloatTip:getFloatTip,hideFloatTip:hideFloatTip,showPrompt:showPrompt,showInfoScreen:showInfoScreen,showAd:showAd,hideAd:hideAd};})(window.slayOne,window.document);(function(window,slayOne,document){var viewKey="needsLoginScreen";function renderTitle_(parentNode){parentNode.innerHTML='<span class="needsLoginTitle">'+slayOne.widgets.lang.get("needs_login.title")+'</span>';}function renderImage_(parentNode){var domContainer=document.createElement("div");domContainer.className="needsLoginImgContainer";var listHTML='<img src="'+window.ResourcePath+'imgs/windows/needs_login/intro.png">';listHTML+='<ul>';listHTML+='<li>'+slayOne.widgets.lang.get("needs_login.intro1")+'</li>';listHTML+='<li>'+slayOne.widgets.lang.get("needs_login.intro2")+'</li>';listHTML+='<li>'+slayOne.widgets.lang.get("needs_login.intro3")+'</li>';listHTML+='<li>'+slayOne.widgets.lang.get("needs_login.intro4")+'</li>';listHTML+='<li>'+slayOne.widgets.lang.get("needs_login.intro5")+'</li>';listHTML+='<li>'+slayOne.widgets.lang.get("needs_login.intro6")+'</li>';listHTML+='<li>'+slayOne.widgets.lang.get("needs_login.intro7")+'</li>';listHTML+='</ul>';domContainer.innerHTML=listHTML;parentNode.appendChild(domContainer);}function renderLoginButton_(parentNode){slayOne.widgets.labelButton(parentNode,{label:slayOne.widgets.lang.get("needs_login.login_btn.label"),theme:"LightGreen",tip:slayOne.widgets.lang.get("needs_login.login_btn.tooltip"),tipAlign:"left",onClick:function onClick(){slayOne.views.homeScreen.hideWindow();slayOne.viewHelpers.hidePopup(viewKey);window.uiManager.showLogin();}});}function renderSignUpButton_(parentNode){slayOne.widgets.labelButton(parentNode,{label:slayOne.widgets.lang.get("needs_login.signup_btn.label"),theme:"LightFacebook",tip:slayOne.widgets.lang.get("needs_login.signup_btn.tooltip"),tipAlign:"right",onClick:function onClick(){slayOne.views.homeScreen.hideWindow();slayOne.viewHelpers.hidePopup(viewKey);FacebookUtils.loginFbThenGame();}});}function render(viewModel){var domContent=document.createElement("div");domContent.className="needsLoginWindow pixelated";var aRows=[[{renderMethod:renderTitle_}],[{renderMethod:renderImage_}],[{renderMethod:renderLoginButton_},{renderMethod:renderSignUpButton_}]];for(var i=0;i<aRows.length;i++){var aCells=aRows[i];var domTable=document.createElement("div");var domRow=document.createElement("div");domTable.className="mainLayoutTable";domRow.style.display="table-row";domTable.style.marginBottom="20px";for(var j=0;j<aCells.length;j++){var layoutCell=aCells[j];var domCell=document.createElement("div");var renderMethod=layoutCell.renderMethod?layoutCell.renderMethod.bind(this):null;domCell.className="mainLayoutCell";renderMethod(domCell);domRow.appendChild(domCell);}domTable.appendChild(domRow);domContent.appendChild(domTable);}slayOne.viewHelpers.showPopup(viewKey,{theme:'light',content:domContent});}slayOne.views[viewKey]={render:render};})(window,window.slayOne,window.document);(function(window,slayOne,document){var viewKey="roomsListScreen";var domRoomList=null;function renderGameModeSwitcher_(parentNode,viewModel){var gameModeFilterOptions=[{label:slayOne.widgets.lang.get("config.mode.all.label"),value:'-1'}];Array.prototype.push.apply(gameModeFilterOptions,MAP_TYPE_SETTINGS.concat().sort(function(s1,s2){return(s1.unlockLevel||0)-(s2.unlockLevel||0);}).map(function(s1){return{label:slayOne.widgets.lang.get(s1.langLabel),value:s1.id};}));slayOne.widgets.dropdownMenu(parentNode,{customClassName:"gameModeSwitcherDdl",customButtonClassName:"gameModeSwitcherBtn",customButtonWidth:"262px",customButtonHeight:"44px",selectOptions:gameModeFilterOptions,initIndex:0,mainButtonTip:slayOne.widgets.lang.get("lobby.views.browse.mode_filter.tooltip"),onSwitch:function onSwitch(gameModeOption){viewModel.filterGameMode=gameModeOption.value;listFilterUpdate_(viewModel);}});}function renderNameFilter_(parentNode,viewModel){viewModel.tiFilterName=slayOne.widgets.standardTextInput(parentNode,{size:10,placeholder:slayOne.widgets.lang.get("lobby.views.browse.name_filter.placeholder"),cssId:"inputGameNameMap",skin:"standard",customClassName:"gameNameTextInput",onSubmit:function onSubmit(val){viewModel.filterName=val;listFilterUpdate_(viewModel);}});slayOne.widgets.iconButton(parentNode,{customClassName:"nameFilterSearchBtn",iconClassName:'nameFilterSearchBtnIcon',theme:'small',onClick:function onClick(){viewModel.filterName=viewModel.tiFilterName.value;listFilterUpdate_(viewModel);}});}function renderRoomList_(parentNode,viewModel){var domList=document.createElement('div');domList.className="roomListWrapper";var domLoading=document.createElement('div');domLoading.className="roomListLoading";var domLoadingIndicator=slayOne.widgets.loadingIndicator(domLoading,{width:'100%',height:'100%'});domList.appendChild(domLoading);var domListEmpty=document.createElement('div');domListEmpty.className="roomListEmpty";var listEmptyHTML='';listEmptyHTML+='<p>'+slayOne.widgets.lang.get("lobby.views.browse.error.no_games.no_game_found")+'</p>';listEmptyHTML+='<img src="'+window.ResourcePath+'imgs/windows/room/icon_no_room.png">';listEmptyHTML+='<p>'+slayOne.widgets.lang.get("lobby.views.browse.error.no_games.be_first_to_create")+'</p>';domListEmpty.innerHTML=listEmptyHTML;var domListEmptyCreateBtnWrapper=document.createElement('div');slayOne.widgets.labelButton(domListEmptyCreateBtnWrapper,{label:slayOne.widgets.lang.get("lobby.views.browse.error.no_games.create_btn.label"),theme:"HugeNormal",onClick:function onClick(){slayOne.viewHelpers.getPopup('lobby').selectTab(1);}});domListEmpty.appendChild(domListEmptyCreateBtnWrapper);domList.appendChild(domListEmpty);var domContent=document.createElement('div');domContent.className="roomListContent";var domTableHeader=document.createElement('div');domTableHeader.className="roomListHeader";var domHeaderCreator=document.createElement('div');domHeaderCreator.className="roomListHeaderField roomFieldID";domHeaderCreator.innerText=slayOne.widgets.lang.get('clanMembers.head.level');domTableHeader.appendChild(domHeaderCreator);var domHeaderMap=document.createElement('div');domHeaderMap.className="roomListHeaderField roomFieldMapName";domHeaderMap.innerText=slayOne.widgets.lang.get("lobby.views.browse.list.header.map.label");domTableHeader.appendChild(domHeaderMap);var domHeaderPlayers=document.createElement('div');domHeaderPlayers.className="roomListHeaderField roomFieldPlayers";domHeaderPlayers.innerText=slayOne.widgets.lang.get("lobby.views.browse.list.header.players.label");domTableHeader.appendChild(domHeaderPlayers);var domHeaderMode=document.createElement('div');domHeaderMode.className="roomListHeaderField roomFieldMode";domHeaderMode.innerText=slayOne.widgets.lang.get("lobby.views.browse.list.header.mode.label");domTableHeader.appendChild(domHeaderMode);var domHeaderOperations=document.createElement('div');domHeaderOperations.className="roomListHeaderField roomFieldOperations";domTableHeader.appendChild(domHeaderOperations);domContent.appendChild(domTableHeader);var domTableBody=document.createElement('div');domTableBody.className="roomListBody";domContent.appendChild(domTableBody);domList.appendChild(domContent);slayOne.widgets.tooltip(domHeaderMap,{tip:slayOne.widgets.lang.get("lobby.views.browse.list.header.map.tooltip")});slayOne.widgets.tooltip(domHeaderPlayers,{tip:slayOne.widgets.lang.get("lobby.views.browse.list.header.players.tooltip")});slayOne.widgets.tooltip(domHeaderMode,{tip:slayOne.widgets.lang.get("lobby.views.browse.list.header.mode.tooltip")});viewModel.domList=domList;viewModel.domLoading=domLoading;viewModel.domLoadingIndicator=domLoadingIndicator;viewModel.domEmpty=domListEmpty;viewModel.domContent=domContent;viewModel.domTableHeader=domTableHeader;viewModel.domTableBody=domTableBody;parentNode.appendChild(domList);}function listInit_(viewModel,roomsList){listClear_(viewModel);var roomsCount=roomsList.length;for(var i=0;i<roomsCount;i++){viewModel.rooms[roomsList[i].roomId]=roomsList[i];listInsertOne_(viewModel,roomsList[i]);}listFilterUpdate_(viewModel);}function listInsertOne_(viewModel,roomData){var domRow=document.createElement('div');domRow.className="roomListRow";domRow.dataset.slayOneRoomId=roomData.roomId.toString();var rowHTML='';rowHTML+='<span class="roomListField roomFieldID">'+(roomData.tag=='veteran'?'7+':'1-6')+'</span>';rowHTML+='<span class="roomListField roomFieldMapName">'+roomData.mapName+'</span>';rowHTML+='<span class="roomListField roomFieldPlayers"><object class="roomFieldPlayersCurrent">'+roomData.numPlayers+'</object>/'+roomData.numPlayersMax+'</span>';rowHTML+='<span class="roomListField roomFieldMode">'+slayOne.widgets.lang.get(MAP_TYPE_SETTINGS[roomData.mode].langLabel)+'</span>';domRow.innerHTML=rowHTML;var domOperations=document.createElement('span');domOperations.className="roomListField roomFieldOperations";var mismatch=pl_lvl<=6&&roomData.tag=='veteran'||pl_lvl>6&&roomData.tag!='veteran';slayOne.widgets.labelButton(domOperations,{label:slayOne.widgets.lang.get(roomData.mode==3||(MAP_TYPE_SETTINGS[roomData.mode].unlockLevel||0)>pl_lvl||mismatch?"lobby.views.browse.list.row.watch_btn.label":"lobby.views.browse.list.row.join_btn.label"),theme:"SmallNormal",onClick:function onClick(){listClickHandler_(viewModel,roomData);}});domRow.appendChild(domOperations);viewModel.domTableBody.appendChild(domRow);var domRoomTip=document.createElement('div');domRoomTip.className="roomListTip";domRoomTip.style.display="none";var search=getSearchQuery();var showDebugInfo=!!search["debug"];var roomTipHTML='<div class="mapMetaThumbnail">';roomTipHTML+='<div class="mapMetaTitle">'+roomData.mapName+'</div>';if(showDebugInfo){roomTipHTML+='<div class="mapMetaTitle">'+roomData.source+'</div>';roomTipHTML+='<div class="mapMetaTitle">'+roomData.createTime+'</div>';}roomTipHTML+='<div class="mapMetaDesc">';roomTipHTML+='<div class="mapMetaPlayers">'+slayOne.widgets.lang.get("lobby.views.browse.list.row.tooltip.player.header")+': <span class="mapMetaPlayersCurrent">'+roomData.numPlayers+'</span><span>/</span><span class="mapMetaPlayersMax">'+roomData.numPlayersMax+'</span></div>';roomTipHTML+='<div class="mapMetaPlayers">'+'<span>'+slayOne.widgets.lang.get("lobby.views.browse.list.row.tooltip.requirement")+'</span>'+'<span class="mapMetaPlayersCurrent">'+(roomData.tag=='veteran'?'7+':'1-6')+'</span>'+'</div>';roomTipHTML+='<div class="mapMetaMode">'+slayOne.widgets.lang.get(MAP_TYPE_SETTINGS[roomData.mode].langLabel)+'</div>';roomTipHTML+='</div>';roomTipHTML+='<img src="'+roomData.mapThumbnail+'" onerror="holdPlaceMapThumbnail(event);"  onload="holdPlaceMapThumbnail(event);">';roomTipHTML+='<div class="mapMetaSize">'+roomData.mapW+'x'+roomData.mapH+'</div>';roomTipHTML+='</div>';domRoomTip.innerHTML=roomTipHTML;domRow.appendChild(domRoomTip);domRow.addEventListener("mouseover",function(){domRoomTip.style.display="flex";});domRow.addEventListener("mouseout",function(){domRoomTip.style.display="none";});if(shouldHideRoom_(viewModel,roomData)){domRow.style.display="none";}else{domRow.style.display="block";}}function listClickHandler_(viewModel,roomData){var respTimeout=setTimeout(function(){clearTimeout(respTimeout);slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("msg.error_wait_too_long")});},5000);var respCb=function respCb(){clearTimeout(respTimeout);window.network.removeMessageListener(NetworkMessages.GameEntered,respCb);slayOne.viewHelpers.hideFullScreenLoading();slayOne.viewHelpers.hidePopup("lobby");};var errCb=function errCb(msg){clearTimeout(respTimeout);if(msg=='reload-game'){slayOne.viewHelpers.hidePopup("lobby");}else{slayOne.viewHelpers.showFloatTip({tipType:'error',content:msg});}window.network.removeMessageListener(NetworkMessages.LoginFail,errCb);slayOne.viewHelpers.hideFullScreenLoading();};slayOne.viewHelpers.showFullScreenLoading();window.network.addMessageListener(NetworkMessages.GameEntered,respCb);window.network.addMessageListener(NetworkMessages.LoginFail,errCb);var mismatch=pl_lvl<=6&&roomData.tag=='veteran'||pl_lvl>6&&roomData.tag!='veteran';window.joinGamePurpose=roomData.mode==3||(MAP_TYPE_SETTINGS[roomData.mode].unlockLevel||0)>pl_lvl||mismatch?'spectate':null;window.network.send(["join-game",roomData.roomId].join("$"));}function listUpdateOne_(viewModel,roomData){var roomDom=getDomByRoomId_(viewModel,roomData.roomId);if(roomDom==null){listInsertOne_(viewModel,roomData);viewModel.rooms[roomData.roomId]=roomData;listFilterUpdate_(viewModel);}else{roomDom.querySelector(".roomFieldPlayersCurrent").innerText=roomData.numPlayers;roomDom.querySelector(".mapMetaPlayersCurrent").innerText=roomData.numPlayers;viewModel.rooms[roomData.roomId].numPlayers=roomData.numPlayers;}}function listDeleteOne_(viewModel,roomId){var roomDom=getDomByRoomId_(viewModel,roomId);if(roomDom==null){return;}viewModel.domTableBody.removeChild(roomDom);delete viewModel.rooms[roomId];listFilterUpdate_(viewModel);}function getDomByRoomId_(viewModel,roomId){var doms=viewModel.domTableBody.children;var domsCount=doms.length;for(var i=0;i<domsCount;i++){if(doms[i].dataset.slayOneRoomId==roomId.toString()){return doms[i];}}return null;}function listFilterUpdate_(viewModel){var hasVisibleRooms=false;var doms=viewModel.domTableBody.children;var domsCount=doms.length;for(var i=0;i<domsCount;i++){var roomData=viewModel.rooms[doms[i].dataset.slayOneRoomId];if(shouldHideRoom_(viewModel,roomData)){doms[i].style.display="none";}else{hasVisibleRooms=true;doms[i].style.display="block";}}if(hasVisibleRooms){viewModel.domContent.style.display="block";viewModel.domEmpty.style.display="none";}else{viewModel.domContent.style.display="none";if(viewModel.filterGameMode==MAP_TYPE.TOURNAMENT){viewModel.domEmpty.style.display="none";}else{viewModel.domEmpty.style.display="block";}}}function shouldHideRoom_(viewModel,roomData){if(viewModel.filterGameMode>=0){if(roomData.mode!=viewModel.filterGameMode){return true;}}if(viewModel.filterName&&viewModel.filterName.length>0){if(roomData.mapName.toLowerCase().indexOf(viewModel.filterName.toLowerCase())>=0){return false;}return true;}return false;}function listClear_(viewModel){viewModel.rooms={};viewModel.domTableBody.innerHTML='';}function getRoomsList_(listModel){window.network.send("req-games-list");if(listModel.roomWatching){setTimeout(getRoomsList_,10000,listModel);}}function render(parentNode,viewModel){var domContent=document.createElement('div');domContent.className="roomTabView roomsListView";var listModel={isLoadingList:false,filterGameMode:-1,filterName:'',rooms:{},domList:null,domLoading:null,domLoadingIndicator:null,domEmpty:null,domContent:null,domTableHeader:null,domTableBody:null,tiFilterName:null};var aRows=[[{renderMethod:renderGameModeSwitcher_},{renderMethod:renderNameFilter_}],[{renderMethod:renderRoomList_}]];for(var i=0;i<aRows.length;i++){var aCells=aRows[i];var domTable=document.createElement("div");var domRow=document.createElement("div");domTable.className="mainLayoutTable";domRow.style.display="table-row";for(var j=0;j<aCells.length;j++){var layoutCell=aCells[j];var domCell=document.createElement("div");var renderMethod=layoutCell.renderMethod?layoutCell.renderMethod.bind(this):null;domCell.className="mainLayoutCell roomListLayoutCell";renderMethod(domCell,listModel);domRow.appendChild(domCell);}domTable.appendChild(domRow);domContent.appendChild(domTable);}domContent.onCreate=function(initData){};domContent.onShow=function(initData){listModel.roomWatching=true;listModel.isLoadingList=true;listModel.domContent.style.display='none';listModel.domEmpty.style.display='none';listModel.domLoadingIndicator.startAnimation();listModel.domLoading.style.display='block';listModel.networkInitCb=function(roomsData){if(listModel.isLoadingList){listModel.isLoadingList=false;listModel.domLoading.style.display='none';listModel.domLoadingIndicator.stopAnimation();}listInit_(listModel,roomsData);};window.network.addMessageListener(NetworkMessages.GameListResponse,listModel.networkInitCb);getRoomsList_(listModel);};domContent.onHide=function(){listModel.roomWatching=false;window.network.removeMessageListener(NetworkMessages.GameListResponse,listModel.networkInitCb);listModel.networkInitCb=null;};parentNode.appendChild(domContent);return domContent;}slayOne.views[viewKey]={render:render};})(window,window.slayOne,window.document);(function(window,slayOne,document){var viewKey="roomCreateScreen";function renderGameModeSwitcher_(parentNode,viewModel){var domContainer=document.createElement('div');domContainer.className="gameModeSwitcherDdlWrapper";var gameModeFilterOptions=MAP_TYPE_SETTINGS.filter(function(s1){return(s1.unlockLevel||0)<=pl_lvl&&s1.id!=MAP_TYPE.TOURNAMENT;}).sort(function(s1,s2){return(s1.unlockLevel||0)-(s2.unlockLevel||0);}).map(function(s1){return{label:slayOne.widgets.lang.get(s1.langLabel),value:s1.id};});var initIndex=0;var modesCount=gameModeFilterOptions.length;for(var i=0;i<modesCount;i++){if(gameModeFilterOptions[i].value==viewModel.filterMapType){initIndex=i;break;}}slayOne.widgets.dropdownMenu(domContainer,{customClassName:"gameModeSwitcherDdl",customButtonClassName:"gameModeSwitcherBtn",customButtonWidth:"262px",customButtonHeight:"44px",selectOptions:gameModeFilterOptions,initIndex:initIndex,mainButtonTip:slayOne.widgets.lang.get("lobby.views.create.mode_filter.tooltip"),onSwitch:function onSwitch(gameModeOption){listClear_(viewModel);viewModel.filterMapType=gameModeOption.value!=MAP_TYPE.TOURNAMENT?gameModeOption.value:MAP_TYPE.TOURNAMENT_UNRANKED;localStorage.setItem("defaultCreateMode",viewModel.filterMapType);viewModel.tiRoundTime.value=getRoundTime(viewModel);getNumBots(viewModel);refreshList_(viewModel);}});parentNode.appendChild(domContainer);}function renderMapsList_(parentNode,viewModel){var domList=document.createElement('div');domList.className="mapListWrapper";var domLoading=document.createElement('div');domLoading.className="mapListLoading";var domLoadingIndicator=slayOne.widgets.loadingIndicator(domLoading,{width:'100%',height:'100%'});domList.appendChild(domLoading);var domTableBody=document.createElement('div');domTableBody.className="mapListBody";domList.appendChild(domTableBody);viewModel.domList=domList;viewModel.domLoading=domLoading;viewModel.domLoadingIndicator=domLoadingIndicator;viewModel.domTableBody=domTableBody;parentNode.appendChild(domList);}function renderParamFields_(parentNode,viewModel){renderBotsInput_(parentNode,viewModel);renderRoundTimeInput_(parentNode,viewModel);}function renderBotsInput_(parentNode,viewModel){var domContent=document.createElement('div');domContent.className="roomCreateParamInput";var domLabel=document.createElement('span');domLabel.className="fieldLabel";domLabel.innerText=slayOne.widgets.lang.get("lobby.views.create.bots_num.prefix");domContent.appendChild(domLabel);var staticNum=document.createElement('div');staticNum.className="staticNum";staticNum.innerText=18;staticNum.style.display='none';domContent.appendChild(staticNum);var tiNumBots=slayOne.widgets.standardTextInput(domContent,{size:10,placeholder:"",cssId:"inputNumBots",skin:"standard",customClassName:"botNumTextInput"});viewModel.tiNumBots=tiNumBots;slayOne.widgets.tooltip(domContent,{tip:slayOne.widgets.lang.get("lobby.views.create.bots_num.tooltip"),align:"left",multiline:true,width:"450px",verticalAlign:"top"});getNumBots(viewModel);parentNode.appendChild(domContent);}function getRoundTime(viewModel){if(viewModel.filterMapType==MAP_TYPE.ZOMBIE_COOP){return'10';}else{return'15';}}function getNumBots(viewModel){var input=viewModel.tiNumBots.parentNode;var staticNum=input.parentNode.querySelector('div.staticNum');if(viewModel.filterMapType==MAP_TYPE.ZOMBIE_COOP){input.style.display='none';staticNum.style.display='';viewModel.tiNumBots.value='18';}else{input.style.display='';staticNum.style.display='none';viewModel.tiNumBots.value='4';}}function renderRoundTimeInput_(parentNode,viewModel){var domContent=document.createElement('div');domContent.className="roomCreateParamInput";var domLabel=document.createElement('span');domLabel.className="fieldLabel";domLabel.innerText=slayOne.widgets.lang.get("lobby.views.create.round_time.prefix");domContent.appendChild(domLabel);var tiRoundTime=slayOne.widgets.standardTextInput(domContent,{size:10,placeholder:"",cssId:"inputRoundTime",skin:"standard",customClassName:"roundTimeTextInput"});viewModel.tiRoundTime=tiRoundTime;slayOne.widgets.tooltip(domContent,{tip:slayOne.widgets.lang.get("lobby.views.create.round_time.tooltip"),align:"left"});viewModel.tiRoundTime.value=getRoundTime(viewModel);parentNode.appendChild(domContent);}function renderPrivateGameCheckbox_(parentNode,viewModel){var domCheckBox=slayOne.widgets.checkbox(parentNode,{selected:false,label:slayOne.widgets.lang.get("lobby.views.create.private_game.checkbox"),customClassName:"roomCreatePrivateCheckbox",onChange:function onChange(selected){}});slayOne.widgets.tooltip(domCheckBox,{tip:slayOne.widgets.lang.get("lobby.views.create.private_game.tooltip"),align:"left"});viewModel.cbPrivateGame=domCheckBox;}function isFreeMap(viewModel){var mapId=viewModel.selectedMapId;var isFree=false;for(var i=0;i<CREATION_FREE_MAPS.length;i++){if(mapId==CREATION_FREE_MAPS[i]){isFree=true;}}return isFree;}function renderStartButton_(parentNode,viewModel){var button=document.createElement('div');button.className='F-Button gold';button.innerHTML='<div class="label">'+' <span>'+slayOne.widgets.lang.get("lobby.views.create.start_btn.label")+'</span>'+' <div class="icon x16 gold" id="roomCreationPrice1"></div>'+' <span class="goldNumber" id="roomCreationPrice2">'+CONST.GAME_CREATION_GOLD_COST+'</span>'+' </div>'+'<div class="hover"></div>';button.on('click',function(){createGame(viewModel);});parentNode.appendChild(button);}function listInit_(viewModel){var numColumns=3;var mapsCount=viewModel.maps.length;var mapRow=null;for(var i=0;i<mapsCount;i++){if(i%numColumns==0){mapRow=document.createElement('div');mapRow.className='mapListRow';}var mapCell=document.createElement('div');mapCell.className='mapListCell';var addedNode=listCreateOne_(mapCell,viewModel,viewModel.maps[i]);viewModel.mapNodes.push(addedNode);mapRow.appendChild(mapCell);if(i%numColumns==numColumns-1){viewModel.domTableBody.appendChild(mapRow);mapRow=null;}}if(mapRow!=null){viewModel.domTableBody.appendChild(mapRow);}if(mapsCount>0){selectMap_(viewModel,viewModel.maps[0].mapId,true);}}function listClear_(viewModel){viewModel.domTableBody.innerHTML='';viewModel.mapNodes=[];}function listCreateOne_(parentNode,viewModel,mapData){var domMap=document.createElement('div');domMap.className="mapNode";var mapHTML='';mapHTML+='<div class="mapTitle">'+mapData.mapName+'</div>';mapHTML+='<div class="mapThumbail">';mapHTML+='<img src="'+mapData.thumbnail+'" onerror="holdPlaceMapThumbnail(event); " onload="holdPlaceMapThumbnail(event);">';mapHTML+='<div class="mapSize">'+mapData.mapW+'x'+mapData.mapH+'</div>';mapHTML+='</div>';mapHTML+='<div class="mapCapacity">'+slayOne.widgets.lang.get("lobby.views.create.list.row.tooltip.player.header")+': <span>'+mapData.maxPlayers+'</span></div>';mapHTML+='<div class="mapMode">'+slayOne.widgets.lang.get(MAP_TYPE_SETTINGS[mapData.mode].langLabel)+'</div>';domMap.innerHTML=mapHTML;var domHighlight=document.createElement('div');domHighlight.className="mapNodeHighlight";domHighlight.style.display="none";domMap.appendChild(domHighlight);domMap.setSelected=function(val){if(val){domHighlight.style.display="block";addClassToDom(domMap,"selectedNode");}else{domHighlight.style.display="none";removeClassFromDom(domMap,"selectedNode");}};domMap.dataset.slayOneMapId=mapData.mapId.toString();if(mapData.mapDesc&&mapData.mapDesc.length>0){var escapedDesc=escapeHtml(mapData.mapDesc);if(escapedDesc.length>0){var domRoomTip=document.createElement('div');domRoomTip.className="mapListTip";domRoomTip.style.display="none";var roomTipHTML='<div class="mapTipWrapper">';roomTipHTML+='<div class="mapMetaDetail">'+escapedDesc+'</div>';roomTipHTML+='</div>';domRoomTip.innerHTML=roomTipHTML;domMap.appendChild(domRoomTip);domMap.addEventListener("mouseover",function(){domRoomTip.style.display="flex";});domMap.addEventListener("mouseout",function(){domRoomTip.style.display="none";});}}slayOne.widgets.hoverLight(domMap,{width:'166px',height:'198px'});domMap.addEventListener("click",function(evt){selectMap_(viewModel,mapData.mapId);});slayOne.widgets.clickable(domMap);parentNode.appendChild(domMap);return domMap;}function refreshList_(viewModel){listClear_(viewModel);getMapsList_(viewModel,function(mapsData){viewModel.maps=mapsData;listInit_(viewModel);});}function getMapsList_(viewModel,callback){if(viewModel.networkInitCb){window.network.removeMessageListener(NetworkMessages.MapListResponse,viewModel.networkInitCb);viewModel.networkInitCb=null;}viewModel.isLoadingList=true;viewModel.domTableBody.style.display='none';viewModel.domLoadingIndicator.startAnimation();viewModel.domLoading.style.display='block';viewModel.networkInitCb=function(mapsList){window.network.removeMessageListener(NetworkMessages.MapListResponse,viewModel.networkInitCb);viewModel.networkInitCb=null;viewModel.isLoadingList=false;viewModel.domTableBody.style.display='block';viewModel.domLoading.style.display='none';viewModel.domLoadingIndicator.stopAnimation();mapsList.forEach(function(mapData){mapData.mode=viewModel.filterMapType;});callback(mapsList);};window.network.addMessageListener(NetworkMessages.MapListResponse,viewModel.networkInitCb);window.network.send("req-map-list-4-create$"+viewModel.filterMapType);}function selectMap_(viewModel,mapId,force){if(!force&&mapId==viewModel.selectedMapId){return;}if(viewModel.selectedMapId!=null){var oldMapNode=getMapNodeById_(viewModel,viewModel.selectedMapId);if(oldMapNode){oldMapNode.setSelected(false);}}viewModel.selectedMapId=mapId;var isFree=isFreeMap(viewModel);document.getElementById("roomCreationPrice1").style.display=isFree?'none':'';document.getElementById("roomCreationPrice2").style.display=isFree?'none':'';var newMapNode=getMapNodeById_(viewModel,viewModel.selectedMapId);if(newMapNode){newMapNode.setSelected(true);}}function getMapNodeById_(viewModel,mapId){var mapNodesCount=viewModel.mapNodes.length;for(var i=0;i<mapNodesCount;i++){if(viewModel.mapNodes[i].dataset.slayOneMapId==mapId.toString()){return viewModel.mapNodes[i];}}return null;}function createGame(viewModel){var isFree=isFreeMap(viewModel);if(isFree){createGame_(viewModel);return;}if(pl_gold<CONST.GAME_CREATION_GOLD_COST){slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("room.create.error.insufficient")});return;}F$confirm(F_('room.create.confirm',{gold:CONST.GAME_CREATION_GOLD_COST}),createGame_.bind(null,viewModel));}function createGame_(viewModel){BIUtils.startEvent('flow','home.buttons.play');var respTimeout=setTimeout(function(){clearTimeout(respTimeout);slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("msg.error_wait_too_long")});},5000);var respCb=function respCb(){clearTimeout(respTimeout);window.network.removeMessageListener(NetworkMessages.GameEntered,respCb);slayOne.viewHelpers.hideFullScreenLoading();slayOne.viewHelpers.hidePopup("lobby");var isFree=isFreeMap(viewModel);if(!isFree){pl_gold-=CONST.GAME_CREATION_GOLD_COST;}F$('resourceBar').refresh();};var errCb=function errCb(msg){if(msg=='reload-game'){slayOne.viewHelpers.hidePopup("lobby");}else{slayOne.viewHelpers.showFloatTip({tipType:'error',content:msg});}clearTimeout(respTimeout);window.network.removeMessageListener(NetworkMessages.LoginFail,errCb);slayOne.viewHelpers.hideFullScreenLoading();};slayOne.viewHelpers.showFullScreenLoading();window.network.addMessageListener(NetworkMessages.GameEntered,respCb);window.network.addMessageListener(NetworkMessages.LoginFail,errCb);network.send(["create-game",viewModel.selectedMapId,viewModel.tiRoundTime.value,viewModel.tiNumBots.value,viewModel.filterMapType,viewModel.cbPrivateGame.getSelected()?1:0].join("$"));BIUtils.endEvent('flow','home.buttons.play','send:create-game');}function render(parentNode,viewModel){var domContent=document.createElement('div');domContent.className="roomTabView roomCreateView";var mapsModel={networkInitCb:null,filterMapType:'4',selectedMapId:null,maps:[],mapNodes:[],domMain:domContent,domList:null,domLoading:null,domLoadingIndicator:null,domTableBody:null,tiNumBots:null,tiRoundTime:null};var storedCreateMode=localStorage.getItem("defaultCreateMode");if(storedCreateMode&&storedCreateMode.length>0){mapsModel.filterMapType=storedCreateMode!=MAP_TYPE.TOURNAMENT?storedCreateMode:MAP_TYPE.TOURNAMENT_UNRANKED;}var aRows=[[{renderMethod:renderGameModeSwitcher_},{renderMethod:renderPrivateGameCheckbox_}],[{renderMethod:renderMapsList_}],[{renderMethod:renderParamFields_},{renderMethod:renderStartButton_}]];for(var i=0;i<aRows.length;i++){var aCells=aRows[i];var domTable=document.createElement("div");var domRow=document.createElement("div");domTable.className="mainLayoutTable";domRow.style.display="table-row";domTable.style.marginBottom=i==0?"15px":"8px";for(var j=0;j<aCells.length;j++){var layoutCell=aCells[j];var domCell=document.createElement("div");var renderMethod=layoutCell.renderMethod?layoutCell.renderMethod.bind(this):null;domCell.className="mainLayoutCell roomCreateLayoutCell";renderMethod(domCell,mapsModel);domRow.appendChild(domCell);}domTable.appendChild(domRow);domContent.appendChild(domTable);}domContent.onCreate=function(initData){};domContent.onShow=function(initData){refreshList_(mapsModel);};domContent.onHide=function(){if(viewModel.networkInitCb){window.network.removeMessageListener(NetworkMessages.MapListResponse,viewModel.networkInitCb);viewModel.networkInitCb=null;}};parentNode.appendChild(domContent);return domContent;}slayOne.views[viewKey]={render:render};})(window,window.slayOne,window.document);(function(window,slayOne,document){var viewKey="loginScreen";function renderUserNameInput_(parentNode,viewModel){var domContainer=document.createElement('div');domContainer.className="userInputRow";var domTextInput=slayOne.widgets.standardTextInput(domContainer,{size:10,placeholder:slayOne.widgets.lang.get("account.views.login.name.placeholder"),cssId:"inputUserName",skin:"standard",customClassName:"userLoginRegTextInput userNameTextInput",iconClassName:"iconUserName",onSubmit:function onSubmit(val){commitLogin_(viewModel);}});viewModel.tiUserName=domTextInput;parentNode.appendChild(domContainer);}function renderUserPassInput_(parentNode,viewModel){var domContainer=document.createElement('div');domContainer.className="userInputRow";var domTextInput=slayOne.widgets.standardTextInput(domContainer,{size:10,inputType:'password',placeholder:slayOne.widgets.lang.get("account.views.login.password.placeholder"),cssId:"inputUserPass",skin:"standard",customClassName:"userLoginRegTextInput userPassTextInput",iconClassName:"iconUserPass",onSubmit:function onSubmit(val){commitLogin_(viewModel);}});viewModel.tiUserPass=domTextInput;parentNode.appendChild(domContainer);}function renderStayLoggedInCheckBox_(parentNode,viewModel){var domCheckBox=slayOne.widgets.checkbox(parentNode,{selected:true,label:slayOne.widgets.lang.get("account.views.login.stay_logged_in.label"),labelClassName:"userStayLoggedInCb",onChange:function onChange(selected){}});viewModel.cbStayLoggedIn=domCheckBox;}function renderLoginButton_(parentNode,viewModel){slayOne.widgets.labelButton(parentNode,{label:slayOne.widgets.lang.get("account.views.login.buttons.submit.label"),tipAlign:"center",theme:"LargeNormal",customClassName:"userLoginRegBtn",onClick:function onClick(){commitLogin_(viewModel);}});}function renderFbSignUpButton_(parentNode,viewModel){slayOne.widgets.labelButton(parentNode,{label:slayOne.widgets.lang.get("account.views.login.buttons.fbLogin.label"),tipAlign:"center",theme:"LargeFBNormal",onClick:function onClick(){FacebookUtils.loginFbThenGame(function(res){if(res.result==0){slayOne.viewHelpers.hidePopup("account");}});}});}function commitLogin_(viewModel){var loginParams=collectParams_(viewModel);if(!loginParams){return;}var timeoutTipHandle=null;var respTimeout=setTimeout(function(){clearTimeout(respTimeout);timeoutTipHandle=slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("msg.login_timeout"),duration:-1});},5000);var respCbFail=function respCbFail(){timeoutTipHandle?slayOne.viewHelpers.hideFloatTip(timeoutTipHandle):clearTimeout(respTimeout);window.network.removeMessageListener(NetworkMessages.LoginSuccess,respCbSuccess);window.network.removeMessageListener(NetworkMessages.RegisterResponse,respCbFail);slayOne.viewHelpers.hideFullScreenLoading();};var respCbSuccess=function respCbSuccess(){respCbFail();slayOne.viewHelpers.hidePopup("account");};slayOne.viewHelpers.showFullScreenLoading();window.network.addMessageListener(NetworkMessages.LoginSuccess,respCbSuccess);window.network.addMessageListener(NetworkMessages.RegisterResponse,respCbFail);network.send(loginParams.join('$'));}function collectParams_(viewModel){var valUserName=trim(viewModel.tiUserName.value).replace(/ /g,'_');viewModel.tiUserName.value=valUserName;var valUserPass=viewModel.tiUserPass.value;var valStayLoggedIn=viewModel.cbStayLoggedIn.getSelected();if(!valUserName||valUserName.length<=0){slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("account.views.login.name.warning")});return null;}if(!valUserPass||valUserPass.length<=0){slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("account.views.login.password.warning")});return null;}return['login',valUserName,valUserPass,valStayLoggedIn?'1':''];}function render(parentNode,viewModel){var domContent=document.createElement('div');domContent.className="loginRegView";var mapsModel={tiUserName:null,tiUserPass:null,cbStayLoggedIn:null};var aRows=[[{renderMethod:renderUserNameInput_}],[{renderMethod:renderUserPassInput_}],[{renderMethod:renderStayLoggedInCheckBox_}],function(){var buttons=[{renderMethod:renderLoginButton_}];!isDesktop&&buttons.push({renderMethod:renderFbSignUpButton_});return buttons;}()];for(var i=0;i<aRows.length;i++){var aCells=aRows[i];var domTable=document.createElement("div");var domRow=document.createElement("div");domTable.className="mainLayoutTable";domRow.style.display="table-row";domTable.style.marginBottom="10px";for(var j=0;j<aCells.length;j++){var layoutCell=aCells[j];var domCell=document.createElement("div");var renderMethod=layoutCell.renderMethod?layoutCell.renderMethod.bind(this):null;domCell.className="mainLayoutCell";renderMethod(domCell,mapsModel);domRow.appendChild(domCell);}domTable.appendChild(domRow);domContent.appendChild(domTable);}domContent.onCreate=function(initData){};domContent.onShow=function(initData){};domContent.onHide=function(){};parentNode.appendChild(domContent);return domContent;}slayOne.views[viewKey]={render:render};})(window,window.slayOne,window.document);(function(window,slayOne,document){var viewKey="registerScreen";function renderUserNameInput_(parentNode,viewModel){var domContainer=document.createElement('div');domContainer.className="userInputRow";var domTextInput=slayOne.widgets.standardTextInput(domContainer,{size:10,placeholder:slayOne.widgets.lang.get("account.views.signup.name.placeholder"),cssId:"inputUserName",skin:"standard",customClassName:"userLoginRegTextInput userNameTextInput",iconClassName:"iconUserName",onSubmit:function onSubmit(val){commitRegistration_(viewModel);}});slayOne.widgets.tooltip(domContainer,{tip:slayOne.widgets.lang.get("account.views.signup.name.tooltip"),align:"center",verticalAlign:"top"});viewModel.tiUserName=domTextInput;parentNode.appendChild(domContainer);}function renderUserPassInput_(parentNode,viewModel){var domContainer=document.createElement('div');domContainer.className="userInputRow";var domTextInput=slayOne.widgets.standardTextInput(domContainer,{size:10,inputType:'password',placeholder:slayOne.widgets.lang.get("account.views.signup.password.placeholder"),cssId:"inputUserPass",skin:"standard",customClassName:"userLoginRegTextInput userPassTextInput",iconClassName:"iconUserPass",onSubmit:function onSubmit(val){commitRegistration_(viewModel);}});slayOne.widgets.tooltip(domContainer,{tip:slayOne.widgets.lang.get("account.views.signup.password.tooltip"),align:"center",verticalAlign:"top"});viewModel.tiUserPass=domTextInput;parentNode.appendChild(domContainer);}function renderUserEmailInput_(parentNode,viewModel){var domContainer=document.createElement('div');domContainer.className="userInputRow";var domTextInput=slayOne.widgets.standardTextInput(domContainer,{size:10,placeholder:slayOne.widgets.lang.get("account.views.signup.email.placeholder"),cssId:"inputUserEmail",skin:"standard",customClassName:"userLoginRegTextInput userEmailTextInput",iconClassName:"iconUserEmail",onSubmit:function onSubmit(val){commitRegistration_(viewModel);}});viewModel.tiUserEmail=domTextInput;parentNode.appendChild(domContainer);}function renderRegisterButton_(parentNode,viewModel){slayOne.widgets.labelButton(parentNode,{label:slayOne.widgets.lang.get("account.views.signup.buttons.submit.label"),theme:"LargeNormal",customClassName:"userLoginRegBtn",onClick:function onClick(){commitRegistration_(viewModel);}});}function renderFbSignUpButton_(parentNode,viewModel){slayOne.widgets.labelButton(parentNode,{label:slayOne.widgets.lang.get("account.views.login.buttons.fbSignUp.label"),tipAlign:"center",theme:"LargeFBNormal",onClick:function onClick(){FacebookUtils.loginFbThenGame(function(res){if(res.result==0){slayOne.viewHelpers.hidePopup("account");}});}});}function renderUserAgreementTips_(parentNode,viewModel){var domTips=document.createElement('div');domTips.className='agreementTips';domTips.innerHTML=slayOne.widgets.lang.get("account.views.signup.agreement.template",{termName:'<a class="pseudoLink withClickSound" onclick="window.toggleAGB();">'+slayOne.widgets.lang.get("account.views.signup.agreement.termname")+'</a>'});parentNode.appendChild(domTips);}function commitRegistration_(viewModel){gaEventOnce('player-register');var registerParams=collectParams_(viewModel);if(!registerParams){return;}var timeoutTipHandle=null;var respTimeout=setTimeout(function(){clearTimeout(respTimeout);timeoutTipHandle=slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("msg.signup_timeout"),duration:-1});},5000);var respCbSuccess=function respCbSuccess(respData){gaEventOnce('register-succeeded');timeoutTipHandle?slayOne.viewHelpers.hideFloatTip(timeoutTipHandle):clearTimeout(respTimeout);window.network.removeMessageListener(NetworkMessages.RegisterSuccess,respCbSuccess);window.network.removeMessageListener(NetworkMessages.RegisterResponse,respCbFail);slayOne.viewHelpers.hideFullScreenLoading();slayOne.viewHelpers.showFloatTip({tipType:'success',content:slayOne.widgets.lang.get("msg.signup_success")});slayOne.viewHelpers.getPopup("account").selectTab(0);};var respCbFail=function respCbFail(failMessage){timeoutTipHandle?slayOne.viewHelpers.hideFloatTip(timeoutTipHandle):clearTimeout(respTimeout);window.network.removeMessageListener(NetworkMessages.RegisterSuccess,respCbSuccess);window.network.removeMessageListener(NetworkMessages.RegisterResponse,respCbFail);slayOne.viewHelpers.hideFullScreenLoading();};slayOne.viewHelpers.showFullScreenLoading();window.network.addMessageListener(NetworkMessages.RegisterSuccess,respCbSuccess);window.network.addMessageListener(NetworkMessages.RegisterResponse,respCbFail);network.send(registerParams.join('$'));}function collectParams_(viewModel){var valUserName=trim(viewModel.tiUserName.value).replace(/ /g,'_');viewModel.tiUserName.value=valUserName;var valUserPass=viewModel.tiUserPass.value;var valUserEmail=viewModel.tiUserEmail.value;if(!valUserName||valUserName.length<=0){slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("account.views.signup.name.warning")});return null;}if(!valUserPass||valUserPass.length<=0){slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("account.views.signup.password.warning")});return null;}if(!valUserEmail||valUserEmail.length<=0){slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get("account.views.signup.email.warning")});return null;}return['register',valUserName,valUserPass,valUserEmail,'',''];}function render(parentNode,viewModel){var domContent=document.createElement('div');domContent.className="loginRegView";var mapsModel={tiUserName:null,tiUserPass:null,tiUserEmail:null};var aRows=[[{renderMethod:renderUserNameInput_}],[{renderMethod:renderUserPassInput_}],[{renderMethod:renderUserEmailInput_}],function(){var buttons=[{renderMethod:renderRegisterButton_}];!isDesktop&&buttons.push({renderMethod:renderFbSignUpButton_});return buttons;}(),[{renderMethod:renderUserAgreementTips_}]];for(var i=0;i<aRows.length;i++){var aCells=aRows[i];var domTable=document.createElement("div");var domRow=document.createElement("div");domTable.className="mainLayoutTable";domRow.style.display="table-row";domTable.style.marginBottom="10px";for(var j=0;j<aCells.length;j++){var layoutCell=aCells[j];var domCell=document.createElement("div");var renderMethod=layoutCell.renderMethod?layoutCell.renderMethod.bind(this):null;domCell.className="mainLayoutCell";renderMethod(domCell,mapsModel);domRow.appendChild(domCell);}domTable.appendChild(domRow);domContent.appendChild(domTable);}domContent.onCreate=function(initData){};domContent.onShow=function(initData){};domContent.onHide=function(){};parentNode.appendChild(domContent);return domContent;}slayOne.views[viewKey]={render:render};})(window,window.slayOne,window.document);(function(window,slayOne,document){var viewKey="infoScreen";function render(screenTitle,screenContent){var domContainer=document.createElement("div");domContainer.className="infoScreen pixelated";var domWindowTitle=document.createElement("div");domWindowTitle.className="infoScreenTitle";domWindowTitle.innerHTML=screenTitle;domContainer.appendChild(domWindowTitle);var domContentWrap=document.createElement("div");domContentWrap.className="infoScreenContentWrap";var domContent=document.createElement("div");domContent.className="infoScreenContent";domContent.innerHTML=screenContent;domContentWrap.appendChild(domContent);domContainer.appendChild(domContentWrap);slayOne.viewHelpers.showPopup(viewKey,{theme:'light',content:domContainer});}slayOne.views[viewKey]={render:render};})(window,window.slayOne,window.document);(function(window,slayOne,document){var viewKey="hotkeyScreen";function showWindow(options){var domContent=document.createElement('div');domContent.className="hotkeyView";var viewModel={};var domHeader=document.createElement('div');domHeader.className="screenTitle";domHeader.innerHTML=slayOne.widgets.lang.get("hotkey.title");domContent.appendChild(domHeader);var domKeysContainer=document.createElement('div');domKeysContainer.className="hotkeysWrapper";var str="";for(var attribute in commandNames){var cmdKey=commandKeys[attribute];var name=window.commandNameLabels[attribute];var nameShow='';if((typeof name==="undefined"?"undefined":_typeof(name))==='object'&&name.hasOwnProperty('weapon')){nameShow=slayOne.widgets.lang.get('config.keyname.weaponSwitch').replace(/\[\[weapon\]\]/,slayOne.widgets.lang.get('weapons.'+name.weapon+'.name'));}else{nameShow=slayOne.widgets.lang.get(name);}str+="<div class='hotkeySubDiv'>"+nameShow;str+=" <button data-key='"+attribute+"' class='hotkey_button withClickSound' id='hotkey_"+attribute+"' onclick='changeHotkey1("+attribute+");'>";str+=getKeyName(cmdKey)+"</button></div>";}domKeysContainer.innerHTML=str;domContent.appendChild(domKeysContainer);slayOne.viewHelpers.showPopup(viewKey,{theme:'light',content:domContent,onClose:options.onClose});}function hideWindow(){slayOne.viewHelpers.hidePopup(viewKey);}slayOne.views[viewKey]={showWindow:showWindow,hideWindow:hideWindow};})(window,window.slayOne,window.document);(function(window,slayOne,document){var viewKey="playerProfileScreen";function renderPlayerMeta_(parentNode,viewModel){var profile=viewModel.profile;var str='';var self=!!(profile.pid==db_id&&game.mapWelcome&&!isSteam);str+='<div class="fullLine">Nickname: <span class="playerNick" style="color: '+NameColor.getColor()+'">'+escapeHtml(profile.displayName)+'</span> ';if(self){str+='<div class="F-Button changeNick info withClickSound">';str+='<div class="label"></div>';str+='<div class="hover"></div>';str+='</div>';}str+='</div>';str+='<div class="fullLine">Player ID: <span class="highlightedNum">'+profile.pid+'</span></div>';var dateCreated=new Date(parseInt(profile.tsCreated));if(profile.clanName&&profile.clanName.length>0){str+="<div class='fullLine'>"+F_("profile.clan.label",{clanName:"[<a class='playerClanName pseudoLink yellow withClickSound'>"+profile.clanName+"</a>]"})+"</div>";}str+="<div class='smallHalf'>"+F_("profile.level.label",{level:"<span class='highlightedNum'>"+getLvlFromXp(profile.exp)+"</span>"})+"</div>";str+="<div class='largeHalf'>"+F_("profile.elo.label",{elo:"<span class='highlightedNum'>"+profile.elo+"</span>"})+"</div>";str+="<div class='smallHalf'>"+F_("profile.num_kills.label",{numKills:"<span class='boldText green'>"+profile.numKills+"</span>"})+"</div>";var kdRateStr="";if(profile.numDeaths>0){kdRateStr=' '+F_("profile.kdrate.label",{rate:"<span class=''>"+Math.floor(parseInt(profile.numKills)/parseInt(profile.numDeaths)*10)/10+"</span>"});}str+="<div class='largeHalf'>"+F_("profile.num_death.label",{numDeaths:"<span class='boldText red'>"+profile.numDeaths+"</span>"})+kdRateStr+"</div>";var spawnTimeStr=dateCreated.getDate()+"/"+(dateCreated.getMonth()+1)+"/"+dateCreated.getFullYear();str+="<div class='fullLine'>"+F_("profile.spawn_time.label",{spawnTime:"<span class='highlightedNum'>"+spawnTimeStr+"</span>"})+"</div>";parentNode.innerHTML=str;if(self){parentNode.querySelector('.changeNick').addEventListener('click',function(){F$('changeNick').open();});}var clanLink=parentNode.querySelector(".playerClanName");if(clanLink){clanLink.addEventListener("click",function(){showClanInfo(profile.clanName);hide();});}}function renderChangeNameColor_(parentNode,viewModel){var profile=viewModel.profile;var self=!!(profile.pid==db_id&&game.mapWelcome);if(!self){return;}if(loginData.name_color.length<2){return;}var domBtnContainer=document.createElement('div');domBtnContainer.className="nameColorContainer";viewModel.btnChangeColor=slayOne.widgets.labelButton(domBtnContainer,{label:'change name color',theme:"LightGreen",customClassName:"changeNameColor",onClick:function onClick(){NameColor.show();}});parentNode.appendChild(domBtnContainer);}function renderPlayerDescription_(parentNode,viewModel){var profile=viewModel.profile;var domDesc=document.createElement('div');var str="";str+="<textarea spellcheck='false' class='playerDesc'";str+=" maxlength='255' readonly id='personal_text'>"+escapeHtml(profile.desc)+"</textarea>";domDesc.innerHTML=str;viewModel.taDesc=domDesc.querySelector(".playerDesc");parentNode.appendChild(domDesc);}function renderOperationsButtons_(parentNode,viewModel){var profile=viewModel.profile;var domBtnContainer=document.createElement('div');domBtnContainer.className="buttonsContainer";viewModel.btnEditDesc=slayOne.widgets.labelButton(domBtnContainer,{label:F_("profile.btn_desc_edit.label"),theme:"LightGreen",customClassName:"editDescButton",onClick:function onClick(){setDescEditEnabled_(viewModel,true);refreshButtonStatus_(viewModel);}});viewModel.btnSaveDesc=slayOne.widgets.labelButton(domBtnContainer,{label:F_("profile.btn_desc_save.label"),theme:"LightGreen",customClassName:"editDescButton",onClick:function onClick(){setDescEditEnabled_(viewModel,false);refreshButtonStatus_(viewModel);window.network.send("update-profile-text$"+viewModel.taDesc.value);}});parentNode.appendChild(domBtnContainer);setDescEditEnabled_(viewModel,false);refreshButtonStatus_(viewModel);}function setDescEditEnabled_(viewModel,enabled){viewModel.editingDesc=enabled;if(enabled){viewModel.taDesc.readOnly=false;addClassToDom(viewModel.taDesc,"editableDesc");viewModel.taDesc.focus();}else{viewModel.taDesc.readOnly=true;removeClassFromDom(viewModel.taDesc,"editableDesc");}}function refreshButtonStatus_(viewModel){viewModel.btnEditDesc.style.display='none';viewModel.btnSaveDesc.style.display='none';switch(viewModel.perspective){case'self':{viewModel.btnEditDesc.style.display=viewModel.editingDesc?'none':'block';viewModel.btnSaveDesc.style.display=viewModel.editingDesc?'block':'none';break;}case'guest':{break;}case'clan_admin':{break;}}}function show(options){var domContent=document.createElement('div');domContent.className="playerProfileView";var viewModel={btnEditDesc:null,btnSaveDesc:null,taDesc:null,editingDesc:false,perspective:options&&options.perspective?options.perspective:'guest',profile:options.profile};var domPlayerMeta=document.createElement('div');domPlayerMeta.className="playerMeta";renderPlayerMeta_(domPlayerMeta,viewModel);domContent.appendChild(domPlayerMeta);renderChangeNameColor_(domContent,viewModel);var domPlayerDescWrapper=document.createElement('div');domPlayerDescWrapper.className="playerDescWrapper";renderPlayerDescription_(domPlayerDescWrapper,viewModel);if(game.mapWelcome){renderOperationsButtons_(domPlayerDescWrapper,viewModel);}domContent.appendChild(domPlayerDescWrapper);slayOne.viewHelpers.showPopup(viewKey,{theme:'light',content:domContent,onClose:function onClose(){NameColor.hide();}});}function hide(){slayOne.viewHelpers.hidePopup(viewKey);}slayOne.views[viewKey]={show:show,hide:hide};})(window,window.slayOne,window.document);(function(window,slayOne,document){var viewKey="fbNameScreen";var domContainer;var nameInput;var playerEmail;var rendered=false;var callback=null;function render(){domContainer=document.createElement("div");domContainer.className="container";var logo=document.createElement("img");logo.src=window.ResourcePath+"imgs/welcome/logo.png";logo.className="logo";domContainer.appendChild(logo);var label=document.createElement("span");label.className="confirm-user-username";label.innerText=F_("fbName.confirm.label1");domContainer.appendChild(label);var inputContainer=document.createElement("div");inputContainer.className="inputName";inputContainer.style.verticalAlign="top";nameInput=slayOne.widgets.standardTextInput(inputContainer,{size:10,placeholder:"",cssId:"inputNumBots",skin:"standard",customClassName:"botNumTextInput",iconClassName:"iconUserName"});domContainer.appendChild(inputContainer);var btn=slayOne.widgets.labelButton(domContainer,{label:"save",theme:"LargeNormal ",customClassName:"buttonSave",onClick:function onClick(){btn.disabled=true;gaEventOnce('player-save-name-email');FacebookUtils.register(nameInput.value,playerEmail,function(msg){btn.disabled=false;if(msg.result==0){gaEventOnce('save-name-email-succeeded');hide();}if(typeof callback=="function"){callback(msg);}});}});}function show(name,email,cb){if(!rendered){render();}callback=cb;if(!!name){nameInput.value=name;}playerEmail=email;slayOne.viewHelpers.showPopup(viewKey,{theme:'prompt',content:domContainer});}function hide(){slayOne.viewHelpers.hidePopup(viewKey);}slayOne.views[viewKey]={show:show,hide:hide};})(window,window.slayOne,window.document);(function(slayOne,document){function selectionSwitcher(parentNode,options){var selectOptions=options.selectOptions;var onSwitch=options.onSwitch;var maxIndex=selectOptions.length-1;var indexSection=0;var currentSelection;var domSwitcher=document.createElement("div");var domText=slayOne.widgets.standardText(domSwitcher,'',{maxWidth:300,textAlign:"center",letterSpacing:-1});var domArrowLeft=document.createElement("div");var domArrowRight=document.createElement("div");if(options&&options.initIndex){indexSection=options.initIndex;}var setCurrentSelection=function setCurrentSelection(){currentSelection=selectOptions[indexSection];domText.setText(currentSelection.label);};domSwitcher.className="selectionSwitcher";domArrowLeft.className="switcherLeft switcherButtons";domArrowRight.className="switcherRight switcherButtons";domSwitcher.appendChild(domArrowLeft);domSwitcher.appendChild(domArrowRight);domArrowLeft.onclick=function(){indexSection--;if(indexSection<0){indexSection=maxIndex;}setCurrentSelection();onSwitch(currentSelection);};domArrowRight.onclick=function(){indexSection++;if(indexSection>maxIndex){indexSection=0;}setCurrentSelection();onSwitch(currentSelection);};slayOne.widgets.hoverLight(domArrowLeft,{width:'50px',height:'52px'});slayOne.widgets.hoverLight(domArrowRight,{width:'50px',height:'52px'});slayOne.widgets.clickable(domArrowLeft);slayOne.widgets.clickable(domArrowRight);setCurrentSelection();parentNode.appendChild(domSwitcher);}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.selectionSwitcher=selectionSwitcher;})(window.slayOne,window.document);(function(slayOne,document){function standardField(parentNode,domContent,options){var domField=document.createElement("div");var finalClassName="standardField";var skinOption="standard";if(options&&options.skin){skinOption=options.skin;}finalClassName+=" standardFieldSkin"+capitalize(skinOption);if(options&&options.customClassName){finalClassName+=" "+options.customClassName;}domField.className=finalClassName;domField.appendChild(domContent);parentNode.appendChild(domField);domField.setSkin=function(val){var finalClassName="standardField standardFieldSkin"+capitalize(val);if(options&&options.customClassName){finalClassName+=" "+options.customClassName;}this.className=finalClassName;}.bind(domField);return domField;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.standardField=standardField;})(window.slayOne,window.document);(function(slayOne,document){function standardTextInput(parentNode,options){var inputText=document.createElement("input");inputText.className="standardTextInput";var typeOption=options&&options.inputType?options.inputType:'text';inputText.type=typeOption;if(options.cssId){inputText.id=options.cssId;}if(options.size){inputText.size=options.size;}if(options.fontSize){inputText.style.fontSize=options.fontSize+"px";}else{inputText.style.fontSize="17px";}if(options.placeholder){inputText.placeholder=options.placeholder;}if(options&&options.iconClassName){var domIcon=document.createElement('div');domIcon.className="standardTextInputIcon "+options.iconClassName;parentNode.appendChild(domIcon);}inputText.addEventListener("keypress",function(e){if(e.which==10||e.which==13){if(options.onSubmit){window.soundManager.playSound(window.SOUND.CLICK);options.onSubmit(inputText.value);}}});slayOne.widgets.standardField(parentNode,inputText,options);return inputText;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.standardTextInput=standardTextInput;})(window.slayOne,window.document);(function(slayOne,document){function standardText(parentNode,text,options){var txt=document.createElement("span");var finalClassName="standardText";if(options&&options.customClassName){finalClassName+=" "+options.customClassName;}txt.className=finalClassName;var domLabel=document.createElement("span");domLabel.innerText=text;txt.appendChild(domLabel);if(options&&options.maxWidth){txt.style.maxWidth=options.maxWidth+"px";}if(options&&options.textAlign){txt.style.textAlign=options.textAlign;}else{txt.style.textAlign="center";}if(options&&options.letterSpacing){txt.style.letterSpacing=options.letterSpacing+"px";}var field=slayOne.widgets.standardField(parentNode,txt,{skin:options.skin,customClassName:options.customContainerClassName});txt.setText=function(val){domLabel.innerText=val;};txt.setSkin=function(val){field.setSkin(val);};return txt;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.standardText=standardText;})(window.slayOne,window.document);(function(window,slayOne,document){function dropdownMenu(parentNode,options){var domMenu=document.createElement("div");var domToggle=document.createElement("div");domToggle.className="dropdownToggleButton";domMenu.appendChild(domToggle);var finalClassName="dropdownMenu";if(options&&options.customClassName){finalClassName+=" "+options.customClassName;}domMenu.className=finalClassName;var initIndexOption=0;if(options&&options.initIndex){initIndexOption=options.initIndex;}domMenu.selectedIndex=initIndexOption;var domMainButton=slayOne.widgets.standardText(domMenu,options.selectOptions[initIndexOption].label,{textAlign:"left",customClassName:options.customButtonClassName});domMenu.optionsData=options.selectOptions;var tipWidth=options&&options.customButtonWidth?options.customButtonWidth:'202px';var tipHeight=options&&options.customButtonHeight?options.customButtonHeight:'40px';var domList=document.createElement("div");domList.className="dropdownMenuList";var optionsCount=options.selectOptions.length;for(var optionIndex=0;optionIndex<optionsCount;optionIndex++){var dataOption=options.selectOptions[optionIndex];var domOption=slayOne.widgets.standardText(domList,dataOption.label,{textAlign:"left",skin:domMenu.selectedIndex==optionIndex?"light":"dark",customContainerClassName:"dropdownMenuListItem",customClassName:options.customButtonClassName});domOption.dataset.optionIndex=optionIndex;domOption.onclick=function(idx){return function(){if(domMenu.selectOption(idx)){options.onSwitch(domMenu.optionsData[idx]);}};}(optionIndex);slayOne.widgets.hoverLight(domOption,{theme:'lite',width:tipWidth,height:tipHeight,top:'-5px',left:'-5px'});slayOne.widgets.clickable(domOption);}domMainButton.onclick=getDropDownMenuMainButtonClickCallback(domMainButton,domList,domToggle);slayOne.widgets.clickable(domMainButton);domList.style.display="none";domMenu.appendChild(domList);domMenu.selectOption=function(optionIndex){if(optionIndex==domMenu.selectedIndex){return false;}domList.children[domMenu.selectedIndex].setSkin("dark");domMenu.selectedIndex=optionIndex;domList.children[domMenu.selectedIndex].setSkin("light");var selectedOption=domMenu.optionsData[optionIndex];domMainButton.setText(selectedOption.label);return true;};if(options&&options.mainButtonTip&&options.mainButtonTip.length>0){slayOne.widgets.tooltip(domMainButton,{tip:options.mainButtonTip});}parentNode.appendChild(domMenu);return domMenu;}function getDropDownMenuMainButtonClickCallback(domMainButton,domList,domToggle){return function dropDownMenuMainButtonClickCallback(){if(domList.style.display=="none"){var hideDropDownList=function hideDropDownList(){domList.style.display="none";domToggle.className="dropdownToggleButton";document.removeEventListener("click",hideDropDownList);};domList.style.display="block";domToggle.className="dropdownToggleButtonActive";domMainButton.tipEffect&&domMainButton.tipEffect.hide();setTimeout(function(){document.addEventListener("click",hideDropDownList);},0);}else{domList.style.display="none";domToggle.className="dropdownToggleButton";domMainButton.tipEffect&&domMainButton.tipEffect.show();}};}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.dropdownMenu=dropdownMenu;})(window,window.slayOne,window.document);(function(slayOne,document){var themeSizes={StandardGreen:{w:'160px',h:'60px'},LargeGreen:{w:'240px',h:'60px'},StandardYellow:{w:'160px',h:'60px'},LargeYellow:{w:'240px',h:'60px'},LargeBrown:{w:'286px',h:'68px'},LightGreen:{w:'278px',h:'48px'},LightDarkGreen:{w:'278px',h:'48px'},LightDisabled:{w:'278px',h:'48px'},LightFacebook:{w:'278px',h:'48px'},LightTwitch:{w:'278px',h:'48px'},TinyGreen:{w:'168px',h:'46px'},TinyRed:{w:'168px',h:'46px'},StandardTab:{w:'212px',h:'56px'},StandardTabActivated:{w:'212px',h:'56px'},SmallNormal:{w:'88px',h:'50px'},LargeNormal:{w:'206px',h:'54px'},LargeFBNormal:{w:'206px',h:'54px'},HugeNormal:{w:'246px',h:'54px'}};function labelButton(parentNode,options){var btn=document.createElement("div");var btnTheme=options&&options.theme?options.theme:"StandardYellow";var finalClassName="pixelated labelButton labelButton"+btnTheme;if(options&&options.customClassName){finalClassName+=' '+options.customClassName;}var multiline=options&&options.multiline?options.multiline:false;if(multiline){btn.innerHTML='<div class="labelMultiline">'+options.label+'</div>';}else{btn.innerHTML='<div class="label">'+options.label+'</div>';}btn.className=finalClassName;slayOne.widgets.clickable(btn);btn.onclick=options.onClick;if(!options||!options.noHoverLight){btn.presentSubComponent("hover");}if(options&&options.tip&&options.tip.length>0){btn.tipEffect=slayOne.widgets.tooltip(btn,{tip:options.tip,align:options.tipAlign});}parentNode.appendChild(btn);btn.setTheme=function(val){var finalClassName="pixelated labelButton labelButton"+val;if(options&&options.customClassName){finalClassName+=' '+options.customClassName;}btn.className=finalClassName;slayOne.widgets.clickable(btn);};return btn;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.labelButton=labelButton;})(window.slayOne,window.document);(function(window,slayOne,document){var iconButtonSizes={standard:{w:'62px',h:'66px'},small:{w:'44px',h:'48px'}};function iconButton(parentNode,options){var btn=document.createElement("div");var themeOption=options&&options.theme?options.theme:"standard";if(options&&options.cssId){btn.id=options.cssId;}var finalClassName="pixelated iconButton";if(options&&options.customClassName){finalClassName+=' '+options.customClassName;}btn.className=finalClassName;var domBackground=document.createElement("div");domBackground.className="iconButtonBackground"+capitalize(themeOption);btn.appendChild(domBackground);var domContent=document.createElement("div");domContent.className="iconButtonIcon iconButtonIcon"+capitalize(themeOption)+" "+options.iconClassName;btn.appendChild(domContent);slayOne.widgets.clickable(btn);btn.onclick=function(){options.onClick();};parentNode.appendChild(btn);slayOne.widgets.hoverLight(btn,{width:iconButtonSizes[themeOption].w,height:iconButtonSizes[themeOption].h});var isTipEnabled=options.tip&&options.tip.length>0;if(isTipEnabled){btn.tipEffect=slayOne.widgets.tooltip(btn,{tip:options.tip});}return btn;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.iconButton=iconButton;})(window,window.slayOne,window.document);(function(window,slayOne,document){function tooltip(parentNode,options){var domTip=parentNode.querySelector(".standardTooltipContainer");if(!domTip){domTip=document.createElement("div");var finalClassName="standardTooltipContainer";var verticalAlignOption=options&&options.verticalAlign?options.verticalAlign:"bottom";if(verticalAlignOption=="top"){finalClassName+=" standardTooltipContainerOnTop";}domTip.className=finalClassName;domTip.style.display="none";parentNode.appendChild(domTip);parentNode.addEventListener("mouseover",function(){domTip.style.display="block";});parentNode.addEventListener("mouseout",function(){domTip.style.display="none";});}var tooltipClassName='standardTooltip';var isMultiline=options&&options.multiline?options.multiline:false;if(isMultiline){tooltipClassName="standardTooltipMultiline";var tipWidth=options&&options.width?options.width:'200px';domTip.style.width=tipWidth;domTip.innerHTML='<div class="'+tooltipClassName+'"><span>'+options.tip+'</span></div>';}else{domTip.innerHTML='<div class="'+tooltipClassName+'"><span>'+options.tip+'</span></div>';}var alignment="left";if(options&&options.align){alignment=options.align;}switch(alignment){case"left":{domTip.style.left='2px';domTip.style.right='auto';domTip.style.display='none';domTip.querySelector("."+tooltipClassName).style.left='0';break;}case"center":{domTip.style.left='50%';domTip.style.right='auto';domTip.style.display='none';domTip.querySelector("."+tooltipClassName).style.left='-50%';break;}case"right":{domTip.style.right='2px';domTip.style.left='auto';domTip.style.display='none';domTip.querySelector("."+tooltipClassName).style.right="0";break;}}domTip.hide=function(){domTip.style.display="none";};domTip.show=function(){domTip.style.display="block";};parentNode.tipEffect=domTip;return domTip;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.tooltip=tooltip;})(window,window.slayOne,window.document);(function(window,slayOne,document){var themeBorderSizes={normal:{w:'32px',h:'32px'},lite:{w:'24px',h:'24px'}};function hoverLight(parentNode,options){var themeOption=options&&options.theme?options.theme:'normal';var domHover=parentNode.querySelector(".hoverLight");if(!domHover){domHover=document.createElement("div");domHover.className="hoverLight hoverLight"+capitalize(themeOption);parentNode.appendChild(domHover);parentNode.addEventListener("mouseover",function(){domHover.style.display="block";});parentNode.addEventListener("mouseout",function(){domHover.style.display="none";});}domHover.style.width='calc('+options.width+' - '+themeBorderSizes[themeOption].w+')';domHover.style.height='calc('+options.height+' - '+themeBorderSizes[themeOption].h+')';if(options.left){domHover.style.left=options.left;}if(options.top){domHover.style.top=options.top;}domHover.style.display="none";return domHover;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.hoverLight=hoverLight;})(window,window.slayOne,window.document);(function(window,slayOne,document){var factoryMethods={light:lightPopupWindow,tabbed:tabbedPopupWindow,standard:standardPopupWindow,prompt:lightPopupWindow};function popupWindow(parentNode,options){var themeOption=options&&options.theme?options.theme:"light";return factoryMethods[themeOption](parentNode,options);}function lightPopupWindow(parentNode,options){var domWindow=document.createElement("div");domWindow.id=options.windowName;domWindow.className="popupWndWrapper";domWindow.closePopUp=function(){options.onClose&&options.onClose();};var themeClassName="popupWndFrameLight";var domMask=document.createElement("div");domMask.className="popupWndMask";domWindow.appendChild(domMask);var domContentWindow=document.createElement("div");domContentWindow.className="popupWndContent "+themeClassName;domContentWindow.appendChild(options.content);if(!(options&&options.hideCloseBtn)){var domCloseBtn=document.createElement("div");domCloseBtn.className="popupWndCloseBtn";domCloseBtn.innerHTML='<img src="'+window.ResourcePath+'imgs/main_ui/icon_close.png">';domCloseBtn.onclick=domWindow.closePopUp;slayOne.widgets.clickable(domCloseBtn);domContentWindow.appendChild(domCloseBtn);}domWindow.appendChild(domContentWindow);parentNode.appendChild(domWindow);return domWindow;}function standardPopupWindow(parentNode,options){var domWindow=document.createElement("div");domWindow.id=options.windowName;domWindow.className="popupWndWrapper";var themeClassName="popupWndFrameStandard";var domMask=document.createElement("div");domMask.className="popupWndMask";domWindow.appendChild(domMask);var domContentWindow=document.createElement("div");domContentWindow.className="popupWndContent "+themeClassName;var domWindowBg=document.createElement("div");domWindowBg.className="popupWndStandardBg";domContentWindow.appendChild(domWindowBg);if(options&&options.title){var domTitle=document.createElement("div");domTitle.className="popupWndTitleWrapper";domTitle.innerHTML='<div class="popupWndTitle"><div class="popupWndTitleBg"></div><div class="popupWndTitleContent">'+options.title+'</div></div>';domContentWindow.appendChild(domTitle);}var domTabContent=document.createElement("div");domTabContent.className="popupWndViewContainer";domTabContent.appendChild(options.content);domContentWindow.appendChild(domTabContent);domWindow.closePopUp=function(){options.onClose&&options.onClose();};var domCloseBtn=document.createElement("div");domCloseBtn.className="popupWndCloseBtn pixelated";domCloseBtn.innerHTML='<img src="'+window.ResourcePath+'imgs/main_ui/icon_close_tabbed.png">';domCloseBtn.onclick=domWindow.closePopUp;slayOne.widgets.clickable(domCloseBtn);domContentWindow.appendChild(domCloseBtn);slayOne.widgets.hoverLight(domCloseBtn,{width:'58px',height:'60px'});domWindow.appendChild(domContentWindow);parentNode.appendChild(domWindow);return domWindow;}function tabbedPopupWindow(parentNode,options){var domWindow=document.createElement("div");domWindow.id=options.windowName;domWindow.className="popupWndWrapper";var themeClassName="popupWndFrameTabbed";var domMask=document.createElement("div");domMask.className="popupWndMask";domWindow.appendChild(domMask);var domContentWindow=document.createElement("div");domContentWindow.className="popupWndContent "+themeClassName;var domWindowBg=document.createElement("div");domWindowBg.className="popupWndStandardBg";domContentWindow.appendChild(domWindowBg);if(options&&options.title){var domTitle=document.createElement("div");domTitle.className="popupWndTitleWrapper";domTitle.innerHTML='<div class="popupWndTitle"><div class="popupWndTitleBg"></div><div class="popupWndTitleContent">'+options.title+'</div></div>';domContentWindow.appendChild(domTitle);}var domTabButtons=document.createElement("div");domTabButtons.className="popupWndTabbedButtonContainer";domWindow.tabButtons=[];var tabButtonsCount=options.tabs.length;for(var tabButtonIndex=0;tabButtonIndex<tabButtonsCount;tabButtonIndex+=1){var tabButton=slayOne.widgets.labelButton(domTabButtons,{theme:'StandardTab',label:options.tabs[tabButtonIndex].label,onClick:function(btnIndex){return function(){domWindow.selectTab(btnIndex);};}(tabButtonIndex),tip:options.tabs[tabButtonIndex].tip,tipAlign:"center"});domWindow.tabButtons.push(tabButton);}var domTabContent=document.createElement("div");domTabContent.className="popupWndTabbedViewContainer";domContentWindow.appendChild(domTabContent);domContentWindow.appendChild(domTabButtons);domWindow.closePopUp=function(){if(domTabContent.firstChild){domTabContent.firstChild.onHide&&domTabContent.firstChild.onHide();}options.onClose&&options.onClose();};var domCloseBtn=document.createElement("div");domCloseBtn.className="popupWndCloseBtn pixelated";domCloseBtn.innerHTML='<img src="'+window.ResourcePath+'imgs/main_ui/icon_close_tabbed.png">';domCloseBtn.onclick=domWindow.closePopUp;slayOne.widgets.clickable(domCloseBtn);domContentWindow.appendChild(domCloseBtn);slayOne.widgets.hoverLight(domCloseBtn,{width:'58px',height:'60px'});domWindow.currentTabIndex=-1;domWindow.cachedViews={};domWindow.tabsData=options.tabs;domWindow.selectTab=function(selectedTabIndex,tabData){if(selectedTabIndex==domWindow.currentTabIndex){return;}if(domTabContent.firstChild){domTabContent.firstChild.onHide&&domTabContent.firstChild.onHide();domTabContent.removeChild(domTabContent.firstChild);}if(domWindow.currentTabIndex>=0){domWindow.tabButtons[domWindow.currentTabIndex].setTheme('StandardTab');}domWindow.currentTabIndex=selectedTabIndex;var nextTabData=domWindow.tabsData[selectedTabIndex];var nextView=domWindow.cachedViews[nextTabData.view];if(nextView){domTabContent.appendChild(nextView);}else{nextView=domWindow.cachedViews[nextTabData.view]=slayOne.views[nextTabData.view].render(domTabContent,{});nextView.onCreate&&nextView.onCreate(tabData);}domWindow.tabButtons[domWindow.currentTabIndex].setTheme('StandardTabActivated');nextView.onShow&&nextView.onShow(tabData);};domWindow.appendChild(domContentWindow);parentNode.appendChild(domWindow);var initTabIndex=0;if(options&&options.initTabIndex){initTabIndex=options.initTabIndex;}domWindow.selectTab(initTabIndex);return domWindow;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.popupWindow=popupWindow;})(window,window.slayOne,window.document);(function(window,slayOne,document){function loadingIndicator(parentNode,options){var domContainer=document.createElement("div");domContainer.className="loadingIndicator";if(options&&options.width){domContainer.style.width=options.width;}if(options&&options.height){domContainer.style.height=options.height;}var domDotsWrapper=document.createElement("div");domDotsWrapper.className="dotsWrapper";domContainer.appendChild(domDotsWrapper);var domDots=[];var dotsCount=4;for(var i=0;i<dotsCount;i++){var domDot=document.createElement("div");domDot.className="dot";domDots.push(domDot);domDotsWrapper.appendChild(domDot);}parentNode.appendChild(domContainer);domContainer.animationInterval=-1;domContainer.startAnimation=function(){domContainer.stopAnimation();domContainer.setDotOffset(0);domContainer.animationInterval=setInterval(function(){domContainer.setDotOffset((domContainer.dotOffset+1)%dotsCount);},125);};domContainer.stopAnimation=function(){if(domContainer.animationInterval==-1){return;}clearInterval(domContainer.animationInterval);domContainer.animationInterval=-1;};domContainer.setDotOffset=function(dotOffset){domContainer.dotOffset=dotOffset;domContainer.updateDotClasses();};domContainer.updateDotClasses=function(){for(var i=0;i<dotsCount;i++){domDots[i].className="dot dot"+((dotsCount-domContainer.dotOffset+i)%dotsCount).toString();}};return domContainer;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.loadingIndicator=loadingIndicator;})(window,window.slayOne,window.document);(function(window,slayOne,document){function checkbox(parentNode,options){var domContainer=document.createElement("div");var finalClassName="checkboxWrapper";if(options&&options.customClassName){finalClassName+=" "+options.customClassName;}domContainer.className=finalClassName;var initSelected=false;if(options&&options.selected){initSelected=options.selected;}var widgetModel={selected:initSelected,onChange:null};if(options&&options.onChange){widgetModel.onChange=options.onChange;}var domWidget=document.createElement("div");domWidget.className="checkboxIconWrapper";var domWidgetSelected=document.createElement("div");domWidgetSelected.className="checkboxIconSelected";domWidgetSelected.style.display=initSelected?"block":"none";domWidget.appendChild(domWidgetSelected);domContainer.appendChild(domWidget);var domLabel=document.createElement("div");var labelClassName="checkboxLabel";if(options&&options.labelClassName){labelClassName+=' '+options.labelClassName;}domLabel.className=labelClassName;domLabel.innerHTML=options.label;domContainer.appendChild(domLabel);domContainer.toggleSelected=function(){domContainer.setSelected(!domContainer.getSelected());};domContainer.setSelected=function(val){if(widgetModel.selected==val){return;}widgetModel.selected=val;domWidgetSelected.style.display=val?"block":"none";widgetModel.onChange&&widgetModel.onChange(widgetModel.selected);};domContainer.getSelected=function(){return widgetModel.selected;};domContainer.addEventListener("click",function(){domContainer.toggleSelected();});slayOne.widgets.clickable(domContainer);if(options&&options.tip){var tipAlignOption=options&&options.tipAlign?options.tipAlign:"center";if(options&&options.tipMultiline){var tipWidthOption=options&&options.tipWidth?options.tipWidth:"200px";slayOne.widgets.tooltip(domContainer,{tip:options.tip,align:tipAlignOption,multiline:true,width:tipWidthOption});}else{slayOne.widgets.tooltip(domContainer,{tip:options.tip,align:tipAlignOption});}}parentNode.appendChild(domContainer);return domContainer;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.checkbox=checkbox;})(window,window.slayOne,window.document);(function(window,slayOne,document){function floatTip(options){var typeOption=options&&options.tipType?options.tipType:"success";var domContainer=document.createElement('div');domContainer.className="floatTipContainer floatTipType"+capitalize(typeOption);var domIcon=document.createElement('div');domIcon.className="floatTipIcon";domContainer.appendChild(domIcon);var domContent=document.createElement('div');domContent.className="floatTipContent";domContent.innerHTML=options.content;domContainer.appendChild(domContent);domContainer.startShowAnimation=function(cbComplete){addClassToDom(domContainer,"floatTipShowing");domContainer.tipHideCallback=cbComplete;var durationOption=options&&options.duration?options.duration:5000;if(durationOption<=0){domContainer.hideTimeout=-1;return;}domContainer.hideTimeout=setTimeout(function(){domContainer.startHideAnimation(cbComplete);},durationOption);};domContainer.startHideAnimation=function(){if(domContainer.hideTimeout>0){clearTimeout(domContainer.hideTimeout);domContainer.hideTimeout=-1;}removeClassFromDom(domContainer,"floatTipShowing");addClassToDom(domContainer,"floatTipHiding");setTimeout(function(){domContainer.tipHideCallback&&domContainer.tipHideCallback();},500);};domContainer.setContent=function(val){domContent.innerHTML=val;};return domContainer;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.floatTip=floatTip;})(window,window.slayOne,window.document);(function(window,slayOne,document){var clickableClassName="withClickSound";function clickable(targetNode){addClassToDom(targetNode,clickableClassName);}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.clickable=clickable;window.document.addEventListener("click",function(e){var node=e.target;var hasClickableClass=false;var depth=0;var maxDetectDepth=5;while(depth<maxDetectDepth&&node!=null){depth+=1;if(node.className&&node.className.indexOf(clickableClassName)>=0){hasClickableClass=true;break;}node=node.parentNode;}if(hasClickableClass){window.soundManager.playSound(window.SOUND.CLICK);}});})(window,window.slayOne,window.document);(function(window,slayOne,document){var languageObject={locale:null,supportedLocales:{'ar-SA':'العربية','de-DE':'Deutsch','en-US':'English','es-ES':'español','fr-FR':'français','id-ID':'Bahasa Indonesia','it-IT':'italiano','ja-JP':'日本語','ko-KR':'한국어','pl-PL':'polski','pt-BR':'português(Brazil)','ru-RU':'русский','th-TH':'ไทย','tr-TR':'Türkçe','zh-TW':'中文(繁體)','zh-CN':'中文(简体)'},defaultLocale:'en-US',data:{},get:function get(key,params){var result=this.data[this.locale][key];if(!result||result.length<=0){return"";}if(params){result=result.replace(/\[\[([^\]]+)]]/g,function(pattern,key){return params[key];});}return result;},initialize:function initialize(callback){var self=this;this.locale=this.getClosestLocale(this.getPreferredLocale()||FacebookUtils.locale||this.getSystemLocale());document.documentElement.setAttribute("lang",this.locale);ajax(window.ResourcePath+"locales/"+this.locale+".json",function(data){self.data[self.locale]=JSON.parse(data);callback();});},getPreferredLocale:function getPreferredLocale(){var result=null;try{result=window.localStorage.getItem("langChosen");}catch(e){result=null;}return result;},setPreferredLocale:function setPreferredLocale(val){try{window.localStorage.setItem("langChosen",val);}catch(e){console.error(e);}},getSystemLocale:function getSystemLocale(){if(window.navigator.languages&&window.navigator.languages.length!=0){return window.navigator.languages;}return window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage;},getClosestLocale:function getClosestLocale(locale){if(!Array.isArray(locale)){locale=[locale];}locale.map(function(lang){if(typeof lang!='string'){return'none';}return lang.replace("_","-");});var _iteratorNormalCompletion34=true;var _didIteratorError34=false;var _iteratorError34=undefined;try{for(var _iterator34=locale[Symbol.iterator](),_step34;!(_iteratorNormalCompletion34=(_step34=_iterator34.next()).done);_iteratorNormalCompletion34=true){var lang=_step34.value;if(this.supportedLocales[lang]){return lang;}}}catch(err){_didIteratorError34=true;_iteratorError34=err;}finally{try{if(!_iteratorNormalCompletion34&&_iterator34.return){_iterator34.return();}}finally{if(_didIteratorError34){throw _iteratorError34;}}}for(var i=0;i<locale.length;i++){var lang=locale[i];for(var itrLang in this.supportedLocales){if(!this.supportedLocales.hasOwnProperty(itrLang))continue;var strikeIndex=lang.indexOf("-");var main=strikeIndex>=0?lang.substr(0,strikeIndex):lang;if(itrLang.indexOf(main)==0){return itrLang;}}}return this.defaultLocale;}};if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.lang=languageObject;})(window,window.slayOne,window.document);(function(window,slayOne,document){function rangeSelection(parentNode,options){var domContainer=document.createElement("div");var classNameOption=options&&options.customClassName?options.customClassName:'';domContainer.innerHTML="<input class='"+classNameOption+"' type='range' min='"+options.min+"' max='"+options.max+"' step='"+options.step+"' value='"+options.value+"' id='soundRange'/>";parentNode.appendChild(domContainer);domContainer.querySelector("input").onchange=function(e){options.onChange(e.target.value);};return domContainer;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.rangeSelection=rangeSelection;})(window,window.slayOne,window.document);(function(window,slayOne,document){function topLabelled(options){var domContainer=document.createElement('div');var finalClassName="labelledContainer";if(options&&options.customClassName){finalClassName+=" "+options.customClassName;}domContainer.className=finalClassName;var domLabel=document.createElement('div');domLabel.className="widgetLabel";domLabel.innerHTML=options.label;domContainer.appendChild(domLabel);var domWidget=document.createElement('div');domWidget.className="widgetContainer";domWidget.appendChild(options.content);domContainer.appendChild(domWidget);return domContainer;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.topLabelled=topLabelled;})(window,window.slayOne,window.document);(function(window,slayOne,document){function getPredefinedButtonConfig(buttonLabel){switch(buttonLabel){case'ok':{return{btnName:'ok',label:slayOne.widgets.lang.get("prompt.btn_ok.label"),theme:"TinyGreen"};}case'cancel':{return{btnName:'cancel',label:slayOne.widgets.lang.get("prompt.btn_cancel.label"),theme:"TinyRed"};}}return null;}function promptWindow(options){var domContainer=document.createElement('div');domContainer.className="promptContainer";var titleOption=options&&options.title?options.title:"";if(titleOption&&titleOption.length>0){var domTitle=document.createElement('div');domTitle.className="promptTitle";domTitle.innerHTML=titleOption;domContainer.appendChild(domTitle);}var domContent=document.createElement('div');domContent.className="promptContent";domContent.innerHTML=options.content;domContainer.appendChild(domContent);var domBtnContainer=document.createElement('div');domBtnContainer.className="promptBtnContainer";options.buttons.forEach(function(btnOption){if(typeof btnOption=='string'){btnOption=getPredefinedButtonConfig(btnOption);}if(!btnOption){return;}var lastClick=btnOption.onClick;btnOption.onClick=function(){options.onClick&&options.onClick(btnOption.btnName);lastClick&&lastClick();};slayOne.widgets.labelButton(domBtnContainer,btnOption);});domContainer.appendChild(domBtnContainer);return domContainer;}if(!slayOne.widgets){slayOne.widgets={};}slayOne.widgets.prompt=promptWindow;})(window,window.slayOne,window.document);var currentProfile=null,SOUND=window.SOUND,keyNames=window.keyNames,entityMap={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'},buttonData={exitGame:{widget:"iconButton",cssId:"btnExitGame",iconClass:"iconButtonExitGame",methodShow:function methodShow(){attemptExitGame();},methodShouldShow:function methodShouldShow(){return isInGame();},label:"top.buttons.exit_game.tooltip"},exitApp:{widget:"iconButton",cssId:"btnExitApp",iconClass:"iconButtonExitGame",methodShow:function methodShow(){attemptExitApp();},methodShouldShow:function methodShouldShow(){return!isInGame()&&window.isDesktop;},label:"top.buttons.exitApp.tooltip"},gameOptions:{widget:"iconButton",cssId:"btnOptions",iconClass:"iconButtonOptions",methodShow:function methodShow(){toggleOptionsMenu();},label:"top.buttons.options.tooltip"},fullScreen:{widget:"iconButton",cssId:"btnSeparate",iconClass:"iconButtonFullScreen",methodShow:function methodShow(){toggleFullscreen(document.documentElement);},methodShouldShow:function methodShouldShow(){return true;},label:"options.btn_fullscreen.tooltip"},rankings:{widget:"iconButton",cssId:"btnRankList",iconClass:"iconButtonRankList",methodShow:function methodShow(){window.uiManager.togglePlayerList();},methodShouldShow:function methodShouldShow(){return!isInGame();},label:"top.buttons.ranking.tooltip"},myProfile:{widget:"iconButton",cssId:"btnProfile",iconClass:"iconButtonProfile",methodShow:function methodShow(){uiManager.showPlayerInfoById(db_id);},methodShouldShow:function methodShouldShow(){return!isInGame()&&authLevel>=AUTH_LEVEL.PLAYER;},label:"top.buttons.profile.tooltip"},myClan:{widget:"iconButton",cssId:"btnClanList",iconClass:"iconButtonClanList",methodShow:function methodShow(){window.uiManager.requestMyClanInfo();},methodShouldShow:function methodShouldShow(){return!isInGame()&&authLevel>=AUTH_LEVEL.PLAYER;},label:"top.buttons.myclan.tooltip"},wiki:{widget:"iconButton",cssId:"btnChat",iconClass:"iconButtonChat",methodShow:function methodShow(){window.open(slayOne.widgets.lang.get('url.chat'),"_blank");},methodShouldShow:function methodShouldShow(){return!isInGame()&&!isSteam;},label:"top.buttons.chat.tooltip"},mapEditor:{widget:"iconButton",cssId:"btnMapEditor",iconClass:"iconButtonMapEditor",methodShow:function methodShow(){launchEditor();},methodShouldShow:function methodShouldShow(){return!isInGame()&&authLevel>=AUTH_LEVEL.MOD;},label:"top.buttons.map_editor.tooltip"}};function renderMainMenu_(parentNode){var cssId="menuButtonContainer";var menuButtonContainer=document.getElementById(cssId)||document.createElement("div");menuButtonContainer.id=cssId;menuButtonContainer.setAttribute("data-noclick",'yes');for(var buttonKey in buttonData){var btnData=buttonData[buttonKey];if(btnData.widget=="iconButton"){btnData.instance=slayOne.widgets.iconButton(menuButtonContainer,{cssId:btnData.cssId,iconClassName:btnData.iconClass,onClick:btnData.methodShow,tip:slayOne.widgets.lang.get(btnData.label)});}else if(btnData.widget=="labelButton"){btnData.instance=slayOne.widgets.labelButton(menuButtonContainer,{cssId:btnData.cssId,iconClassName:btnData.iconClass,onClick:btnData.methodShow,label:slayOne.widgets.lang.get(btnData.iconLabel),multiline:btnData.multiline,tip:slayOne.widgets.lang.get(btnData.label),theme:btnData.theme});}btnData.instance.style.display="none";}if(isSteam){try{var ele=document.createElement('div');ele.id='steam-addon';var btn1=document.createElement('div');btn1.innerHTML='<a href="#"><img src="'+window.ResourcePath+'imgs/btn_link.png"></img><div class="hover"></div></a>';btn1.onclick=function(){F$('goRoom').show();};ele.appendChild(btn1);menuButtonContainer.appendChild(ele);}catch(err){}}else{try{var ele=document.createElement('div');ele.id='greenlight-button';var btn1=document.createElement('div');btn1.innerHTML="<a target='_blank' href='https://store.steampowered.com/app/743350/Slayone/?utm_source=official&utm_term=index'><img width=218 height=64 src='"+window.ResourcePath+"imgs/steam.png'></img><div class='hover'></div></a>";btn1.tooltipData=F_('home.tooltip.steam');var btn2=document.createElement('div');btn2.innerHTML="<a target='_blank' href='https://trello.com/b/pIJc0nLA/slayone-development'><img width=142 height=64 src='"+window.ResourcePath+"imgs/patchnotes.png'></img><div class='hover'></div></a>";btn2.tooltipData=F_('home.tooltip.patchnotes');ele.appendChild(btn1);menuButtonContainer.appendChild(ele);}catch(err){}}parentNode.appendChild(menuButtonContainer);};function UIManager(){};UIManager.prototype.requestMyClanInfo=function(){F$('clanMain').show();};var displayMsgCloseButtonCreated=false;function displayMsg(msg){if(!displayMsgCloseButtonCreated){displayMsgCloseButtonCreated=true;document.getElementById("serverInfoDiv").appendChild(uiManager.createCloseButton());}document.getElementById("serverInfoDivContent").innerHTML=msg;document.getElementById("serverInfoDiv").style.display="inline";};function setOptions(){sound_volume=parseFloat(document.getElementById("soundRange").value);localStorage.setItem("sound_volume",sound_volume);minimapSizeFactor=parseFloat(document.getElementById("minimapSizeFactor").value);localStorage.setItem("minimapSizeFactor",minimapSizeFactor);graphicSettings=document.getElementById("graphicSettings").checked?0:10;localStorage.setItem("graphicSettings",graphicSettings);weaponsUnclickable=document.getElementById("weaponsUnclickable").checked;localStorage.setItem("weaponsUnclickable",weaponsUnclickable);hideChat=document.getElementById("hideChat").checked;localStorage.setItem("hideChat",hideChat);document.getElementById("chatDisplayDiv").style.display=hideChat?"none":"block";};function toggleOptionsMenu(){slayOne.views.optionsScreen.showWindow({});};UIManager.prototype.togglePlayerList=function(page,alwaysOpen,elo){var el=document.getElementById("optionsWindow");el.className="optionsWindow1 basicWindow";if(!alwaysOpen&&el.style.display=="inline"&&el.getAttribute("data-windowtype")=="playerlist"){el.style.display="none";return;}el.style.display="inline";network.send("playerList$"+(page?page:"0")+"$"+(elo?"1":"0"));};var showTutorialWindow_=function showTutorialWindow_(){var videoURLs={'en':'//www.youtube.com/embed/dMtZiL1lnaM','pt':'//www.youtube.com/embed/ky3uTWJIMtg','es':'//www.youtube.com/embed/ieKZ0BIvNuM'};var videoURL=videoURLs[slayOne.widgets.lang.locale];if(!videoURL){videoURL=videoURLs['en'];}localStorage.setItem("tutorialVideoShown","true");uiManager.refreshMenuButtons();var domContent=document.createElement("div");var videoOrigin=window.location.protocol+"//"+window.location.host;var domContentHTML='<iframe width="600" height="338" src="'+videoURL+'?autoplay=1&origin='+videoOrigin+'" frameborder="0" allowfullscreen></iframe>';domContentHTML+='<div class="faqTips">';domContentHTML+=slayOne.widgets.lang.get("faq.content",{fbFanPage:'<a class="withClickSound" href="https://www.facebook.com/slay.one.game/" target="_blank">'+slayOne.widgets.lang.get("faq.content.facebook")+'</a>',subreddit:'<a class="withClickSound" href="https://www.reddit.com/r/slayone" target="_blank">'+slayOne.widgets.lang.get("faq.content.reddit")+'</a>'});domContentHTML+='</div>';domContent.innerHTML=domContentHTML;slayOne.viewHelpers.showWindow({domContent:domContent,headerLabel:slayOne.widgets.lang.get("faq.title"),onClose:function onClose(){slayOne.viewHelpers.hideWindow();if(!game||game.mapWelcome){var viewModel={authLevel:authLevel};slayOne.views.homeScreen.render(viewModel);}}});};function onSubmit(e){if(!$('#check1').prop('checked')){displayMsg("You have to accept the text");e.preventDefault();return false;}if(!$('#check2').prop('checked')){displayMsg("You have to accept the terms and conditions");e.preventDefault();return false;}var radioVal=$('input[name="legal_radio"]:checked').val();if(!radioVal){displayMsg("You have to select a cancellation policy option");e.preventDefault();return false;}$('#buy_form_item_number')[0].value=$('#original_value')[0].value+"_"+radioVal;setTimeout(function(){document.getElementById("optionsWindow").innerHTML="<div style='width: 100%; text-align: center; margin-top: 200px; font-size: 26px;'>waiting while payment is being handled ...</div>";},1000);return true;};function toggleImprint(){slayOne.viewHelpers.showInfoScreen({title:"Imprint",content:"<div>Slay.one is a free indie 2D multiplayer topdown shooter for browsers. For more info, you can check out our <a class='withClickSound' href=\"https://www.reddit.com/r/WebGames/comments/5b48nw/slayone_a_multiplayer_topdown_shooter_were_the/\" target=\"_blank\">Reddit AMA</a>.<br><br>Publisher:<br><br>KingsGroup Holding<br>San Francisco, CA, USA<br><br>Contact Email: <a class='withClickSound' href=\"mailto:support@slay.one\">support@slay.one</a><br></div>"});};function toggleAGB(){slayOne.viewHelpers.showFullScreenLoading();ajax("legalities/agb.html",function(data){slayOne.viewHelpers.hideFullScreenLoading();slayOne.viewHelpers.showInfoScreen({title:"General Terms and Conditions",content:data});});};function showAGB2(){slayOne.viewHelpers.showFullScreenLoading();ajax("legalities/agb.html",function(data){slayOne.viewHelpers.hideFullScreenLoading();slayOne.viewHelpers.showInfoScreen({title:"General Terms and Conditions",content:data});});};function toggleWRE(){ajax("legalities/wre.html",function(data){slayOne.viewHelpers.showInfoScreen({title:"Cancellation Policy",content:data});});};function toggleDSE(){slayOne.viewHelpers.showFullScreenLoading();ajax("legalities/dse.html",function(data){slayOne.viewHelpers.hideFullScreenLoading();slayOne.viewHelpers.showInfoScreen({title:"Privacy Policy",content:data});});};UIManager.prototype.toggleClanList=function(page,alwaysOpen){var el=document.getElementById("optionsWindow");el.className="optionsWindow1 basicWindow";if(!alwaysOpen&&el.style.display=="inline"&&el.getAttribute("data-windowtype")=="clanlist"){el.style.display="none";return;}el.style.display="inline";network.once(NetworkMessages.ClanList,this.showClanList.bind(this));network.send("clanList$$"+(page?page:"0")+"$10");};UIManager.prototype.showHatsMenu=function(){F$('items').show();};function buyItem(id){displayMsg("<div style='text-align: center;'>Buy "+hats[id].name+" for <span class='yellow'>"+hats[id].gold+"</span> gold ?<br /><button class='withClickSound' onclick='buyItem2(\""+id+"\");'>Yes</button></div>");};function buyItem2(id){document.getElementById("serverInfoDiv").style.display="none";network.send("buyItem$"+id);};function buyAbility(id){displayMsg("<div style='text-align: center;'>Buy "+abilities[id].name+" for <span class='yellow'>"+abilities[id].gold+"</span> gold ?<br /><button class='withClickSound' onclick='buyAbility2(\""+id+"\");'>Yes</button></div>");};function buyAbility2(id){document.getElementById("serverInfoDiv").style.display="none";network.send("buyAbility$"+id);};UIManager.prototype.showLobby=function(tabIndex){slayOne.viewHelpers.showPopup("lobby",{theme:'tabbed',initTabIndex:tabIndex||0,title:slayOne.widgets.lang.get("lobby.title"),tabs:[{label:slayOne.widgets.lang.get("lobby.tabs.browse.label"),view:'roomsListScreen',tip:slayOne.widgets.lang.get("lobby.tabs.browse.tooltip")},{label:slayOne.widgets.lang.get("lobby.tabs.create.label"),view:'roomCreateScreen',tip:slayOne.widgets.lang.get("lobby.tabs.create.tooltip")}]});};UIManager.prototype.showOptions=function(){var str="<div class='header'>Options</div>";str+="<div class='options_h2'>Volume</div><div><input type='range' min='0' max='1' step='0.01' value='"+sound_volume+"' id='soundRange' onchange='setOptions();' /></div>";str+="<div class='options_h2'>Minimap Size</div><div><input type='range' min='0.5' max='2' step='0.01' value='"+minimapSizeFactor+"' id='minimapSizeFactor' onchange='setOptions();' /></div>";str+="<div class='options_h2' onmouseover='uiManager.showHatsInfo2(\"Reduces the amount of graphic effects displayed. Can increase the amount of frames per second.\");' ";str+=" onmouseout='uiManager.hideHatsInfo2();'><label>Low Graphic Effects <input type='checkbox' "+(graphicSettings?"":" checked='checked' ");str+=" id='graphicSettings' class='withClickSound' onchange='setOptions();' /></label></div>";str+="<div class='options_h2'><label>Hide ingame chat <input class='withClickSound' type='checkbox' "+(hideChat?" checked='checked' ":"")+" id='hideChat' onchange='setOptions();' /></label></div>";str+="<div>&nbsp;</div>";if(!isMobile)str+="<div><button class='withClickSound' onclick='uiManager.showHotkeyWindow();'>Controls</button></div>";str+="<div><button class='withClickSound' onclick='toggleFullscreen(document.documentElement);'>Fullscreen [<span class='red'>F8</span>]</button></div>";if(!game||game.mapWelcome){str+="<div><button class='withClickSound' onclick='loadReplay();'>Load replay</button></div>";str+="<div><button class='withClickSound' onclick='attemptExitGame();'>Leave Game</button></div>";}document.getElementById("optionsWindow").innerHTML=str;document.getElementById("optionsWindow").appendChild(this.createCloseButton());document.getElementById("optionsWindow").setAttribute("data-windowtype","options");};UIManager.prototype.showResults=function(data){F$("result").show(data);};UIManager.prototype.showHotkeyWindow=function(){var str="<div class='header'>Controls</div>";for(var attribute in commandNames){if(commandNames.hasOwnProperty(attribute))str+="<div class='hotkeySubDiv'>"+commandNames[attribute]+" <button data-key='"+attribute+"' class='hotkey_button withClickSound' id='hotkey_"+attribute+"' onclick='changeHotkey1("+attribute+");'>"+keyNames[commandKeys[attribute]]+"</button></div>";}document.getElementById("optionsWindow").innerHTML=str;document.getElementById("optionsWindow").appendChild(this.createCloseButton());document.getElementById("optionsWindow").setAttribute("data-windowtype","hotkeys");};function changeHotkey1(key){var hotkey_buttons=document.getElementsByClassName("hotkey_button");for(var i=0;i<hotkey_buttons.length;i++){hotkey_buttons[i].style.color="";hotkey_buttons[i].className="hotkey_button";}document.getElementById("hotkey_"+key).style.color="red";document.getElementById("hotkey_"+key).className="hotkey_button hotkey_button_active";};UIManager.prototype.showPlayerList=function(data){var page=parseInt(data[2]);var lastpage=0;lastPlayerListPage=page;var countPages=Math.ceil(parseInt(data[1])/10);var elo=data[3]=="1";var str="<div style='font-size: 16px; margin-top: 16px;'>";str+=(elo?"<a class='pseudoLink withClickSound' onclick='uiManager.togglePlayerList(-1, true);'>":"")+"Players (XP)"+(elo?"</a>":"");str+=" | "+(!elo?"<a class='pseudoLink withClickSound' onclick='uiManager.togglePlayerList(-1, true, true);'>":"")+"Players (elo)"+(!elo?"</a>":"");str+=" | <a class='pseudoLink withClickSound' onclick='uiManager.toggleClanList();'>Clans</a></div>";str+="<table id='playerListTable'><tr class='headTR'><td>Rank</td><td>Name</td><td>Clan</td><td>"+(elo?"elo":"level")+"</td></tr>";var k=1;for(var i=4;i<data.length;i+=2){var pos1=data[i].indexOf(':');var playerId=data[i].substr(0,pos1);var pos2=data[i].indexOf(':',pos1+1);var playerName=data[i].substr(pos1+1,pos2-pos1-1);var playerClanTag=data[i].substr(pos2+1);var playerScore=elo?Math.round(data[i+1]/1000):data[i+1];var clan=playerClanTag?"<td>[<a class='pseudoLink yellow withClickSound' onclick='showClanInfo(\""+playerClanTag+"\");'>"+playerClanTag+"</a>]</td>":"<td></td>";str+="<tr><td>"+(k+page*10)+"</td><td><a class='pseudoLink withClickSound' onclick='uiManager.showPlayerInfoById(\""+playerId+"\");'>"+escapeHtml(playerName)+"</a></td>"+clan+"<td>";str+=(elo?playerScore:getLvlFromXp(playerScore))+"</td></tr>";k++;}str+="</table>";if(countPages>1){str+="<div id='pageSystem'>";for(i=0;i<countPages;i++){if(i<=1||i>=countPages-2||i>=page-3&&i<=page+3){if(lastpage>0&&lastpage!=i-1)str+=" ... ";str+=i==page?" "+(i+1)+" ":"<button class='withClickSound' onclick='uiManager.togglePlayerList("+i+", true, "+(elo?"true":"false")+");'>"+(i+1)+"</button>";lastpage=i;}}str+="</div>";}document.getElementById("optionsWindow").innerHTML=str;document.getElementById("optionsWindow").appendChild(this.createCloseButton());document.getElementById("optionsWindow").setAttribute("data-windowtype","playerlist");};UIManager.prototype.showClanList=function(data){var page=data.page;var lastpage=0;lastPlayerListPage=page;var countPages=Math.ceil(data.total/10);var str="<div style='font-size: 16px; margin-top: 16px;'>";str+="<a class='pseudoLink withClickSound' onclick='uiManager.togglePlayerList(-1, true);'>Players (XP)</a>";str+=" | <a class='pseudoLink withClickSound' onclick='uiManager.togglePlayerList(-1, true, true);'>Players (elo)</a>";str+=" | Clans</div><table id='playerListTable'><tr class='headTR'><td>Rank</td><td>Tag</td><td>Name</td><td>Members</td><td>Score</td></tr>";var k=1;for(var i=0;i<data.length;i++){var datum=data[i];str+="<tr><td>"+(k+page*10)+"</td><td>[<a class='pseudoLink withClickSound' onclick='showClanInfo(\""+datum.tag+"\");'>"+datum.tag+"</a>]</td><td>"+datum.name+"</td><td>"+datum.countMembers+"</td><td>"+datum.elo+"</td></tr>";k++;}str+="</table>";if(countPages>1){str+="<div id='pageSystem'>";for(i=0;i<countPages;i++){if(i<=1||i>=countPages-2||i>=page-3&&i<=page+3){if(lastpage>0&&lastpage!=i-1)str+=" ... ";str+=i==page?" "+(i+1)+" ":"<button class='withClickSound' onclick='uiManager.toggleClanList("+i+", true);'>"+(i+1)+"</button>";lastpage=i;}}str+="</div>";}document.getElementById("optionsWindow").innerHTML=str;document.getElementById("optionsWindow").appendChild(this.createCloseButton());document.getElementById("optionsWindow").setAttribute("data-windowtype","clanlist");};UIManager.prototype.showPlayerInfoById=function(pid){pid=pid|0;if(pid<1){return;}network.send("plInfo$"+pid);slayOne.viewHelpers.showFullScreenLoading();};UIManager.prototype.showPlayerInfoWithData=function(profile){slayOne.viewHelpers.hideFullScreenLoading();if(db_id==profile.pid){currentProfile=profile;}slayOne.views.playerProfileScreen.show({perspective:db_id==profile.pid?'self':'guest',profile:profile});};function getMemberList(applications,clan_id,clan_tag){network.send("getMemberList$"+applications+"$"+(clan_id?clan_id:"")+"$"+clan_tag);};UIManager.prototype.memberList=function(data){var clan_tag=data[3];if(clan_tag==pl_clan_tag){window.pl_clan_role=parseInt(data[1]);}if(data[0]=="memberList"){var arr=[];for(var i=4;i<data.length;i+=3){var plAuth=parseInt(data[i+1]);arr.push({id:parseInt(data[i+2]),name:data[i],role:authLevelNames[plAuth],roleNumber:plAuth});}F$('myClan_memberList').dataProvider.source=arr;if(clan_tag==pl_clan_tag&&pl_clan_role>=AUTH_LEVEL.MOD){var clan_id=data[2];getMemberList(true,clan_id,clan_tag);}else{slayOne.viewHelpers.hideFullScreenLoading();}}else{var arr=[];for(var i=4;i<data.length;i+=3){arr.push({id:parseInt(data[i+1]),timestamp:data[i+2],name:data[i]});}arr.sort(function(obj1,obj2){if(obj1.timestamp<obj2.timestamp){return 1;}if(obj1.timestamp>obj2.timestamp){return-1;}return 0;});F$('myClan_requestList').dataProvider.source=arr;slayOne.viewHelpers.hideFullScreenLoading();}};function kickMember(member){network.send("kickMember$"+member);};function makeMember(member){network.send("makeMember$"+member);};function makeMod(member){network.send("makeMod$"+member);};function makeAdmin(member){network.send("makeAdmin$"+member);};function acceptClanMember(member,name){network.send("acceptClanMember$"+member+"$"+name);};function rejectClanMember(member){network.send("rejectClanMember$"+member);};function apply4Clan(clan_tag){network.send("apply4Clan$"+(clan_tag?clan_tag:document.getElementById("applyClanInput").value));};function leaveClan1(){displayMsg("<div>Really leave clan ?</div><div><button class='withClickSound' onclick='leaveClan2();'>Yes</button><br /><button class='withClickSound' onclick='dontLeaveClan();'>No</button></div>");};function leaveClan2(){network.send("leaveClan");document.getElementById("serverInfoDiv").style.display="none";};function dontLeaveClan(){document.getElementById("serverInfoDiv").style.display="none";};UIManager.prototype.createClan=function(){network.send("createClan$"+document.getElementById("clanTagInput").value+"$"+document.getElementById("clanNameInput").value);};function editClanText1(){var textarea=document.getElementById("clan_text");textarea.readOnly=false;textarea.className="textarea";var button=document.getElementById("editClanTextButton");button.innerHTML="save";button.onclick=editClanText2;slayOne.widgets.clickable(button);};function editClanText2(){var textarea=document.getElementById("clan_text");textarea.readOnly=true;textarea.className="inactive_textarea textarea";var button=document.getElementById("editClanTextButton");button.innerHTML="edit clan text";button.onclick=editClanText1;slayOne.widgets.clickable(button);network.send("update-clan-text$"+textarea.value);};function editClanName1(){var input=document.getElementById("clan_name");input.readOnly=false;input.className="clan_name_input";var button=document.getElementById("editClanNameButton");button.innerHTML="save";button.onclick=editClanName2;slayOne.widgets.clickable(button);};function editClanName2(){var input=document.getElementById("clan_name");input.readOnly=true;input.className="inactive_input clan_name_input";var button=document.getElementById("editClanNameButton");button.innerHTML="edit";button.onclick=editClanName1;slayOne.widgets.clickable(button);network.send("update-clan-name$"+input.value);};UIManager.prototype.createCloseButton=function(cb){var self=this;var closeButton=document.createElement("button");closeButton.innerHTML="x";closeButton.className="closeButton";closeButton.onclick=function(){var el=document.getElementById("optionsWindow");if(el&&el.style.display=="inline"&&el.getAttribute("data-windowtype")=="abilities"){if(self.getAbilitiePoints()<=CONST.MAX_CRYSTALS){if(self.countActiveAbilities()<=2){var json=JSON.stringify(pl_abilities,null,0);if(json!=self.oldAbilities){network.send("abUpd$"+json);}}}}this.parentNode.style.display="none";cb&&cb();};slayOne.widgets.clickable(closeButton);return closeButton;};UIManager.prototype.createButton=function(caption,className,onclick,css,appendTo,id,onmouseover,onmouseout,name,att1){var b=document.createElement("button");b.innerHTML=caption;if(css)b.style.cssText=css;if(className)b.className=className;if(id)b.id=id;b.onclick=onclick;if(appendTo&&appendTo.appendChild)appendTo.appendChild(b);b.setAttribute("data-noclick",'yes');if(onmouseover)b.onmouseover=onmouseover;if(onmouseout)b.onmouseout=onmouseout;if(name)b.name=name;if(att1)b.setAttribute("data-att1",att1);slayOne.widgets.clickable(b);return b;};UIManager.prototype.showLogin=function(){this.showAccountWindow(0);};UIManager.prototype.showRegister=function(){this.showAccountWindow(1);};UIManager.prototype.showAccountWindow=function(tabIndex){var self=this;slayOne.viewHelpers.showPopup("account",{theme:'tabbed',tabs:[{label:slayOne.widgets.lang.get("account.tabs.login.label"),view:'loginScreen'},{label:slayOne.widgets.lang.get("account.tabs.signup.label"),view:'registerScreen'}],initTabIndex:tabIndex,onClose:function onClose(){if(!db_id&&!localStorage.getItem('showedTutorialHint')&&!FacebookUtils.authInfo){F$('welcome').open();}else{self.showMainScene();}}});};UIManager.prototype.login=function(){var inputUserName=document.getElementById('playerNameInput').value;var inputPassword=document.getElementById('playerPwInput').value;var inputStayLoggedIn=document.getElementById('stayLoggedIn').checked;network.send(['login',inputUserName,inputPassword,inputStayLoggedIn].join('$'));};UIManager.prototype.register=function(){var inputUserName=document.getElementById('playerNameInput').value;var inputPassword=document.getElementById('playerPwInput').value;var inputEmail=document.getElementById('emailInput').value;network.send(['register',inputUserName,inputPassword,inputEmail,'',''].join('$'));};UIManager.prototype.showWelcomeTip=function(){if(loginData.new_player){return;}if(this.welcomeTipShown){return;}this.welcomeTipShown=true;slayOne.viewHelpers.showFloatTip({tipType:'success',content:slayOne.widgets.lang.get("msg.welcome",{playerName:networkPlayerName}),duration:2000});};UIManager.prototype.resetWelcomeTip=function(){this.welcomeTipShown=false;};UIManager.prototype.loginSuccess=function(data){pl_items=parseItems(data.new_items);if(isSteam){var name=SteamInfo.user.screenName.substr(0,20);if(data.name!==name){data.name=name;network.send('changeSteamNick$'+JSON.stringify({nick:name,steamId:SteamInfo.user.steamId}));}}networkPlayerName=data.name;authLevel=data.lvl|0;pl_xp=data.xp|0;pl_lvl=getLvlFromXp(pl_xp);pl_gold=data.gold|0;db_id=data.db_id|0;pl_abilities_unlocked=data.abilities_unlocked;pl_hat=hats[data.hat];pl_abilities=Skin.getAbList(data.hat);pl_clan_tag=data.clan_tag;pl_clan_role=data.clan_role;pl_tutorials=data.tutorials|0;pl_chests=parseChests(data.chests);network.send('getDailyQuests');network.autojoin(data.name);if(data.session_id){setSessionId(data.session_id);}var fid=data.fid|0;if(fid){localStorage.setItem("fId",fid);FacebookUtils.showBottomBar();}else{F$('bottomBar').show();F$('bottomBar').hideForFb();}if(!data.agb_accepted|0)showAGB2();else{F$('resourceBar').show();this.showMainScene();}this.refreshMenuButtons();this.showWelcomeTip();var search=getSearchQuery();var clanTag=search["clan"];if(clanTag){showClanInfo(clanTag);}};UIManager.prototype.showProgressInfo=function(){document.getElementById("playerProgressInfo").style.display="block";};UIManager.prototype.hideProgressInfo=function(){document.getElementById("playerProgressInfo").style.display="none";};UIManager.prototype.showHatsInfo=function(str){document.getElementById("hatsInfo").innerHTML=str;document.getElementById("hatsInfo").style.display="block";};UIManager.prototype.showHatsInfo2=function(str){document.getElementById("hatsInfo2").innerHTML=str;document.getElementById("hatsInfo2").style.display="block";};UIManager.prototype.hideHatsInfo=function(){document.getElementById("hatsInfo").style.display="none";};UIManager.prototype.hideHatsInfo2=function(){document.getElementById("hatsInfo2").style.display="none";};UIManager.prototype.showMenuButtonInfo=function(str){document.getElementById("menuButtonsInfo").innerHTML=str;document.getElementById("menuButtonsInfo").style.display="block";};UIManager.prototype.hideMenuButtonInfo=function(){document.getElementById("menuButtonsInfo").style.display="none";};UIManager.prototype.showEditorInfo=function(str){document.getElementById("editorInfo").innerHTML=str;document.getElementById("editorInfo").style.display="block";};UIManager.prototype.hideEditorInfo=function(){document.getElementById("editorInfo").style.display="none";};function crateGamesListTable(){var t=document.createElement("table");t.id="mainGamesTable";t.className="basicTable";var tr=document.createElement("tr");tr.innerHTML="<tr><td>Map</td><td>Players</td><td>Mode</td><td></td>";t.appendChild(tr);document.getElementById('gamesDiv').innerHTML="";document.getElementById('gamesDiv').appendChild(t);};function switchMode(mod){soundManager.playSound(SOUND.CLICK);var countModes=MAP_TYPE_SETTINGS.length;var newMode=(parseInt(modeSwitchDiv.getAttribute("data-mode-id"))+countModes+mod)%countModes;modeSwitchDiv.setAttribute("data-mode-id",newMode);modeSwitchDiv.innerHTML="<span>"+MAP_TYPE_SETTINGS[newMode].name+"</span>";defaultGameMode=newMode;localStorage.setItem("defaultGameMode",defaultGameMode);};UIManager.prototype.showMainScene=function(){document.getElementById('logindiv').style.display="none";var viewModel={authLevel:authLevel};slayOne.views.homeScreen.render(viewModel);this.refreshMenuButtons();};UIManager.prototype.showFbName=function(name,email,callback){slayOne.views.fbNameScreen.show(name,email,callback);};UIManager.prototype.switchServer=function(serverName){network.connectedServerIndex=serverName;networkPlayerName="";authLevel=AUTH_LEVEL.NONE;pl_xp=0;pl_lvl=0;pl_gold=0;db_id=0;pl_items={};pl_abilities_unlocked="";pl_hat=hats[0];pl_abilities=getDefaultAbilityObj(abilities);pl_clan_tag="";pl_clan_role=AUTH_LEVEL.NONE;pl_tutorials=0;uiManager.showMainScene();uiManager.refreshMenuButtons();network.onBeforeServerSwitch();soundManager.playSound(SOUND.CLICK);new ServerChooser().choose(SERVER_INFOS,serverName,function(s){network.onServerChosen(s);});};UIManager.prototype.refreshClanDiv=function(){if(document.getElementById("playerNameDiv")){var playerNameHTML="";if(pl_clan_tag&&pl_clan_tag.length>0){playerNameHTML+="[<span id='playerClanDiv' class='yellow withClickSound' onclick='uiManager.requestMyClanInfo();'>"+pl_clan_tag+"</span>] ";}playerNameHTML+="<span onclick='uiManager.showPlayerInfoById(\""+db_id+"\");'>"+escapeHtml(networkPlayerName)+"</span>";document.getElementById("playerNameDiv").innerHTML=playerNameHTML;}slayOne.views.homeScreen.refreshWelcomeMessage();};UIManager.prototype.refreshWelcomeDiv=function(){if(document.getElementById('welcomeName')){var clan_tag_str=pl_clan_tag&&pl_clan_tag.length>0?"[<span class='yellow withClickSound' onclick='uiManager.requestMyClanInfo();'>"+pl_clan_tag+"</span>] ":"";document.getElementById('welcomeName').innerHTML=clan_tag_str+networkPlayerName;}};UIManager.prototype.refreshAbilitybutton=function(){var button=document.getElementById('ability_button_main');button.innerHTML="";for(var i=0;i<abilities.length;i++){if(pl_abilities&&pl_abilities[i]&&pl_abilities[i].lvl>0){var a=abilities[i];if(a.type=="passive"){var br=document.createElement("br");button.appendChild(br);}var c_=document.createElement('canvas');button.appendChild(c_);c_.width=a.type=="passive"?40:76;c_.height=c_.width;var ctx_=c_.getContext("2d");ctx_.mozImageSmoothingEnabled=false;ctx_.msImageSmoothingEnabled=false;ctx_.imageSmoothingEnabled=false;var img=imgCoords.button;ctx_.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,0,0,c_.width,c_.height);img=imgCoords[a.icon];var fac=c_.width*0.75/Math.max(img.w,img.h);var w=img.w*fac;var h=img.h*fac;console.log('refreshAbilitybutton',w,h);ctx_.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(c_.width-w)/2,(c_.height-h)/2,w,h);if(a.type=="passive"){var span=document.createElement("span");for(var k=0;k<pl_abilities[i].lvl;k++){span.innerHTML+="I";}button.appendChild(span);}}}};UIManager.prototype.showAbilities=function(){var self=this;var str="<div class='header'>"+F_('abilities.title')+"</div><div id='abilities_description'>"+F_('abilities.desc')+"</div><div id='ab_pts_display'></div><div id='abilityMsg'></div><div id='abilities_inner'>";for(var i=0;i<abilities.length;i++){if(!abilities[i].zombieOnly){var a=abilities[i];var iHaveThis=iHaveAbility(a);var additionalClass=pl_gold>=a.gold?"active_ability_buy_button":"";var onclick=pl_gold>=a.gold?"onclick='buyAbility("+i+");'":"";var blockStr=iHaveThis?"":"<div class='blocker'></div><button class='buyAbilityButton withClickSound "+additionalClass+" ' "+onclick+">"+F_("abilities.button.buy",{gold:a.gold})+"</button>";var blockClass=iHaveThis?"":" ability_blocked ";var atts="";if(a.levelUpFields)for(var k=0;k<a.levelUpFields.length;k++){atts+="<div><button class='plusbutton' onclick='uiManager.setAbility("+i+", "+k+", 1);'>+</button><button class='minusbutton' onclick='uiManager.setAbility("+i+", "+k+", -1);'>";atts+="-</button> "+a.levelUpFieldsName[k]+": <span id='att_"+i+"_"+k+"'>"+a[a.levelUpFields[k]]+"</span></div>";}var infoStr=" ";str+="<div id='ability_button_"+i+"' onmouseover='uiManager.showHatsInfo2(\""+a.description+"\");' onmouseout='uiManager.hideHatsInfo2();' class='ability_button "+blockClass+"' data-noclick='yes'>";str+="<canvas class='ab_canvas' id='ability_canvas_"+i+"'></canvas><div class='mainPMButtons'><span id='ab_"+i+"'></span>";if(iHaveThis){if(a.type!='passive'){str+=" <button class='btn_ab_setup' onclick='uiManager.setAbility("+i+", undefined, 1);'>"+F_('abilities.button.equip')+"</button>";str+="<button class='btn_ab_putdown' onclick='uiManager.setAbility("+i+", undefined, -1);'>"+F_('abilities.button.unequip')+"</button>";}else{str+=" <button onclick='uiManager.setAbility("+i+", undefined, 1);'>+</button>";str+="<button onclick='uiManager.setAbility("+i+", undefined, -1);'>-</button>";}}str+="</div><div class='hatname2'>"+a.name+"</div>";str+="<div class='atts_container'>"+atts+"<div class='atts_container_inner'></div></div>"+blockStr+"</div>";}}document.getElementById("optionsWindow").innerHTML=str+"</div>";document.getElementById("optionsWindow").appendChild(this.createCloseButton(function(){slayOne.views.homeScreen.refreshAbilitiesPanel();}));document.getElementById("optionsWindow").setAttribute("data-windowtype","abilities");this.oldAbilities=JSON.stringify(pl_abilities,null,0);this.refreshAbilityWindow();};UIManager.prototype.refreshAbilityWindow=function(i){for(var i=0;document.getElementById('ability_canvas_'+i);i++){var c_=document.getElementById('ability_canvas_'+i);c_.width=100;c_.height=100;var ctx_=c_.getContext("2d");ctx_.mozImageSmoothingEnabled=false;ctx_.msImageSmoothingEnabled=false;ctx_.imageSmoothingEnabled=false;var a=abilities[i];var img=imgCoords[a.icon];var fac=80/Math.max(img.w,img.h);var w=img.w*fac;var h=img.h*fac;ctx_.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,(c_.width-w)/2,(c_.height-h)/2,w,h);console.log('a',imgs.miscSheet,img.x,img.y,img.w,img.h,(c_.width-w)/2,(c_.height-h)/2,w,h);if(pl_abilities[i]&&pl_abilities[i].lvl>0&&abilities[i].lvl==1){var img=imgCoords.ok;ctx_.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,c_.width-img.w*3,c_.height-img.h*3,img.w*3,img.h*3);console.log('b',imgs.miscSheet,img.x,img.y,img.w,img.h,c_.width-img.w*3,c_.height-img.h*3,img.w*3,img.h*3);}}for(var i=0;i<abilities.length;i++){var a=abilities[i];var obj=a.object?objects[a.object]:null;var lvl=pl_abilities[i]?pl_abilities[i].lvl:0;var str="";var val=0;for(var j=0;j<lvl;j++){str+="<div class='filledRect'></div>";}for(var j=lvl;j<a.maxLvl;j++){str+="<div class='emptyRect'></div>";}document.getElementById('ab_'+i)&&(document.getElementById('ab_'+i).innerHTML=str);document.getElementById('ability_button_'+i)&&(document.getElementById('ability_button_'+i).className="ability_button"+(lvl?" has_ability":""));if(a.levelUpFields)for(var k=0;k<a.levelUpFields.length;k++){str="";val=obj&&obj[a.levelUpFields[k]]?obj[a.levelUpFields[k]]:a[a.levelUpFields[k]];for(var j=0;j<pl_abilities[i].attributes[k];j++){str+="<div class='filledRect'></div>";val+=a.levelUpValues[k];}for(var j=pl_abilities[i].attributes[k];j<a.levelUpMaxLvl[k];j++){str+="<div class='emptyRect'></div>";}val*=a.displayScale&&a.displayScale[k]?a.displayScale[k]:1;val=val<30?Math.round(val*10)/10:Math.round(val);document.getElementById('att_'+i+'_'+k).innerHTML="<span class='yellow'>"+val+"</span> "+str;}}document.getElementById('ab_pts_display').innerHTML=F_('abilities.crystals',{current:this.getAbilitiePoints(),total:CONST.MAX_CRYSTALS});};UIManager.prototype.setAbility=function(a1,a2,lvl){soundManager.playSound(SOUND.CLICK);lvl=parseInt(lvl);var mainAbility=pl_abilities[a1];if(!mainAbility)return;if(a2>=0){mainAbility.attributes[a2]+=lvl;if(mainAbility.attributes[a2]<0)mainAbility.attributes[a2]=0;if(mainAbility.attributes[a2]>abilities[a1].levelUpMaxLvl[a2])mainAbility.attributes[a2]=abilities[a1].levelUpMaxLvl[a2];}else{mainAbility.lvl+=lvl;if(mainAbility.lvl<0)mainAbility.lvl=0;if(mainAbility.lvl>abilities[a1].maxLvl)mainAbility.lvl=abilities[a1].maxLvl;}if(mainAbility.lvl==0&&mainAbility.attributes)for(var i=0;i<mainAbility.attributes.length;i++){mainAbility.attributes[i]=0;}var isValid=false;var msg="";if(this.getAbilitiePoints()>CONST.MAX_CRYSTALS)msg=F_("abilities.only.crystals",{crystals:CONST.MAX_CRYSTALS});else if(this.countActiveAbilities()>2)msg=F_("abilities.warn.exceed");else{isValid=true;}if(!isValid){if(a2>=0)mainAbility.attributes[a2]-=lvl;else mainAbility.lvl-=lvl;}document.getElementById("abilityMsg").innerHTML=msg;this.refreshAbilityWindow();};UIManager.prototype.countActiveAbilities=function(){var count=0;for(var i=0;i<pl_abilities.length;i++){if(pl_abilities[i].lvl>0&&abilities[i].type!="passive")count++;}return count;};UIManager.prototype.getAbilitiePoints=function(){var pts=0;for(var i=0;i<pl_abilities.length;i++){pts+=pl_abilities[i].lvl*abilities[i].cost;if(pl_abilities[i].attributes){var numAttributes=Math.min(pl_abilities[i].attributes.length,abilities[i].levelUpCost.length);for(var k=0;k<numAttributes;k++){pts+=pl_abilities[i].attributes[k]*abilities[i].levelUpCost[k];}}}return pts;};UIManager.prototype.refreshMenuButtons=function(){for(var buttonKey in buttonData){var btnData=buttonData[buttonKey];if(!btnData.methodShouldShow||btnData.methodShouldShow()){btnData.instance.style.display="inline-block";}else{btnData.instance.style.display="none";}}};UIManager.prototype.registerState=function(msg){if(document.getElementById('serverInfo'))document.getElementById('serverInfo').innerHTML=msg;};UIManager.prototype.setXP=function(xp){pl_xp=parseInt(xp);slayOne.views["homeScreen"].refreshExp();};UIManager.prototype.showDeathScreen=function(killerName){F$('respawn').show(killerName);slayOne.viewHelpers.showAd();};UIManager.prototype.hideDeathScreen=function(){F$('respawn').hide(true);F$('respawnMini').hide(true);};UIManager.prototype.countDownDeath=function(timeTillRespawn){F$('respawn').progress(timeTillRespawn);};function closeAchivementWindow(){soundManager.playSound(SOUND.CLICK);var div=document.getElementById("unlockDiv");div.style.animationName="fadeOut2";div.style.animationDuration="0.4s";div.style.animationFillMode="forwards";setTimeout(function(){document.getElementById("unlockDiv").style.display="none";},500);setTimeout(showAchivement,1000);};function showAchivement(){if(unlocks2Show.length>0&&document.getElementById("unlockDiv").style.display!="inline"){if(unlocks2Show[0].type=="lvlup"){var div=document.getElementById("unlockDiv");var str="<button id='unlockCloseButton' onclick='closeAchivementWindow();'>X</button><div id='lvlUpDiv1'>Level Up</div><div id='lvlUpDiv2'>You reached level <span class='green'>";str+=unlocks2Show[0].lvl+"</span></div><div id='lvlUpDiv3'>You gained <span class='yellow'>"+unlocks2Show[0].gold+"</span> gold</div>";document.getElementById("unlockDivInner").innerHTML=str;div.style.display="inline";div.style.animationName="fadeIn";div.style.animationDuration="0.65s";div.style.animationFillMode="forwards";div=document.getElementById("lvlUpDiv1");div.style.animationName="shine";div.style.animationDuration="0.8s";div.style.animationIterationCount="infinite";soundManager.playSound(SOUND.LVLUP);pl_gold=unlocks2Show[0].goldTotal;F$('resourceBar').refresh();}else if(unlocks2Show[0].type=="unlock"){var div=document.getElementById("unlockDiv");document.getElementById("unlockDivInner").innerHTML="<button id='unlockCloseButton' onclick='closeAchivementWindow();'>X</button>";div.style.display="inline";var hat=unlocks2Show[0].item;var ca_=document.createElement("canvas");document.getElementById("unlockDivInner").appendChild(ca_);ca_.id="unlockCanvas";ca_.width=256;ca_.height=256;var c_=ca_.getContext("2d");c_.mozImageSmoothingEnabled=false;c_.msImageSmoothingEnabled=false;c_.imageSmoothingEnabled=false;var div2=document.createElement("div");if(hat.isHat){var direction=2;var frame=1;var scale=8;c_.drawImage(imgs.shadow,0,0,32*scale,32*scale);c_.drawImage(imgs.weaponsMinus,direction*32,0,32,32,Math.sin(frame*(Math.PI/2))*scale/3,-(frame%2)*scale/2,32*scale,32*scale);c_.drawImage(imgs.legs,frame*32,32*direction+hat.legs*288,32,32,0,0,32*scale,32*scale);if(hat.hatOnly)c_.drawImage(imgs.heads,direction*32,0,32,32,0,0-frame%2*scale/2,32*scale,32*scale);c_.drawImage(imgs.heads,direction*32,32*hat.offset,32,32,0,0-frame%2*scale/2,32*scale,32*scale);c_.drawImage(imgs.weaponsPlus,direction*32,0,32,32,Math.sin(frame*(Math.PI/2))*scale/2,-(frame%2)*scale/1.8,32*scale,32*scale);div2.innerHTML="Unlocked skin \"<span class='green'>"+hat.name+"</span>\"";}else if(hat.isAbility){var img=imgCoords[hat.icon];var scale=150/Math.max(img.w,img.h);c_.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,128-img.w*scale/2,118-img.h*scale/2,img.w*scale,img.h*scale);div2.innerHTML="Unlocked ability \"<span class='green'>"+hat.name+"</span>\"";}div2.className="fontSize20px";document.getElementById("unlockDivInner").appendChild(div2);div.style.animationName="fadeIn";div.style.animationDuration="0.65s";div.style.animationFillMode="forwards";soundManager.playSound(SOUND.UNLOCK);}unlocks2Show.splice(0,1);}};UIManager.prototype.showClanWindow=function(data){slayOne.viewHelpers.hideFullScreenLoading();backButtonContentStr="clInfo$"+data[1];var str="<div class='header2'>[<span class='yellow'>"+data[1]+"</span>]</div>";str+="<div id='clanname'>"+data[2]+"</div>";str+="<div id='clanmemberscount'>Members: <span class='yellow'>"+data[3]+"</span> <button class='withClickSound' onclick='getMemberList(\"false\", "+data[5]+");'>List</button></div>";str+="<div><textarea spellcheck='false' class='inactive_textarea textarea "+(data[6]&&data[6].length>0?"":"invis")+"' ";str+=" readonly id='clan_text'>"+(data[6]?escapeHtml(data[6]):"")+"</textarea></div>";if(pl_clan_tag==""&&authLevel>=AUTH_LEVEL.PLAYER)str+="<button class='withClickSound' onclick='apply4Clan(\""+data[1]+"\");'>Apply</button><div id='applyStateDiv'></div>";document.getElementById("optionsWindow").innerHTML=str;document.getElementById("optionsWindow").appendChild(this.createCloseButton());document.getElementById("optionsWindow").setAttribute("data-windowtype","clans");document.getElementById("optionsWindow").style.display="inline";document.getElementById("optionsWindow").appendChild(this.createButton("back",null,function(){network.send("clanList$"+lastPlayerListPage);},null,null,"backButtonPlInfo"));document.getElementById("optionsWindow").className="optionsWindow1 basicWindow";};UIManager.prototype.lvlUp=function(data){pl_gold=data.client_gold|0;pl_gem=data.client_gem|0;var level=data.level;var rewards=[];if(data.chest){rewards.push({id:data.chest_id,type:'chest',value:data.chest});}if(data.gold){rewards.push({type:'gold',value:data.gold});}if(data.gem){rewards.push({type:'gem',value:data.gem});}for(var i=0;i<MAP_TYPE_SETTINGS.length;i++){var mapType=MAP_TYPE_SETTINGS[i];if(mapType.unlockLevel==level){rewards.push({type:'mode',value:i});}}if(data.skin&&data.skin.length){var _iteratorNormalCompletion35=true;var _didIteratorError35=false;var _iteratorError35=undefined;try{for(var _iterator35=data.skin[Symbol.iterator](),_step35;!(_iteratorNormalCompletion35=(_step35=_iterator35.next()).done);_iteratorNormalCompletion35=true){var skin=_step35.value;rewards.push({type:"hat",value:skin});}}catch(err){_didIteratorError35=true;_iteratorError35=err;}finally{try{if(!_iteratorNormalCompletion35&&_iterator35.return){_iterator35.return();}}finally{if(_didIteratorError35){throw _iteratorError35;}}}}F$('resourceBar').refresh();F$('levelUp').show({level:level,rewards:rewards});};UIManager.prototype.unlock=function(data){var hat=hats[data[1]];obtainHat(data[1]);unlocks2Show.push({type:"unlock",item:hat});showAchivement();if(data[2]){pl_gold=parseInt(data[2]);F$('resourceBar').refresh();}};UIManager.prototype.unlockAbility=function(data){var ab=abilities[data[1]];unlockAbility(ab);unlocks2Show.push({type:"unlock",item:ab});showAchivement();if(data[2]){pl_gold=parseInt(data[2]);F$('resourceBar').refresh();}var el=document.getElementById("optionsWindow");if(el.style.display=="inline"&&el.getAttribute("data-windowtype")=="abilities")uiManager.showAbilities();};window.UIManager=UIManager;function Button(x,y,w,h,key){this.x=x;this.y=y;this.w=w;this.h=h;this.key=key;this.isPressedOld=false;this.isPressed=false;};Button.prototype.getX=function(){var x=this.x;while(x<0){x+=WIDTH/FIELD_SIZE_BASE;}return x;};Button.prototype.getY=function(){var y=this.y;while(y<0){y+=HEIGHT/FIELD_SIZE_BASE;}return y;};Button.prototype.draw=function(){c.lineWidth=SCALE_FACTOR_BASE;c.strokeStyle="rgba(255, 255, 255, 0.8)";c.strokeRect(this.getX()*FIELD_SIZE_BASE,this.getY()*FIELD_SIZE_BASE,this.w*FIELD_SIZE_BASE,this.h*FIELD_SIZE_BASE);};Button.prototype.contains=function(x,y){var x_=this.getX()*FIELD_SIZE_BASE;var y_=this.getY()*FIELD_SIZE_BASE;return x>=x_&&x<=x_+this.w*FIELD_SIZE_BASE&&y>=y_&&y<=y_+this.h*FIELD_SIZE_BASE;};Button.prototype.keyDown=function(){KeyManager.keyDown(this.key);};Button.prototype.keyUp=function(){KeyManager.keyUp(this.key);};function drawMiniMap(view,size,percentageOfCurrentTickPassed){var c=view._canvas.getContext("2d");var game=view._game;var w=minimapSizeFactor*(game.map.x>game.map.y?size:game.map.x/game.map.y*size);var h=minimapSizeFactor*(game.map.y>game.map.x?size:game.map.y/game.map.x*size);view._canvas.width=w;view._canvas.height=h;c.mozImageSmoothingEnabled=false;c.msImageSmoothingEnabled=false;c.imageSmoothingEnabled=false;var scale=w/game.map.x;var scaleTop3=SCALE_FACTOR_BASE*0.8;c.globalAlpha=0.8;c.drawImage(view._baseCanvas,0,0,w,h);drawMiniMapScreenBorder(c,size,w/game.map.x);var players=game.players;c.globalAlpha=1-0.7*(Math.cos(timestamp/100)/Math.PI+0.5);var _iteratorNormalCompletion36=true;var _didIteratorError36=false;var _iteratorError36=undefined;try{for(var _iterator36=players[Symbol.iterator](),_step36;!(_iteratorNormalCompletion36=(_step36=_iterator36.next()).done);_iteratorNormalCompletion36=true){var p=_step36.value;var rank=-1;if(game.type.zombies)for(var k=0;k<game.interface_.top3.length;k++){if(game.interface_.top3[k].name==p.name)rank=game.interface_.top3[k].rank;}if(p.dieAt){continue;}if(!game.playingPlayer||p==game.playingPlayer||rank>0||p.team==game.playingPlayer.team&&p.team!=0||game.showEnemiesOnMinimapUntil>=game.ticksCounter||game.playingPlayer.isHumanZombie&&p.isBoss){var x_=p.x0+percentageOfCurrentTickPassed*(p.x-p.x0);var y_=p.y0+percentageOfCurrentTickPassed*(p.y-p.y0);var x2_=w*x_/game.map.x;var y2_=h*y_/game.map.y;var crownImg=imgCoords.crownYellow;var crosshairImg=imgCoords.crosshairRed;if(p!=game.playingPlayer&&game[scf1+scf2]>game.ticksCounter+1000)return;if(p.isZombie){c.fillStyle="#FFFA7D";img=imgCoords.light_yellow;}else if(p==game.playingPlayer){c.fillStyle="#00FF06";img=imgCoords.light_green;crownImg=imgCoords.crownGreen;crosshairImg=imgCoords.crosshairGreen;}else if(game.playingPlayer&&p.team==game.playingPlayer.team&&p.team!=0||!game.playingPlayer&&!p.isHumanZombie){c.fillStyle="#FFFFFF";img=imgCoords.light_white;crownImg=imgCoords.crownWhite;crosshairImg=imgCoords.crosshairWhite;}else{c.fillStyle="#FF0000";img=imgCoords.light_red;crownImg=imgCoords.crownRed;crosshairImg=imgCoords.crosshairRed;}if(p.weapon&&p.weapon.isSniper&&game.showEnemiesOnMinimapUntil>=game.ticksCounter){c.drawImage(imgs.miscSheet,crosshairImg.x,crosshairImg.y,crosshairImg.w,crosshairImg.h,x2_-scale*3,y2_-scale*3,scale*6,scale*6);}else if(rank==1){c.drawImage(imgs.miscSheet,crownImg.x,crownImg.y,crownImg.w,crownImg.h,x2_-scale*2.5,y2_-scale*2.5,scale*5,scale*5);}else if(rank>0){drawText(c,rank,c.fillStyle,scaleTop3*2.5,x2_,y2_+scaleTop3*2,20*scaleTop3,"center",c.globalAlpha);}else{c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x2_-scale*4,y2_-scale*4,scale*8,scale*8);c.fillRect(x2_-scale,y2_-scale,scale*2,scale*2);}}}}catch(err){_didIteratorError36=true;_iteratorError36=err;}finally{try{if(!_iteratorNormalCompletion36&&_iterator36.return){_iterator36.return();}}finally{if(_didIteratorError36){throw _iteratorError36;}}}c.globalAlpha=1;if(game.type.flag){for(var j=0;j<2;j++){var img=j==0?imgCoords.redFlag:imgCoords.blueFlag;var flag=j==0?game.redFlag:game.blueFlag;if(flag){var x_=flag.currentX;var y_=flag.currentY;if(flag.carriedBy){var p=flag.carriedBy;x_=p.x0+percentageOfCurrentTickPassed*(p.x-p.x0);y_=p.y0+percentageOfCurrentTickPassed*(p.y-p.y0);}var x2_=w*x_/game.map.x;var y2_=h*y_/game.map.y;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x2_-3*scale,y2_-5*scale,scale*6,scale*8);}}}}function drawMiniMapScreenBorder(c,size,rate){var X=game.cameraX;var Y=game.cameraY;var W=game.cameraX2-game.cameraX;var H=game.cameraY2-game.cameraY;X=(X*rate|0)+0.5;Y=(Y*rate|0)+0.5;W=W*rate|0;H=(H*rate|0)+2;c.strokeStyle="#FFF";c.strokeRect(X,Y,W,H);}function Minimap(game){this.canvas=document.createElement("canvas");this.canvas.width=game.map.x;this.canvas.height=game.map.y;this.ctx=this.canvas.getContext("2d");if(tileTypes[game.map.defaultTiles].avgColor){this.ctx.fillStyle=tileTypes[game.map.defaultTiles].avgColor;this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);}for(var i=0;i<game.groundTiles.length;i++){var tile=game.groundTiles[i];var type=tile.type;if(type.avgColor){this.ctx.fillStyle=type.avgColor;this.ctx.fillRect(tile.x,tile.y,type.w?type.w:1,type.h?type.h:1);}}this.ctx.fillStyle="black";this.ctx.globalAlpha=0.5;this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);this.ctx.globalAlpha=1;for(var i=0;i<game.tiles.length;i++){if(!game.tiles[i].ground){var tile=game.tiles[i];var type=tile.type;if(type.avgColor){this.ctx.fillStyle=type.avgColor;this.ctx.fillRect(tile.x,tile.y,type.w?type.w:1,type.h?type.h:1);}}}};Minimap.prototype.draw=function(percentageOfCurrentTickPassed){var size=SCALE_FACTOR_BASE*32*minimapSizeFactor;var w=game.map.x>game.map.y?size:game.map.x/game.map.y*size;var h=game.map.y>game.map.x?size:game.map.y/game.map.x*size;var x=WIDTH-(size+w)/2;var y=(size-h)/2;var scale=w/game.map.x;c.fillStyle="black";c.fillRect(WIDTH-size-SCALE_FACTOR_BASE*3,0,size+SCALE_FACTOR_BASE*3,size+SCALE_FACTOR_BASE*6);if(game.type.showTop3&&game.type.winningCondition){var img=imgCoords[game.type.ressourceIconName];c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,WIDTH-SCALE_FACTOR_BASE*6,size+0*SCALE_FACTOR_BASE,img.w*SCALE_FACTOR_BASE*0.5,img.h*SCALE_FACTOR_BASE*0.5);drawText(c,slayOne.widgets.lang.get("game.minimap.rank.label"),"#866F47",SCALE_FACTOR_BASE*4,WIDTH-38*SCALE_FACTOR_BASE,size+SCALE_FACTOR_BASE*5);var scaleTop3=SCALE_FACTOR_BASE*0.8;var xTop3=WIDTH-50*scaleTop3;var yTop3=size+6*SCALE_FACTOR_BASE;for(var i=0;i<game.interface_.top3.length;i++){var pl=game.interface_.top3[i];var clan=pl.clan?"["+pl.clan+"] ":"";var itsme=game&&game.playingPlayer&&game.playingPlayer.name==pl.name;var textColor=itsme?"#AABB81":top3Colors[i];if(game.type.team&&game.type.souls){if(pl.team==1){c.fillStyle=itsme?"rgba(160, 50, 50, 0.9)":"rgba(160, 50, 50, 0.5)";textColor="#DA5556";}else{c.fillStyle=itsme?"rgba(27, 105, 142, 0.9)":"rgba(27, 105, 142, 0.5)";textColor="#28A1DA";}}else c.fillStyle=itsme?"rgba(0, 0, 0, 0.9)":"rgba(0, 0, 0, 0.5)";c.fillRect(xTop3,yTop3,50*scaleTop3,8*scaleTop3);if(pl.rank==1){var crown=imgCoords.crownYellow;c.drawImage(imgs.miscSheet,crown.x,crown.y,crown.w,crown.h,xTop3+1.5*scaleTop3,yTop3+1.5*scaleTop3,crown.w*scaleTop3*0.5,crown.h*scaleTop3*0.5);}else drawText(c,pl.rank,itsme?"#AABB81":top3ColorsRank[i],scaleTop3*4,xTop3+5*scaleTop3,yTop3+6*scaleTop3,20*scaleTop3,"center");drawText(c,clan+pl.name,textColor,scaleTop3*4,xTop3+10*scaleTop3,yTop3+6*scaleTop3,null,"left",null,null,null,scaleTop3*22);drawText(c,pl.souls,"#b4b7b8",scaleTop3*4,xTop3+48*scaleTop3,yTop3+6*scaleTop3,20*scaleTop3,"right");yTop3+=8*scaleTop3;}}c.drawImage(this.canvas,x,y,w,h);var players=game.players.concat(game.zombies);for(var i=0;i<players.length;i++){var p=players[i];var rank=-1;if(game.type.souls)for(var k=0;k<game.interface_.top3.length;k++){if(game.interface_.top3[k].name==p.name)rank=game.interface_.top3[k].rank;}if(!p.dieAt&&(!game.playingPlayer||p==game.playingPlayer||rank>0||p.team==game.playingPlayer.team&&p.team!=0||game.showEnemiesOnMinimapUntil>=game.ticksCounter)){var x_=p.x0+percentageOfCurrentTickPassed*(p.x-p.x0);var y_=p.y0+percentageOfCurrentTickPassed*(p.y-p.y0);var x2_=x+w*x_/game.map.x;var y2_=y+h*y_/game.map.y;var crownImg=imgCoords.crownYellow;var crosshairImg=imgCoords.crosshairRed;if(p!=game.playingPlayer&&game[scf1+scf2]>game.ticksCounter+1000)return;if(p.isZombie){c.fillStyle="#FFFA7D";img=imgCoords.light_yellow;}else if(p==game.playingPlayer){c.fillStyle="#00FF06";img=imgCoords.light_green;crownImg=imgCoords.crownGreen;crosshairImg=imgCoords.crosshairGreen;}else if(game.playingPlayer&&p.team==game.playingPlayer.team&&p.team!=0){c.fillStyle="#FFFFFF";img=imgCoords.light_white;crownImg=imgCoords.crownWhite;crosshairImg=imgCoords.crosshairWhite;}else{c.fillStyle="#FF0000";img=imgCoords.light_red;crownImg=imgCoords.crownRed;crosshairImg=imgCoords.crosshairRed;}c.globalAlpha=1-0.7*(Math.cos(timestamp/100)/Math.PI+0.5);if(p.weapon&&p.weapon.isSniper&&game.showEnemiesOnMinimapUntil>=game.ticksCounter){c.drawImage(imgs.miscSheet,crosshairImg.x,crosshairImg.y,crosshairImg.w,crosshairImg.h,x2_-scale*3,y2_-scale*3,scale*6,scale*6);}else if(rank>0){if(rank==1)c.drawImage(imgs.miscSheet,crownImg.x,crownImg.y,crownImg.w,crownImg.h,x2_-scale*2.5,y2_-scale*2.5,scale*5,scale*5);else drawText(c,rank,c.fillStyle,scaleTop3*2.5,x2_,y2_+scaleTop3*2,20*scaleTop3,"center",c.globalAlpha);}else{c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x2_-scale*4,y2_-scale*4,scale*8,scale*8);c.fillRect(x2_-scale,y2_-scale,scale*2,scale*2);}c.globalAlpha=1;}}if(game.type.flag){for(var j=0;j<2;j++){var img=j==0?imgCoords.redFlag:imgCoords.blueFlag;var flag=j==0?game.redFlag:game.blueFlag;if(flag){var x_=flag.currentX;var y_=flag.currentY;if(flag.carriedBy){var p=flag.carriedBy;x_=p.x0+percentageOfCurrentTickPassed*(p.x-p.x0);y_=p.y0+percentageOfCurrentTickPassed*(p.y-p.y0);}var x2_=x+w*x_/game.map.x;var y2_=y+h*y_/game.map.y;c.drawImage(imgs.miscSheet,img.x,img.y,img.w,img.h,x2_-3*scale,y2_-5*scale,scale*6,scale*8);}}}};var map1={"x":64,"y":64,"defaultTiles":0,"tiles":[{"x":12,"y":0,"id":11},{"x":12,"y":1,"id":12},{"x":12,"y":2,"id":24},{"x":13,"y":2,"id":4},{"x":14,"y":2,"id":4},{"x":17,"y":2,"id":4},{"x":15,"y":2,"id":2},{"x":16,"y":2,"id":3},{"x":18,"y":2,"id":23},{"x":18,"y":0,"id":9},{"x":18,"y":1,"id":9},{"x":2,"y":2,"id":1},{"x":3,"y":2,"id":1},{"x":7,"y":5,"id":1},{"x":8,"y":4,"id":1},{"x":9,"y":3,"id":1},{"x":0,"y":9,"id":51},{"x":3,"y":9,"id":51},{"x":6,"y":9,"id":51},{"x":9,"y":9,"id":51},{"x":1,"y":9,"id":50},{"x":7,"y":9,"id":50},{"x":2,"y":9,"id":49},{"x":5,"y":9,"id":49},{"x":8,"y":9,"id":49},{"x":4,"y":9,"id":52},{"x":10,"y":9,"id":52},{"x":0,"y":11,"id":45},{"x":3,"y":11,"id":45},{"x":5,"y":11,"id":45},{"x":6,"y":11,"id":45},{"x":9,"y":11,"id":45},{"x":2,"y":11,"id":43},{"x":4,"y":11,"id":43},{"x":8,"y":11,"id":43},{"x":1,"y":11,"id":44},{"x":7,"y":11,"id":44},{"x":10,"y":11,"id":44},{"x":15,"y":11,"id":47},{"x":11,"y":11,"id":45},{"x":13,"y":11,"id":45},{"x":12,"y":11,"id":43},{"x":14,"y":11,"id":43},{"x":15,"y":10,"id":56},{"x":15,"y":9,"id":57},{"x":11,"y":9,"id":52},{"x":12,"y":8,"id":61},{"x":12,"y":7,"id":63},{"x":12,"y":5,"id":53},{"x":15,"y":5,"id":54},{"x":12,"y":6,"id":63},{"x":12,"y":9,"id":50},{"x":13,"y":5,"id":50},{"x":14,"y":5,"id":49},{"x":15,"y":8,"id":56},{"x":15,"y":6,"id":56},{"x":15,"y":7,"id":56},{"x":13,"y":9,"id":55},{"x":14,"y":9,"id":55},{"x":13,"y":7,"id":55},{"x":14,"y":7,"id":55},{"x":2,"y":5,"id":31},{"x":2,"y":6,"id":31},{"x":3,"y":6,"id":31},{"x":3,"y":5,"id":31},{"x":22,"y":5,"id":45},{"x":24,"y":5,"id":45},{"x":26,"y":5,"id":45},{"x":23,"y":5,"id":46},{"x":25,"y":5,"id":46},{"x":26,"y":6,"id":62},{"x":26,"y":9,"id":62},{"x":26,"y":12,"id":62},{"x":26,"y":7,"id":63},{"x":26,"y":10,"id":63},{"x":26,"y":13,"id":63},{"x":26,"y":11,"id":62},{"x":26,"y":8,"id":62},{"x":21,"y":5,"id":48},{"x":21,"y":4,"id":62},{"x":21,"y":3,"id":53},{"x":22,"y":3,"id":52},{"x":25,"y":3,"id":52},{"x":23,"y":3,"id":51},{"x":26,"y":3,"id":51},{"x":24,"y":3,"id":50},{"x":27,"y":3,"id":50},{"x":28,"y":3,"id":54},{"x":28,"y":4,"id":56},{"x":28,"y":7,"id":56},{"x":28,"y":9,"id":56},{"x":28,"y":13,"id":56},{"x":28,"y":5,"id":57},{"x":28,"y":8,"id":57},{"x":28,"y":11,"id":57},{"x":28,"y":6,"id":58},{"x":28,"y":10,"id":58},{"x":28,"y":12,"id":58},{"x":28,"y":16,"id":58},{"x":28,"y":17,"id":47},{"x":26,"y":17,"id":48},{"x":28,"y":15,"id":56},{"x":28,"y":14,"id":59},{"x":27,"y":17,"id":46},{"x":26,"y":15,"id":62},{"x":26,"y":16,"id":63},{"x":26,"y":14,"id":63},{"x":27,"y":15,"id":55},{"x":27,"y":13,"id":55},{"x":27,"y":11,"id":55},{"x":27,"y":9,"id":55},{"x":27,"y":7,"id":55},{"x":27,"y":5,"id":55},{"x":26,"y":20,"id":53},{"x":28,"y":20,"id":54},{"x":27,"y":20,"id":51},{"x":28,"y":21,"id":56},{"x":28,"y":24,"id":56},{"x":28,"y":27,"id":56},{"x":28,"y":28,"id":56},{"x":28,"y":29,"id":47},{"x":27,"y":29,"id":43},{"x":24,"y":29,"id":43},{"x":21,"y":29,"id":43},{"x":17,"y":29,"id":43},{"x":28,"y":23,"id":57},{"x":28,"y":25,"id":57},{"x":28,"y":26,"id":59},{"x":28,"y":22,"id":59},{"x":26,"y":21,"id":63},{"x":26,"y":24,"id":63},{"x":26,"y":26,"id":63},{"x":26,"y":27,"id":51},{"x":22,"y":27,"id":51},{"x":19,"y":27,"id":51},{"x":17,"y":27,"id":51},{"x":18,"y":27,"id":49},{"x":21,"y":27,"id":49},{"x":24,"y":27,"id":49},{"x":20,"y":27,"id":49},{"x":23,"y":27,"id":49},{"x":25,"y":27,"id":49},{"x":26,"y":25,"id":62},{"x":26,"y":22,"id":62},{"x":26,"y":23,"id":62},{"x":18,"y":29,"id":44},{"x":22,"y":29,"id":44},{"x":25,"y":29,"id":44},{"x":19,"y":29,"id":45},{"x":23,"y":29,"id":45},{"x":26,"y":29,"id":45},{"x":20,"y":29,"id":45},{"x":16,"y":29,"id":48},{"x":16,"y":27,"id":53},{"x":16,"y":28,"id":63},{"x":27,"y":27,"id":55},{"x":27,"y":25,"id":55},{"x":27,"y":23,"id":55},{"x":27,"y":22,"id":55},{"x":10,"y":14,"id":52},{"x":7,"y":14,"id":52},{"x":5,"y":14,"id":52},{"x":3,"y":14,"id":52},{"x":9,"y":14,"id":50},{"x":6,"y":14,"id":50},{"x":4,"y":14,"id":50},{"x":11,"y":14,"id":50},{"x":8,"y":14,"id":50},{"x":12,"y":14,"id":49},{"x":2,"y":14,"id":53},{"x":2,"y":15,"id":63},{"x":13,"y":14,"id":54},{"x":13,"y":15,"id":56},{"x":13,"y":20,"id":56},{"x":13,"y":23,"id":56},{"x":13,"y":17,"id":57},{"x":13,"y":19,"id":57},{"x":13,"y":24,"id":57},{"x":13,"y":25,"id":59},{"x":13,"y":22,"id":59},{"x":13,"y":18,"id":59},{"x":13,"y":16,"id":59},{"x":13,"y":21,"id":59},{"x":13,"y":26,"id":58},{"x":13,"y":28,"id":58},{"x":13,"y":27,"id":59},{"x":13,"y":29,"id":47},{"x":11,"y":29,"id":48},{"x":12,"y":29,"id":45},{"x":11,"y":27,"id":63},{"x":11,"y":23,"id":63},{"x":11,"y":19,"id":63},{"x":11,"y":25,"id":62},{"x":11,"y":21,"id":62},{"x":11,"y":18,"id":62},{"x":11,"y":26,"id":61},{"x":11,"y":22,"id":61},{"x":11,"y":28,"id":60},{"x":11,"y":24,"id":60},{"x":11,"y":20,"id":60},{"x":11,"y":17,"id":60},{"x":11,"y":16,"id":45},{"x":8,"y":16,"id":45},{"x":4,"y":16,"id":45},{"x":9,"y":16,"id":46},{"x":6,"y":16,"id":46},{"x":3,"y":16,"id":46},{"x":10,"y":16,"id":43},{"x":7,"y":16,"id":43},{"x":5,"y":16,"id":43},{"x":2,"y":16,"id":48},{"x":12,"y":16,"id":55},{"x":12,"y":18,"id":55},{"x":12,"y":20,"id":55},{"x":12,"y":22,"id":55},{"x":12,"y":24,"id":55},{"x":12,"y":26,"id":55},{"x":12,"y":27,"id":55},{"x":22,"y":6,"id":1},{"x":22,"y":10,"id":1},{"x":22,"y":9,"id":1},{"x":22,"y":8,"id":1},{"x":22,"y":7,"id":1},{"x":23,"y":10,"id":1},{"x":16,"y":21,"id":1},{"x":17,"y":21,"id":1},{"x":22,"y":15,"id":1},{"x":23,"y":15,"id":1},{"x":17,"y":15,"id":1},{"x":22,"y":21,"id":1},{"x":23,"y":21,"id":1},{"x":29,"y":22,"id":1},{"x":31,"y":28,"id":1},{"x":20,"y":24,"id":31},{"x":13,"y":0,"id":42},{"x":14,"y":0,"id":42},{"x":15,"y":0,"id":42},{"x":16,"y":0,"id":42},{"x":17,"y":0,"id":42},{"x":5,"y":24,"id":43},{"x":4,"y":23,"id":62},{"x":6,"y":23,"id":59},{"x":6,"y":22,"id":54},{"x":4,"y":22,"id":53},{"x":5,"y":22,"id":52},{"x":6,"y":24,"id":47},{"x":4,"y":24,"id":48},{"x":0,"y":10,"id":55},{"x":1,"y":10,"id":55},{"x":13,"y":6,"id":55},{"x":14,"y":6,"id":55},{"x":13,"y":8,"id":55},{"x":14,"y":8,"id":55},{"x":13,"y":1,"id":42},{"x":14,"y":1,"id":42},{"x":15,"y":1,"id":42},{"x":16,"y":1,"id":42},{"x":17,"y":1,"id":42},{"x":17,"y":0,"id":42},{"x":16,"y":0,"id":42},{"x":15,"y":0,"id":42},{"x":14,"y":0,"id":42},{"x":13,"y":0,"id":42},{"x":2,"y":10,"id":55},{"x":3,"y":10,"id":55},{"x":4,"y":10,"id":55},{"x":5,"y":10,"id":55},{"x":6,"y":10,"id":55},{"x":7,"y":10,"id":55},{"x":8,"y":10,"id":55},{"x":9,"y":10,"id":55},{"x":10,"y":10,"id":55},{"x":11,"y":10,"id":55},{"x":12,"y":10,"id":55},{"x":13,"y":10,"id":55},{"x":14,"y":10,"id":55},{"x":22,"y":4,"id":55},{"x":23,"y":4,"id":55},{"x":24,"y":4,"id":55},{"x":25,"y":4,"id":55},{"x":26,"y":4,"id":55},{"x":27,"y":4,"id":55},{"x":27,"y":6,"id":55},{"x":27,"y":8,"id":55},{"x":27,"y":10,"id":55},{"x":27,"y":12,"id":55},{"x":27,"y":14,"id":55},{"x":27,"y":16,"id":55},{"x":27,"y":21,"id":55},{"x":27,"y":24,"id":55},{"x":27,"y":26,"id":55},{"x":17,"y":28,"id":55},{"x":18,"y":28,"id":55},{"x":19,"y":28,"id":55},{"x":20,"y":28,"id":55},{"x":21,"y":28,"id":55},{"x":22,"y":28,"id":55},{"x":23,"y":28,"id":55},{"x":24,"y":28,"id":55},{"x":25,"y":28,"id":55},{"x":26,"y":28,"id":55},{"x":27,"y":28,"id":55},{"x":12,"y":28,"id":55},{"x":12,"y":25,"id":55},{"x":12,"y":23,"id":55},{"x":12,"y":21,"id":55},{"x":12,"y":19,"id":55},{"x":12,"y":17,"id":55},{"x":12,"y":15,"id":55},{"x":11,"y":15,"id":55},{"x":10,"y":15,"id":55},{"x":9,"y":15,"id":55},{"x":8,"y":15,"id":55},{"x":7,"y":15,"id":55},{"x":6,"y":15,"id":55},{"x":5,"y":15,"id":55},{"x":4,"y":15,"id":55},{"x":3,"y":15,"id":55},{"x":5,"y":23,"id":55},{"x":32,"y":21,"id":63},{"x":32,"y":25,"id":63},{"x":32,"y":29,"id":63},{"x":32,"y":20,"id":53},{"x":33,"y":20,"id":52},{"x":36,"y":20,"id":52},{"x":39,"y":20,"id":52},{"x":34,"y":20,"id":50},{"x":38,"y":20,"id":50},{"x":41,"y":20,"id":50},{"x":43,"y":20,"id":50},{"x":44,"y":20,"id":54},{"x":44,"y":21,"id":56},{"x":44,"y":22,"id":47},{"x":43,"y":22,"id":43},{"x":40,"y":22,"id":43},{"x":37,"y":22,"id":43},{"x":35,"y":22,"id":43},{"x":34,"y":23,"id":56},{"x":34,"y":26,"id":56},{"x":34,"y":30,"id":56},{"x":34,"y":22,"id":59},{"x":34,"y":28,"id":59},{"x":34,"y":24,"id":59},{"x":34,"y":29,"id":58},{"x":34,"y":27,"id":58},{"x":34,"y":25,"id":58},{"x":38,"y":22,"id":46},{"x":42,"y":22,"id":46},{"x":36,"y":22,"id":44},{"x":39,"y":22,"id":44},{"x":41,"y":22,"id":44},{"x":37,"y":20,"id":51},{"x":40,"y":20,"id":51},{"x":35,"y":20,"id":49},{"x":42,"y":20,"id":49},{"x":32,"y":23,"id":62},{"x":32,"y":27,"id":62},{"x":32,"y":30,"id":62},{"x":32,"y":32,"id":62},{"x":32,"y":22,"id":60},{"x":32,"y":24,"id":60},{"x":32,"y":26,"id":60},{"x":32,"y":28,"id":60},{"x":32,"y":31,"id":60},{"x":32,"y":16,"id":60},{"x":32,"y":13,"id":60},{"x":32,"y":8,"id":60},{"x":32,"y":5,"id":53},{"x":32,"y":6,"id":62},{"x":32,"y":10,"id":62},{"x":32,"y":15,"id":62},{"x":32,"y":12,"id":62},{"x":32,"y":17,"id":48},{"x":34,"y":17,"id":47},{"x":33,"y":17,"id":44},{"x":34,"y":16,"id":56},{"x":34,"y":13,"id":56},{"x":34,"y":9,"id":56},{"x":33,"y":5,"id":50},{"x":36,"y":5,"id":50},{"x":40,"y":5,"id":50},{"x":43,"y":5,"id":50},{"x":48,"y":5,"id":50},{"x":51,"y":5,"id":50},{"x":35,"y":5,"id":52},{"x":38,"y":5,"id":52},{"x":41,"y":5,"id":52},{"x":50,"y":5,"id":52},{"x":53,"y":5,"id":52},{"x":47,"y":5,"id":53},{"x":44,"y":5,"id":54},{"x":44,"y":6,"id":56},{"x":47,"y":6,"id":62},{"x":47,"y":7,"id":48},{"x":44,"y":7,"id":47},{"x":42,"y":7,"id":46},{"x":37,"y":7,"id":46},{"x":39,"y":7,"id":46},{"x":34,"y":7,"id":46},{"x":35,"y":7,"id":45},{"x":38,"y":7,"id":45},{"x":41,"y":7,"id":45},{"x":43,"y":7,"id":45},{"x":36,"y":7,"id":45},{"x":40,"y":7,"id":43},{"x":34,"y":11,"id":57},{"x":34,"y":15,"id":57},{"x":34,"y":8,"id":58},{"x":34,"y":10,"id":58},{"x":34,"y":12,"id":58},{"x":34,"y":14,"id":58},{"x":32,"y":14,"id":61},{"x":32,"y":11,"id":61},{"x":32,"y":9,"id":61},{"x":32,"y":7,"id":61},{"x":34,"y":5,"id":51},{"x":37,"y":5,"id":51},{"x":39,"y":5,"id":52},{"x":42,"y":5,"id":52},{"x":49,"y":5,"id":52},{"x":52,"y":5,"id":52},{"x":54,"y":5,"id":54},{"x":55,"y":6,"id":54},{"x":56,"y":7,"id":54},{"x":57,"y":8,"id":54},{"x":58,"y":9,"id":54},{"x":58,"y":10,"id":56},{"x":58,"y":14,"id":56},{"x":58,"y":17,"id":56},{"x":58,"y":19,"id":56},{"x":58,"y":22,"id":56},{"x":58,"y":12,"id":57},{"x":58,"y":15,"id":57},{"x":58,"y":18,"id":57},{"x":58,"y":21,"id":57},{"x":58,"y":11,"id":59},{"x":58,"y":13,"id":59},{"x":58,"y":16,"id":59},{"x":58,"y":20,"id":59},{"x":48,"y":7,"id":46},{"x":50,"y":7,"id":46},{"x":52,"y":7,"id":46},{"x":49,"y":7,"id":45},{"x":51,"y":7,"id":45},{"x":53,"y":7,"id":45},{"x":56,"y":10,"id":63},{"x":54,"y":8,"id":48},{"x":55,"y":9,"id":48},{"x":56,"y":12,"id":63},{"x":56,"y":16,"id":63},{"x":56,"y":19,"id":63},{"x":56,"y":22,"id":63},{"x":56,"y":20,"id":62},{"x":56,"y":18,"id":62},{"x":56,"y":14,"id":62},{"x":56,"y":11,"id":62},{"x":56,"y":21,"id":60},{"x":56,"y":17,"id":60},{"x":56,"y":15,"id":60},{"x":56,"y":13,"id":60},{"x":56,"y":23,"id":48},{"x":58,"y":23,"id":47},{"x":57,"y":23,"id":44},{"x":57,"y":22,"id":55},{"x":57,"y":21,"id":55},{"x":57,"y":20,"id":55},{"x":57,"y":19,"id":55},{"x":57,"y":18,"id":55},{"x":57,"y":17,"id":55},{"x":57,"y":16,"id":55},{"x":57,"y":15,"id":55},{"x":57,"y":14,"id":55},{"x":57,"y":13,"id":55},{"x":57,"y":12,"id":55},{"x":57,"y":11,"id":55},{"x":57,"y":10,"id":55},{"x":57,"y":9,"id":55},{"x":56,"y":8,"id":55},{"x":55,"y":7,"id":55},{"x":54,"y":6,"id":55},{"x":33,"y":16,"id":55},{"x":33,"y":15,"id":55},{"x":33,"y":14,"id":55},{"x":33,"y":13,"id":55},{"x":33,"y":12,"id":55},{"x":33,"y":11,"id":55},{"x":33,"y":10,"id":55},{"x":33,"y":9,"id":55},{"x":33,"y":8,"id":55},{"x":33,"y":7,"id":55},{"x":33,"y":6,"id":55},{"x":33,"y":21,"id":55},{"x":33,"y":22,"id":55},{"x":33,"y":23,"id":55},{"x":33,"y":24,"id":55},{"x":33,"y":25,"id":55},{"x":33,"y":26,"id":55},{"x":33,"y":27,"id":55},{"x":33,"y":28,"id":55},{"x":33,"y":29,"id":55},{"x":33,"y":30,"id":55},{"x":53,"y":23,"id":1},{"x":53,"y":24,"id":1},{"x":53,"y":25,"id":1},{"x":53,"y":26,"id":1},{"x":53,"y":27,"id":1},{"x":34,"y":33,"id":56},{"x":34,"y":36,"id":56},{"x":34,"y":37,"id":52},{"x":51,"y":37,"id":51},{"x":53,"y":37,"id":51},{"x":55,"y":37,"id":51},{"x":56,"y":37,"id":62},{"x":56,"y":34,"id":62},{"x":56,"y":32,"id":62},{"x":56,"y":29,"id":62},{"x":56,"y":27,"id":63},{"x":56,"y":30,"id":63},{"x":56,"y":35,"id":63},{"x":56,"y":26,"id":53},{"x":58,"y":26,"id":54},{"x":57,"y":26,"id":51},{"x":58,"y":27,"id":56},{"x":58,"y":30,"id":56},{"x":58,"y":34,"id":56},{"x":58,"y":37,"id":56},{"x":58,"y":38,"id":56},{"x":35,"y":37,"id":50},{"x":37,"y":37,"id":50},{"x":36,"y":37,"id":49},{"x":52,"y":37,"id":49},{"x":54,"y":37,"id":49},{"x":56,"y":36,"id":60},{"x":56,"y":33,"id":60},{"x":56,"y":31,"id":60},{"x":56,"y":28,"id":60},{"x":58,"y":29,"id":59},{"x":58,"y":32,"id":59},{"x":58,"y":35,"id":59},{"x":58,"y":36,"id":58},{"x":58,"y":33,"id":58},{"x":58,"y":31,"id":58},{"x":58,"y":28,"id":58},{"x":34,"y":31,"id":58},{"x":34,"y":34,"id":58},{"x":34,"y":35,"id":59},{"x":34,"y":32,"id":59},{"x":53,"y":28,"id":1},{"x":53,"y":29,"id":1},{"x":53,"y":30,"id":1},{"x":53,"y":31,"id":1},{"x":50,"y":37,"id":53},{"x":50,"y":38,"id":63},{"x":50,"y":41,"id":63},{"x":50,"y":44,"id":63},{"x":50,"y":47,"id":63},{"x":47,"y":40,"id":54},{"x":46,"y":40,"id":53},{"x":47,"y":41,"id":47},{"x":46,"y":41,"id":48},{"x":46,"y":46,"id":48},{"x":46,"y":45,"id":53},{"x":47,"y":45,"id":54},{"x":47,"y":46,"id":47},{"x":47,"y":51,"id":47},{"x":46,"y":50,"id":53},{"x":47,"y":50,"id":54},{"x":46,"y":51,"id":48},{"x":41,"y":46,"id":48},{"x":41,"y":41,"id":48},{"x":41,"y":51,"id":48},{"x":42,"y":51,"id":47},{"x":42,"y":46,"id":47},{"x":42,"y":41,"id":47},{"x":41,"y":50,"id":53},{"x":41,"y":40,"id":53},{"x":41,"y":45,"id":53},{"x":42,"y":40,"id":54},{"x":42,"y":45,"id":54},{"x":42,"y":50,"id":54},{"x":38,"y":39,"id":57},{"x":38,"y":42,"id":57},{"x":38,"y":45,"id":57},{"x":38,"y":47,"id":57},{"x":38,"y":50,"id":57},{"x":38,"y":53,"id":57},{"x":50,"y":50,"id":63},{"x":50,"y":53,"id":63},{"x":50,"y":39,"id":61},{"x":50,"y":42,"id":61},{"x":50,"y":45,"id":61},{"x":50,"y":48,"id":61},{"x":50,"y":51,"id":61},{"x":50,"y":52,"id":63},{"x":50,"y":49,"id":63},{"x":50,"y":46,"id":63},{"x":50,"y":43,"id":63},{"x":50,"y":40,"id":63},{"x":38,"y":40,"id":56},{"x":38,"y":43,"id":56},{"x":38,"y":46,"id":56},{"x":38,"y":49,"id":56},{"x":38,"y":51,"id":56},{"x":38,"y":37,"id":54},{"x":38,"y":38,"id":56},{"x":38,"y":41,"id":56},{"x":38,"y":44,"id":56},{"x":38,"y":48,"id":56},{"x":38,"y":52,"id":56},{"x":58,"y":39,"id":47},{"x":57,"y":40,"id":47},{"x":56,"y":41,"id":47},{"x":55,"y":42,"id":47},{"x":54,"y":43,"id":47},{"x":54,"y":44,"id":56},{"x":54,"y":48,"id":56},{"x":54,"y":50,"id":56},{"x":54,"y":52,"id":56},{"x":54,"y":54,"id":56},{"x":54,"y":56,"id":56},{"x":54,"y":57,"id":47},{"x":50,"y":57,"id":48},{"x":52,"y":57,"id":46},{"x":51,"y":57,"id":44},{"x":53,"y":57,"id":44},{"x":50,"y":55,"id":63},{"x":50,"y":54,"id":62},{"x":50,"y":56,"id":62},{"x":54,"y":55,"id":56},{"x":54,"y":53,"id":56},{"x":54,"y":46,"id":56},{"x":54,"y":45,"id":58},{"x":54,"y":47,"id":58},{"x":54,"y":49,"id":58},{"x":54,"y":51,"id":58},{"x":61,"y":58,"id":58},{"x":61,"y":55,"id":58},{"x":61,"y":51,"id":58},{"x":59,"y":48,"id":53},{"x":60,"y":48,"id":50},{"x":59,"y":50,"id":62},{"x":59,"y":53,"id":62},{"x":59,"y":57,"id":62},{"x":62,"y":48,"id":52},{"x":61,"y":48,"id":51},{"x":63,"y":48,"id":51},{"x":63,"y":50,"id":43},{"x":61,"y":50,"id":43},{"x":62,"y":50,"id":45},{"x":61,"y":53,"id":56},{"x":61,"y":56,"id":56},{"x":61,"y":59,"id":56},{"x":61,"y":61,"id":47},{"x":59,"y":61,"id":48},{"x":60,"y":61,"id":46},{"x":61,"y":60,"id":56},{"x":61,"y":57,"id":56},{"x":61,"y":54,"id":56},{"x":61,"y":52,"id":56},{"x":59,"y":49,"id":63},{"x":59,"y":52,"id":63},{"x":59,"y":55,"id":63},{"x":59,"y":59,"id":63},{"x":59,"y":51,"id":61},{"x":59,"y":54,"id":61},{"x":59,"y":56,"id":61},{"x":59,"y":58,"id":61},{"x":59,"y":60,"id":61},{"x":60,"y":33,"id":31},{"x":59,"y":33,"id":31},{"x":61,"y":33,"id":31},{"x":59,"y":34,"id":31},{"x":61,"y":19,"id":31},{"x":62,"y":14,"id":31},{"x":61,"y":14,"id":31},{"x":62,"y":29,"id":31},{"x":61,"y":44,"id":31},{"x":61,"y":45,"id":31},{"x":55,"y":49,"id":31},{"x":56,"y":48,"id":31},{"x":56,"y":49,"id":31},{"x":0,"y":32,"id":49},{"x":4,"y":32,"id":49},{"x":7,"y":32,"id":49},{"x":10,"y":32,"id":49},{"x":12,"y":32,"id":49},{"x":15,"y":32,"id":49},{"x":32,"y":35,"id":63},{"x":32,"y":38,"id":63},{"x":32,"y":39,"id":62},{"x":32,"y":40,"id":48},{"x":33,"y":41,"id":48},{"x":34,"y":42,"id":48},{"x":35,"y":43,"id":48},{"x":35,"y":44,"id":63},{"x":35,"y":46,"id":63},{"x":35,"y":49,"id":63},{"x":35,"y":52,"id":63},{"x":35,"y":54,"id":48},{"x":38,"y":54,"id":47},{"x":36,"y":54,"id":43},{"x":37,"y":54,"id":44},{"x":35,"y":58,"id":53},{"x":37,"y":58,"id":54},{"x":37,"y":61,"id":56},{"x":37,"y":60,"id":57},{"x":37,"y":62,"id":57},{"x":37,"y":59,"id":59},{"x":37,"y":63,"id":59},{"x":35,"y":60,"id":63},{"x":35,"y":62,"id":63},{"x":35,"y":59,"id":62},{"x":35,"y":61,"id":62},{"x":35,"y":63,"id":62},{"x":36,"y":58,"id":52},{"x":35,"y":47,"id":62},{"x":35,"y":51,"id":62},{"x":35,"y":53,"id":62},{"x":35,"y":45,"id":61},{"x":35,"y":48,"id":61},{"x":35,"y":50,"id":61},{"x":32,"y":34,"id":61},{"x":32,"y":36,"id":61},{"x":32,"y":37,"id":60},{"x":32,"y":33,"id":60},{"x":41,"y":56,"id":48},{"x":46,"y":56,"id":48},{"x":42,"y":56,"id":47},{"x":47,"y":56,"id":47},{"x":41,"y":55,"id":53},{"x":46,"y":55,"id":53},{"x":42,"y":55,"id":54},{"x":47,"y":55,"id":54},{"x":16,"y":32,"id":54},{"x":16,"y":34,"id":47},{"x":14,"y":34,"id":46},{"x":11,"y":34,"id":46},{"x":8,"y":34,"id":46},{"x":5,"y":34,"id":46},{"x":2,"y":34,"id":46},{"x":0,"y":34,"id":43},{"x":3,"y":34,"id":43},{"x":6,"y":34,"id":43},{"x":12,"y":34,"id":43},{"x":1,"y":34,"id":44},{"x":4,"y":34,"id":44},{"x":7,"y":34,"id":44},{"x":10,"y":34,"id":44},{"x":13,"y":34,"id":44},{"x":9,"y":34,"id":45},{"x":15,"y":34,"id":45},{"x":2,"y":32,"id":51},{"x":5,"y":32,"id":51},{"x":8,"y":32,"id":51},{"x":13,"y":32,"id":51},{"x":11,"y":32,"id":51},{"x":14,"y":32,"id":52},{"x":9,"y":32,"id":52},{"x":6,"y":32,"id":52},{"x":3,"y":32,"id":52},{"x":1,"y":32,"id":52},{"x":16,"y":33,"id":56},{"x":4,"y":38,"id":53},{"x":6,"y":38,"id":54},{"x":4,"y":46,"id":48},{"x":6,"y":46,"id":47},{"x":6,"y":59,"id":47},{"x":4,"y":59,"id":48},{"x":4,"y":50,"id":53},{"x":6,"y":50,"id":54},{"x":11,"y":50,"id":53},{"x":13,"y":50,"id":54},{"x":13,"y":38,"id":54},{"x":11,"y":38,"id":53},{"x":11,"y":46,"id":48},{"x":13,"y":46,"id":47},{"x":13,"y":59,"id":47},{"x":11,"y":59,"id":48},{"x":18,"y":46,"id":48},{"x":18,"y":59,"id":48},{"x":18,"y":38,"id":53},{"x":18,"y":50,"id":53},{"x":20,"y":38,"id":54},{"x":20,"y":50,"id":54},{"x":20,"y":59,"id":47},{"x":20,"y":46,"id":47},{"x":25,"y":32,"id":53},{"x":27,"y":32,"id":54},{"x":27,"y":46,"id":47},{"x":27,"y":59,"id":47},{"x":25,"y":59,"id":48},{"x":25,"y":46,"id":48},{"x":25,"y":50,"id":53},{"x":27,"y":50,"id":54},{"x":33,"y":50,"id":1},{"x":34,"y":50,"id":1},{"x":30,"y":54,"id":1},{"x":29,"y":54,"id":1},{"x":28,"y":54,"id":1},{"x":27,"y":52,"id":56},{"x":27,"y":55,"id":56},{"x":27,"y":57,"id":56},{"x":20,"y":52,"id":56},{"x":20,"y":55,"id":56},{"x":20,"y":57,"id":56},{"x":13,"y":53,"id":56},{"x":13,"y":56,"id":56},{"x":13,"y":58,"id":56},{"x":6,"y":56,"id":56},{"x":6,"y":54,"id":56},{"x":6,"y":52,"id":56},{"x":6,"y":40,"id":56},{"x":6,"y":42,"id":56},{"x":6,"y":43,"id":56},{"x":13,"y":40,"id":56},{"x":13,"y":42,"id":56},{"x":13,"y":45,"id":56},{"x":20,"y":41,"id":56},{"x":20,"y":43,"id":56},{"x":20,"y":45,"id":56},{"x":27,"y":45,"id":56},{"x":27,"y":40,"id":56},{"x":27,"y":35,"id":56},{"x":27,"y":37,"id":56},{"x":27,"y":42,"id":56},{"x":18,"y":57,"id":63},{"x":18,"y":55,"id":63},{"x":18,"y":52,"id":63},{"x":25,"y":52,"id":63},{"x":25,"y":55,"id":63},{"x":25,"y":57,"id":63},{"x":25,"y":43,"id":63},{"x":25,"y":40,"id":63},{"x":25,"y":37,"id":63},{"x":25,"y":34,"id":63},{"x":18,"y":41,"id":63},{"x":18,"y":44,"id":63},{"x":11,"y":44,"id":63},{"x":11,"y":42,"id":63},{"x":11,"y":40,"id":63},{"x":4,"y":40,"id":63},{"x":4,"y":42,"id":63},{"x":4,"y":43,"id":63},{"x":4,"y":54,"id":63},{"x":4,"y":57,"id":63},{"x":11,"y":52,"id":63},{"x":11,"y":54,"id":63},{"x":11,"y":57,"id":63},{"x":4,"y":56,"id":62},{"x":4,"y":52,"id":62},{"x":4,"y":44,"id":62},{"x":4,"y":41,"id":62},{"x":11,"y":41,"id":62},{"x":11,"y":45,"id":62},{"x":18,"y":43,"id":62},{"x":18,"y":39,"id":62},{"x":25,"y":36,"id":62},{"x":25,"y":38,"id":62},{"x":25,"y":44,"id":62},{"x":25,"y":53,"id":62},{"x":25,"y":56,"id":62},{"x":18,"y":56,"id":62},{"x":18,"y":53,"id":62},{"x":11,"y":56,"id":62},{"x":11,"y":51,"id":62},{"x":4,"y":53,"id":62},{"x":4,"y":55,"id":62},{"x":4,"y":45,"id":60},{"x":4,"y":39,"id":60},{"x":11,"y":39,"id":60},{"x":11,"y":43,"id":60},{"x":18,"y":40,"id":60},{"x":18,"y":42,"id":60},{"x":18,"y":45,"id":60},{"x":25,"y":33,"id":60},{"x":25,"y":35,"id":60},{"x":25,"y":39,"id":60},{"x":25,"y":41,"id":60},{"x":25,"y":42,"id":60},{"x":25,"y":45,"id":60},{"x":25,"y":51,"id":60},{"x":25,"y":54,"id":60},{"x":25,"y":58,"id":60},{"x":18,"y":58,"id":60},{"x":18,"y":54,"id":60},{"x":18,"y":51,"id":60},{"x":11,"y":53,"id":60},{"x":11,"y":55,"id":60},{"x":11,"y":58,"id":60},{"x":4,"y":58,"id":60},{"x":4,"y":51,"id":60},{"x":6,"y":44,"id":57},{"x":6,"y":41,"id":57},{"x":13,"y":43,"id":57},{"x":13,"y":41,"id":57},{"x":20,"y":40,"id":57},{"x":20,"y":42,"id":57},{"x":20,"y":53,"id":57},{"x":13,"y":55,"id":57},{"x":6,"y":53,"id":57},{"x":6,"y":57,"id":57},{"x":13,"y":51,"id":57},{"x":20,"y":51,"id":57},{"x":27,"y":51,"id":57},{"x":27,"y":44,"id":57},{"x":27,"y":34,"id":57},{"x":27,"y":38,"id":57},{"x":6,"y":45,"id":59},{"x":6,"y":39,"id":59},{"x":6,"y":51,"id":59},{"x":6,"y":55,"id":59},{"x":6,"y":58,"id":59},{"x":13,"y":57,"id":59},{"x":13,"y":54,"id":59},{"x":13,"y":52,"id":59},{"x":20,"y":54,"id":59},{"x":20,"y":56,"id":59},{"x":20,"y":58,"id":59},{"x":27,"y":58,"id":59},{"x":27,"y":56,"id":59},{"x":27,"y":54,"id":59},{"x":27,"y":53,"id":59},{"x":27,"y":43,"id":59},{"x":27,"y":41,"id":59},{"x":27,"y":39,"id":59},{"x":27,"y":36,"id":59},{"x":27,"y":33,"id":59},{"x":13,"y":44,"id":59},{"x":13,"y":39,"id":59},{"x":20,"y":39,"id":59},{"x":20,"y":44,"id":59},{"x":5,"y":38,"id":50},{"x":12,"y":38,"id":50},{"x":19,"y":38,"id":50},{"x":26,"y":32,"id":50},{"x":26,"y":50,"id":50},{"x":19,"y":50,"id":50},{"x":12,"y":50,"id":50},{"x":5,"y":50,"id":50},{"x":5,"y":59,"id":44},{"x":12,"y":59,"id":44},{"x":19,"y":59,"id":44},{"x":26,"y":59,"id":44},{"x":26,"y":46,"id":44},{"x":19,"y":46,"id":44},{"x":12,"y":46,"id":44},{"x":5,"y":46,"id":44},{"x":17,"y":34,"id":1},{"x":18,"y":34,"id":1},{"x":18,"y":35,"id":1},{"x":18,"y":36,"id":1},{"x":18,"y":37,"id":1},{"x":23,"y":49,"id":1},{"x":24,"y":49,"id":1},{"x":14,"y":41,"id":1},{"x":14,"y":42,"id":1},{"x":14,"y":43,"id":1},{"x":10,"y":38,"id":1},{"x":10,"y":40,"id":1},{"x":10,"y":43,"id":1},{"x":0,"y":52,"id":1},{"x":0,"y":46,"id":1},{"x":0,"y":36,"id":1},{"x":0,"y":35,"id":1},{"x":1,"y":35,"id":1},{"x":0,"y":60,"id":1},{"x":3,"y":62,"id":1},{"x":3,"y":63,"id":1},{"x":8,"y":55,"id":1},{"x":16,"y":57,"id":1},{"x":16,"y":39,"id":1},{"x":21,"y":32,"id":1},{"x":22,"y":32,"id":1},{"x":22,"y":33,"id":1},{"x":21,"y":33,"id":1},{"x":24,"y":38,"id":1},{"x":21,"y":44,"id":1},{"x":22,"y":44,"id":1},{"x":21,"y":56,"id":1},{"x":22,"y":56,"id":1},{"x":7,"y":49,"id":1},{"x":7,"y":50,"id":1},{"x":8,"y":50,"id":1},{"x":8,"y":49,"id":1},{"x":7,"y":51,"id":1},{"x":8,"y":51,"id":1},{"x":3,"y":42,"id":1},{"x":2,"y":42,"id":1},{"x":28,"y":41,"id":1},{"x":29,"y":42,"id":1},{"x":30,"y":43,"id":1},{"x":29,"y":43,"id":1},{"x":28,"y":43,"id":1},{"x":28,"y":42,"id":1},{"x":17,"y":62,"id":1},{"x":17,"y":63,"id":1},{"x":27,"y":60,"id":1},{"x":11,"y":47,"id":1},{"x":11,"y":48,"id":1},{"x":11,"y":49,"id":1},{"x":34,"y":2,"id":31},{"x":35,"y":2,"id":31},{"x":36,"y":2,"id":31},{"x":37,"y":2,"id":31},{"x":40,"y":2,"id":31},{"x":41,"y":2,"id":31},{"x":58,"y":0,"id":31},{"x":58,"y":1,"id":31},{"x":58,"y":3,"id":31},{"x":58,"y":4,"id":31},{"x":59,"y":5,"id":31},{"x":60,"y":5,"id":31},{"x":61,"y":5,"id":31},{"x":59,"y":4,"id":31},{"x":63,"y":0,"id":31},{"x":61,"y":6,"id":31},{"x":18,"y":15,"id":31},{"x":3,"y":46,"id":31},{"x":3,"y":45,"id":31},{"x":5,"y":39,"id":55},{"x":5,"y":40,"id":55},{"x":5,"y":41,"id":55},{"x":5,"y":42,"id":55},{"x":5,"y":43,"id":55},{"x":5,"y":44,"id":55},{"x":5,"y":45,"id":55},{"x":5,"y":51,"id":55},{"x":5,"y":52,"id":55},{"x":5,"y":53,"id":55},{"x":5,"y":54,"id":55},{"x":5,"y":55,"id":55},{"x":5,"y":56,"id":55},{"x":5,"y":57,"id":55},{"x":5,"y":58,"id":55},{"x":12,"y":39,"id":55},{"x":12,"y":40,"id":55},{"x":12,"y":41,"id":55},{"x":12,"y":42,"id":55},{"x":12,"y":43,"id":55},{"x":12,"y":44,"id":55},{"x":12,"y":45,"id":55},{"x":12,"y":51,"id":55},{"x":12,"y":52,"id":55},{"x":12,"y":53,"id":55},{"x":12,"y":54,"id":55},{"x":12,"y":55,"id":55},{"x":12,"y":56,"id":55},{"x":12,"y":57,"id":55},{"x":12,"y":58,"id":55},{"x":19,"y":39,"id":55},{"x":19,"y":40,"id":55},{"x":19,"y":41,"id":55},{"x":19,"y":42,"id":55},{"x":19,"y":43,"id":55},{"x":19,"y":44,"id":55},{"x":19,"y":45,"id":55},{"x":19,"y":51,"id":55},{"x":19,"y":52,"id":55},{"x":19,"y":53,"id":55},{"x":19,"y":54,"id":55},{"x":19,"y":55,"id":55},{"x":19,"y":56,"id":55},{"x":19,"y":57,"id":55},{"x":19,"y":58,"id":55},{"x":26,"y":51,"id":55},{"x":26,"y":52,"id":55},{"x":26,"y":53,"id":55},{"x":26,"y":54,"id":55},{"x":26,"y":55,"id":55},{"x":26,"y":56,"id":55},{"x":26,"y":57,"id":55},{"x":26,"y":58,"id":55},{"x":26,"y":33,"id":55},{"x":26,"y":34,"id":55},{"x":26,"y":35,"id":55},{"x":26,"y":36,"id":55},{"x":26,"y":37,"id":55},{"x":26,"y":38,"id":55},{"x":26,"y":39,"id":55},{"x":26,"y":40,"id":55},{"x":26,"y":41,"id":55},{"x":26,"y":42,"id":55},{"x":26,"y":43,"id":55},{"x":26,"y":44,"id":55},{"x":26,"y":45,"id":55},{"x":33,"y":31,"id":55},{"x":33,"y":32,"id":55},{"x":33,"y":33,"id":55},{"x":33,"y":34,"id":55},{"x":33,"y":35,"id":55},{"x":33,"y":36,"id":55},{"x":33,"y":37,"id":55},{"x":33,"y":38,"id":55},{"x":33,"y":39,"id":55},{"x":33,"y":40,"id":55},{"x":34,"y":38,"id":55},{"x":34,"y":39,"id":55},{"x":34,"y":40,"id":55},{"x":34,"y":41,"id":55},{"x":35,"y":38,"id":55},{"x":35,"y":39,"id":55},{"x":35,"y":40,"id":55},{"x":35,"y":41,"id":55},{"x":35,"y":42,"id":55},{"x":36,"y":38,"id":55},{"x":37,"y":38,"id":55},{"x":36,"y":39,"id":55},{"x":37,"y":39,"id":55},{"x":36,"y":40,"id":55},{"x":37,"y":40,"id":55},{"x":36,"y":41,"id":55},{"x":37,"y":41,"id":55},{"x":36,"y":42,"id":55},{"x":37,"y":42,"id":55},{"x":36,"y":43,"id":55},{"x":37,"y":43,"id":55},{"x":36,"y":44,"id":55},{"x":37,"y":44,"id":55},{"x":36,"y":45,"id":55},{"x":37,"y":45,"id":55},{"x":36,"y":46,"id":55},{"x":37,"y":46,"id":55},{"x":36,"y":47,"id":55},{"x":37,"y":47,"id":55},{"x":36,"y":49,"id":55},{"x":37,"y":48,"id":55},{"x":36,"y":48,"id":55},{"x":37,"y":49,"id":55},{"x":36,"y":50,"id":55},{"x":37,"y":50,"id":55},{"x":36,"y":51,"id":55},{"x":37,"y":51,"id":55},{"x":36,"y":52,"id":55},{"x":37,"y":52,"id":55},{"x":36,"y":53,"id":55},{"x":37,"y":53,"id":55},{"x":36,"y":59,"id":55},{"x":36,"y":60,"id":55},{"x":36,"y":61,"id":55},{"x":36,"y":62,"id":55},{"x":36,"y":63,"id":55},{"x":63,"y":49,"id":55},{"x":62,"y":49,"id":55},{"x":61,"y":49,"id":55},{"x":60,"y":49,"id":55},{"x":60,"y":50,"id":55},{"x":60,"y":51,"id":55},{"x":60,"y":52,"id":55},{"x":60,"y":53,"id":55},{"x":60,"y":54,"id":55},{"x":60,"y":55,"id":55},{"x":60,"y":56,"id":55},{"x":60,"y":57,"id":55},{"x":60,"y":58,"id":55},{"x":60,"y":59,"id":55},{"x":60,"y":60,"id":55},{"x":57,"y":27,"id":55},{"x":57,"y":28,"id":55},{"x":57,"y":29,"id":55},{"x":57,"y":30,"id":55},{"x":57,"y":31,"id":55},{"x":57,"y":32,"id":55},{"x":57,"y":33,"id":55},{"x":57,"y":34,"id":55},{"x":57,"y":35,"id":55},{"x":57,"y":36,"id":55},{"x":57,"y":37,"id":55},{"x":57,"y":38,"id":55},{"x":57,"y":39,"id":55},{"x":56,"y":38,"id":55},{"x":56,"y":39,"id":55},{"x":56,"y":40,"id":55},{"x":55,"y":38,"id":55},{"x":55,"y":39,"id":55},{"x":55,"y":40,"id":55},{"x":55,"y":41,"id":55},{"x":54,"y":38,"id":55},{"x":54,"y":39,"id":55},{"x":54,"y":40,"id":55},{"x":54,"y":41,"id":55},{"x":54,"y":42,"id":55},{"x":51,"y":38,"id":55},{"x":52,"y":38,"id":55},{"x":53,"y":38,"id":55},{"x":53,"y":39,"id":55},{"x":52,"y":39,"id":55},{"x":51,"y":39,"id":55},{"x":51,"y":40,"id":55},{"x":52,"y":40,"id":55},{"x":53,"y":40,"id":55},{"x":52,"y":41,"id":55},{"x":51,"y":41,"id":55},{"x":53,"y":41,"id":55},{"x":53,"y":42,"id":55},{"x":52,"y":42,"id":55},{"x":51,"y":42,"id":55},{"x":51,"y":43,"id":55},{"x":52,"y":43,"id":55},{"x":53,"y":43,"id":55},{"x":53,"y":44,"id":55},{"x":52,"y":44,"id":55},{"x":51,"y":44,"id":55},{"x":51,"y":45,"id":55},{"x":52,"y":45,"id":55},{"x":53,"y":45,"id":55},{"x":53,"y":46,"id":55},{"x":52,"y":46,"id":55},{"x":51,"y":46,"id":55},{"x":51,"y":47,"id":55},{"x":52,"y":47,"id":55},{"x":53,"y":47,"id":55},{"x":51,"y":48,"id":55},{"x":52,"y":48,"id":55},{"x":53,"y":48,"id":55},{"x":53,"y":49,"id":55},{"x":52,"y":49,"id":55},{"x":51,"y":49,"id":55},{"x":51,"y":50,"id":55},{"x":52,"y":50,"id":55},{"x":53,"y":50,"id":55},{"x":53,"y":51,"id":55},{"x":52,"y":51,"id":55},{"x":51,"y":51,"id":55},{"x":51,"y":52,"id":55},{"x":52,"y":52,"id":55},{"x":53,"y":52,"id":55},{"x":53,"y":53,"id":55},{"x":52,"y":53,"id":55},{"x":51,"y":53,"id":55},{"x":51,"y":54,"id":55},{"x":52,"y":54,"id":55},{"x":53,"y":54,"id":55},{"x":53,"y":55,"id":55},{"x":52,"y":55,"id":55},{"x":51,"y":55,"id":55},{"x":51,"y":56,"id":55},{"x":52,"y":56,"id":55},{"x":53,"y":56,"id":55},{"x":5,"y":0,"id":66},{"x":24,"y":0,"id":66},{"x":33,"y":0,"id":66},{"x":42,"y":0,"id":66},{"x":51,"y":0,"id":66},{"x":27,"y":18,"id":66},{"x":33,"y":18,"id":66},{"x":57,"y":24,"id":66},{"x":5,"y":25,"id":66},{"x":7,"y":17,"id":66},{"x":7,"y":12,"id":66},{"x":52,"y":58,"id":66},{"x":12,"y":47,"id":66},{"x":19,"y":47,"id":66},{"x":26,"y":47,"id":66},{"x":5,"y":47,"id":66},{"x":5,"y":60,"id":66},{"x":12,"y":60,"id":66},{"x":19,"y":60,"id":66},{"x":26,"y":60,"id":66},{"x":21,"y":30,"id":66},{"x":55,"y":53,"id":67},{"x":55,"y":46,"id":67},{"x":59,"y":36,"id":67},{"x":59,"y":29,"id":67},{"x":59,"y":15,"id":67},{"x":16,"y":7,"id":67},{"x":0,"y":22,"id":67},{"x":0,"y":55,"id":67},{"x":0,"y":40,"id":67},{"x":14,"y":17,"id":67},{"x":39,"y":48,"id":67},{"x":38,"y":59,"id":67},{"x":31,"y":10,"id":68},{"x":55,"y":18,"id":68},{"x":63,"y":15,"id":68},{"x":63,"y":56,"id":68},{"x":49,"y":48,"id":68},{"x":34,"y":47,"id":68},{"x":24,"y":40,"id":68},{"x":24,"y":55,"id":68},{"x":31,"y":36,"id":68},{"x":37,"y":13,"id":70},{"x":38,"y":13,"id":70},{"x":39,"y":13,"id":70},{"x":39,"y":12,"id":70},{"x":38,"y":12,"id":70},{"x":37,"y":12,"id":70},{"x":47,"y":12,"id":70},{"x":47,"y":13,"id":70},{"x":47,"y":14,"id":70},{"x":47,"y":15,"id":70},{"x":48,"y":15,"id":70},{"x":49,"y":15,"id":70},{"x":50,"y":15,"id":70},{"x":51,"y":15,"id":70},{"x":51,"y":14,"id":70},{"x":51,"y":13,"id":70},{"x":51,"y":12,"id":70},{"x":47,"y":25,"id":70},{"x":46,"y":25,"id":70},{"x":45,"y":25,"id":70},{"x":46,"y":14,"id":31},{"x":46,"y":15,"id":31},{"x":45,"y":15,"id":31},{"x":48,"y":16,"id":31},{"x":55,"y":14,"id":31},{"x":55,"y":15,"id":31},{"x":38,"y":11,"id":31},{"x":39,"y":11,"id":31},{"x":38,"y":31,"id":48},{"x":38,"y":27,"id":53},{"x":40,"y":31,"id":47},{"x":40,"y":27,"id":54},{"x":39,"y":31,"id":45},{"x":39,"y":27,"id":49},{"x":40,"y":29,"id":56},{"x":38,"y":29,"id":62},{"x":38,"y":28,"id":63},{"x":38,"y":30,"id":63},{"x":40,"y":28,"id":57},{"x":40,"y":30,"id":57},{"x":39,"y":30,"id":55},{"x":39,"y":29,"id":55},{"x":39,"y":28,"id":55},{"x":41,"y":31,"id":70},{"x":42,"y":31,"id":70},{"x":43,"y":31,"id":70},{"x":41,"y":30,"id":70},{"x":42,"y":30,"id":70},{"x":41,"y":29,"id":70},{"x":42,"y":29,"id":70},{"x":41,"y":28,"id":70},{"x":41,"y":27,"id":70},{"x":42,"y":28,"id":70},{"x":41,"y":26,"id":70},{"x":42,"y":27,"id":70},{"x":43,"y":28,"id":70},{"x":44,"y":28,"id":70},{"x":49,"y":16,"id":1},{"x":50,"y":16,"id":1},{"x":48,"y":25,"id":1},{"x":49,"y":25,"id":1},{"x":50,"y":25,"id":1},{"x":48,"y":26,"id":1},{"x":49,"y":26,"id":1},{"x":50,"y":26,"id":1},{"x":50,"y":27,"id":1},{"x":55,"y":36,"id":1},{"x":54,"y":36,"id":1},{"x":55,"y":35,"id":1},{"x":55,"y":34,"id":1},{"x":42,"y":16,"id":70},{"x":43,"y":8,"id":70},{"x":42,"y":8,"id":70},{"x":41,"y":8,"id":1},{"x":40,"y":8,"id":1},{"x":35,"y":8,"id":1},{"x":55,"y":10,"id":1},{"x":48,"y":12,"id":53},{"x":50,"y":12,"id":54},{"x":48,"y":14,"id":48},{"x":50,"y":14,"id":47},{"x":48,"y":13,"id":63},{"x":50,"y":13,"id":57},{"x":49,"y":12,"id":50},{"x":49,"y":14,"id":45},{"x":49,"y":13,"id":55},{"x":47,"y":11,"id":70},{"x":48,"y":11,"id":70},{"x":49,"y":11,"id":70},{"x":50,"y":11,"id":70},{"x":51,"y":11,"id":70},{"x":55,"y":13,"id":1},{"x":55,"y":16,"id":1},{"x":35,"y":15,"id":1},{"x":35,"y":16,"id":1},{"x":41,"y":19,"id":1},{"x":42,"y":19,"id":1},{"x":37,"y":23,"id":1},{"x":28,"y":50,"id":70},{"x":29,"y":50,"id":70},{"x":29,"y":51,"id":70},{"x":28,"y":51,"id":70},{"x":28,"y":52,"id":70},{"x":29,"y":52,"id":70},{"x":28,"y":53,"id":70},{"x":29,"y":53,"id":70},{"x":17,"y":18,"id":70},{"x":18,"y":18,"id":70},{"x":61,"y":36,"id":70},{"x":61,"y":37,"id":70}],"groundTiles":[{"x":27,"y":-5,"id":22},{"x":0,"y":0,"id":41},{"x":0,"y":1,"id":41},{"x":2,"y":2,"id":40},{"x":1,"y":3,"id":40},{"x":4,"y":1,"id":40},{"x":1,"y":1,"id":39},{"x":1,"y":0,"id":39},{"x":0,"y":2,"id":39},{"x":1,"y":2,"id":39},{"x":2,"y":1,"id":39},{"x":2,"y":0,"id":39},{"x":4,"y":0,"id":39},{"x":3,"y":2,"id":39},{"x":0,"y":3,"id":39},{"x":0,"y":5,"id":39},{"x":2,"y":4,"id":39},{"x":1,"y":6,"id":39},{"x":0,"y":6,"id":39},{"x":3,"y":5,"id":39},{"x":4,"y":4,"id":39},{"x":5,"y":3,"id":39},{"x":4,"y":3,"id":39},{"x":3,"y":3,"id":39},{"x":5,"y":2,"id":39},{"x":6,"y":1,"id":39},{"x":6,"y":0,"id":39},{"x":7,"y":1,"id":39},{"x":7,"y":3,"id":39},{"x":7,"y":2,"id":39},{"x":7,"y":4,"id":39},{"x":6,"y":5,"id":39},{"x":5,"y":5,"id":39},{"x":4,"y":6,"id":39},{"x":6,"y":6,"id":39},{"x":8,"y":6,"id":39},{"x":8,"y":5,"id":39},{"x":9,"y":5,"id":39},{"x":9,"y":4,"id":39},{"x":9,"y":3,"id":39},{"x":8,"y":2,"id":39},{"x":9,"y":1,"id":39},{"x":10,"y":2,"id":39},{"x":10,"y":4,"id":39},{"x":10,"y":5,"id":39},{"x":10,"y":1,"id":39},{"x":9,"y":0,"id":39},{"x":8,"y":0,"id":39},{"x":11,"y":0,"id":39},{"x":11,"y":2,"id":39},{"x":11,"y":4,"id":39},{"x":11,"y":5,"id":39},{"x":10,"y":6,"id":39},{"x":7,"y":5,"id":39},{"x":6,"y":4,"id":39},{"x":2,"y":6,"id":41},{"x":1,"y":5,"id":41},{"x":2,"y":3,"id":41},{"x":3,"y":4,"id":41},{"x":5,"y":4,"id":41},{"x":6,"y":2,"id":41},{"x":8,"y":3,"id":41},{"x":8,"y":1,"id":41},{"x":10,"y":3,"id":41},{"x":4,"y":5,"id":40},{"x":1,"y":4,"id":40},{"x":0,"y":4,"id":40},{"x":5,"y":1,"id":40},{"x":7,"y":0,"id":40},{"x":8,"y":4,"id":40},{"x":5,"y":6,"id":40},{"x":9,"y":6,"id":40},{"x":11,"y":6,"id":40},{"x":2,"y":5,"id":39},{"x":3,"y":6,"id":38},{"x":3,"y":1,"id":38},{"x":3,"y":0,"id":38},{"x":4,"y":2,"id":38},{"x":5,"y":0,"id":38},{"x":6,"y":3,"id":38},{"x":9,"y":2,"id":38},{"x":11,"y":1,"id":38},{"x":10,"y":0,"id":38},{"x":11,"y":3,"id":38},{"x":7,"y":6,"id":38},{"x":0,"y":7,"id":41},{"x":1,"y":7,"id":41},{"x":5,"y":7,"id":41},{"x":6,"y":7,"id":41},{"x":8,"y":7,"id":41},{"x":10,"y":7,"id":41},{"x":2,"y":7,"id":38},{"x":3,"y":7,"id":38},{"x":4,"y":7,"id":38},{"x":7,"y":7,"id":38},{"x":9,"y":7,"id":38},{"x":11,"y":7,"id":38},{"x":1,"y":18,"id":34},{"x":2,"y":18,"id":34},{"x":2,"y":21,"id":34},{"x":4,"y":23,"id":34},{"x":7,"y":26,"id":34},{"x":4,"y":26,"id":34},{"x":1,"y":26,"id":34},{"x":1,"y":29,"id":34},{"x":4,"y":29,"id":34},{"x":7,"y":29,"id":34},{"x":9,"y":29,"id":34},{"x":9,"y":26,"id":34},{"x":7,"y":24,"id":34},{"x":9,"y":24,"id":34},{"x":6,"y":22,"id":34},{"x":9,"y":20,"id":34},{"x":5,"y":19,"id":34},{"x":7,"y":19,"id":34},{"x":5,"y":20,"id":34},{"x":4,"y":21,"id":34},{"x":9,"y":18,"id":34},{"x":6,"y":18,"id":34},{"x":3,"y":24,"id":37},{"x":3,"y":28,"id":37},{"x":6,"y":27,"id":37},{"x":8,"y":22,"id":37},{"x":7,"y":20,"id":37},{"x":3,"y":19,"id":37},{"x":2,"y":22,"id":35},{"x":1,"y":20,"id":35},{"x":1,"y":24,"id":35},{"x":1,"y":27,"id":35},{"x":5,"y":25,"id":35},{"x":6,"y":24,"id":35},{"x":8,"y":23,"id":35},{"x":9,"y":21,"id":35},{"x":7,"y":18,"id":35},{"x":4,"y":18,"id":35},{"x":8,"y":28,"id":35},{"x":16,"y":30,"id":33},{"x":17,"y":30,"id":33},{"x":18,"y":30,"id":33},{"x":19,"y":30,"id":33},{"x":21,"y":30,"id":32},{"x":23,"y":30,"id":32},{"x":25,"y":30,"id":32},{"x":27,"y":30,"id":32},{"x":29,"y":30,"id":32},{"x":30,"y":29,"id":32},{"x":29,"y":28,"id":32},{"x":30,"y":27,"id":32},{"x":31,"y":25,"id":32},{"x":30,"y":25,"id":32},{"x":29,"y":24,"id":32},{"x":30,"y":23,"id":32},{"x":30,"y":22,"id":32},{"x":29,"y":21,"id":32},{"x":30,"y":20,"id":32},{"x":29,"y":20,"id":32},{"x":31,"y":21,"id":32},{"x":29,"y":26,"id":32},{"x":31,"y":30,"id":32},{"x":20,"y":30,"id":33},{"x":22,"y":30,"id":33},{"x":24,"y":30,"id":33},{"x":26,"y":30,"id":33},{"x":28,"y":30,"id":33},{"x":29,"y":29,"id":33},{"x":30,"y":30,"id":33},{"x":31,"y":29,"id":33},{"x":31,"y":28,"id":33},{"x":30,"y":28,"id":33},{"x":29,"y":27,"id":33},{"x":31,"y":27,"id":33},{"x":30,"y":26,"id":33},{"x":31,"y":26,"id":33},{"x":29,"y":25,"id":33},{"x":30,"y":24,"id":33},{"x":31,"y":24,"id":33},{"x":29,"y":23,"id":33},{"x":29,"y":22,"id":33},{"x":31,"y":23,"id":33},{"x":31,"y":22,"id":33},{"x":30,"y":21,"id":33},{"x":31,"y":20,"id":33},{"x":31,"y":17,"id":33},{"x":31,"y":16,"id":33},{"x":31,"y":15,"id":33},{"x":31,"y":14,"id":33},{"x":31,"y":13,"id":33},{"x":10,"y":12,"id":20},{"x":4,"y":12,"id":20},{"x":14,"y":3,"id":20},{"x":23,"y":0,"id":20},{"x":30,"y":3,"id":20},{"x":29,"y":8,"id":20},{"x":22,"y":6,"id":21},{"x":22,"y":7,"id":21},{"x":23,"y":9,"id":21},{"x":24,"y":10,"id":21},{"x":24,"y":9,"id":21},{"x":25,"y":8,"id":21},{"x":24,"y":7,"id":21},{"x":24,"y":6,"id":21},{"x":25,"y":7,"id":21},{"x":25,"y":6,"id":21},{"x":23,"y":8,"id":22},{"x":24,"y":8,"id":22},{"x":25,"y":10,"id":22},{"x":22,"y":8,"id":21},{"x":22,"y":9,"id":21},{"x":22,"y":10,"id":21},{"x":23,"y":10,"id":21},{"x":23,"y":7,"id":21},{"x":23,"y":6,"id":21},{"x":25,"y":9,"id":21},{"x":11,"y":30,"id":34},{"x":12,"y":30,"id":34},{"x":13,"y":30,"id":34},{"x":14,"y":30,"id":34},{"x":14,"y":29,"id":34},{"x":14,"y":28,"id":34},{"x":14,"y":27,"id":34},{"x":14,"y":26,"id":34},{"x":14,"y":25,"id":35},{"x":14,"y":23,"id":35},{"x":14,"y":22,"id":35},{"x":14,"y":19,"id":35},{"x":14,"y":17,"id":35},{"x":14,"y":15,"id":35},{"x":14,"y":14,"id":35},{"x":14,"y":13,"id":35},{"x":14,"y":16,"id":35},{"x":14,"y":18,"id":35},{"x":14,"y":20,"id":34},{"x":14,"y":21,"id":34},{"x":14,"y":24,"id":34},{"x":10,"y":30,"id":34},{"x":10,"y":29,"id":34},{"x":10,"y":28,"id":34},{"x":10,"y":26,"id":34},{"x":10,"y":24,"id":34},{"x":10,"y":23,"id":34},{"x":10,"y":21,"id":34},{"x":10,"y":19,"id":34},{"x":10,"y":18,"id":34},{"x":9,"y":17,"id":34},{"x":8,"y":17,"id":34},{"x":6,"y":17,"id":34},{"x":4,"y":17,"id":34},{"x":2,"y":17,"id":34},{"x":1,"y":17,"id":34},{"x":1,"y":15,"id":34},{"x":1,"y":15,"id":34},{"x":1,"y":14,"id":34},{"x":1,"y":13,"id":34},{"x":1,"y":16,"id":34},{"x":3,"y":17,"id":37},{"x":5,"y":17,"id":37},{"x":7,"y":17,"id":37},{"x":10,"y":17,"id":37},{"x":10,"y":20,"id":37},{"x":10,"y":22,"id":37},{"x":10,"y":25,"id":37},{"x":10,"y":27,"id":37},{"x":5,"y":18,"id":37},{"x":8,"y":19,"id":37},{"x":8,"y":18,"id":37},{"x":8,"y":20,"id":37},{"x":8,"y":21,"id":36},{"x":6,"y":19,"id":36},{"x":6,"y":21,"id":36},{"x":7,"y":23,"id":36},{"x":9,"y":22,"id":36},{"x":4,"y":19,"id":36},{"x":4,"y":20,"id":36},{"x":2,"y":19,"id":36},{"x":5,"y":22,"id":36},{"x":5,"y":21,"id":36},{"x":6,"y":23,"id":36},{"x":8,"y":24,"id":36},{"x":8,"y":25,"id":36},{"x":6,"y":25,"id":36},{"x":9,"y":27,"id":36},{"x":5,"y":26,"id":36},{"x":4,"y":24,"id":36},{"x":3,"y":23,"id":36},{"x":3,"y":21,"id":36},{"x":3,"y":22,"id":36},{"x":4,"y":22,"id":36},{"x":3,"y":20,"id":36},{"x":3,"y":26,"id":36},{"x":4,"y":27,"id":36},{"x":15,"y":17,"id":36},{"x":15,"y":23,"id":35},{"x":16,"y":24,"id":35},{"x":18,"y":6,"id":20},{"x":20,"y":12,"id":19},{"x":23,"y":12,"id":19},{"x":30,"y":10,"id":19},{"x":17,"y":13,"id":19},{"x":6,"y":20,"id":19},{"x":1,"y":22,"id":19},{"x":2,"y":27,"id":19},{"x":15,"y":28,"id":19},{"x":17,"y":31,"id":33},{"x":18,"y":31,"id":33},{"x":20,"y":31,"id":33},{"x":22,"y":31,"id":33},{"x":24,"y":31,"id":33},{"x":29,"y":31,"id":33},{"x":19,"y":31,"id":32},{"x":21,"y":31,"id":32},{"x":23,"y":31,"id":32},{"x":28,"y":31,"id":32},{"x":30,"y":31,"id":32},{"x":31,"y":31,"id":32},{"x":30,"y":32,"id":32},{"x":31,"y":32,"id":32},{"x":31,"y":33,"id":32},{"x":35,"y":11,"id":22},{"x":35,"y":10,"id":22},{"x":35,"y":12,"id":21},{"x":36,"y":12,"id":21},{"x":37,"y":12,"id":21},{"x":38,"y":12,"id":21},{"x":39,"y":12,"id":21},{"x":41,"y":11,"id":21},{"x":43,"y":12,"id":21},{"x":44,"y":11,"id":21},{"x":46,"y":11,"id":21},{"x":46,"y":12,"id":21},{"x":47,"y":13,"id":21},{"x":48,"y":12,"id":21},{"x":51,"y":12,"id":21},{"x":52,"y":11,"id":21},{"x":53,"y":10,"id":21},{"x":52,"y":9,"id":21},{"x":51,"y":8,"id":21},{"x":50,"y":9,"id":21},{"x":49,"y":8,"id":21},{"x":48,"y":9,"id":21},{"x":47,"y":8,"id":21},{"x":46,"y":9,"id":21},{"x":45,"y":8,"id":21},{"x":46,"y":7,"id":21},{"x":45,"y":6,"id":21},{"x":46,"y":5,"id":21},{"x":45,"y":4,"id":21},{"x":46,"y":3,"id":21},{"x":44,"y":9,"id":21},{"x":43,"y":8,"id":21},{"x":42,"y":9,"id":21},{"x":40,"y":9,"id":21},{"x":39,"y":8,"id":21},{"x":38,"y":9,"id":21},{"x":37,"y":8,"id":21},{"x":36,"y":9,"id":21},{"x":35,"y":8,"id":21},{"x":37,"y":11,"id":21},{"x":39,"y":11,"id":22},{"x":41,"y":8,"id":22},{"x":41,"y":10,"id":22},{"x":41,"y":12,"id":22},{"x":49,"y":11,"id":22},{"x":53,"y":12,"id":22},{"x":54,"y":11,"id":22},{"x":54,"y":9,"id":22},{"x":53,"y":8,"id":22},{"x":55,"y":12,"id":22},{"x":55,"y":10,"id":22},{"x":47,"y":11,"id":22},{"x":28,"y":35,"id":33},{"x":29,"y":36,"id":33},{"x":30,"y":37,"id":33},{"x":31,"y":38,"id":33},{"x":30,"y":36,"id":33},{"x":30,"y":35,"id":33},{"x":29,"y":34,"id":33},{"x":30,"y":33,"id":33},{"x":28,"y":33,"id":33},{"x":29,"y":33,"id":33},{"x":31,"y":35,"id":33},{"x":31,"y":36,"id":33},{"x":28,"y":32,"id":32},{"x":29,"y":32,"id":32},{"x":28,"y":34,"id":32},{"x":29,"y":35,"id":32},{"x":30,"y":34,"id":32},{"x":31,"y":34,"id":32},{"x":31,"y":37,"id":32},{"x":24,"y":32,"id":32},{"x":23,"y":32,"id":32},{"x":24,"y":33,"id":32},{"x":59,"y":26,"id":39},{"x":60,"y":26,"id":39},{"x":61,"y":26,"id":39},{"x":62,"y":26,"id":39},{"x":63,"y":26,"id":39},{"x":63,"y":27,"id":39},{"x":62,"y":27,"id":39},{"x":61,"y":27,"id":39},{"x":60,"y":27,"id":39},{"x":59,"y":28,"id":39},{"x":60,"y":28,"id":39},{"x":60,"y":29,"id":39},{"x":61,"y":29,"id":39},{"x":61,"y":28,"id":39},{"x":63,"y":29,"id":39},{"x":63,"y":30,"id":39},{"x":62,"y":30,"id":39},{"x":60,"y":30,"id":39},{"x":60,"y":30,"id":39},{"x":61,"y":31,"id":39},{"x":60,"y":31,"id":39},{"x":60,"y":32,"id":39},{"x":59,"y":32,"id":39},{"x":59,"y":31,"id":39},{"x":62,"y":31,"id":39},{"x":63,"y":32,"id":39},{"x":62,"y":32,"id":39},{"x":62,"y":33,"id":39},{"x":63,"y":34,"id":39},{"x":60,"y":34,"id":39},{"x":61,"y":34,"id":39},{"x":61,"y":35,"id":39},{"x":62,"y":35,"id":39},{"x":63,"y":35,"id":39},{"x":63,"y":36,"id":39},{"x":62,"y":36,"id":39},{"x":60,"y":36,"id":39},{"x":60,"y":37,"id":39},{"x":62,"y":37,"id":39},{"x":63,"y":37,"id":39},{"x":63,"y":38,"id":39},{"x":62,"y":38,"id":39},{"x":61,"y":38,"id":39},{"x":60,"y":38,"id":39},{"x":59,"y":38,"id":39},{"x":59,"y":36,"id":39},{"x":58,"y":40,"id":39},{"x":59,"y":41,"id":39},{"x":60,"y":40,"id":39},{"x":61,"y":41,"id":39},{"x":62,"y":40,"id":39},{"x":61,"y":40,"id":39},{"x":61,"y":39,"id":39},{"x":60,"y":39,"id":39},{"x":60,"y":41,"id":39},{"x":61,"y":42,"id":39},{"x":62,"y":42,"id":39},{"x":63,"y":41,"id":39},{"x":63,"y":40,"id":39},{"x":63,"y":43,"id":39},{"x":63,"y":44,"id":39},{"x":62,"y":44,"id":39},{"x":62,"y":43,"id":39},{"x":61,"y":43,"id":39},{"x":60,"y":43,"id":39},{"x":59,"y":43,"id":39},{"x":58,"y":43,"id":39},{"x":57,"y":43,"id":39},{"x":57,"y":42,"id":39},{"x":58,"y":42,"id":39},{"x":58,"y":44,"id":39},{"x":59,"y":45,"id":39},{"x":59,"y":44,"id":39},{"x":62,"y":45,"id":39},{"x":60,"y":45,"id":39},{"x":58,"y":45,"id":39},{"x":57,"y":45,"id":39},{"x":56,"y":45,"id":39},{"x":56,"y":44,"id":39},{"x":56,"y":43,"id":39},{"x":56,"y":46,"id":39},{"x":56,"y":47,"id":39},{"x":57,"y":47,"id":39},{"x":57,"y":48,"id":39},{"x":58,"y":48,"id":39},{"x":58,"y":47,"id":39},{"x":58,"y":46,"id":39},{"x":59,"y":46,"id":39},{"x":61,"y":46,"id":39},{"x":62,"y":46,"id":39},{"x":55,"y":47,"id":39},{"x":55,"y":45,"id":39},{"x":57,"y":49,"id":39},{"x":57,"y":50,"id":39},{"x":56,"y":50,"id":39},{"x":56,"y":51,"id":39},{"x":57,"y":51,"id":39},{"x":58,"y":52,"id":39},{"x":57,"y":52,"id":39},{"x":56,"y":52,"id":39},{"x":55,"y":53,"id":39},{"x":56,"y":53,"id":39},{"x":57,"y":53,"id":39},{"x":58,"y":53,"id":39},{"x":58,"y":54,"id":39},{"x":57,"y":54,"id":39},{"x":56,"y":54,"id":39},{"x":56,"y":55,"id":39},{"x":55,"y":55,"id":39},{"x":57,"y":55,"id":39},{"x":58,"y":56,"id":39},{"x":57,"y":56,"id":39},{"x":56,"y":56,"id":39},{"x":55,"y":56,"id":39},{"x":50,"y":58,"id":39},{"x":50,"y":60,"id":39},{"x":51,"y":61,"id":39},{"x":50,"y":61,"id":39},{"x":52,"y":61,"id":39},{"x":52,"y":60,"id":39},{"x":52,"y":59,"id":39},{"x":53,"y":59,"id":39},{"x":54,"y":61,"id":39},{"x":56,"y":61,"id":39},{"x":55,"y":60,"id":39},{"x":55,"y":59,"id":39},{"x":56,"y":59,"id":39},{"x":56,"y":60,"id":39},{"x":57,"y":60,"id":39},{"x":57,"y":59,"id":39},{"x":57,"y":58,"id":39},{"x":56,"y":58,"id":39},{"x":56,"y":57,"id":39},{"x":56,"y":48,"id":39},{"x":55,"y":49,"id":39},{"x":56,"y":49,"id":39},{"x":55,"y":48,"id":39},{"x":61,"y":45,"id":39},{"x":61,"y":44,"id":39},{"x":53,"y":62,"id":39},{"x":52,"y":62,"id":39},{"x":50,"y":62,"id":39},{"x":55,"y":62,"id":39},{"x":56,"y":62,"id":39},{"x":58,"y":62,"id":39},{"x":59,"y":62,"id":39},{"x":60,"y":62,"id":39},{"x":62,"y":62,"id":39},{"x":62,"y":62,"id":39},{"x":63,"y":61,"id":39},{"x":62,"y":61,"id":39},{"x":62,"y":59,"id":39},{"x":63,"y":60,"id":39},{"x":63,"y":58,"id":39},{"x":62,"y":58,"id":39},{"x":62,"y":57,"id":39},{"x":63,"y":56,"id":39},{"x":62,"y":55,"id":39},{"x":63,"y":55,"id":39},{"x":62,"y":54,"id":39},{"x":63,"y":54,"id":39},{"x":62,"y":53,"id":39},{"x":63,"y":52,"id":39},{"x":62,"y":51,"id":39},{"x":54,"y":58,"id":39},{"x":54,"y":58,"id":39},{"x":52,"y":58,"id":39},{"x":52,"y":58,"id":39},{"x":54,"y":60,"id":39},{"x":53,"y":60,"id":39},{"x":51,"y":59,"id":39},{"x":58,"y":58,"id":39},{"x":58,"y":59,"id":39},{"x":58,"y":60,"id":39},{"x":53,"y":61,"id":41},{"x":54,"y":59,"id":41},{"x":55,"y":58,"id":41},{"x":55,"y":54,"id":41},{"x":55,"y":51,"id":41},{"x":58,"y":50,"id":41},{"x":57,"y":46,"id":41},{"x":57,"y":44,"id":41},{"x":57,"y":41,"id":41},{"x":59,"y":40,"id":41},{"x":63,"y":39,"id":41},{"x":63,"y":31,"id":41},{"x":61,"y":30,"id":41},{"x":59,"y":27,"id":41},{"x":59,"y":29,"id":41},{"x":61,"y":36,"id":41},{"x":62,"y":39,"id":41},{"x":58,"y":51,"id":39},{"x":55,"y":50,"id":40},{"x":58,"y":49,"id":40},{"x":55,"y":46,"id":40},{"x":55,"y":44,"id":40},{"x":55,"y":43,"id":40},{"x":60,"y":42,"id":40},{"x":59,"y":42,"id":40},{"x":60,"y":44,"id":40},{"x":62,"y":41,"id":40},{"x":51,"y":60,"id":40},{"x":55,"y":61,"id":40},{"x":57,"y":61,"id":40},{"x":58,"y":61,"id":40},{"x":62,"y":56,"id":40},{"x":63,"y":57,"id":40},{"x":63,"y":53,"id":40},{"x":54,"y":62,"id":41},{"x":51,"y":62,"id":41},{"x":51,"y":58,"id":41},{"x":53,"y":58,"id":41},{"x":55,"y":57,"id":41},{"x":57,"y":57,"id":41},{"x":57,"y":62,"id":41},{"x":61,"y":62,"id":41},{"x":62,"y":60,"id":41},{"x":63,"y":62,"id":41},{"x":63,"y":59,"id":41},{"x":62,"y":52,"id":41},{"x":63,"y":51,"id":41},{"x":58,"y":55,"id":41},{"x":58,"y":57,"id":41},{"x":63,"y":45,"id":41},{"x":60,"y":46,"id":41},{"x":63,"y":46,"id":41},{"x":63,"y":42,"id":41},{"x":56,"y":42,"id":41},{"x":59,"y":39,"id":41},{"x":59,"y":37,"id":41},{"x":61,"y":37,"id":41},{"x":62,"y":34,"id":41},{"x":63,"y":33,"id":41},{"x":61,"y":32,"id":41},{"x":59,"y":30,"id":41},{"x":62,"y":28,"id":41},{"x":63,"y":28,"id":41},{"x":62,"y":30,"id":41},{"x":60,"y":35,"id":41},{"x":59,"y":35,"id":41},{"x":40,"y":57,"id":36},{"x":41,"y":57,"id":36},{"x":42,"y":57,"id":36},{"x":43,"y":57,"id":36},{"x":43,"y":56,"id":36},{"x":43,"y":55,"id":36},{"x":43,"y":54,"id":36},{"x":42,"y":54,"id":36},{"x":41,"y":54,"id":36},{"x":40,"y":54,"id":36},{"x":40,"y":55,"id":36},{"x":40,"y":56,"id":36},{"x":40,"y":52,"id":36},{"x":41,"y":52,"id":36},{"x":42,"y":52,"id":36},{"x":43,"y":52,"id":36},{"x":43,"y":51,"id":36},{"x":43,"y":50,"id":36},{"x":40,"y":50,"id":36},{"x":40,"y":49,"id":36},{"x":41,"y":49,"id":36},{"x":42,"y":49,"id":36},{"x":43,"y":46,"id":36},{"x":43,"y":47,"id":36},{"x":42,"y":47,"id":36},{"x":41,"y":47,"id":36},{"x":40,"y":46,"id":36},{"x":40,"y":45,"id":36},{"x":40,"y":44,"id":36},{"x":41,"y":44,"id":36},{"x":43,"y":44,"id":36},{"x":43,"y":41,"id":36},{"x":43,"y":42,"id":36},{"x":42,"y":42,"id":36},{"x":41,"y":42,"id":36},{"x":40,"y":41,"id":36},{"x":40,"y":40,"id":36},{"x":40,"y":39,"id":36},{"x":43,"y":39,"id":36},{"x":43,"y":40,"id":36},{"x":45,"y":41,"id":36},{"x":45,"y":42,"id":36},{"x":45,"y":40,"id":36},{"x":46,"y":39,"id":36},{"x":47,"y":39,"id":36},{"x":48,"y":40,"id":36},{"x":48,"y":39,"id":36},{"x":48,"y":41,"id":36},{"x":48,"y":42,"id":36},{"x":47,"y":42,"id":36},{"x":45,"y":47,"id":36},{"x":46,"y":47,"id":36},{"x":47,"y":47,"id":36},{"x":48,"y":47,"id":36},{"x":48,"y":46,"id":36},{"x":45,"y":45,"id":36},{"x":48,"y":45,"id":36},{"x":48,"y":44,"id":36},{"x":45,"y":44,"id":36},{"x":45,"y":49,"id":36},{"x":45,"y":51,"id":36},{"x":45,"y":52,"id":36},{"x":46,"y":52,"id":36},{"x":47,"y":52,"id":36},{"x":48,"y":51,"id":36},{"x":48,"y":50,"id":36},{"x":48,"y":49,"id":36},{"x":45,"y":54,"id":36},{"x":45,"y":55,"id":36},{"x":45,"y":56,"id":36},{"x":45,"y":57,"id":36},{"x":47,"y":57,"id":36},{"x":48,"y":57,"id":36},{"x":48,"y":56,"id":36},{"x":48,"y":55,"id":36},{"x":48,"y":54,"id":36},{"x":46,"y":57,"id":37},{"x":48,"y":52,"id":37},{"x":45,"y":50,"id":37},{"x":40,"y":51,"id":37},{"x":43,"y":49,"id":37},{"x":40,"y":47,"id":37},{"x":43,"y":45,"id":37},{"x":45,"y":46,"id":37},{"x":46,"y":42,"id":37},{"x":45,"y":39,"id":37},{"x":40,"y":42,"id":37},{"x":40,"y":62,"id":35},{"x":41,"y":62,"id":35},{"x":41,"y":61,"id":35},{"x":41,"y":59,"id":35},{"x":40,"y":60,"id":35},{"x":43,"y":60,"id":35},{"x":43,"y":61,"id":35},{"x":43,"y":62,"id":35},{"x":42,"y":62,"id":35},{"x":42,"y":61,"id":35},{"x":45,"y":62,"id":35},{"x":46,"y":61,"id":35},{"x":47,"y":61,"id":35},{"x":48,"y":62,"id":35},{"x":46,"y":62,"id":37},{"x":48,"y":61,"id":37},{"x":47,"y":60,"id":37},{"x":46,"y":60,"id":34},{"x":48,"y":59,"id":34},{"x":46,"y":59,"id":34},{"x":3,"y":43,"id":20},{"x":3,"y":44,"id":20},{"x":3,"y":46,"id":20},{"x":7,"y":41,"id":20},{"x":15,"y":37,"id":20},{"x":17,"y":43,"id":20},{"x":16,"y":49,"id":20},{"x":22,"y":48,"id":20},{"x":23,"y":39,"id":20},{"x":22,"y":37,"id":20},{"x":23,"y":35,"id":20},{"x":20,"y":34,"id":20},{"x":2,"y":38,"id":20},{"x":1,"y":41,"id":20},{"x":1,"y":45,"id":20},{"x":2,"y":51,"id":20},{"x":2,"y":55,"id":20},{"x":9,"y":56,"id":20},{"x":9,"y":52,"id":20},{"x":1,"y":59,"id":20},{"x":14,"y":60,"id":20},{"x":15,"y":59,"id":20},{"x":15,"y":52,"id":20},{"x":23,"y":52,"id":20},{"x":23,"y":55,"id":20},{"x":21,"y":60,"id":20},{"x":24,"y":61,"id":20},{"x":32,"y":58,"id":20},{"x":30,"y":56,"id":20},{"x":33,"y":56,"id":20},{"x":29,"y":50,"id":20},{"x":33,"y":48,"id":20},{"x":33,"y":45,"id":20},{"x":29,"y":47,"id":20},{"x":22,"y":47,"id":20},{"x":22,"y":41,"id":20},{"x":39,"y":17,"id":20},{"x":21,"y":14,"id":20},{"x":17,"y":19,"id":20},{"x":24,"y":19,"id":20},{"x":19,"y":8,"id":20},{"x":34,"y":2,"id":20},{"x":39,"y":2,"id":20},{"x":46,"y":1,"id":20},{"x":50,"y":2,"id":20},{"x":54,"y":2,"id":20},{"x":56,"y":2,"id":20},{"x":58,"y":2,"id":20},{"x":59,"y":4,"id":20},{"x":60,"y":3,"id":20},{"x":62,"y":9,"id":20},{"x":60,"y":11,"id":20},{"x":35,"y":32,"id":22},{"x":36,"y":31,"id":22},{"x":35,"y":30,"id":22},{"x":36,"y":29,"id":22},{"x":35,"y":28,"id":22},{"x":36,"y":27,"id":22},{"x":35,"y":26,"id":22},{"x":36,"y":25,"id":22},{"x":35,"y":24,"id":22},{"x":36,"y":23,"id":22},{"x":37,"y":24,"id":22},{"x":39,"y":24,"id":22},{"x":41,"y":24,"id":22},{"x":43,"y":24,"id":22},{"x":45,"y":24,"id":22},{"x":44,"y":23,"id":22},{"x":46,"y":23,"id":22},{"x":48,"y":23,"id":22},{"x":49,"y":23,"id":22},{"x":51,"y":23,"id":22},{"x":51,"y":25,"id":22},{"x":52,"y":26,"id":22},{"x":52,"y":28,"id":22},{"x":51,"y":29,"id":22},{"x":52,"y":30,"id":22},{"x":51,"y":31,"id":22},{"x":52,"y":32,"id":22},{"x":54,"y":32,"id":22},{"x":55,"y":31,"id":22},{"x":55,"y":29,"id":22},{"x":55,"y":27,"id":22},{"x":54,"y":26,"id":22},{"x":54,"y":24,"id":22},{"x":54,"y":22,"id":22},{"x":55,"y":21,"id":22},{"x":54,"y":20,"id":22},{"x":55,"y":19,"id":22},{"x":52,"y":34,"id":21},{"x":51,"y":33,"id":21},{"x":51,"y":35,"id":21},{"x":54,"y":34,"id":21},{"x":55,"y":35,"id":21},{"x":55,"y":33,"id":21},{"x":54,"y":30,"id":21},{"x":54,"y":28,"id":21},{"x":55,"y":25,"id":21},{"x":55,"y":23,"id":21},{"x":56,"y":24,"id":21},{"x":58,"y":24,"id":21},{"x":52,"y":24,"id":21},{"x":50,"y":24,"id":21},{"x":48,"y":24,"id":21},{"x":47,"y":24,"id":21},{"x":42,"y":23,"id":21},{"x":40,"y":23,"id":21},{"x":38,"y":23,"id":21},{"x":36,"y":33,"id":21},{"x":37,"y":32,"id":21},{"x":38,"y":32,"id":21},{"x":38,"y":33,"id":21},{"x":45,"y":22,"id":21},{"x":46,"y":21,"id":21},{"x":47,"y":20,"id":21},{"x":48,"y":21,"id":21},{"x":49,"y":20,"id":21},{"x":50,"y":21,"id":21},{"x":51,"y":20,"id":21},{"x":52,"y":21,"id":21},{"x":53,"y":33,"id":21}],"spawningPoints":[{"x":1,"y":1},{"x":10,"y":6},{"x":30,"y":1},{"x":30,"y":11},{"x":1,"y":29},{"x":9,"y":18},{"x":62,"y":45},{"x":1,"y":61},{"x":2,"y":37},{"x":49,"y":46},{"x":30,"y":30},{"x":39,"y":62},{"x":62,"y":12},{"x":53,"y":10},{"x":48,"y":27},{"x":33,"y":48},{"x":57,"y":61},{"x":15,"y":62},{"x":24,"y":24}],"waypoints":[{"x":5,"y":1},{"x":5,"y":6},{"x":10,"y":1},{"x":10,"y":3},{"x":19,"y":3},{"x":20,"y":1},{"x":26,"y":0},{"x":30,"y":2},{"x":30,"y":9},{"x":30,"y":18},{"x":30,"y":30},{"x":15,"y":30},{"x":15,"y":24},{"x":20,"y":22},{"x":20,"y":18},{"x":19,"y":11},{"x":16,"y":12},{"x":24,"y":11},{"x":24,"y":7},{"x":1,"y":12},{"x":1,"y":18},{"x":9,"y":19},{"x":2,"y":25},{"x":2,"y":30},{"x":8,"y":27},{"x":24,"y":24},{"x":46,"y":8},{"x":46,"y":2},{"x":38,"y":0},{"x":51,"y":1},{"x":56,"y":1},{"x":56,"y":4},{"x":60,"y":8},{"x":62,"y":8},{"x":60,"y":14},{"x":62,"y":2},{"x":60,"y":21},{"x":61,"y":24},{"x":61,"y":31},{"x":62,"y":33},{"x":61,"y":38},{"x":59,"y":42},{"x":62,"y":43},{"x":57,"y":46},{"x":51,"y":28},{"x":44,"y":36},{"x":44,"y":43},{"x":44,"y":48},{"x":44,"y":53},{"x":44,"y":60},{"x":40,"y":43},{"x":48,"y":43},{"x":48,"y":48},{"x":40,"y":48},{"x":40,"y":53},{"x":48,"y":53},{"x":48,"y":60},{"x":39,"y":60},{"x":39,"y":55},{"x":53,"y":60},{"x":56,"y":62},{"x":62,"y":62},{"x":63,"y":57},{"x":62,"y":52},{"x":56,"y":57},{"x":57,"y":52},{"x":33,"y":56},{"x":30,"y":62},{"x":23,"y":62},{"x":23,"y":55},{"x":17,"y":60},{"x":15,"y":58},{"x":15,"y":52},{"x":16,"y":47},{"x":22,"y":48},{"x":29,"y":48},{"x":31,"y":51},{"x":32,"y":44},{"x":30,"y":39},{"x":30,"y":34},{"x":23,"y":44},{"x":22,"y":40},{"x":22,"y":36},{"x":19,"y":32},{"x":24,"y":31},{"x":11,"y":61},{"x":8,"y":61},{"x":2,"y":60},{"x":1,"y":56},{"x":2,"y":52},{"x":1,"y":47},{"x":9,"y":55},{"x":9,"y":50},{"x":9,"y":47},{"x":8,"y":42},{"x":1,"y":40},{"x":2,"y":36},{"x":8,"y":36},{"x":15,"y":36},{"x":15,"y":42},{"x":30,"y":25},{"x":38,"y":9},{"x":43,"y":12},{"x":38,"y":18},{"x":44,"y":17},{"x":49,"y":21},{"x":42,"y":24},{"x":36,"y":25},{"x":36,"y":34},{"x":47,"y":29},{"x":54,"y":21},{"x":54,"y":24},{"x":54,"y":32},{"x":51,"y":33}],"ammo":[{"x":5,"y":1,"weapon":1},{"x":62,"y":52,"weapon":1},{"x":24,"y":7,"weapon":1},{"x":1,"y":40,"weapon":1},{"x":9,"y":19,"weapon":3},{"x":2,"y":60,"weapon":2},{"x":44,"y":60,"weapon":3},{"x":38,"y":0,"weapon":2},{"x":40,"y":43,"weapon":2},{"x":62,"y":2,"weapon":4},{"x":36,"y":34,"weapon":4},{"x":23,"y":62,"weapon":4},{"x":38,"y":9,"weapon":5},{"x":19,"y":32,"weapon":5},{"x":62,"y":43,"weapon":5}]};if(typeof exports!=='undefined'){exports.map=map;}FunUI.layouts["alert"]="<div id=\"alert\" class=\"F-Prompt\"> <h2 class=\"title\"></h2> <div class=\"content\"> </div> <div class=\"buttonBar\"> <div class=\"F-Button green tiny yes\">_(prompt.btn_ok.label)</div> </div> </div>";(function(){FunUI.traits.alert={__init__:function __init__(){}};})();FunUI.layouts["bottomBar"]="<ul id=\"bottomBar\" class=\"hide\"> <div id=\"bottomBar_leftLinks\"> <a class=\"withClickSound\" href=\"javascript: toggleImprint()\">_(home.footer.imprint.label)</a> <a class=\"withClickSound\" href=\"javascript: toggleAGB()\">_(home.footer.terms.label)</a> </div> <div class=\"F-PageCtrl tiny prevPage show\"></div> <div class=\"F-PageCtrl tiny nextPage show\"></div> <div class=\"F-Button add show\" data-tooltip-data=\"_(home.footer.tooltip.addFriend)\">_(home.footer.button.addFriend)</div> <ul id=\"bottomBar_friend_list\" class=\"F-List show\"> <li class=\"F-ItemRenderer\"> <span class=\"name\"></span> <img class=\"pic\" src=\"\" width=\"64\" height=\"64\"> <span class=\"level\"></span> <div class=\"hover\"></div> </li> </ul> <div id=\"bottomBar_rightLinks\"> <a class=\"withClickSound\" href=\"javascript: toggleDSE()\">_(home.footer.privacy.label)</a> <a class=\"ioGameLink withClickSound\" href=\"http://iogames.space/\" target=\"_blank\">.IO Games</a> </div> </ul>";(function(){var bottomBarModel={data:new F$ArrayView(5)};FunUI.traits.bottomBar={__init__:function __init__(){this.prevPageCtrl=this.getSubComponent('prevPage');this.prevPageCtrl.dataProvider=bottomBarModel.data;this.nextPageCtrl=this.getSubComponent('nextPage');this.nextPageCtrl.dataProvider=bottomBarModel.data;this.addButton=this.getSubComponent('add');this.addButton.on("click",this.inviteFriend);this.querySelector('.ioGameLink').style.display=FacebookUtils.embeddedInCanvas?"none":"";if((typeof FacebookUtils==="undefined"?"undefined":_typeof(FacebookUtils))=='object'){bottomBarModel.data.sourceView=FacebookUtils.fbArrayView;}},inviteFriend:function inviteFriend(){FacebookUtils.inviteFriend();},show:function show(){if(this.parentNode==null){document.body.appendChild(this);window.network.addMessageListener(NetworkMessages.GameEntered,this.hide);window.network.removeMessageListener(NetworkMessages.GameExit,this.show);}},hide:function hide(){if(this.parentNode){this.parentNode.removeChild(this);window.network.removeMessageListener(NetworkMessages.GameEntered,this.hide);window.network.addMessageListener(NetworkMessages.GameExit,this.show);}},showForFb:function showForFb(){this.show();this.removeClass('hide');},hideForFb:function hideForFb(){this.addClass("hide");}};FunUI.traits.bottomBar_friend_list={__init__:function __init__(){this.dataProvider=bottomBarModel.data;}};FunUI.traits.bottomBar_friend_list.itemRenderer={__init__:function __init__(){this.labelName=this.getSubComponent("name");this.pic=this.getSubComponent("pic");this.labelLevel=this.getSubComponent("level");this.on("click",this.showFriendInfo);},render:function render(data,index){this.labelName.innerHTML=data.name;this.labelLevel.innerHTML=data.level;this.pic.src=data.pic;},showFriendInfo:function showFriendInfo(){FacebookUtils.showFriendInfo(this.data.db_id);}};})();FunUI.layouts["changeNick"]="<div id=\"changeNick\" class=\"F-Prompt\"> <div class=\"title\"></div> <div class=\"content\"></div> <h2 class=\"titleText\">_(changeNick.title)</h2> <div class=\"nickBar\"> <div class=\"F-TextInput\"></div> <div class=\"dateLimit\"></div> <div class=\"tips\">_(changeNick.tips)</div> </div> <div class=\"buttonBar\"> <div class=\"F-Button green tiny no\">_(prompt.btn_cancel.label)</div> <div class=\"F-Button green tiny yes\">_(prompt.btn_ok.label)</div> </div> </div>";(function(){FunUI.traits.changeNick={__init__:function __init__(){var input=this.querySelector('input');input.maxLength=15;input.value=currentProfile.displayName;},"<Observer event='keypress' selector='input' />":function ObserverEventKeypressSelectorInput(e){if(e.keyCode==13){this.submit();}},"<Observer event='change' selector='input' />":function ObserverEventChangeSelectorInput(e){this.formatNick(e.srcElement);},formatNick:function formatNick(obj){obj.value=_formatNick(obj.value,true);},open:function open(){var dateLimit=this.querySelector('.dateLimit');var day=this.changeLimitDays();if(day){dateLimit.innerText=slayOne.widgets.lang.get('changeNick.dateLimit',{num:day});dateLimit.style.display='block';}else{dateLimit.style.display='none';}this.show(null,null,this.submit);},changeLimitDays:function changeLimitDays(){if(currentProfile.displayName==='Player'){return 0;}return Math.max(6-Math.ceil((now()-currentProfile.tsNick)/86400),0);},submit:function submit(){if(this.changeLimitDays()){return;}var nick=_formatNick(this.querySelector('input').value);if(nick.length<3){return;}network.send("changeNick$"+JSON.stringify({nick:nick}));networkPlayerName=nick;currentProfile.displayName=nick;currentProfile.tsNick=Date.now()/1000|0;var o;if(o=Z$('#homeUIContent .nick')){o.innerText=nick;}if(o=Z$('#playerProfileScreen .playerNick')){o.innerText=nick;}this.hide();}};})();FunUI.layouts["clanJoin"]="<div id=\"clanJoin\" class=\"F-Window light\" data-modal=\"true\"> <h2 class=\"title\">_(clanJoin.title)</h2> <div class=\"content\"> <h3> <span class=\"quote\">[</span> <span class=\"clanTag\">BBB</span> <span class=\"quote\">]</span> <span class=\"clanName\">CLAN NAME</span> </h3> <div class=\"F-TextInput desc\" data-multiline=\"true\">I&#x2019;d like to join your clan</div> <div class=\"buttonBar\"> <div class=\"F-Button tiny cancel\">_(clanJoin.button.cancel)</div> <div class=\"F-Button tiny send\">_(clanJoin.button.send)</div> </div> </div> </div>";(function(){FunUI.traits.clanJoin={_tagField:null,_nameField:null,_cancelButton:null,_clan:null,__init__:function __init__(){this._tagField=this.querySelector(".clanTag");this._nameField=this.querySelector(".clanName");this._cancelButton=this.querySelector(".cancel");this.querySelector('.send').on('click',this.apply4Clan);this._cancelButton.on('click',this.close);},apply4Clan:function apply4Clan(){slayOne.viewHelpers.showFullScreenLoading();network.once(NetworkMessages.ClanApply,this.onResponse);network.send("apply4Clan$"+this._clan.tag);},showClan:function showClan(clan){this._clan=clan;this._tagField.innerHTML=clan.tag;this._nameField.innerHTML=clan.name;this.open();},onResponse:function onResponse(data){slayOne.viewHelpers.hideFullScreenLoading();slayOne.viewHelpers.showFloatTip({tipType:data[1]==0?'success':'error',content:data[2]});if(data[1]==0){F$('clanMain').appliedClans[this._clan.id]=true;}this.close();}};})();FunUI.layouts["clanMain"]="<div class=\"F-Window\" id=\"clanMain\" data-modal=\"true\"> <h2 class=\"title\">_(clanMain.title)</h2> <ul class=\"F-TabPage content\"> <li id=\"clanMain_browse\" class=\"F-TabSubPage browse\"> <h3 class=\"title\">_(clanMain.browse.title)</h3> <ul id=\"clanMain_browseViewStack\" class=\"F-ViewStack content\"> <li class=\"subView\"> <div class=\"searchBar\"> <div class=\"F-TextInput searchInput\" data-placeholder=\"_(clanMain.browse.search.placeholder)\"></div> <div class=\"F-Button search\" data-tooltip-data=\"_(clanMain.tooltip.search)\"></div> </div> <ul id=\"clanMain_list\" class=\"F-List\"> <li class=\"F-ItemRenderer\"> <h4><span class=\"quote\">[</span><span class=\"clanTag\">BBB</span><span class=\"quote\">]</span> <span class=\"clanName\">CLAN NAME</span></h4> <div class=\"members\"> <h5 class=\"membersTitle\">_(clanMain.label.members)</h5> <span class=\"membersNumber\"></span> </div> <div class=\"F-Button small join\">_(clanMain.browse.join)</div> <div class=\"F-Button info\" data-tooltip-data=\"_(clanMain.tooltip.profile)\"></div> </li> </ul> </li> <li id=\"clanMain_info\" class=\"subView\"> <div class=\"clanInfo\"> <div class=\"baseInfo\"> <h4><span class=\"quote\">[</span><span class=\"clanTag\">BBB</span><span class=\"quote\">]</span> <span class=\"clanName\">CLAN NAME</span></h4> <table> <tr> <th>_(clanMain.label.score)</th> <td class=\"elo\">1,000,220</td> <th>_(clanMain.label.members)</th> <td class=\"members\">150</td> </tr> </table> </div> <pre class=\"description\">\n                            In theory, the user only needs to know that the\n                            internet connection is...\n                            In theory, the user only needs to know that the\n                            internet connection is...\n                            In theory, the user only needs to know that the\n                            internet connection is...\n                        </pre> </div> <div class=\"F-Button back\" data-tooltip-data=\"_(clanMain.tooltip.back)\"></div> <div class=\"buttonBar\"> <div class=\"F-Button tiny join\">_(clanMain.browse.info.button.join)</div> <div class=\"space\"></div> <div class=\"F-Button tiny dark btnMembers\"> _(clanMain.browse.info.button.members) </div> </div> </li> </ul> </li> <li id=\"clanMain_create\" class=\"F-TabSubPage\"> <h3 class=\"title\">_(clanMain.create.title)</h3> <div class=\"content clanForm\"> <div class=\"F-TextInput name\" data-placeholder=\"_(clanMain.create.placeholder.name)\" data-max-length=\"12\"></div> <div class=\"F-TextInput tag\" data-placeholder=\"_(clanMain.create.placeholder.tag)\" data-max-length=\"6\"></div> <div class=\"F-TextInput description\" data-placeholder=\"_(clanMain.create.placeholder.description)\" data-multiline=\"true\"></div> <div class=\"F-Button gold create\"> <div class=\"label\"> <span>_(clanMain.create.button.label)</span> <div class=\"icon x16 gold\"></div> <span class=\"goldNumber\">1,000</span> </div> </div> </div> </li> <li id=\"clanMain_mine\" class=\"F-TabSubPage active\"> <h3 class=\"title\">_(clanMain.mine.title)</h3> <ul class=\"F-ViewStack content\"> <li id=\"clanMain_myInfo\" class=\"subView\"> <div class=\"clanInfo\"> <div class=\"baseInfo\"> <h4><span class=\"quote\">[</span><span class=\"clanTag\">BBB</span><span class=\"quote\">]</span> <span class=\"clanName\">CLAN NAME</span></h4> <table> <tr> <th>_(clanMain.label.score)</th> <td class=\"elo\">1,000,220</td> <th>_(clanMain.label.members)</th> <td class=\"members\">150</td> </tr> </table> </div> <pre class=\"description\">\n                            In theory, the user only needs to know that the\n                            internet connection is...\n                            In theory, the user only needs to know that the\n                            internet connection is..an\n                            In theory, the user only needs to know that the\n                            internet connection is...\n                        </pre> </div> <div class=\"buttonBar\"> <div class=\"F-Button tiny red leave\">_(clanMain.mine.operations.leave)</div> <div class=\"F-Button tiny members\">_(clanMain.mine.operations.members) <div class=\"hint\"></div> </div> <div class=\"F-Button tiny share\">_(clanMain.mine.operations.share)</div> </div> </li> <div class=\"F-Button setting\" data-tooltip-data=\"_(clanMain.tooltip.setting)\"></div> <li class=\"subView clanForm\"> <div class=\"F-Button back\" data-tooltip-data=\"_(clanMain.tooltip.back)\"></div> <div class=\"tag\" data-placeholder=\"_(clanMain.create.placeholder.tag)\"></div> <div class=\"F-TextInput name\" data-placeholder=\"_(clanMain.create.placeholder.name)\" data-max-length=\"6\"></div> <div class=\"F-TextInput description\" data-placeholder=\"_(clanMain.create.placeholder.description)\" data-multiline=\"true\"></div> <div class=\"F-Button huge save\">_(clanMain.mine.setting.save)</div> </li> </ul> </li> </ul> <div class=\"F-Button close\"></div> </div>";(function(){var clans=new F$ArrayView();var appliedClans={};function requestMyClanInfo(){network.send("myClanInfo");}FunUI.traits.clanMain={_searchInput:null,_tabPage:null,_createIndex:1,_mineIndex:2,appliedClans:appliedClans,__init__:function __init__(){this._searchInput=this.querySelector('.searchInput');this._searchInput.on(FunUI.events.INPUT_SUBMIT,this.loadClanList);this._tabPage=this.querySelector('.F-TabPage.content');this._tabPage.on(FunUI.events.SELECTED_CHANGED,this.refreshClanList);this.querySelector('.F-Button.search').on('click',this.loadClanList);this.loadClanApps();},show:function show(clan){this.open();var mineView=F$('clanMain_mine');if(pl_clan_tag){this.showMine();network.once(NetworkMessages.MyClanInfo,mineView.showInfo);network.send("myClanInfo");}else{this.showCreate();}if(clan){this._tabPage.selectedIndex=0;F$('clanMain_info').showClan(clan,true);}else{this._tabPage.selectedIndex=pl_clan_tag?this._mineIndex:this._createIndex;this.loadClanList();}},showMine:function showMine(){this._tabPage.excludePage(this._createIndex);this._tabPage.includePage(this._mineIndex);this._tabPage.selectedIndex=this._mineIndex;},showCreate:function showCreate(){this._tabPage.excludePage(this._mineIndex);this._tabPage.includePage(this._createIndex);this._tabPage.selectedIndex=this._createIndex;},loadClanApps:function loadClanApps(){network.addMessageListener(NetworkMessages.ClanAppsOfPlayer,this.onLoadClanApps);network.send("getClanAppsOfPlayer");},onLoadClanApps:function onLoadClanApps(message){for(var i=1;i<message.length;i++){appliedClans[message[i]]=true;}},loadClanList:function loadClanList(){if(!window.network)return;slayOne.viewHelpers.showFullScreenLoading();network.addMessageListener(NetworkMessages.ClanList,this.onClanList);network.send("clanList$"+this._searchInput.text+"$"+0+"$20");},onClanList:function onClanList(data){network.removeMessageListener(NetworkMessages.ClanList,this.onClanList);slayOne.viewHelpers.hideFullScreenLoading();clans.source=data;},refreshClanList:function refreshClanList(){if(this._tabPage.selectedIndex==0){F$('clanMain_list').render();}}};FunUI.traits.clanMain_create={_nameInput:null,_tagInput:null,_descInput:null,__init__:function __init__(){this._nameInput=this.querySelector('.F-TextInput.name');this._tagInput=this.querySelector('.F-TextInput.tag');this._descInput=this.querySelector('.F-TextInput.description');this.querySelector('.goldNumber').innerText=CONST.CLAN_CREATION_GOLD_COST;this.querySelector('.F-Button.create').on('click',this.create);},create:function create(){F$confirm(F_('clanMain.create.confirm.content',{gold:CONST.CLAN_CREATION_GOLD_COST,clanName:this._tagInput.text}),this._create);},_create:function _create(){if(pl_gold<CONST.CLAN_CREATION_GOLD_COST){slayOne.viewHelpers.showFloatTip({tipType:'error',content:F_('clanMain.create.error.insufficient')});return;}network.once(NetworkMessages.ServerInfo,slayOne.viewHelpers.hideFullScreenLoading);network.once(NetworkMessages.ClanInfo,this.onClanInfo);network.once(NetworkMessages.UpdateClan,this.onCreate);network.send("createClan$"+this._tagInput.text+"$"+this._nameInput.text+"$"+this._descInput.text);},onClanInfo:function onClanInfo(data){F$('clanMain').showMine();setTimeout(F$('clanMain_mine').showInfo,0,data);},onCreate:function onCreate(){pl_gold-=CONST.CLAN_CREATION_GOLD_COST;F$('resourceBar').refresh();}};var infoPanel={_tagField:null,_nameField:null,_scoreField:null,_membersField:null,_descField:null,_clan:null,initFields:function initFields(){this._tagField=this.querySelector(".clanTag");this._nameField=this.querySelector(".clanName");this._scoreField=this.querySelector(".elo");this._membersField=this.querySelector(".members");this._descField=this.querySelector(".description");},_showClan:function _showClan(clan){this._tagField.innerText=clan.tag;this._nameField.innerText=clan.name;this._scoreField.innerText=clan.elo;this._membersField.innerText=clan.countMembers;this._descField.innerText=clan.description;this._clan=clan;}};FunUI.traits.clanMain_info=Object.assign({_clan:null,_joinButton:null,_anchor:false,__init__:function __init__(){this.initFields();this.querySelector('.back').on('click',this.goBack);this.querySelector('.btnMembers').on('click',this.showMembers);this._joinButton=this.querySelector('.join');this._joinButton.on('click',this.showJoin);},showMembers:function showMembers(){F$('myClan').showClan(this._clan);},showClan:function showClan(clan,anchor){F$('clanMain_browseViewStack').selectSubView(1);this._showClan(clan);this._clan=clan;this._joinButton.style.visibility=pl_clan_tag||appliedClans[clan.id]?"hidden":"visible";this._anchor=anchor;},showJoin:function showJoin(){F$('clanJoin').showClan(this._clan);},goBack:function goBack(){F$('clanMain_browseViewStack').selectSubView(0);if(this._anchor){F$("clanMain").loadClanList();this._anchor=false;}}},infoPanel);FunUI.traits.clanMain_list={dataProvider:clans};FunUI.traits.clanMain_list.itemRenderer={_titleField:null,_nameField:null,_membersNumberField:null,_joinButton:null,__init__:function __init__(){this.querySelector(".info").on('click',this.requestClanInfo);this._joinButton=this.querySelector('.join');this._joinButton.on('click',this.showJoin);this._titleField=this.querySelector("h4");this._nameField=this.querySelector(".clanName");this._tagField=this.querySelector(".clanTag");this._membersNumberField=this.querySelector(".membersNumber");},render:function render(data){this._tagField.innerText=data.tag;this._nameField.innerText=data.name;this._titleField.tooltipData="["+data.tag+"] "+data.name;this._membersNumberField.innerText=data.countMembers;this._joinButton.style.visibility=pl_clan_tag?"hidden":"visible";},requestClanInfo:function requestClanInfo(){if(!!window.network){_requestClanInfo(this.data.tag,this.showClanInfo);}else{this.showClanInfo(this.data);}},showClanInfo:function showClanInfo(clan){F$('clanMain_info').showClan(clan);},showJoin:function showJoin(){F$('clanJoin').showClan(this.data);}};FunUI.traits.clanMain_myInfo=Object.assign({_hint:null,__init__:function __init__(){this.initFields();this._hint=this.querySelector('.hint');},showClan:function showClan(clan){this._showClan(clan);if(!clan||!clan.appsCount){this._hint.style.display="none";}else{this._hint.style.display="block";}}},infoPanel);FunUI.traits.clanMain_mine={_viewStack:null,_nameInput:null,_tagLabel:null,_descInput:null,clan:null,__init__:function __init__(){this._viewStack=this.querySelector('.F-ViewStack');this.querySelector('.setting').on('click',this.showEdit);this.querySelector('.back').on('click',this.back);this.querySelector('.F-Button.members').on('click',this.showMembers);this.querySelector('.F-Button.share').on('click',this.showShare);this.querySelector('.leave').on('click',this.leave);this._nameInput=this.querySelector('.clanForm .F-TextInput.name');this._tagLabel=this.querySelector('.clanForm .tag');this._descInput=this.querySelector('.clanForm .F-TextInput.description');this._settingButton=this.querySelector('.F-Button.setting');this.querySelector('.F-Button.save').on('click',this.update);},back:function back(){this.showInfo(this.clan);},showMembers:function showMembers(){F$('clanMain').close();F$('myClan').showClan(this.clan);},showShare:function showShare(){F$('clanShare').show(this.clan);},showInfo:function showInfo(clan){this._viewStack.selectSubView(0);F$('clanMain_myInfo').showClan(clan);this._settingButton.style.visibility=pl_clan_tag&&pl_clan_role>=AUTH_LEVEL.ADMIN?"visible":"hidden";this.clan=clan;},showEdit:function showEdit(){var clan=this.clan;this._viewStack.selectSubView(1);this._nameInput.text=clan.name;this._tagLabel.innerText="["+clan.tag+"]";this._descInput.text=escapeHtml(clan.description);},update:function update(){network.once(NetworkMessages.ServerInfo,slayOne.viewHelpers.hideFullScreenLoading);network.once(NetworkMessages.UpdateClan,this.onUpdate);slayOne.viewHelpers.showFullScreenLoading();network.send("update-clan$"+this._nameInput.text+"$"+this._descInput.text);},onUpdate:function onUpdate(){slayOne.viewHelpers.hideFullScreenLoading();this.clan.name=this._nameInput.text;this.clan.description=this._descInput.text;this.showInfo(this.clan);},leave:function leave(){F$confirm(F_("clanMain.leave.confirm.content"),this.doLeave);},doLeave:function doLeave(){slayOne.viewHelpers.showFullScreenLoading();network.once(NetworkMessages.ServerInfo,slayOne.viewHelpers.hideFullScreenLoading);network.once(NetworkMessages.UpdateClan,this.onLeave);network.send("leaveClan");},onLeave:function onLeave(){F$('clanMain').show();}};})();FunUI.layouts["clanShare"]="<div id=\"clanShare\" class=\"F-Window light\"> <h2 class=\"title\">_(clanShare.title)</h2> <div class=\"content\"> <input class=\"inviteLink\" type=\"text\" readonly=\"readonly\" value=\"\"> <div class=\"buttonBar\"> <div class=\"F-Button link\">_(clanShare.btn.copy_link.label)</div> <div class=\"F-Button socialMedia fb\"></div> <div class=\"F-Button socialMedia tw\"></div> </div> </div> <div class=\"F-Button close\"></div> </div>";(function(){FunUI.traits.clanShare={_gameLink:null,_linkInput:null,__init__:function __init__(){this._linkInput=this.querySelector('.inviteLink');this.querySelector('.F-Button.link').on('click',this.copyLink);this.querySelector('.F-Button.fb').on('click',this.openFacebook);this.querySelector('.F-Button.tw').on('click',this.openTwiter);},show:function show(clan){this._gameLink=getClanLink(clan.tag);this._linkInput.value=this._gameLink;this.open();},copyLink:function copyLink(){copyInput(this._linkInput);},openFacebook:function openFacebook(){shareToFacebook(this._gameLink);},openTwiter:function openTwiter(){shareToTwiter(this._gameLink);}};})();FunUI.layouts["confirm"]="<div id=\"confirm\" class=\"F-Prompt\"> <h2 class=\"title\"></h2> <div class=\"content\"> </div> <div class=\"buttonBar\"> <div class=\"F-Button green tiny no\">_(prompt.btn_cancel.label)</div> <div class=\"F-Button green tiny yes\">_(prompt.btn_ok.label)</div> </div> </div>";(function(){FunUI.traits.confirm={__init__:function __init__(){}};})();FunUI.layouts["dailyQuest"]="<div id=\"dailyQuest\" class=\"F-Window light zombie\"> <div class=\"title ribbon\">_(dailyQuest.title)</div> <div class=\"F-Button close\"></div> <ul id=\"dailyQuest_list\" class=\"F-List content\"> <li class=\"F-ItemRenderer\"> <div class=\"quest\"> <div class=\"name\"></div> <canvas class=\"figure\" width=\"100\" height=\"100\"></canvas> <img class=\"weapon\"> <div class=\"desc\"></div> <div class=\"count\"></div> <img class=\"completed\"> <div class=\"reward\">_(dailyQuest.rewards)</div> <span> <img class=\"chest middle\" width=\"56\" height=\"38\"> <span class=\"rewardCount middle\">x1</span> </span> </div> <div class=\"empty\"> <div class=\"future\"></div> </div> </li> </ul> <div class=\"hint\">_(dailyQuest.unavailing)</div> </div>";(function(){var quests=new F$ArrayView();var updateHintInterval=null;FunUI.traits.dailyQuest={open:function open(){quests.source=pl_daily_quests.quests;FunUI.managers.PopUpManager.addPopUp(this,this.modal);if(updateHintInterval){clearInterval(updateHintInterval);}updateHintInterval=setInterval(this.updateHint,1000);this.updateHint();},close:function close(){FunUI.managers.PopUpManager.removePopUp(this);if(updateHintInterval){clearInterval(updateHintInterval);updateHintInterval=null;}},tryCompleteQuests:function tryCompleteQuests(){for(var i=0;i<pl_daily_quests.quests.length;i++){if(pl_daily_quests.quests[i]){if(!pl_daily_quests.quests[i].completed&&!pl_daily_quests.quests[i].completeRequestSent){if(pl_daily_quests.quests[i].count>=pl_daily_quests.quests[i].total){network.send('completeDailyQuest$'+i);pl_daily_quests.quests[i].completeRequestSent=true;break;}}}}},refresh:function refresh(){quests.source=pl_daily_quests.quests;quests.invalidate();},updateHint:function updateHint(){var allDone=true;for(var i=0;i<pl_daily_quests.quests.length;i++){if(pl_daily_quests.quests[i]){if(!pl_daily_quests.quests[i].completed){allDone=false;break;}}}var hint=this.querySelector('.hint');if(allDone){var countdown=pl_daily_quests.refreshCountdown-parseInt((Date.now()-pl_daily_quests.refreshCountdownStart)/1000);var hours=parseInt(countdown/3600);var minutes=Math.ceil((countdown-hours*3600)/60);hint.innerText=slayOne.widgets.lang.get('dailyQuest.allDone').replace('[[x]]',hours).replace('[[y]]',minutes);}else{hint.innerText=slayOne.widgets.lang.get('dailyQuest.unavailing');}}};FunUI.traits.dailyQuest_list={dataProvider:quests};FunUI.traits.dailyQuest_list.itemRenderer={_quest:null,_empty:null,_nameField:null,_figure:null,_weapon:null,_descField:null,_countField:null,_chest:null,_rewardCount:null,_futureField:null,_rankButton:null,_completed:null,__init__:function __init__(){this._quest=this.querySelector('.quest');this._empty=this.querySelector('.empty');this._nameField=this.querySelector('.name');this._figure=this.querySelector('.figure');this._weapon=this.querySelector('.weapon');this._descField=this.querySelector('.desc');this._countField=this.querySelector('.count');this._chest=this.querySelector('.chest');this._rewardCount=this.querySelector('.rewardCount');this._futureField=this.querySelector('.future');this._rankButton=this.querySelector('.rank');this._completed=this.querySelector('.completed');},show:function show(){FunUI.managers.PopUpManager.addPopUp(this,false,FunUI.utils.LAYER_TOP);},render:function render(data){Skin.close();if(data==null){var hours=parseInt(pl_daily_quests.refreshCountdown/3600);var minutes=Math.ceil((pl_daily_quests.refreshCountdown-hours*3600)/60);minutes=minutes>=10?''+minutes:'0'+minutes;this._futureField.innerHTML=F_("dailyQuest.countdown",{seconds:hours+":"+minutes});this._empty.style.display='block';this._quest.style.display='none';return;}this._nameField.innerHTML=slayOne.widgets.lang.get('dailyQuest.'+data.type+'.title');this._weapon.src=window.ResourcePath+"imgs/dailyQuest/"+data.type+".png";this._descField.innerHTML=slayOne.widgets.lang.get('dailyQuest.'+data.type+'.desc').replace('[[x]]',data.total);this._countField.innerHTML=data.count+'/'+data.total;this._chest.src=window.ResourcePath+"imgs/chest/chest_1"+".png";this._rewardCount.innerText='x'+data.rewardCount;this._empty.style.display='none';this._quest.style.display='block';this._completed.src=window.ResourcePath+"imgs/dailyQuest/completed.png";if(data.completed){this._completed.style.display='block';}else{this._completed.style.display='none';}}};})();FunUI.layouts["gameShare"]="<div id=\"gameShare\" class=\"F-Window light\" data-modal=\"true\"> <h2 class=\"title\">_(gameShare.title)</h2> <div class=\"content\"> <input class=\"inviteLink\" type=\"text\" readonly=\"readonly\" value=\"\"> <div class=\"buttonBar\"> <div class=\"F-Button link\">_(gameShare.btn.copy_link.label)</div> <div class=\"F-Button socialMedia fb\"></div> <div class=\"F-Button socialMedia tw\"></div> </div> </div> <div class=\"F-Button close\"></div> </div>";(function(){FunUI.traits.gameShare={_gameLink:null,_linkInput:null,__init__:function __init__(){this._linkInput=this.querySelector('.inviteLink');},show:function show(){this.open();this._gameLink=getCurrentGameLink();this._linkInput.value=this._gameLink;},"<Observer event='click' selector='.F-Button.link' />":function ObserverEventClickSelectorFButtonLink(){copyInput(this._linkInput);},"<Observer event='click' selector='.F-Button.fb' />":function ObserverEventClickSelectorFButtonFb(){shareToFacebook(this._gameLink);},"<Observer event='click' selector='.F-Button.tw' />":function ObserverEventClickSelectorFButtonTw(){shareToTwiter(this._gameLink);}};})();FunUI.layouts["giftExchange"]="<div id=\"giftExchange\" class=\"F-Window light\" data-modal=\"true\"> <div class=\"F-Button close\"></div> <div class=\"content\"> <div class=\"titleBar viewSend\"> <span class=\"title\">SEND</span> <div class=\"icon exp x48\"></div> <span class=\"label\">1 hour 2x EXP boost</span> </div> <div class=\"titleBar viewRequest\"> <span class=\"title\">REQUEST</span> <div class=\"icon live x48\"></div> <span class=\"label\">InstaRevives</span> </div> <div class=\"searchBar\"> <div id=\"giftExchange_input\" class=\"F-TextInput\" data-placeholder=\"SEARCH\"></div> <div class=\"F-Button search\"></div> <div class=\"F-RadioGroup\"> <div class=\"F-RadioButton\">Game Friends</div> <div class=\"F-RadioButton selected\">All Friends</div> </div> </div> <ul id=\"giftExchange_list\" class=\"F-List\" data-multi-select=\"true\"> <li class=\"F-ItemRenderer\"> <img class=\"pic\" src=\"\"> <span class=\"name\"></span> <div class=\"checkbox\"><div class=\"hover\"></div></div> </li> </ul> <div class=\"control\"> <div class=\"F-SelectAllCtrl\">Select All</div> <div class=\"F-Button darkGreen light viewRequest\">REQUEST</div> <div class=\"F-Button darkGreen light viewSend\">SEND</div> </div> </div> </div>";(function(){var giftExchangeModel={friends:new F$ArrayView({filter:function filter(friend){var input=F$("giftExchange_input");return friend.name.indexOf(input.text)>=0;}})};FunUI.traits.giftExchange={SEND:"send",REQUEST:"request",__init__:function __init__(){var selectAllCtrl=this.getElementsByClassName('F-SelectAllCtrl')[0];selectAllCtrl.listenTo(F$('giftExchange_list'));},show:function show(op){if(op==this.SEND){this.removeClass("viewRequest");this.addClass("viewSend");}else{this.removeClass("viewSend");this.addClass("viewRequest");}this.open();}};FunUI.traits.giftExchange_input={__init__:function __init__(){var input=this;this.on(FunUI.events.TEXT_CHANGED,function(){giftExchangeModel.friends.invalidate();});}};FunUI.traits.giftExchange_list={};FunUI.traits.giftExchange_list.itemRenderer={__init__:function __init__(){this.labelName=this.getSubComponent("name");this.pic=this.getSubComponent("pic");this.checkbox=this.getSubComponent('checkbox');var item=this;this.checkbox.on("click",function(){var list=item.list;if(item.selected){list.deselectItem(item.index);}else{list.selectItem(item.index);}});},render:function render(data){this.labelName.innerHTML=data.name;this.pic.src=data.pic;}};})();FunUI.layouts["giftMain"]="<div id=\"giftMain\" class=\"F-Window\"> <h2 class=\"title\">GIFT</h2> <div class=\"F-Button close\"></div> <ul class=\"F-TabPage content\"> <li class=\"F-TabSubPage\"> <h3 class=\"title\">SEND</h3> <div id=\"giftMain_send\" class=\"content\"> <div class=\"nav\"> <div class=\"giftBox\"> <span class=\"giftName\">2x EXP Boost</span> <div class=\"icon exp x128 center\"></div> <span class=\"label\">SEND</span> <div class=\"hover\"></div> </div> <div class=\"giftBox\"> <span class=\"giftName\">InstaRevives</span> <div class=\"icon live x128 center\"></div> <span class=\"label\">REQUEST_GIFTS</span> <div class=\"hover\"></div> </div> </div> <span class=\"comment\">You can send a Free Gifts to each of your Facebook friends every day.</span> </div> </li> <li class=\"F-TabSubPage\"> <h3 class=\"title\">INBOX</h3> <div class=\"F-ViewStack content\" id=\"giftMain_inbox\"> <div class=\"subView\"> <ul id=\"giftMain_inboxList\" class=\"F-List\"> <li class=\"F-ItemRenderer\"> <img class=\"pic\" src=\"\"> <span class=\"friendName\"></span> <span class=\"itemName\"></span> <div class=\"F-Button claim\"></div> </li> </ul> <div class=\"F-Button huge acceptAll\">ACCEPT ALL</div> </div> <div class=\"subView noGift\"> <h4>NO GIFTS TO COLLECT</h4> <p>Request gifts and invite friends to get more Gifts! </p> <div class=\"buttonBar\"> <div class=\"F-Button huge\">REQUEST GIFT</div> <div class=\"F-Button huge\">INVITE FRIENDS</div> </div> </div> </div> </li> </ul> </div>";(function(){var giftMainModel={data:new F$ArrayView()};FunUI.traits.giftMain_inboxList={multiSelect:true};FunUI.traits.giftMain_inboxList.itemRenderer={__init__:function __init__(){this.pic=this.getSubComponent("pic");this.labelFriendName=this.getSubComponent("friendName");this.labelItemName=this.getSubComponent("itemName");this.buttonClaim=this.getSubComponent("claim");var item=this;this.buttonClaim.addEventListener("click",function(event){alert("领取"+item.data);});},render:function render(data){this.pic.src=data.pic;this.labelFriendName.innerHTML=data.name;this.labelItemName.innerHTML="1 hour 2x EXP boost";}};})();FunUI.layouts["goRoom"]="<div id=\"goRoom\" class=\"fullscreen-bg\"> <div class=\"F-Window\" data-modal=\"true\"> <h2 class=\"title\">_(steam.goRoom.title)</h2> <div class=\"F-Button close\"></div> <div class=\"content\"> <p>_(steam.goRoom.text1)</p> <p>https://slay.one/?server=prod-cn-bj&amp;game=1024&amp;mode=4</p> <p>_(steam.goRoom.text2)</p> <div class=\"F-TextInput\"></div> <div class=\"F-Button huge\">_(steam.goRoom.btn)</div> <p id=\"goRoomFeedback\">&#xA0;</p> </div> </div> </div>";(function(){FunUI.traits.goRoom={transCode:null,isSubmit:false,__init__:function __init__(){this.transCode=0;},"<Observer event='keypress' selector='.content > input' />":function ObserverEventKeypressSelectorContentInput(e){if(e.keyCode==13){this.submit();}},"<Observer event='click' selector='.content > .F-Button' />":function ObserverEventClickSelectorContentFButton(e){this.submit();},"<Observer event='click' selector='.close' />":function ObserverEventClickSelectorClose(){FunUI.managers.PopUpManager.removePopUp(this);},submit:function submit(){if(isSteamBindSend){return;}var code=this.querySelector('input[type=text]').value.trim();var pattern=/https?:\/\/slay\.one\/\?server=[0-9a-zA-Z\-]+&game=\d+&mode=\d+/;if(!pattern.test(code)){this.message(F_('steam.goRoom.error'));return;}this.message(F_('steam.goRoom.pass'),true);var btn=this.querySelector('.content .F-Button');btn.className=btn.className+' disabled';location.href=code;},message:function message(s,isNotice){var o=document.getElementById('goRoomFeedback');o.innerText=s;if(isNotice){o.style.color='#fff';}},show:function show(){slayOne.views.optionsScreen.hideWindow();FunUI.managers.PopUpManager.addPopUp(this,false,FunUI.utils.LAYER_TOP);}};})();FunUI.layouts["hatTooltip"]="<div id=\"hatTooltip\" class=\"F-Tooltip\"> <h2 style=\"display: none\"></h2> <h3>_(hatTooltip.currentLevel)</h3> <ul id=\"hatTooltip_list\" class=\"F-List\"> <li class=\"F-ItemRenderer\"> <span class=\"name\"></span> <span class=\"value\"></span> </li> </ul> <br class=\"next\"> <h3 class=\"next\">_(hatTooltip.nextLevel)</h3> <ul id=\"hatTooltip_list_next\" class=\"F-List next\"> <li class=\"F-ItemRenderer\"> <span class=\"name\"></span> <span class=\"value\"></span> </li> </ul> <br class=\"next\"> <p style=\"color: #F012BE\">_(hatTooltip.infectionOnly)</p> </div>";(function(){var properties=new F$ArrayView();var properties_next=new F$ArrayView();var itemRenderer={_nameField:null,_valueField:null,__init__:function __init__(){this._nameField=this.querySelector('.name');this._valueField=this.querySelector('.value');},render:function render(data){this._nameField.innerHTML=data.name;this._valueField.innerHTML=data.value;}};FunUI.traits.hatTooltip={_titleField:null,__init__:function __init__(){this._titleField=this.querySelector('h2');},render:function render(data){var hat=hats[data.id];var level=data.level;this._titleField.innerHTML=hat.name;var props=[];var props_next=[];var upgrade=hat.extra[level];if(upgrade){var colorOK='#bcbc77';var colorNotEnough='#f48d8d';var skinCost=upgrade.upgradeSkinCost;if(skinCost){var cost={};cost.name=slayOne.widgets.lang.get('hatTooltip.skinCost');var clr=skinCost<=data.count?colorOK:colorNotEnough;cost.value='<span style="color: '+clr+'">'+data.count+'/'+skinCost+'</span>';props_next.push(cost);}var goldCost=upgrade.upgradeGoldCost;if(goldCost){var cost={};cost.name=slayOne.widgets.lang.get('hatTooltip.goldCost');var clr=goldCost<=pl_gold?colorOK:colorNotEnough;cost.value='<span style="color: '+clr+'">'+goldCost+'</span>';props_next.push(cost);}}for(var i=0;i<abilities.length;i++){var aName=abilities[i].locales.name;if(hat[aName]){var prop={};var plus=hatQualityPlus[hat.quality];prop.name=abilities[i].name;prop.value='+'+(hat[aName]+plus*(level-1)).toFixed(1);props.push(prop);var prop_next={};prop_next.name=abilities[i].name;prop_next.value='+'+(hat[aName]+plus*level).toFixed(1);props_next.push(prop_next);}}properties.source=props;properties_next.source=props_next;if(!hat.extra||!hat.extra[level+1]){this.addClass('noNext');}else{this.removeClass('noNext');}}};FunUI.traits.hatTooltip_list={dataProvider:properties};FunUI.traits.hatTooltip_list_next={dataProvider:properties_next};FunUI.traits.hatTooltip_list.itemRenderer=itemRenderer;FunUI.traits.hatTooltip_list_next.itemRenderer=itemRenderer;})();FunUI.layouts["items"]="<div id=\"items\" class=\"F-Window\"> <h2 class=\"title\">_(items.title)</h2> <ul class=\"F-TabPage content\"> <li class=\"F-TabSubPage\"> <h3 class=\"title\">_(items.tabs.skin.title)</h3> <ul id=\"items_skinList\" class=\"F-List content\"> <li class=\"F-ItemRenderer\" data-tooltip-renderer=\"hatTooltip\"> <div class=\"hover\"></div> <canvas width=\"100\" height=\"100\"></canvas> <div class=\"info\"> <h4>NEW SKIN</h4> <div class=\"qualityLabel\">Common</div> <div class=\"levelLabel\">Level 3</div> <div class=\"F-ProgressBar\"> <div class=\"indicator\"></div> </div> <div class=\"amountLabel\">04/10</div> <div class=\"pixelated labelButton labelButtonUpgrade withClickSound\"> <div class=\"label\">_(items.upgrade)</div> <div class=\"hover\"></div> </div> </div> </li> </ul> </li> <li class=\"F-TabSubPage\"> <h3 class=\"title\">_(items.tabs.namecolor.title)</h3> <ul id=\"name_colorList\" class=\"F-List content\"> <li class=\"F-ItemRenderer\" data-tooltip=\"hatTooltip\"> <p></p> </li> </ul> </li> <li class=\"F-TabSubPage\" data-disabled=\"true\"> <h3 class=\"title\">_(items.tabs.emote.title)</h3> <div class=\"content\"></div> </li> </ul> <div class=\"F-Button close\"></div> </div>";(function(){var skins=new F$ArrayView({sort:function sort(hat1,hat2){if(pl_items[hat1.id]&&!pl_items[hat2.id]){return-1;}if(!pl_items[hat1.id]&&pl_items[hat2.id]){return 1;}return hat1.id-hat2.id;}});var colorList=new F$ArrayView({});FunUI.traits.items={__init__:function __init__(){},show:function show(){this.open();skins.source=hats;var list=[];var code;var _arr7=[true,false];for(var _i8=0;_i8<_arr7.length;_i8++){var isOwn=_arr7[_i8];for(var i in NAME_COLOR){i=i|0;if(i<200){continue;}if(isOwn!==loginData.name_color.indexOf(i)>=0){continue;}var row=NAME_COLOR[i];row.id=i;row.isOwn=isOwn;list.push(row);if(row.isOwn){code=row.code;}}if(isOwn){list.push({id:0,name:'auto-pick',isOwn:true,code:code});}}var _iteratorNormalCompletion37=true;var _didIteratorError37=false;var _iteratorError37=undefined;try{for(var _iterator37=list[Symbol.iterator](),_step37;!(_iteratorNormalCompletion37=(_step37=_iterator37.next()).done);_iteratorNormalCompletion37=true){var row=_step37.value;if(row.id==loginData.name_color_select){row.selected=true;}}}catch(err){_didIteratorError37=true;_iteratorError37=err;}finally{try{if(!_iteratorNormalCompletion37&&_iterator37.return){_iterator37.return();}}finally{if(_didIteratorError37){throw _iteratorError37;}}}colorList.source=list;},refresh:function refresh(){skins.invalidate();}};FunUI.traits.name_colorList={dataProvider:colorList};FunUI.traits.name_colorList.itemRenderer={__init__:function __init__(){this.on('click',this.select);},select:function select(){if(!this.data.isOwn){return;}this.selected=true;var id=this.data.id;if(loginData.name_color_select!=id){loginData.name_color_select=id;network.send('chooseNameColor$'+id);}},render:function render(color,index){this.data=color;var p=this.querySelector('p');if(!color.isOwn){this.style.opacity=0.2;}p.innerText=color.name;p.style.color=color.code;if(color.id==loginData.name_color_select){this.delayCall(this.list.selectItem,this.list,index);}}};FunUI.traits.items_skinList={dataProvider:skins};FunUI.traits.items_skinList.itemRenderer={_qualityLabel:null,_levelLabel:null,_levelProgressBar:null,_amountLabel:null,_titleLabel:null,_upgradeButton:null,_canvas:null,__init__:function __init__(){this._titleLabel=this.querySelector('h4');this._qualityLabel=this.querySelector('.info .qualityLabel');this._levelLabel=this.querySelector('.info .levelLabel');this._levelProgressBar=this.querySelector('.info .F-ProgressBar');this._amountLabel=this.querySelector('.info .amountLabel');this._upgradeButton=this.querySelector('.info .labelButtonUpgrade');this._canvas=this.querySelector('canvas').getContext('2d');this._canvas.mozImageSmoothingEnabled=false;this._canvas.msImageSmoothingEnabled=false;this._canvas.imageSmoothingEnabled=false;this.on('click',this.select);this.on(FunUI.events.SELECTED_CHANGED,this.setHat);this._upgradeButton.on('click',this.upgradeHat);},setHat:function setHat(){if(this.selected&&pl_hat.id!=this.data.id){_setHat(this.data.id);}},upgradeHat:function upgradeHat(){var data=pl_items[this.data.id];var cfg=hats[data.id];var skinName=this.data.name;var goldCost=cfg.extra[data.level].upgradeGoldCost;if(goldCost>0){if(pl_gold>=goldCost){F$confirm(F_('items.upgrade.confirm',{gold:'<span style="color: #2ECC40">'+goldCost+'</span>',skinName:skinName}),function(){slayOne.viewHelpers.showFullScreenLoading();network.send("upgradeNewItem$"+data.id);});}else{F$alert(F_('items.upgrade.notEnoughGold',{gold:'<span style="color: #2ECC40">'+goldCost+'</span>'}));}}else{slayOne.viewHelpers.showFullScreenLoading();network.send("upgradeNewItem$"+data.id);}},render:function render(hat,index){var data=pl_items[hat.id];if(data){this.style.pointerEvents="auto";this.style.opacity=1;}else{data={count:0,level:1};this.style.pointerEvents="none";this.style.opacity=.2;};this._titleLabel.innerHTML=hat.name;this.className=this.className.replace(/quality_[^\s]+/g,"");this.addClass("quality_"+hat.quality);this._qualityLabel.innerHTML=F_("items.quality."+hat.quality);this._levelLabel.innerHTML=F_('items.level',data);var skinCost=hat.extra[data.level].upgradeSkinCost;if(skinCost>0){if(data.count<skinCost){this._levelProgressBar.setProgresses(skinCost,data.count);this._amountLabel.innerHTML=data.count+"/"+skinCost+' '+F_('items.unit');this._levelProgressBar.style.display="";this._amountLabel.style.display="";this._upgradeButton.style.display='none';}else{this._levelProgressBar.style.display="none";this._amountLabel.style.display="none";this._upgradeButton.style.display='';}}else{this._levelProgressBar.style.display="none";this._amountLabel.style.display="none";this._upgradeButton.style.display='none';}drawHat(this._canvas,hat,3.5,2,100,100);if(hat==pl_hat){this.delayCall(this.list.selectItem,this.list,index);}this.tooltipData=data;}};})();FunUI.layouts["levelUp"]="<div id=\"levelUp\" class=\"F-Window light\"> <div class=\"title ribbon\">_(levelUp.title)</div> <div class=\"content\"> <div class=\"badge\">10</div> <div class=\"figure\"></div> <div class=\"congrats\"> <p>_(levelUp.congrats)</p> </div> <fieldset class=\"rewardArea\"> <legend>_(levelUp.reward.title)</legend> <ul id=\"levelUp_rewardList\" class=\"F-List\"> <li class=\"F-ItemRenderer\"> <div class=\"icon_unlock\"></div> <h3>new skin</h3> <canvas width=\"100\" height=\"100\"></canvas> <img width=\"80\" class=\"center\"> </li> </ul> </fieldset> <div class=\"F-Button norm ok\">_(levelUp.button.OK)</div> <div class=\"F-Button norm blue share\">_(levelUp.button.share)</div> </div> </div>";(function(){var rewards=new F$ArrayView();FunUI.traits.levelUp={_badge:null,_rewardTitle:null,__init__:function __init__(){this._badge=this.querySelector('.badge');this._rewardTitle=this.querySelector('.rewardArea legend');},show:function show(model){FunUI.managers.PopUpManager.addPopUp(this,true,FunUI.managers.PopUpManager.LAYER_TOP);this._badge.innerHTML=model.level;this._rewardTitle.innerHTML=F_('levelUp.reward.title',{level:model.level});rewards.source=model.rewards.slice(0,9);soundManager.playSound(SOUND.LVLUP);},"<Observer event='click' selector='.F-Button.ok' /> hide":function ObserverEventClickSelectorFButtonOkHide(){FunUI.managers.PopUpManager.removePopUp(this);document.removeEventListener("click",this.tryHide,true);},"<Observer event='click' selector='.F-Button.share' />":function ObserverEventClickSelectorFButtonShare(){shareToFacebook(window.location.href);}};FunUI.traits.levelUp_rewardList={dataProvider:rewards};FunUI.traits.levelUp_rewardList.itemRenderer={_iconUnlock:null,_title:null,_canvas:null,_c:null,_img:null,__init__:function __init__(){this._iconUnlock=this.querySelector('.icon_unlock');this._title=this.querySelector('h3');this._canvas=this.querySelector('canvas');this._c=this._canvas.getContext('2d');this._c.mozImageSmoothingEnabled=false;this._c.msImageSmoothingEnabled=false;this._c.imageSmoothingEnabled=false;this._img=this.querySelector('img');},render:function render(data,index){this._c.fillStyle="rgba(0, 0, 0, 0)";if(data.type=='gold'){this._title.innerHTML=F_('levelUp.title.gold',{gold:'x'+data.value});this._canvas.style.display="none";this._img.src=window.ResourcePath+"imgs/icons/icon_gold02.png";this._img.style.display="";this._iconUnlock.style.display="none";}else if(data.type=='chest'){this._title.innerHTML=F_('levelUp.title.chest',{name:getChestName(data.id),count:'x'+data.value});this._canvas.style.display="none";this._img.src=window.ResourcePath+"imgs/chest/chest_"+data.id+".png";this._img.style.display="";this._iconUnlock.style.display="none";}else if(data.type=='mode'){var mode=MAP_TYPE_SETTINGS[data.value];this._title.innerHTML=F_(mode.langLabel);this._canvas.style.display="none";this._img.src=window.ResourcePath+"imgs/icons/"+mode.icon;this._img.style.display="";this._iconUnlock.style.display="";}else if(data.type=='gem'){this._title.innerHTML=F_('levelUp.title.gem',{gem:'x'+data.value});this._canvas.style.display="none";this._img.src=window.ResourcePath+"imgs/icons/gem.png";this._img.style.display="";this._iconUnlock.style.display="none";}else if(data.type=='hat'){var hat=hats[data.value];this._title.innerHTML=hat.name;this._img.style.display="none";this._canvas.style.display="";this._iconUnlock.style.display="";if(!window.imgs){return;}drawHat(this._c,hat,3.5,2,this._canvas.width,this._canvas.height);}}};})();FunUI.layouts["miniMap"]="<div id=\"miniMap\"> <canvas width=\"150\" height=\"150\"></canvas> <div class=\"buttonBar\"> <div class=\"F-Button score green\">_(miniMap.button.score)</div> </div> <ul id=\"miniMap_list\" class=\"F-List\"> <li class=\"F-ItemRenderer\"> <span class=\"rank\"></span> <span class=\"name\"></span> <span class=\"score\"></span> </li> </ul> </div>";(function(){var size=150;var top3Players=new F$ArrayView();FunUI.traits.miniMap={_canvas:null,_baseCanvas:null,_game:null,_gameChanged:null,_scoreButton:null,__init__:function __init__(){this._canvas=this.querySelector('canvas');this._scoreButton=this.querySelector('.F-Button.score');this._scoreButton.on("click",this.toggleFullRank);},show:function show(game){document.body.appendChild(this);this._game=game;this.drawBaseCanvas();if(game.type.showTop3&&game.type.winningCondition){F$('miniMap_list').style.display="";}else{F$('miniMap_list').style.display="none";}},hide:function hide(){if(this.parentNode==document.body){document.body.removeChild(this);}},drawBaseCanvas:function drawBaseCanvas(){if(!this._baseCanvas){this._baseCanvas=document.createElement('canvas');}var game=this._game;this._baseCanvas.width=game.map.x;this._baseCanvas.height=game.map.y;var ctx=this._baseCanvas.getContext("2d");if(tileTypes[game.map.defaultTiles].avgColor){ctx.fillStyle=tileTypes[game.map.defaultTiles].avgColor;ctx.fillRect(0,0,this._baseCanvas.width,this._baseCanvas.height);}for(var i=0;i<game.groundTiles.length;i++){var tile=game.groundTiles[i];var type=tile.type;if(type.avgColor){ctx.fillStyle=type.avgColor;ctx.fillRect(tile.x,tile.y,type.w?type.w:1,type.h?type.h:1);}}ctx.fillStyle="black";ctx.globalAlpha=0.5;ctx.fillRect(0,0,this._baseCanvas.width,this._baseCanvas.height);ctx.globalAlpha=1;for(var i=0;i<game.tiles.length;i++){if(!game.tiles[i].ground){var tile=game.tiles[i];var type=tile.type;if(type.avgColor){ctx.fillStyle=type.avgColor;ctx.fillRect(tile.x,tile.y,type.w?type.w:1,type.h?type.h:1);}}}},render:function render(percentageOfCurrentTickPassed){if(!this._canvas){return;}drawMiniMap(this,size,percentageOfCurrentTickPassed);if(this._game.type.showTop3&&game.type.winningCondition){top3Players.source=game.interface_.top3;}this._scoreButton.disabled=this._game.ticksCounter<0;},toggleFullRank:function toggleFullRank(){var rankView=F$('rankInGame');if(!rankView.parentNode){rankView.show();}else{rankView.hide();}}};FunUI.traits.miniMap_list={dataProvider:top3Players};FunUI.traits.miniMap_list.itemRenderer={_rankField:null,_nameField:null,_scoreField:null,__init__:function __init__(){this._rankField=this.querySelector('.rank');this._nameField=this.querySelector('.name');this._scoreField=this.querySelector('.score');},render:function render(data){var itsme=game&&game.playingPlayer&&game.playingPlayer.id==data.id;this._rankField.innerHTML=data.rank;var clan='';if(data.clan){clan="["+data.clan+"] ";}this._nameField.innerHTML=clan+escapeHtml(data.name);var souls=data.souls;if(souls>=1000){souls=Math.floor(souls/1000)+"k";}this._scoreField.innerHTML=souls;if(itsme){this.addClass('me');}else{this.removeClass('me');}if(data.team==1){this.addClass("redTeam");this.removeClass("blueTeam");}else if(data.team==2){this.addClass("blueTeam");this.removeClass("redTeam");}else{this.removeClass("blueTeam");this.removeClass("redTeam");}}};})();FunUI.layouts["myClan"]="<div id=\"myClan\" class=\"F-Window\" data-modal=\"true\"> <h2 class=\"title\">_(myClan.title)</h2> <ul class=\"F-TabPage content\"> <li class=\"F-TabSubPage membersPage\"> <h3 class=\"title\">_(myClan.tab.members.title)</h3> <div class=\"content\"> <div class=\"searchBar\"> <div class=\"F-TextInput searchInput\" data-placeholder=\"_(myClan.search.placeholder)\"></div> <div class=\"F-Button search\"></div> </div> <ul class=\"F-List\" id=\"myClan_memberList\"> <li class=\"F-ItemRenderer\"> <div> <h4 class=\"name\"></h4> <div class=\"role\"></div> </div> <div class=\"F-Button remove\" data-tooltip-data=\"_(myClan.tooltip.remove)\"></div> <div class=\"F-Button demote\" data-tooltip-data=\"_(myClan.tooltip.demote)\"></div> <div class=\"F-Button promote\" data-tooltip-data=\"_(myClan.tooltip.promote)\"></div> <div class=\"F-Button info\" data-tooltip-data=\"_(myClan.tooltip.profile)\"></div> </li> </ul> <div class=\"pageBar\"> <div class=\"F-PageCtrl prevPage\">_(page.previous)</div> <div class=\"F-PageCtrl nextPage\">_(page.next)</div> </div> </div> </li> <li class=\"F-TabSubPage requestsPage\"> <h3 class=\"title\">_(myClan.tab.requests.title)</h3> <div class=\"content\"> <div class=\"searchBar\"> <div class=\"F-TextInput searchInput\" data-placeholder=\"_(myClan.search.placeholder)\"></div> <div class=\"F-Button search\"></div> </div> <ul class=\"F-List\" id=\"myClan_requestList\"> <li class=\"F-ItemRenderer\"> <h4 class=\"name\"></h4> <div class=\"F-Button reject\" data-tooltip-data=\"_(myClan.tooltip.decline)\"></div> <div class=\"F-Button accept\" data-tooltip-data=\"_(myClan.tooltip.approve)\"></div> <div class=\"F-Button info\" data-tooltip-data=\"_(myClan.tooltip.profile)\"></div> </li> </ul> <div class=\"pageBar\"> <div class=\"F-PageCtrl prevPage\">_(page.previous)</div> <div class=\"F-PageCtrl nextPage\">_(page.next)</div> </div> </div> </li> </ul> <div class=\"F-Button close\"></div> </div>";(function(){var members=new F$ArrayView(10);var requests=new F$ArrayView(10);var currentClan=null;var invalidateRequests=requests.invalidate.bind(requests);var invalidateMembers=members.invalidate.bind(members);FunUI.traits.myClan={_membersSearchInput:null,_requestsSearchInput:null,_requestsPage:null,_membersPage:null,__init__:function __init__(){this._requestsSearchInput=this.querySelector('.requestsPage .searchInput');this._requestsSearchInput.on(FunUI.events.INPUT_SUBMIT,invalidateRequests);this._membersSearchInput=this.querySelector('.membersPage .searchInput');this._membersSearchInput.on(FunUI.events.INPUT_SUBMIT,invalidateMembers);this.querySelector('.requestsPage .F-Button.search').on('click',invalidateRequests);this.querySelector('.membersPage .F-Button.search').on('click',invalidateMembers);this.on(FunUI.events.ADD_POP_UP,this.onAddPopUp);this.on(FunUI.events.REMOVE_POP_UP,this.onRemovePopUp);requests.filter=this.requestsFilerFunction;members.filter=this.membersFilerFunction;this.querySelector('.requestsPage .F-PageCtrl.prevPage').dataProvider=requests;this.querySelector('.requestsPage .F-PageCtrl.nextPage').dataProvider=requests;this.querySelector('.membersPage .F-PageCtrl.prevPage').dataProvider=members;this.querySelector('.membersPage .F-PageCtrl.nextPage').dataProvider=members;this._requestsPage=this.querySelector('.requestsPage');this._membersPage=this.querySelector('.membersPage');},membersFilerFunction:function membersFilerFunction(data){return data.name.indexOf(this._membersSearchInput.text)>=0;},requestsFilerFunction:function requestsFilerFunction(data){return data.name.indexOf(this._requestsSearchInput.text)>=0;},showClan:function showClan(clan){currentClan=clan;this.open();},onAddPopUp:function onAddPopUp(){slayOne.viewHelpers.showFullScreenLoading();getMemberList(false,currentClan.id,currentClan.tag);this.querySelector('.F-TabPage.content').selectedIndex=0;requests.source=[];members.source=[];this.title=currentClan.tag;this._requestsPage.disabled=currentClan.tag!=pl_clan_tag||pl_clan_role<AUTH_LEVEL.MOD;},onRemovePopUp:function onRemovePopUp(){F$('clanMain').open();}};FunUI.traits.myClan_memberList={dataProvider:members};FunUI.traits.myClan_memberList.itemRenderer={_nameLabel:null,_roleLabel:null,__init__:function __init__(){this._nameLabel=this.querySelector('.name');this._roleLabel=this.querySelector('.role');this.querySelector(".remove").on('click',this.kickMember);this.querySelector(".demote").on('click',this.demoteMember);this.querySelector(".promote").on('click',this.promoteMember);this.querySelector(".info").on('click',this.getPlayerInfo);this._removeButton=this.querySelector(".remove");this._demoteButton=this.querySelector(".demote");this._promoteButton=this.querySelector(".promote");},render:function render(data){this._nameLabel.innerHTML=data.name;this._roleLabel.innerHTML=data.role;this._removeButton.style.visibility=currentClan.tag==pl_clan_tag&&data.name!=networkPlayerName&&pl_clan_role>AUTH_LEVEL.PLAYER&&pl_clan_role>=data.roleNumber?'visible':'hidden';this._demoteButton.style.visibility=currentClan.tag==pl_clan_tag&&data.name!=networkPlayerName&&data.roleNumber>AUTH_LEVEL.PLAYER&&pl_clan_role>=data.roleNumber?'visible':'hidden';this._promoteButton.style.visibility=currentClan.tag==pl_clan_tag&&data.name!=networkPlayerName&&data.roleNumber<AUTH_LEVEL.ADMIN&&pl_clan_role>data.roleNumber?'visible':'hidden';},kickMember:function kickMember(){F$confirm(F_("myClan.kick.confirm",{playerName:this.data.name}),this.kickMemberImpl);},kickMemberImpl:function kickMemberImpl(){kickMember(this.data.name);},demoteMember:function demoteMember(){if(this.data.roleNumber==AUTH_LEVEL.ADMIN){makeMod(this.data.name);return;}if(this.data.roleNumber==AUTH_LEVEL.MOD){makeMember(this.data.name);return;}console.error('you should never be here. the player cannot be denoted.',this.data);},promoteMember:function promoteMember(){if(this.data.roleNumber<=AUTH_LEVEL.PLAYER){makeMod(this.data.name);return;}if(this.data.roleNumber==AUTH_LEVEL.MOD){makeAdmin(this.data.name);return;}console.error('you should never be here. the player cannot be denoted.',this.data);},getPlayerInfo:function getPlayerInfo(){showPlayerInfo(this.data.id);}};FunUI.traits.myClan_requestList={dataProvider:requests};FunUI.traits.myClan_requestList.itemRenderer={_nameLabel:null,__init__:function __init__(){this._nameLabel=this.querySelector('.name');this.querySelector(".reject").on('click',this.rejectMember);this.querySelector(".accept").on('click',this.acceptMember);this.querySelector(".info").on('click',this.getPlayerInfo);},render:function render(data){this._nameLabel.innerHTML=data.name;},rejectMember:function rejectMember(){rejectClanMember(this.data.id);},acceptMember:function acceptMember(){acceptClanMember(this.data.id,this.data.name);},getPlayerInfo:function getPlayerInfo(){showPlayerInfo(this.data.id);}};})();FunUI.layouts["newGame"]="<div id=\"newGame\" class=\"F-Window light ffa\"> <div class=\"title ribbon\">_(newGame.title)</div> <div class=\"F-Button close\"></div> <div class=\"content\"> <div class=\"row first\"> <div class=\"item tutorial\"> <span class=\"icon\"></span> _(newGame.label.tutorial) <div class=\"hover\"></div> </div> <div class=\"item custom\"> <span class=\"icon\"></span> _(newGame.label.custom) <div class=\"hover\"></div> </div> </div> <div class=\"row second\"> <div class=\"item ffa\"> _(newGame.label.ffa) <span class=\"icon\"></span> <div class=\"hover\"></div> </div> <div class=\"item zombie\"> _(newGame.label.zombie) <span class=\"icon\"></span> <div class=\"hover\"></div> </div> <div class=\"item team\"> _(newGame.label.team) <span class=\"icon\"></span> <div class=\"hover\"></div> </div> </div> <div class=\"row third\"> <p class=\"zombie\"> _(newGame.desc.zombie) </p> <p class=\"team\"> _(newGame.desc.team) </p> <p class=\"ffa\"> _(newGame.desc.ffa) </p> </div> <div class=\"row fourth\"> <div class=\"F-Button light zombie\" data-game-mode=\"5\">_(newGame.button.infection)</div> <div class=\"F-Button light team\" data-game-mode=\"2\">_(newGame.button.flag)</div> <div class=\"F-Button light team\" data-game-mode=\"1\">_(newGame.button.team)</div> <div class=\"F-Button light ffa\" data-game-mode=\"4\">_(newGame.button.normal)</div> <div class=\"F-Button light ffa\" data-game-mode=\"3\">_(newGame.button.ranked)</div> <div class=\"F-Button light ffa newgame-custombuild\" data-game-mode=\"6\">_(newGame.button.custombuild)</div> </div> </div> </div>";(function(){FunUI.traits.newGame={_nickName:null,show:function show(nickName){this._nickName=nickName||"";this.open();this.renderLock();},renderLock:function renderLock(){this.querySelector('.custom').disabled=!db_id;var buttons=this.querySelectorAll(".row.fourth .F-Button");for(var i=0;i<buttons.length;i++){var button=buttons[i];var setting=MAP_TYPE_SETTINGS[button.gameMode];if(setting.unlockLevel>pl_lvl){button.disabled=true;button.tooltipData=F_("config.mode.tooltip.lock",{mode:F_(setting.langLabel),level:setting.unlockLevel});}else{button.disabled=false;button.tooltipData=null;}}},"<Observer event='click' selector='.row.fourth .F-Button' />":function ObserverEventClickSelectorRowFourthFButton(event){var button=event.currentTarget;var gameMode=button.gameMode;if(gameMode==3&&!db_id){slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get('hint.rankedDeathmatch.login')});return;}if(gameMode==6){this.close();CustomBuild.show();return;}var sendToServer="joinRandomGame$"+this._nickName+"$"+gameMode;window.joinGamePurpose=gameMode==3?'play':null;BIUtils.startEvent('flow','home.buttons.play');var respTimeout=setTimeout(function(){clearTimeout(respTimeout);slayOne.viewHelpers.showFloatTip({tipType:'error',content:slayOne.widgets.lang.get('msg.error_wait_too_long')});},10000);var that=this;var respFailCb=function respFailCb(failMessage){clearTimeout(respTimeout);window.network.removeMessageListener(NetworkMessages.GameEntered,respSuccessCb);window.network.removeMessageListener(NetworkMessages.LoginFail,respFailCb);slayOne.viewHelpers.hideFullScreenLoading();if(failMessage=='reload-game'){that.close();}else{slayOne.viewHelpers.showFloatTip({tipType:'error',content:failMessage});}};var respSuccessCb=function respSuccessCb(){clearTimeout(respTimeout);window.network.removeMessageListener(NetworkMessages.GameEntered,respSuccessCb);window.network.removeMessageListener(NetworkMessages.LoginFail,respFailCb);that.close();};slayOne.viewHelpers.showFullScreenLoading();window.network.addMessageListener(NetworkMessages.GameEntered,respSuccessCb);window.network.addMessageListener(NetworkMessages.LoginFail,respFailCb);window.network.send(sendToServer);gaEventOnce('player-want-to-join-random-game');BIUtils.endEvent('flow','home.buttons.play','send:joinRandomGame');},"<Observer event='click' selector='.row.second .item' />":function ObserverEventClickSelectorRowSecondItem(event){var target=event.currentTarget;var modes=["ffa","zombie","team"];for(var i=0;i<modes.length;i++){if(target.hasClass(modes[i])){for(var j=0;j<modes.length;j++){if(modes[i]!=modes[j]){this.removeClass(modes[j]);}}this.addClass(modes[i]);break;}}},"<Observer event='click' selector='.tutorial' />":function ObserverEventClickSelectorTutorial(){if(!isTutored(1)){gaEventOnce('player-click-tutorial-button');}startTutorial();this.close();},"<Observer event='click' selector='.custom' />":function ObserverEventClickSelectorCustom(){uiManager.showLobby(1);this.close();}};})();FunUI.layouts["openChest"]="<div id=\"openChest\"> <div class=\"center\"> <ul class=\"rewards\"> <li class=\"reward gold\"> <div class=\"frame\"> <div class=\"icon\"></div> <span class=\"label\">_(openChest.label.gold)</span> </div> <div class=\"summary\"> <h3>_(openChest.label.gold)</h3> <div class=\"amount\">1000</div> <div class=\"yoursLabel\">_(openChest.label.gold.yours)</div> <div class=\"yoursAmount\">500000</div> </div> </li> <li class=\"reward skin\"> <div class=\"frame\"> <canvas width=\"100\" height=\"100\"></canvas> <span class=\"label\">_(openChest.label.skin)</span> </div> <div class=\"summary\"> <h3>Name</h3> <div class=\"quality Rare\">Rare</div> <div class=\"level\">Level 3</div> <div class=\"F-ProgressBar\"> <div class=\"indicator\"></div> </div> <div class=\"progress\">04/10</div> </div> </li> </ul> <div class=\"chest_ani\"> <div class=\"chest_figure\"></div> </div> </div> </div>";(function(){FunUI.traits.openChest={_goldAmountField:null,_goldYoursAmountField:null,_hatNameField:null,_hatQualityField:null,_hatLevelField:null,_hatProgressBar:null,_hatProgressField:null,_hatCanvas:null,_showTime:null,__init__:function __init__(){this._goldAmountField=this.querySelector('.rewards .reward.gold .amount');this._goldYoursAmountField=this.querySelector('.rewards .reward.gold .yoursAmount');this._hatNameField=this.querySelector('.rewards .reward.skin .summary h3');this._hatQualityField=this.querySelector('.rewards .reward.skin .summary .quality');this._hatLevelField=this.querySelector('.rewards .reward.skin .summary .level');this._hatProgressBar=this.querySelector('.rewards .reward.skin .summary .F-ProgressBar');this._hatProgressField=this.querySelector('.rewards .reward.skin .summary .progress');this._hatCanvas=this.querySelector('.rewards .reward.skin canvas').getContext('2d');this._hatCanvas.mozImageSmoothingEnabled=false;this._hatCanvas.msImageSmoothingEnabled=false;this._hatCanvas.imageSmoothingEnabled=false;},show:function show(chestId,gold,hatId){Skin.close();FunUI.managers.PopUpManager.addPopUp(this,false,FunUI.utils.LAYER_TOP);this.className=this.className.replace(/chest_\d+/g,"");this.addClass("chest_"+chestId);this._goldAmountField.innerHTML=gold;this._goldYoursAmountField.innerHTML=pl_gold;var hat=hats[hatId];var myHat=pl_items[hatId];this._hatNameField.innerHTML=hat.name;this._hatQualityField.innerHTML=hat.quality;this._hatQualityField.dataset.value=hat.quality;this._hatLevelField.innerHTML=F_('openChest.label.level',myHat);var skinCost=hat.extra[myHat.level].upgradeSkinCost;if(skinCost>0){this._hatProgressBar.setProgresses(skinCost,myHat.count);this._hatProgressField.innerHTML=myHat.count+"/"+skinCost+' '+F_('items.unit');this._hatProgressBar.style.display="";this._hatProgressField.style.display="";}else{this._hatProgressBar.style.display="none";this._hatProgressField.style.display="none";}drawHat(this._hatCanvas,hat,3.5,2,100,100);this._showTime=Date.now();},"<Observer event='click'/>":function ObserverEventClick(){if(Date.now()-this._showTime>=1000){FunUI.managers.PopUpManager.removePopUp(this);}}};})();FunUI.layouts["rankInGame"]="<div id=\"rankInGame\" class=\"ongoing start\"> <div class=\"vote\"> <h2><span class=\"voteTitle\">_(rankInGame.title.voteMap)</span><span class=\"ongoing\">_(rankInGame.title.countdown.current)</span><span class=\"waiting\">_(rankInGame.title.countdown.next)</span><span class=\"timeToNext\"></span></h2> <ul id=\"rankInGame_mapList\" class=\"F-List\"> <li class=\"F-ItemRenderer\" data-tooltip-renderer=\"tooltipMap\"> <div class=\"hover\"></div> <div class=\"checkbox\"></div> <div class=\"name\"></div> <div class=\"voteLabel\">_(rankInGame.title.voteLabel)</div> <div class=\"voteValue\"></div> </li> </ul> </div> <div class=\"victory\"></div> <div class=\"rankArea\"> <table class=\"normal\"> <caption>_(rankInGame.title)</caption> <thead> <tr> <th class=\"name\">_(rankInGame.thead.name)</th> <th class=\"clan\">_(rankInGame.thead.clan)</th> <th class=\"score\">_(rankInGame.thead.score)</th> <th class=\"souls\">_(rankInGame.thead.souls)</th> <th class=\"kill\">_(rankInGame.thead.kill)</th> <th class=\"death\">_(rankInGame.thead.death)</th> <th class=\"muteCell\">_(rankInGame.thead.mute)</th> </tr> </thead> <tbody id=\"rankInGame_normalList\" class=\"F-List\"> <tr class=\"F-ItemRenderer\"> <td class=\"name\"></td> <td class=\"clan\"><span>[</span><span class=\"clan\"></span><span>]</span></td> <td class=\"score\"></td> <td class=\"souls\"></td> <td class=\"kill\"></td> <td class=\"death\"></td> <td class=\"muteCell\"> <div class=\"F-Button mute\"> <div class=\"hover lite\"></div> </div> </td> </tr> </tbody> </table> <table class=\"team\"> <caption>_(rankInGame.title)</caption> <thead> <tr> <th class=\"name\">_(rankInGame.thead.name)</th> <th class=\"clan\">_(rankInGame.thead.clan)</th> <th class=\"score\">_(rankInGame.thead.score)</th> <th class=\"souls\">_(rankInGame.thead.souls)</th> <th class=\"kill\">_(rankInGame.thead.kill)</th> <th class=\"death\">_(rankInGame.thead.death)</th> <th class=\"muteCell\">_(rankInGame.thead.mute)</th> </tr> </thead> <tbody class=\"redTeamSummary\"> <tr> <td colspan=\"6\"> <span class=\"teamName\"></span> <span class=\"teamScore\"></span> </td> </tr> </tbody> <tbody id=\"rankInGame_redList\" class=\"F-List\"> <tr class=\"F-ItemRenderer\"> <td class=\"name\"></td> <td class=\"clan\"></td> <td class=\"score\"></td> <td class=\"souls\"></td> <td class=\"kill\"></td> <td class=\"death\"></td> <td class=\"muteCell\"> <div class=\"F-Button mute\"> <div class=\"hover lite\"></div> </div> </td> </tr> </tbody> <tbody class=\"blueTeamSummary\"> <tr> <td colspan=\"6\"> <span class=\"teamName\"></span> <span class=\"teamScore\"></span> </td> </tr> </tbody> <tbody id=\"rankInGame_blueList\" class=\"F-List\"> <tr class=\"F-ItemRenderer\"> <td class=\"name\"></td> <td class=\"clan\"></td> <td class=\"score\"></td> <td class=\"souls\"></td> <td class=\"kill\"></td> <td class=\"death\"></td> <td class=\"muteCell\"> <div class=\"F-Button mute\"> <div class=\"hover lite\"></div> </div> </td> </tr> </tbody> </table> <div class=\"topButtonBar\"> <div class=\"F-Button tiny invite\">_(rankInGame.button.invite)</div> <div class=\"F-Button close ongoing\"></div> </div> <div class=\"levelWarn\">_(rankInGame.level.warn)</div> <div class=\"F-Button gameCtrl green medium start spectate\">_(rankInGame.button.spectate)</div> <div class=\"F-Button gameCtrl yellow medium start normal play\">_(rankInGame.button.play)</div> <div class=\"F-Button gameCtrl red medium start team\">_(rankInGame.button.join.red)</div> <div class=\"F-Button gameCtrl blue medium start team\">_(rankInGame.button.join.blue)</div> </div> </div>";(function(){var maps=new F$ArrayView();var normalPlayers=new F$ArrayView();var redTeamFilter=function redTeamFilter(p){return p.team==1;};var blueTeamFilter=function blueTeamFilter(p){return p.team==2;};var redZombieFilter=function redZombieFilter(p){return!p.isHumanZombie;};var blueZombieFilter=function blueZombieFilter(p){return p.isHumanZombie;};var redPlayers=new F$ArrayView();var bluePlayers=new F$ArrayView();FunUI.traits.rankInGame={_redNameField:null,_blueNameField:null,_redScoreField:null,_blueScoreField:null,_redScore:0,_blueScore:0,_type:null,_hiding:false,_timeToNextLabel:null,_victoryLabel:null,_voteTitle:null,_rankArea:null,_game:null,_levelWarnField:null,__init__:function __init__(){this._redScoreField=this.querySelector('.redTeamSummary .teamScore');this._blueScoreField=this.querySelector('.blueTeamSummary .teamScore');this._redNameField=this.querySelector('.redTeamSummary .teamName');this._blueNameField=this.querySelector('.blueTeamSummary .teamName');this._timeToNextLabel=this.querySelector('.vote .timeToNext');this._victoryLabel=this.querySelector('.victory');this._voteTitle=this.querySelector('.voteTitle');this._rankArea=this.querySelector('.rankArea');this._levelWarnField=this.querySelector('.levelWarn');maps.on(FunUI.events.ARRAY_VIEW_UPDATE,this.showOrHideVoteTitle);this.showOrHideVoteTitle();this.querySelector('.F-Button.spectate').on('click',joinTeam.bind(null,-1));this.querySelector('.F-Button.play').on('click',joinTeam.bind(null,1));this.querySelector('.F-Button.red').on('click',joinTeam.bind(null,1));this.querySelector('.F-Button.blue').on('click',joinTeam.bind(null,2));this.querySelector('.F-Button.invite').on('click',openGameShare);this.querySelector('.F-Button.close').on('click',this.hide);},set timeToNext(v){if(this._timeToNextLabel){this._timeToNextLabel.innerHTML=v;}},hideRank:function hideRank(){this._rankArea.style.display="none";},showRank:function showRank(){this._rankArea.style.display="";},showOrHideVoteTitle:function showOrHideVoteTitle(){if(maps.length>0){this._voteTitle.style.display="";}else{this._voteTitle.style.display="none";}},show:function show(hideRank){if(this._game!=game){this._gameChanged=true;normalPlayers.sort=game.playerSortHandler;this._game=game;this.invalidate();}FunUI.managers.PopUpManager.addPopUp(this);this.refreshRank();this.refreshPlaying();if(hideRank){this.hideRank();}else{this.showRank();}document.addEventListener('wheel',this.scrollList);},scrollList:function scrollList(event){var elements=[F$('rankInGame_normalList'),F$('rankInGame_redList'),F$('rankInGame_blueList')];for(var i=0;i<elements.length;i++){if(elements[i].containsMouse()){elements[i].scrollTop+=event.deltaY;break;}}},hide:function hide(){if(game.ticksCounter>=-1){this.doHide();}},doHide:function doHide(){document.removeEventListener('wheel',this.scrollList);F$("tooltipMap").hide();FunUI.managers.PopUpManager.removePopUp(this);},setVictoryMessage:function setVictoryMessage(message){if(this._victoryLabel){this._victoryLabel.innerHTML=message;}},refreshTime:function refreshTime(ongoing,time){if(this.parentNode==null){return;}if(ongoing){this.removeClass('waiting');this.addClass("ongoing");}else{this.removeClass('ongoing');this.addClass("waiting");}if(this._timeToNextLabel){this._timeToNextLabel.innerHTML=time;}},refreshTeamScore:function refreshTeamScore(){this._scoreChanged=true;this.invalidate();},refreshRank:function refreshRank(){normalPlayers.source=game.players;},refreshPlaying:function refreshPlaying(){this.refreshRank();if(game.playingPlayerID>0||game.iAmSpec||game.replayMode){this.removeClass('start');this.removeClass('spectate');this._levelWarnField.style.display="none";}else{this.addClass('start');if(joinGamePurpose=="spectate"){this._levelWarnField.innerHTML=F_('rankInGame.level.warn',{levelRange:game.tag=='veteran'?'7+':'1-6'});this._levelWarnField.style.display="block";this.addClass('spectate');}else{this._levelWarnField.style.display="none";this.removeClass('spectate');}}},commitProperties:function commitProperties(){if(this._scoreChanged||this._gameChanged){this._redScoreField.innerHTML=F_("rankInGame.summary.score",{score:game.scoreTeam1});this._blueScoreField.innerHTML=F_("rankInGame.summary.score",{score:game.scoreTeam2});this._scoreChanged=false;}if(this._gameChanged){var gameType=this._game.type;if(gameType.team||gameType.coopZombieMode){this.addClass('team');redPlayers.sourceView=normalPlayers;bluePlayers.sourceView=normalPlayers;F$('rankInGame_normalList').dataProvider=null;if(gameType.coopZombieMode){redPlayers.filter=redZombieFilter;bluePlayers.filter=blueZombieFilter;this._redScoreField.innerHTML="";this._blueScoreField.innerHTML="";this._redNameField.innerHTML=F_("rankInGame.team.humans");this._blueNameField.innerHTML=F_("rankInGame.team.zombies");}else{redPlayers.filter=redTeamFilter;bluePlayers.filter=blueTeamFilter;this._redNameField.innerHTML=F_("rankInGame.team.red");this._blueNameField.innerHTML=F_("rankInGame.team.blue");}}else{this.removeClass('team');redPlayers.sourceView=null;bluePlayers.sourceView=null;F$('rankInGame_normalList').dataProvider=normalPlayers;}if(!gameType.team&&gameType.zombies||gameType.coopZombieMode){this.addClass("zombies");}else{this.removeClass('zombies');}if(gameType.ingameElo){this.addClass('ingameElo');}else{this.removeClass('ingameElo');}this._gameChanged=false;}}};var itemRenderer={_nameField:null,_clanField:null,_scoreField:null,_soulsField:null,_killField:null,_deathField:null,_muteField:null,_muteButton:null,__init__:function __init__(){this._nameField=this.querySelector('.name');this._clanField=this.querySelector('.clan');this._scoreField=this.querySelector('.score');this._soulsField=this.querySelector('.souls');this._killField=this.querySelector('.kill');this._deathField=this.querySelector('.death');this._muteButton=this.querySelector('.mute');this._muteButton.on('click',this.toggleMute);},render:function render(data){if(data.id==game.playingPlayerID){this.addClass("me");}else{this.removeClass("me");}this._nameField.innerHTML=data.name;this._nameField.style.color=data.nameColorCode;this._clanField.innerHTML=data.clan_tag?"["+data.clan_tag+"]":"";this._scoreField.innerHTML=data.elo;this._soulsField.innerHTML=data.souls;this._killField.innerHTML=data.kills;this._deathField.innerHTML=data.deaths;if(data.id!=game.playingPlayerID&&data.name!=networkPlayerName&&data.authLevel>=AUTH_LEVEL.GUEST){this._muteButton.style.display="";if(playerIsBeeingIgnored(data.name)){this._muteButton.addClass("muted");}else{this._muteButton.removeClass("muted");}}else{this._muteButton.style.display="none";}},toggleMute:function toggleMute(event){var name=this.data.name;var isGuest=this.data.authLevel<AUTH_LEVEL.PLAYER;var el=event.currentTarget;name=name.toLowerCase();var index=ignoreList.indexOf(name);if(index>=0){ignoreList.splice(index,1);localStorage.ignoreList=ignoreList.join(";");el.removeClass("muted");game.interface_.addMsg(slayOne.widgets.lang.get("game.msg.ignore.off",{playerName:name}),"white");return;}index=ignoreListTemp.indexOf(name);if(index>=0){ignoreListTemp.splice(index,1);game.interface_.addMsg(slayOne.widgets.lang.get("game.msg.ignore.off",{playerName:name}),"white");el.removeClass("muted");return;}(isGuest?ignoreListTemp:ignoreList).push(name);localStorage.ignoreList=ignoreList.join(";");el.addClass('muted');game.interface_.addMsg(slayOne.widgets.lang.get("game.msg.ignore.on",{playerName:name}),"white");},"<Observer event='mousedown' selector='.name' />":function ObserverEventMousedownSelectorName(){if(this.data.db_id){uiManager.showPlayerInfoById(this.data.db_id);}}};FunUI.traits.rankInGame_normalList={dataProvider:normalPlayers,itemRenderer:itemRenderer};FunUI.traits.rankInGame_redList={dataProvider:redPlayers,itemRenderer:itemRenderer};FunUI.traits.rankInGame_blueList={dataProvider:bluePlayers,itemRenderer:itemRenderer};FunUI.traits.rankInGame_mapList={dataProvider:maps,set maps(v){this.voted=false;this.selectedIndices=[];maps.source=v;},set voted(v){if(v){this.addClass("voted");}else{this.removeClass("voted");}},get voted(){return this.hasClass('voted');}};FunUI.traits.rankInGame_mapList.itemRenderer={_checkbox:null,_valueField:null,_nameField:null,__init__:function __init__(){this.on('click',this.voteMap);this._valueField=this.querySelector('.voteValue');this._nameField=this.querySelector('.name');},render:function render(data,index){this._valueField.innerHTML=data.votes;this._nameField.innerHTML=data.name;this.tooltipData=data;var list=this.list;if(data.voted){list.voted=true;this.select();}else{this.deselect();}},voteMap:function voteMap(){if(this.list.voted){return;}var list=this.list;list.voted=true;network.send("map-vote$"+this.data.id);}};})();FunUI.layouts["resourceBar"]="<div id=\"resourceBar\"> <div class=\"resource gem\"> <div class=\"icon\"></div> <div class=\"value\"></div> <div class=\"F-Button buy buy-gem\"></div> </div> <div class=\"resource gold\"> <div class=\"icon\"></div> <div class=\"value\"></div> <div class=\"F-Button buy buy-gold\"></div> </div> <ul id=\"resourceBar_chestsList\" class=\"F-List\"> <li class=\"F-ItemRenderer chest_1\"> <div class=\"icon\"></div> <div class=\"amount\">6</div> <div class=\"countdown\"> <span class=\"label\">_(chests.noChest)</span> </div> <div class=\"F-Button open\">_(chests.open)</div> </li> </ul> <ul id=\"resourceBar_dailyQuestSidebar\" class=\"F-List\"> <li class=\"F-ItemRenderer quest_1\"> <div class=\"bgimg\"> <div class=\"questTitle\"></div> <div class=\"haveQuest\"> <img class=\"icon\" width=\"56\" height=\"38\"> <label class=\"amount\">6</label> </div> <img class=\"completed\"> </div> <div class=\"hover\"></div> </li> </ul> <div class=\"chest_tip\">_(resourceBar.chest.tip)</div> </div>";(function(){var chests=new F$ArrayView();var quests=new F$ArrayView();var cdInterval;var countingHandlers=[];FunUI.traits.resourceBar={_goldField:null,_chestTip:null,__init__:function __init__(){this._goldField=this.querySelector('.resource.gold .value');this._gemField=this.querySelector('.resource.gem .value');this._chestTip=this.querySelector('.chest_tip');this._chestTip.on('click',this.hideChestTip);if(localStorage.getItem("showedChestTip")||loginData&&loginData.new_player){this.hideChestTip();}this.refresh();},refresh:function refresh(){if(this._goldField){this._goldField.innerHTML=pl_gold;}if(this._gemField){this._gemField.innerHTML=pl_gem;var gemDisplay='none';if(!pl_gem&&!isSteam&&loginData&&!loginData.steam_bind){gemDisplay='inline-block';}this.querySelector('.F-Button.buy-gem').style.display=gemDisplay;}if(FacebookUtils.authInfo){this.addClass("loggedInFB");}else{this.removeClass("loggedInFB");}chests.source=treasureChests;},show:function show(){document.body.appendChild(this);if(!cdInterval){cdInterval=setInterval(this.countdown,100);}this.refresh();},hide:function hide(){if(this.parentNode){clearInterval(cdInterval);cdInterval=0;this.parentNode.removeChild(this);}},countdown:function countdown(){for(var i=0;i<countingHandlers.length;i++){countingHandlers[i]();}},"<Observer event='click' selector='.F-Button.buy-gold' />":function ObserverEventClickSelectorFButtonBuyGold(){F$('shop').show();},"<Observer event='click' selector='.F-Button.buy-gem' />":function ObserverEventClickSelectorFButtonBuyGem(){F$('steamGem').show();},showChestTip:function showChestTip(){if(!this._chestTip.parentNode){this.appendChild(this._chestTip);F$('resourceBar_chestsList').off('mouseover',this.showChestTip);F$('resourceBar_chestsList').on('mouseout',this.hideChestTip);}},hideChestTip:function hideChestTip(){this.removeChild(this._chestTip);F$('resourceBar_chestsList').on('mouseover',this.showChestTip);F$('resourceBar_chestsList').off('mouseout',this.hideChestTip);if(!localStorage.getItem("showedChestTip")){localStorage.setItem("showedChestTip","true");}}};FunUI.traits.resourceBar_chestsList={dataProvider:chests};FunUI.traits.resourceBar_chestsList.itemRenderer={_amountField:null,_countdownLabel:null,_buttonSpeedUp:null,_timeout:null,__init__:function __init__(){this._amountField=this.querySelector('.amount');this._countdownLabel=this.querySelector('.countdown>.label');},render:function render(data){this.className=this.className.replace(/chest_\d+/g,"");this.addClass("chest_"+data.id);var myChest=pl_chests[data.id];var count=myChest?myChest.count:0;this._amountField.innerHTML=count;setTimeout(this.countdown,0);},countdown:function countdown(){var myChest=pl_chests[this.data.id];var count=myChest?myChest.count:0;if(count==0){this.removeClass("openable");return;}var countdownIndex=countingHandlers.indexOf(this.countdown);var openTime=myChest.openTime*1000;if(openTime>=serverTime()){this._countdownLabel.innerHTML=formatCountdown(openTime);if(countdownIndex<0){countingHandlers.push(this.countdown);}this.removeClass("openable");}else{if(countdownIndex>=0){countingHandlers.splice(countdownIndex,1);}this.addClass("openable");}},"<Observer event='click' selector='.F-Button.open' />":function ObserverEventClickSelectorFButtonOpen(){slayOne.viewHelpers.showFullScreenLoading();network.send("openTreasureChest$"+this.data.id+'$'+parseInt(Date.now()/1000));}};FunUI.traits.resourceBar_dailyQuestSidebar={dataProvider:quests,refresh:function refresh(){quests.source=pl_daily_quests.quests;quests.invalidate();}};FunUI.traits.resourceBar_dailyQuestSidebar.itemRenderer={_quest:null,_icon:null,_amount:null,_haveQuest:null,_completed:null,__init__:function __init__(){this._quest=this.querySelector('.questTitle');this._icon=this.querySelector('.icon');this._amount=this.querySelector('.amount');this._haveQuest=this.querySelector('.haveQuest');this._completed=this.querySelector('.completed');this.on('click',function(){F$("dailyQuest").open();});},render:function render(data){this._quest.innerText=slayOne.widgets.lang.get('dailyQuestSidebar.quest');if(data==null){this._haveQuest.style.display='none';return;}this._icon.src=window.ResourcePath+"imgs/dailyQuest/"+data.type+".png";this._haveQuest.style.display='block';this._amount.innerText=data.count+'/'+data.total;this._completed.src=window.ResourcePath+"imgs/dailyQuest/completed.png";if(data.completed){this._amount.style.display='none';this._completed.style.display='block';}else{this._amount.style.display='block';this._completed.style.display='none';}}};})();FunUI.layouts["respawn"]="<div id=\"respawn\" class=\"F-Window waiting\" data-drawing-bg=\"false\"> <div class=\"F-Button close\"><div class=\"hover lite\"></div></div> <h2>_(respawn.promo)</h2> <input class=\"inviteLink\" type=\"text\" readonly=\"readonly\" value=\"\"> <div class=\"buttonBar\"> <div class=\"F-Button link\">_(respawn.btn.copy_link.label)</div> <div class=\"F-Button socialMedia fb\"></div> <div class=\"F-Button socialMedia tw\"></div> </div> <hr> <div class=\"killer\">_(respawn.slayed_by) <span class=\"name\"></span></div> <div class=\"waiting statusDesc\">_(respawn.countdown.not_ready) <span class=\"counter\">0.9</span> </div> <div class=\"ready statusDesc\">_(respawn.countdown.ready)</div> <div class=\"F-Button respawn light\">_(respawn.btn.respawn.label)</div> <div class=\"F-Button help light darkGreen\">_(respawn.btn.help.label)</div> </div>";(function(){FunUI.traits.respawn={_gameLink:null,_linkInput:null,_forceHide:false,_killerNameLabel:null,_buttonRespawn:null,_counterLabel:null,_timeTillRespawn:null,__init__:function __init__(){this._linkInput=this.querySelector('.inviteLink');this._killerNameLabel=this.querySelector('.killer>.name');this._buttonRespawn=this.querySelector('.F-Button.respawn');if(typeof sendRespawn=='function'){this._buttonRespawn.on('click',sendRespawn);}this._counterLabel=this.querySelector('.counter');this.querySelector('.F-Button.link').on('click',this.copyLink);this.querySelector('.F-Button.help').on('click',window.showTutorialWindow_);this.on(FunUI.events.REMOVE_POP_UP,this.showMini);},show:function show(killerName){this._forceHide=false;this._gameLink=getCurrentGameLink();this._linkInput.value=this._gameLink;if(!killerName){killerName="zombie";}this._killerNameLabel.innerHTML=killerName;this.open();},copyLink:function copyLink(){copyInput(this._linkInput);},"<Observer event='click' selector='.F-Button.socialMedia.fb' />":function ObserverEventClickSelectorFButtonSocialMediaFb(){shareToFacebook(this._gameLink);},"<Observer event='click' selector='.F-Button.socialMedia.tw' />":function ObserverEventClickSelectorFButtonSocialMediaTw(){shareToTwiter(this._gameLink);},progress:function progress(timeTillRespawn){this._timeTillRespawn=timeTillRespawn;if(!this.parentNode){if(F$('respawnMini').parentNode){F$('respawnMini').progress(timeTillRespawn);}return;}if(timeTillRespawn>0){if(!this._buttonRespawn.disabled){this.addClass('waiting');this.removeClass('ready');this._buttonRespawn.disabled=true;}var respawnTimeStr=timeTillRespawn.toString();if(respawnTimeStr.indexOf(".")<0){respawnTimeStr+=".0";}this._counterLabel.innerHTML=respawnTimeStr;}else if(timeTillRespawn==0){this.addClass('ready');this.removeClass('waiting');this._buttonRespawn.disabled=false;}},showMini:function showMini(){if(!this._forceHide){F$('respawnMini').show();if(this._timeTillRespawn<=0){F$('respawnMini').progress(0);}}},hide:function hide(force){this._forceHide=force;this.close();}};})();FunUI.layouts["respawnMini"]="<div id=\"respawnMini\" class=\"waiting\"> <div class=\"F-Button green tiny respawn\">_(respawnMini.respawn)</div> <span class=\"ready statusDesc\">_(respawnMini.status.ready)</span> <span class=\"waiting statusDesc\"> _(respawnMini.status.no_ready) <br> <span class=\"counter\">0.9</span> </span> <div class=\"F-Button spread\"></div> </div>";(function(){FunUI.traits.respawnMini={_timeTillRespawn:null,_buttonRespawn:null,_counterLabel:null,__init__:function __init__(){this._counterLabel=this.querySelector('.counter');this._buttonRespawn=this.querySelector('.F-Button.respawn');if(window.sendRespawn){this._buttonRespawn.on('click',sendRespawn);}this._spreadButton=this.querySelector('.F-Button.spread');this._spreadButton.on('click',this.hide.bind(this,false));},show:function show(){document.getElementById("menuButtonContainer").appendChild(this);},hide:function hide(force){if(this.parentNode){this.parentNode.removeChild(this);}if(!force){F$('respawn').open();if(this._timeTillRespawn<=0){F$('respawn').progress(0);}}},progress:function progress(timeTillRespawn){this._timeTillRespawn=timeTillRespawn;if(!this.parentNode){return;}if(timeTillRespawn>0){if(!this._buttonRespawn.disabled){this.addClass('waiting');this.removeClass('ready');this._buttonRespawn.disabled=true;}var respawnTimeStr=timeTillRespawn.toString();if(respawnTimeStr.indexOf(".")<0){respawnTimeStr+=".0";}this._counterLabel.innerHTML=respawnTimeStr;}else if(timeTillRespawn==0){this.addClass('ready');this.removeClass('waiting');this._buttonRespawn.disabled=false;}}};})();FunUI.layouts["result"]="<div id=\"result\"> <h2>_(result.title)</h2> <div class=\"gameInfo reward\"> <div class=\"rankInfo\">_(result.desc.rank)</div> <div class=\"score\"> <span class=\"label\">_(result.label.score)</span> <span class=\"value\">1200</span> </div> <div class=\"souls\"> <span class=\"label\">_(result.label.souls)</span> <span class=\"value\">1200</span> </div> <div class=\"kills\"> <span class=\"label\">_(result.label.kill)</span> <span class=\"value\">1200</span> </div> <div class=\"deaths\"> <span class=\"label\">_(result.label.deaths)</span> <span class=\"value\">1200</span> </div> <div class=\"gold\" data-tooltip-data=\"_(result.tooltip.gold)\"> <span class=\"label\">_(result.label.gold)</span> <span class=\"value\">1200</span> </div> </div> <div class=\"chest reward\"> <h3>_(result.reward.title)</h3> <img class=\"icon center\"> <div class=\"name\"></div> <div class=\"noChest\">_(result.reward.noChest)</div> </div> <fieldset class=\"accountInfo\"> <legend>_(result.label.level)</legend> <div class=\"levelInfo\"> <span class=\"current\">Lv2</span> <span class=\"expInfo\"> <span class=\"increasedExp\">600</span> <span class=\"expLabel\">_(result.label.exp)</span> </span> <span class=\"next\">Lv3</span> </div> <div class=\"F-ProgressBar\"> <div class=\"indicator\"></div> <div class=\"indicator second\"></div> </div> </fieldset> <div> <div class=\"F-Button norm blue fb\">_(result.share)</div> <div class=\"F-Button norm save\">_(result.button.save)</div> <div class=\"F-Button norm keep\">_(result.button.keep)</div> <div class=\"F-Button norm close\">_(result.button.close)</div> </div> </div>";(function(){FunUI.traits.result={_levelProgressBar:null,_rankField:null,_scoreArea:null,_scoreField:null,_soulsArea:null,_soulsField:null,_killsField:null,_deathsField:null,_currentLevelField:null,_nextLevelField:null,_increasedExpField:null,_goldArea:null,_goldField:null,_keepButton:null,_chestArea:null,_chestNameField:null,_chestIconField:null,__init__:function __init__(){this._levelProgressBar=this.querySelector('.accountInfo .F-ProgressBar');this.querySelector('.F-Button.save').on('click',saveReplay);this._rankField=this.querySelector('.rankInfo');this._scoreArea=this.querySelector('.gameInfo .score');this._scoreField=this.querySelector('.gameInfo .score .value');this._soulsArea=this.querySelector('.gameInfo .souls');this._soulsField=this.querySelector('.gameInfo .souls .value');this._killsField=this.querySelector('.gameInfo .kills .value');this._deathsField=this.querySelector('.gameInfo .deaths .value');this._currentLevelField=this.querySelector('.levelInfo .current');this._nextLevelField=this.querySelector('.levelInfo .next');this._increasedExpField=this.querySelector('.increasedExp');this._goldArea=this.querySelector('.gameInfo>.gold');this._goldField=this.querySelector('.gameInfo>.gold>.value');this._keepButton=this.querySelector('.F-Button.keep');this._chestArea=this.querySelector('.chest.reward');this._chestNameField=this._chestArea.querySelector('.name');this._chestIcon=this._chestArea.querySelector('img');},show:function show(data){FunUI.managers.PopUpManager.addPopUp(this,data.exit);if(game.ticksCounter<0){if(game.type.showTop3&&game.type.winningCondition){this._rankField.innerHTML=F_('result.desc.rank',{rank:game.myRank});}else{this._rankField.innerHTML=game.victoryMsg;}}else{this._rankField.innerHTML=F_('result.desc.noEnd');}if(game.type.souls){this._scoreArea.style.display="none";this._soulsArea.style.display="";this._soulsField.innerHTML=data.souls;}else{this._scoreArea.style.display="";this._soulsArea.style.display="none";this._scoreField.innerHTML=data.elo;}this._killsField.innerHTML=data.kills;this._deathsField.innerHTML=data.deaths;this._goldField.innerHTML=data.goldGained;if(data.chestId<0){this._chestArea.addClass('noChest');}else{this._chestArea.removeClass('noChest');var chest=treasureChests[data.chestId];this._chestIcon.src=ResourcePath+"imgs/chest/chest_"+data.chestId+".png";this._chestNameField.innerHTML=getChestName(data.chestId);}this._currentLevelField.innerHTML="Lv"+pl_lvl;this._nextLevelField.innerHTML="Lv"+(pl_lvl+1);var xp1=pl_xp-getTotalXPRequiredForLvl(pl_lvl);var xp2=getXPRequiredForLvl(pl_lvl+1);this._increasedExpField.innerHTML=data.xpGained;this._levelProgressBar.setProgresses(xp2,xp1,xp1-data.xpGained);this._levelProgressBar.tooltipData=F_("result.tooltip.xp",{currentXp:xp1,nextLevelXp:xp2});this.data=data;if(game.mapId==TUTORIALS[1].mapId||data.exit){this._keepButton.style.display='none';}else{this._keepButton.style.display='';}},hide:function hide(){FunUI.managers.PopUpManager.removePopUp(this);},"<Observer event='click' selector='.F-Button.keep' /> ":function ObserverEventClickSelectorFButtonKeep(){F$('rankInGame').showRank();this.hide();},"<Observer event='click' selector='.F-Button.close' />":function ObserverEventClickSelectorFButtonClose(){this.hide();if(this.data.exit){exitGame();}else{attemptExitGame();}},"<Observer event='click' selector='.F-Button.fb' />":function ObserverEventClickSelectorFButtonFb(){shareToFacebook(getCurrentGameLink());}};})();FunUI.layouts["shop"]="<div id=\"shop\" class=\"F-Window\" data-modal=\"true\"> <h2 class=\"title\">_(shop.title)</h2> <ul class=\"content F-TabPage\" data-bar-align=\"left\" data-bar-offset-left=\"10\"> <li class=\"F-TabSubPage tabGold\"> <h3 class=\"title\">_(shop.title.gold)</h3> <ul id=\"shop_goldList\" class=\"F-List content\"> <li class=\"F-ItemRenderer\"> <div class=\"bg\"></div> <h4></h4> <img width=\"80\" height=\"80\"> <div class=\"F-Button buy\">500</div> </li> </ul> </li> <li class=\"F-TabSubPage tabGem\" data-disabled=\"true\"> <h3 class=\"title\">_(shop.title.gem)</h3> <ul class=\"F-List content\"> <li class=\"F-ItemRenderer\"></li> </ul> </li> <li class=\"F-TabSubPage tabSkin\" data-disabled=\"true\"> <h3 class=\"title\">_(shop.title.skin)</h3> <ul class=\"F-List content\"> <li class=\"F-ItemRenderer\"></li> </ul> </li> <li class=\"F-TabSubPage tabItem\" data-disabled=\"true\"> <h3 class=\"title\">_(shop.title.item)</h3> <ul class=\"F-List content\"> <li class=\"F-ItemRenderer\"></li> </ul> </li> </ul> <div class=\"F-Button close\"></div> </div>";(function(){var items=Object.values(window.sku);var goldItems=new F$ArrayView({source:items,filter:function filter(item){return item.type=='gold';}});FunUI.traits.shop={__init__:function __init__(){},show:function show(){this.open();}};FunUI.traits.shop_goldList={__init__:function __init__(){this.dataProvider=goldItems;}};FunUI.traits.shop_goldList.itemRenderer={_img:null,_titleField:null,_buttonBuy:null,__init__:function __init__(){this._img=this.querySelector('img');this._titleField=this.querySelector('h4');this._buttonBuy=this.querySelector('.F-Button.buy');},render:function render(data){this._img.src=window.ResourcePath+'imgs/icons/'+data.icon;this._titleField.innerHTML=data.amount;var price=data.prices[0];this._buttonBuy.label=price.currency+' '+price.amount/100;},"<Observer event='click' selector='.F-Button.buy' />":function ObserverEventClickSelectorFButtonBuy(){slayOne.viewHelpers.showFullScreenLoading();var data=this.data;var itemId=data.id;var that=this;pomelo.request('lobby.orderHandler.order',{itemId:itemId},function(res){if(res.result==0){var product='https://'+window.location.host+'/shop/sku/'+itemId+'?lang='+slayOne.widgets.lang.locale+'&v='+window.skuVersions[data.id];FB.ui({method:'pay',action:'purchaseitem',product:product,quantity:1,request_id:res.orderId},function(data){if(!data){return;}if(!data.error_code){if(window.debugMode==3){console.log("payment:",data);}network.addMessageListener(NetworkMessages.Refresh,that.hideLoading);network.addMessageListener(NetworkMessages.OrderTimeout,that.hideLoading);network.send('waitOrder$'+data.request_id+"$gold");}else{slayOne.viewHelpers.hideFullScreenLoading();console.error(data.error_message);}});}else{slayOne.viewHelpers.hideFullScreenLoading();slayOne.viewHelpers.showFloatTip({tipType:'error',content:res.msg});}});},hideLoading:function hideLoading(){slayOne.viewHelpers.hideFullScreenLoading();network.removeMessageListener(NetworkMessages.OrderTimeout,this.hideLoading);network.removeMessageListener(NetworkMessages.Refresh,this.hideLoading);}};})();FunUI.layouts["steamBindEnd"]="<div id=\"steamBindEnd\" class=\"fullscreen-bg\"> <div class=\"F-Window\" data-modal=\"true\"> <h2 class=\"title\">_(steam.binding.title)</h2> <div class=\"F-Button close\"></div> <div class=\"content\"> <p>_(steam.binding.endText1)</p> <p>_(steam.binding.endText2)</p> <p>_(steam.binding.endText3)</p> <div class=\"F-TextInput\"></div> <div class=\"F-Button huge\">_(steam.binding.endBtn)</div> <p id=\"steamBindEndFeedback\">&#xA0;</p> </div> </div> </div>";(function(){FunUI.traits.steamBindEnd={transCode:null,isSubmit:false,__init__:function __init__(){this.transCode=0;},"<Observer event='keypress' selector='.content > input' />":function ObserverEventKeypressSelectorContentInput(e){if(e.keyCode==13){this.submit();}},"<Observer event='click' selector='.content > .F-Button' />":function ObserverEventClickSelectorContentFButton(e){this.submit();},"<Observer event='click' selector='.close' />":function ObserverEventClickSelectorClose(){FunUI.managers.PopUpManager.removePopUp(this);},submit:function submit(){if(isSteamBindSend){return;}var code=this.querySelector('input[type=text]').value.trim();if(!/^st\d{5,20}_\d{9}$/.test(code)){this.message(F_('steam.binding.endError'));return;}var btn=this.querySelector('.content > .F-Button');if(btn){btn.className=btn.className.replace(/ disabled/,'')+' disabled';}isSteamBindSend=true;network.send('steamBind$'+code);this.message(F_('wait'));},message:function message(s){var o=document.getElementById('steamBindEndFeedback');o.innerText=s;},show:function show(){slayOne.views.optionsScreen.hideWindow();FunUI.managers.PopUpManager.addPopUp(this,false,FunUI.utils.LAYER_TOP);}};})();FunUI.layouts["steamBindStart"]="<div id=\"steamBindStart\" class=\"fullscreen-bg\"> <div class=\"F-Window\" data-modal=\"true\"> <h2 class=\"title\">_(steam.binding.title)</h2> <div class=\"F-Button close\"></div> <div class=\"content\"> <p>_(steam.binding.startText1)</p> <p>_(steam.binding.startText2)</p> <div class=\"F-TextInput\"></div> <div class=\"F-Button huge\">_(steam.binding.startBtn)</div> </div> </div> </div>";(function(){FunUI.traits.steamBindStart={transCode:null,__init__:function __init__(){this.transCode=0;},"<Observer event='click' selector='.close' />":function ObserverEventClickSelectorClose(){FunUI.managers.PopUpManager.removePopUp(this);},show:function show(){slayOne.views.optionsScreen.hideWindow();FunUI.managers.PopUpManager.addPopUp(this,false,FunUI.utils.LAYER_TOP);var box=document.getElementById('steamBindStart').querySelector('div.content');var v='st'+SteamTransData.steam_id+'_'+SteamTransData.trans_rand;var input=box.querySelector('input[type=text]');input.value=v;input.onchange=function(){input.value=v;};input.onfocus=function(){input.select();};box.querySelector('.F-Button').onclick=function(){input.value=v;input.focus();input.select();document.execCommand('copy');};}};})();FunUI.layouts["steamGem"]="<div id=\"steamGem\" class=\"fullscreen-bg\"> <div class=\"F-Window\" data-modal=\"true\"> <h2 class=\"title\">_(steam.gemGuide.title)</h2> <div class=\"F-Button close\"></div> <div class=\"content\"> <p>_(steam.gemGuide.text1)</p> <p>_(steam.gemGuide.text2)</p> <p>_(steam.gemGuide.text3)</p> <p>_(steam.gemGuide.text4)</p> <a class=\"F-Button huge\" href=\"https://store.steampowered.com/app/743350/Slayone/?utm_source=official&amp;utm_term=buy-gem\" target=\"_blank\">_(steam.shopName)</a> </div> </div> </div>";(function(){FunUI.traits.steamGem={_showTime:null,__init__:function __init__(){},show:function show(){FunUI.managers.PopUpManager.addPopUp(this,false,FunUI.utils.LAYER_TOP);this._showTime=Date.now();},"<Observer event='click'/>":function ObserverEventClick(){if(Date.now()-this._showTime>=1000){FunUI.managers.PopUpManager.removePopUp(this);}}};})();FunUI.layouts["tooltipMap"]="<div id=\"tooltipMap\" class=\"F-Tooltip\"> <h2>Courtuard</h2> <div class=\"summary\"> <img width=\"100\"> <div class=\"size\">2*2</div> </div> <div class=\"voteInfo\"> <span class=\"label\">_(tooltipMap.voteInfo.label)</span> <span class=\"value\">6</span> </div> <div class=\"type\">Deathmacth</div> </div>";(function(){FunUI.traits.tooltipMap={_titleField:null,_img:null,_imgForLoad:null,_voteField:null,_typeField:null,_sizeField:null,__init__:function __init__(){this._titleField=this.querySelector('h2');this._voteField=this.querySelector('.voteInfo .value');this._typeField=this.querySelector('.type');this._img=this.querySelector('img');this._imgForLoad=new Image();this._imgForLoad.on("load",this.setImage);this._sizeField=this.querySelector('.size');},render:function render(data){this._img.src=ResourcePath+"imgs/main_ui/map_placeholder.png";this._titleField.innerHTML=data.name;this._voteField.innerHTML=data.votes;this._typeField.innerHTML=MAP_TYPE_SETTINGS[data.type].name;this._sizeField.innerHTML=data.w+"x"+data.h;this._img.src=getMapThumbnail(data.id,data.version);},setImage:function setImage(){if(this._imgForLoad.naturalWidth==1&&this._imgForLoad.naturalHeight==1){return;}this._img.src=this._imgForLoad.src;}};})();FunUI.layouts["tooltipSimple"]="<div id=\"tooltipSimple\" class=\"F-Tooltip\"> </div>";(function(){FunUI.traits.tooltipSimple={__init__:function __init__(){}};})();FunUI.layouts["welcome"]="<div class=\"F-Window\" id=\"welcome\"> <canvas class=\"figure\" width=\"252\" height=\"276\"></canvas> <div class=\"greeting\">_(welcome.greeting)</div> <div class=\"logo\"></div> <p class=\"question\">_(welcome.question)</p> <div class=\"buttonBar\"> <div class=\"F-Button large new\">_(welcome.button.new)</div> <div class=\"F-Button large old\">_(home.buttons.login.label)</div> </div> </div>";(function(){var FIGURE_WIDTH=63;var FIGURE_HEIGHT=59;function FigureAnimation(canvas){var source=window.ResourcePath+"imgs/welcome/figure.png";this._canvas=canvas;this._context=canvas.getContext("2d");var that=this;this._img=new Image();this._img.on("load",function(){that._loaded=true;});this._img.src=source;this._blinkIndex=-1;this._talkIndex=-1;this._interval=0;this._figureDrew=false;}FigureAnimation.prototype.resetBlinking=function(){this._blinkIndex=-Math.round(Math.random()*50);};FigureAnimation.prototype.resetTalking=function(){this._talkIndex=-Math.round(Math.random()*50);};FigureAnimation.prototype.drawEye=function(){if(this._blinkIndex<0||this._blinkIndex>2){return false;}var index=this._blinkIndex==2?0:this._blinkIndex;this._context.drawImage(this._img,FIGURE_WIDTH*(1+index),0,FIGURE_WIDTH,FIGURE_HEIGHT,0,0,FIGURE_WIDTH*4,FIGURE_HEIGHT*4);return true;};FigureAnimation.prototype.drawMouth=function(){if(this._talkIndex<0||this._talkIndex>5){return false;}var baseIndex=Math.floor(this._talkIndex/2);var index=baseIndex==2?0:baseIndex;this._context.drawImage(this._img,FIGURE_WIDTH*(3+index),0,FIGURE_WIDTH,FIGURE_HEIGHT,0,0,FIGURE_WIDTH*4,FIGURE_HEIGHT*4);return true;};FigureAnimation.prototype.start=function(){if(this._interval){return;}this.resetBlinking();this.resetTalking();this._interval=setInterval(FunUI.utils.getBoundMethod(this,"animate"),50);};FigureAnimation.prototype.animate=function(){if(!this._loaded){return;}if(this._blinkIndex>=0||this._talkIndex>=0){this._context.mozImageSmoothingEnabled=false;this._context.msImageSmoothingEnabled=false;this._context.imageSmoothingEnabled=false;this._context.clearRect(0,0,this._canvas.width,this._canvas.height);this._context.drawImage(this._img,0,0,FIGURE_WIDTH,FIGURE_HEIGHT,0,0,FIGURE_WIDTH*4,FIGURE_HEIGHT*4);if(!this.drawEye()){this.resetBlinking();}if(!this.drawMouth()){this.resetTalking();}}else if(!this._figureDrew){this._context.mozImageSmoothingEnabled=false;this._context.msImageSmoothingEnabled=false;this._context.imageSmoothingEnabled=false;this._context.drawImage(this._img,0,0,FIGURE_WIDTH,FIGURE_HEIGHT,0,0,FIGURE_WIDTH*4,FIGURE_HEIGHT*4);}this._figureDrew=true;this._blinkIndex++;this._talkIndex++;};FigureAnimation.prototype.stop=function(){clearInterval(this._interval);this._interval=0;};FunUI.traits.welcome={_figureAnimation:null,__init__:function __init__(){this._figureAnimation=new FigureAnimation(this.querySelector('.figure'));if(this.parentNode){this.startAnimation();}else{this.on(FunUI.events.ADD_POP_UP,this.startAnimation);}},startAnimation:function startAnimation(){this._figureAnimation.start();this.on(FunUI.events.REMOVE_POP_UP,this.stopAnimation);},stopAnimation:function stopAnimation(){this._figureAnimation.stop();this.off(FunUI.events.REMOVE_POP_UP,this.stopAnimation);},"<Observer event='click' selector='.F-Button.new' />":function ObserverEventClickSelectorFButtonNew(){gaEventOnce('player-choose-tutorial');localStorage.setItem('showedTutorialHint',true);startTutorial();this.close();},"<Observer event='click' selector='.F-Button.old' />":function ObserverEventClickSelectorFButtonOld(){uiManager.showLogin();gaEventOnce('player-choose-login');this.close();}};})();resize();window.onresize=resize;var network=null;var game=null;var inBattle=false;var KeyManager=isMobile?new KeyManagerMobile():new KeyManager();F_=slayOne.widgets.lang.get.bind(slayOne.widgets.lang);if(typeof blockAdBlock!=='undefined'){blockAdBlock.onDetected(function(){blockAdBlock=undefined;});blockAdBlock.check(true);}var uiManager=new UIManager();var imgs={legs:loadImage(window.ResourcePath+"imgs/legs.png"),heads:loadImage(window.ResourcePath+"imgs/heads.png"),hands:loadImage(window.ResourcePath+"imgs/hands.png"),throwHands:loadImage(window.ResourcePath+"imgs/throw_hands.png"),shadow:loadImage(window.ResourcePath+"imgs/shadow.png"),miscSheet:loadImage("./miscSheet.png"),tileSheet:loadImage("./tileSheet.png"),weaponsPlus:loadImage(window.ResourcePath+"imgs/weaponsPlus.png"),weaponsMinus:loadImage(window.ResourcePath+"imgs/weaponsMinus.png"),weaponsBodyPlus:loadImage(window.ResourcePath+"imgs/weaponsBodyPlus.png"),weaponsBodyMinus:loadImage(window.ResourcePath+"imgs/weaponsBodyMinus.png"),zombieDeath:loadImage(window.ResourcePath+"imgs/zombie-death.png"),turnZombie:loadImage(window.ResourcePath+"imgs/turn-zombie.png"),rangedZombie:loadImage(window.ResourcePath+"imgs/rangedZombie.png"),crawler:loadImage(window.ResourcePath+"imgs/spider.png"),humanBoss:loadImage(window.ResourcePath+"imgs/human_boss.png"),zombieBoss:loadImage(window.ResourcePath+"imgs/zombie_boss.png")};ressourceLoaded();var soundManager=new SoundManager();(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-78888548-1','auto');ga('send','pageview');var gaLastEventTime={};var gaEventOnce=function gaEventOnce(action){if(!action){console.error('gaEventOnce: invalid action');return;}var category='default';if(FacebookUtils.embeddedInCanvas){category='facebook';}var key=category+':'+action;if(gaLastEventTime[key]&&Date.now()-gaLastEventTime[key]<10000){return;}if(localStorage.getItem(key)){return;}var udid=localStorage.getItem("udid");if(udid&&udid.length>4){if(udid[3]!='#'){return;}}gaLastEventTime[key]=Date.now();var params={hitCallback:function hitCallback(){localStorage.setItem(key,true);}};ga('send','event',category,action,params);};var isTutorialMap=function isTutorialMap(mapId){return mapId==1;};var watchGameplayTime=function watchGameplayTime(timePointList,gameCreateTime,groupName){for(var i=0;i<timePointList.length;i++){(function(t){var eventName=groupName+'-played-'+t+'-seconds';if(localStorage.getItem(eventName)){return;}setTimeout(function(){if(!game||game.ctime!=gameCreateTime){return;}gaEventOnce(eventName);},t*1000);})(timePointList[i]);}};var isDebugLoop=false;var debugLoop=function debugLoop(){if(isDebugLoop){return false;}isDebugLoop=true;window.setInterval(function(){console.log('debug obj num',JSON.stringify(debugGameObjNum()));},1000);};var debugGameObjNum=function debugGameObjNum(){return{objectsToDraw:game.objectsToDraw.length,effects:game.effects.length,objects:game.objects.length,corpses:game.corpses.length,zombies:game.zombies.length,grenades:game.grenades.length,projectiles:game.projectiles.length,movableObjects:game.movableObjects.length};};window.setInterval(function(){if(document.hidden){return;}if(!game||!game.pingShow||!game.isGaming()){return;}if(game.fps<2||game.ping<2){return;}if(!debugMode){F$ajax.post('https://slayone.soulogic.com/analytics-post',null,JSON.stringify({db_id:db_id,fps:game.fps,ping:game.ping,map:game.map.name,tick:game.ticksCounter,region:network.connectedServerIndex,low_effect:game.isLowGraphicEffect|0,num:debugGameObjNum(),ts:Date.now()}));}(function(){if(game.isLowGraphicEffect){return;}if(game.fpsAvg<2){return;}if(localStorage.getItem('graphicSettings')!==null){return;}if(localStorage.getItem('LowGraphicEffectChecked')|0){return;}var history=localStorage.getItem('LowGraphicEffectCheckHistory')||'';if(history.length>0){history+=',';}history+=game.fpsAvg;localStorage.setItem('LowGraphicEffectCheckHistory',history);if(history.length<5){return;}history=history.split(',').splice(0,5);if(history.length<5){return;}var count=0;history.map(function(i){if((i|0)<55){count++;}});if(count>3){localStorage.setItem('graphicSettings',0);}localStorage.setItem('LowGraphicEffectChecked',1);})();},300000);slayOne.viewHelpers.showAd();
//# sourceMappingURL=combo.js.map
